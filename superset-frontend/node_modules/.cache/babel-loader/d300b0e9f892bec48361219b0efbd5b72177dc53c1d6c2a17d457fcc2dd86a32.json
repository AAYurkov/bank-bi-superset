{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport { testWithId } from 'src/utils/testUtils';\nimport { useSelector } from 'react-redux';\nimport { createSelector } from '@reduxjs/toolkit';\nexport const getOnlyExtraFormData = (data) => Object.values(data).reduce((prev, next) => ({ ...prev, [next.id]: next.extraFormData }), {});\nexport const checkIsMissingRequiredValue = (filter, filterState) => {var _filter$controlValues;\n  const value = filterState == null ? void 0 : filterState.value;\n  // TODO: this property should be unhardcoded\n  return ((_filter$controlValues = filter.controlValues) == null ? void 0 : _filter$controlValues.enableEmptyFilter) && (\n  value === null || value === undefined);\n};\nexport const checkIsValidateError = (dataMask) => {\n  const values = Object.values(dataMask);\n  return values.every((value) => {var _value$filterState;return ((_value$filterState = value.filterState) == null ? void 0 : _value$filterState.validateStatus) !== 'error';});\n};\nexport const checkIsApplyDisabled = (dataMaskSelected, dataMaskApplied, filters) => {\n  if (!checkIsValidateError(dataMaskSelected)) {\n    return true;\n  }\n  const dataSelectedValues = Object.values(dataMaskSelected);\n  const dataAppliedValues = Object.values(dataMaskApplied);\n  return areObjectsEqual(getOnlyExtraFormData(dataMaskSelected), getOnlyExtraFormData(dataMaskApplied), { ignoreUndefined: true }) ||\n  dataSelectedValues.length !== dataAppliedValues.length ||\n  filters.some((filter) => {var _dataMaskSelected$fil;return checkIsMissingRequiredValue(filter, dataMaskSelected == null ? void 0 : (_dataMaskSelected$fil = dataMaskSelected[filter == null ? void 0 : filter.id]) == null ? void 0 : _dataMaskSelected$fil.filterState);});\n};\nconst chartsVerboseMapSelector = createSelector([\n(state) => state.sliceEntities.slices,\n(state) => state.datasources],\n(slices, datasources) => Object.keys(slices).reduce((chartsVerboseMaps, chartId) => {var _slices$chartId;\n  const chartDatasource = (_slices$chartId = slices[chartId]) != null && _slices$chartId.datasource ?\n  datasources[slices[chartId].datasource] :\n  undefined;\n  return {\n    ...chartsVerboseMaps,\n    [chartId]: chartDatasource ? chartDatasource.verbose_map : {}\n  };\n}, {}));\nexport const useChartsVerboseMaps = () => useSelector(chartsVerboseMapSelector);__signature__(useChartsVerboseMaps, \"useSelector{}\", () => [useSelector]);\nexport const FILTER_BAR_TEST_ID = 'filter-bar';\nexport const getFilterBarTestId = testWithId(FILTER_BAR_TEST_ID);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(getOnlyExtraFormData, \"getOnlyExtraFormData\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts\");reactHotLoader.register(checkIsMissingRequiredValue, \"checkIsMissingRequiredValue\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts\");reactHotLoader.register(checkIsValidateError, \"checkIsValidateError\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts\");reactHotLoader.register(checkIsApplyDisabled, \"checkIsApplyDisabled\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts\");reactHotLoader.register(chartsVerboseMapSelector, \"chartsVerboseMapSelector\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts\");reactHotLoader.register(useChartsVerboseMaps, \"useChartsVerboseMaps\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts\");reactHotLoader.register(FILTER_BAR_TEST_ID, \"FILTER_BAR_TEST_ID\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts\");reactHotLoader.register(getFilterBarTestId, \"getFilterBarTestId\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["areObjectsEqual","testWithId","useSelector","createSelector","getOnlyExtraFormData","data","Object","values","reduce","prev","next","id","extraFormData","checkIsMissingRequiredValue","filter","filterState","_filter$controlValues","value","controlValues","enableEmptyFilter","undefined","checkIsValidateError","dataMask","every","_value$filterState","validateStatus","checkIsApplyDisabled","dataMaskSelected","dataMaskApplied","filters","dataSelectedValues","dataAppliedValues","ignoreUndefined","length","some","_dataMaskSelected$fil","chartsVerboseMapSelector","state","sliceEntities","slices","datasources","keys","chartsVerboseMaps","chartId","_slices$chartId","chartDatasource","datasource","verbose_map","useChartsVerboseMaps","__signature__","FILTER_BAR_TEST_ID","getFilterBarTestId","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/utils.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport { DataMaskStateWithId, Filter, FilterState } from '@superset-ui/core';\nimport { testWithId } from 'src/utils/testUtils';\nimport { RootState } from 'src/dashboard/types';\nimport { useSelector } from 'react-redux';\nimport { createSelector } from '@reduxjs/toolkit';\n\nexport const getOnlyExtraFormData = (data: DataMaskStateWithId) =>\n  Object.values(data).reduce(\n    (prev, next) => ({ ...prev, [next.id]: next.extraFormData }),\n    {},\n  );\n\nexport const checkIsMissingRequiredValue = (\n  filter: Filter,\n  filterState?: FilterState,\n) => {\n  const value = filterState?.value;\n  // TODO: this property should be unhardcoded\n  return (\n    filter.controlValues?.enableEmptyFilter &&\n    (value === null || value === undefined)\n  );\n};\n\nexport const checkIsValidateError = (dataMask: DataMaskStateWithId) => {\n  const values = Object.values(dataMask);\n  return values.every(value => value.filterState?.validateStatus !== 'error');\n};\n\nexport const checkIsApplyDisabled = (\n  dataMaskSelected: DataMaskStateWithId,\n  dataMaskApplied: DataMaskStateWithId,\n  filters: Filter[],\n) => {\n  if (!checkIsValidateError(dataMaskSelected)) {\n    return true;\n  }\n  const dataSelectedValues = Object.values(dataMaskSelected);\n  const dataAppliedValues = Object.values(dataMaskApplied);\n  return (\n    areObjectsEqual(\n      getOnlyExtraFormData(dataMaskSelected),\n      getOnlyExtraFormData(dataMaskApplied),\n      { ignoreUndefined: true },\n    ) ||\n    dataSelectedValues.length !== dataAppliedValues.length ||\n    filters.some(filter =>\n      checkIsMissingRequiredValue(\n        filter,\n        dataMaskSelected?.[filter?.id]?.filterState,\n      ),\n    )\n  );\n};\n\nconst chartsVerboseMapSelector = createSelector(\n  [\n    (state: RootState) => state.sliceEntities.slices,\n    (state: RootState) => state.datasources,\n  ],\n  (slices, datasources) =>\n    Object.keys(slices).reduce((chartsVerboseMaps, chartId) => {\n      const chartDatasource = slices[chartId]?.datasource\n        ? datasources[slices[chartId].datasource]\n        : undefined;\n      return {\n        ...chartsVerboseMaps,\n        [chartId]: chartDatasource ? chartDatasource.verbose_map : {},\n      };\n    }, {}),\n);\n\nexport const useChartsVerboseMaps = () =>\n  useSelector<RootState, { [chartId: string]: Record<string, string> }>(\n    chartsVerboseMapSelector,\n  );\n\nexport const FILTER_BAR_TEST_ID = 'filter-bar';\nexport const getFilterBarTestId = testWithId(FILTER_BAR_TEST_ID);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}