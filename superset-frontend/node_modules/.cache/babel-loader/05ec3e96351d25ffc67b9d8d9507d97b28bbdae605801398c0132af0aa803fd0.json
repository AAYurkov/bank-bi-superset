{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};import { ascending as d3ascending, quantile as d3quantile, sum as d3sum, mean as d3mean, min as d3min, max as d3max, median as d3median, variance as d3variance, deviation as d3deviation } from 'd3-array';\nimport sandboxedEval from '../utils/sandbox';\nexport function commonLayerProps(formData, setTooltip, setTooltipContent, onSelect) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y\n        });\n      } else\n      {\n        setTooltip(null);\n      }\n      return true;\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n      return true;\n    };\n  } else\n  if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o) => {\n      onSelect(o.object[fd.line_column]);\n      return true;\n    };\n  }\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover)\n  };\n}\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99\n};\n/* Supported d3-array functions */\nconst d3functions = {\n  sum: d3sum,\n  min: d3min,\n  max: d3max,\n  mean: d3mean,\n  median: d3median,\n  variance: d3variance,\n  deviation: d3deviation\n};\n/* Get a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(type = 'sum', accessor = null) {\n  if (type === 'count') {\n    return (arr) => arr.length;\n  }\n  let d3func;\n  if (type in percentiles) {\n    d3func = (arr, acc) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1, o2) => d3ascending(accessor(o1), accessor(o2)));\n      } else\n      {\n        sortedArr = arr.sort(d3ascending);\n      }\n      return d3quantile(sortedArr, percentiles[type], acc);\n    };\n  } else\n  if (type in d3functions) {\n    d3func = d3functions[type];\n  } else\n  {\n    throw new Error(`Unsupported aggregation type: ${type}`);\n  }\n  if (!accessor) {\n    return (arr) => d3func(arr);\n  }\n  return (arr) => d3func(arr.map((x) => accessor(x)));\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(commonLayerProps, \"commonLayerProps\", \"/Users/aryurkov/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx\");reactHotLoader.register(percentiles, \"percentiles\", \"/Users/aryurkov/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx\");reactHotLoader.register(d3functions, \"d3functions\", \"/Users/aryurkov/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx\");reactHotLoader.register(getAggFunc, \"getAggFunc\", \"/Users/aryurkov/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["ascending","d3ascending","quantile","d3quantile","sum","d3sum","mean","d3mean","min","d3min","max","d3max","median","d3median","variance","d3variance","deviation","d3deviation","sandboxedEval","commonLayerProps","formData","setTooltip","setTooltipContent","onSelect","fd","onHover","tooltipContentGenerator","js_tooltip","o","picked","content","x","y","onClick","js_onclick_href","href","window","open","table_filter","undefined","object","line_column","pickable","Boolean","percentiles","p1","p5","p95","p99","d3functions","getAggFunc","type","accessor","arr","length","d3func","acc","sortedArr","sort","o1","o2","Error","map","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS\n * OF ANY KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport {\n  ascending as d3ascending,\n  quantile as d3quantile,\n  sum as d3sum,\n  mean as d3mean,\n  min as d3min,\n  max as d3max,\n  median as d3median,\n  variance as d3variance,\n  deviation as d3deviation,\n} from 'd3-array';\nimport { JsonObject, JsonValue, QueryFormData } from '@superset-ui/core';\nimport sandboxedEval from '../utils/sandbox';\nimport { TooltipProps } from '../components/Tooltip';\n\nexport function commonLayerProps(\n  formData: QueryFormData,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n  setTooltipContent: (content: JsonObject) => ReactNode,\n  onSelect?: (value: JsonValue) => void,\n) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o: JsonObject) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y,\n        });\n      } else {\n        setTooltip(null);\n      }\n      return true;\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o: any) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n      return true;\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o: any) => {\n      onSelect(o.object[fd.line_column]);\n      return true;\n    };\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover),\n  };\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99,\n};\n\n/* Supported d3-array functions */\nconst d3functions: Record<string, any> = {\n  sum: d3sum,\n  min: d3min,\n  max: d3max,\n  mean: d3mean,\n  median: d3median,\n  variance: d3variance,\n  deviation: d3deviation,\n};\n\n/* Get a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(\n  type = 'sum',\n  accessor: ((object: any) => number | undefined) | null = null,\n) {\n  if (type === 'count') {\n    return (arr: number[]) => arr.length;\n  }\n\n  let d3func: (\n    iterable: Array<unknown>,\n    accessor?: (object: JsonObject) => number | undefined,\n  ) => number[] | number | undefined;\n\n  if (type in percentiles) {\n    d3func = (arr, acc: (object: JsonObject) => number | undefined) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1: JsonObject, o2: JsonObject) =>\n          d3ascending(accessor(o1), accessor(o2)),\n        );\n      } else {\n        sortedArr = arr.sort(d3ascending);\n      }\n\n      return d3quantile(\n        sortedArr,\n        percentiles[type as keyof typeof percentiles],\n        acc,\n      );\n    };\n  } else if (type in d3functions) {\n    d3func = d3functions[type];\n  } else {\n    throw new Error(`Unsupported aggregation type: ${type}`);\n  }\n\n  if (!accessor) {\n    return (arr: number[]) => d3func(arr);\n  }\n\n  return (arr: number[]) => d3func(arr.map(x => accessor(x)));\n}\n"],"mappings":"uSAmBA,SACEA,SAAS,IAAIC,WAAW,EACxBC,QAAQ,IAAIC,UAAU,EACtBC,GAAG,IAAIC,KAAK,EACZC,IAAI,IAAIC,MAAM,EACdC,GAAG,IAAIC,KAAK,EACZC,GAAG,IAAIC,KAAK,EACZC,MAAM,IAAIC,QAAQ,EAClBC,QAAQ,IAAIC,UAAU,EACtBC,SAAS,IAAIC,WAAW,QACnB,UAAU;AAEjB,OAAOC,aAAa,MAAM,kBAAkB;AAG5C,OAAM,SAAUC,gBAAgBA,CAC9BC,QAAuB,EACvBC,UAAsD,EACtDC,iBAAqD,EACrDC,QAAqC;EAErC,MAAMC,EAAE,GAAGJ,QAAQ;EACnB,IAAIK,OAAO;EACX,IAAIC,uBAAuB,GAAGJ,iBAAiB;EAC/C,IAAIE,EAAE,CAACG,UAAU,EAAE;IACjBD,uBAAuB,GAAGR,aAAa,CAACM,EAAE,CAACG,UAAU,CAAC;;EAExD,IAAID,uBAAuB,EAAE;IAC3BD,OAAO,GAAGA,CAACG,CAAa,KAAI;MAC1B,IAAIA,CAAC,CAACC,MAAM,EAAE;QACZR,UAAU,CAAC;UACTS,OAAO,EAAEJ,uBAAuB,CAACE,CAAC,CAAC;UACnCG,CAAC,EAAEH,CAAC,CAACG,CAAC;UACNC,CAAC,EAAEJ,CAAC,CAACI;SACN,CAAC;OACH;MAAM;QACLX,UAAU,CAAC,IAAI,CAAC;;MAElB,OAAO,IAAI;IACb,CAAC;;EAEH,IAAIY,OAAO;EACX,IAAIT,EAAE,CAACU,eAAe,EAAE;IACtBD,OAAO,GAAGA,CAACL,CAAM,KAAI;MACnB,MAAMO,IAAI,GAAGjB,aAAa,CAACM,EAAE,CAACU,eAAe,CAAC,CAACN,CAAC,CAAC;MACjDQ,MAAM,CAACC,IAAI,CAACF,IAAI,CAAC;MACjB,OAAO,IAAI;IACb,CAAC;GACF;EAAM,IAAIX,EAAE,CAACc,YAAY,IAAIf,QAAQ,KAAKgB,SAAS,EAAE;IACpDN,OAAO,GAAGA,CAACL,CAAM,KAAI;MACnBL,QAAQ,CAACK,CAAC,CAACY,MAAM,CAAChB,EAAE,CAACiB,WAAW,CAAC,CAAC;MAClC,OAAO,IAAI;IACb,CAAC;;EAGH,OAAO;IACLR,OAAO;IACPR,OAAO;IACPiB,QAAQ,EAAEC,OAAO,CAAClB,OAAO;GAC1B;AACH;AAEA,MAAMmB,WAAW,GAAG;EAClBC,EAAE,EAAE,IAAI;EACRC,EAAE,EAAE,IAAI;EACRC,GAAG,EAAE,IAAI;EACTC,GAAG,EAAE;CACN;AAED;AACA,MAAMC,WAAW,GAAwB;EACvC7C,GAAG,EAAEC,KAAK;EACVG,GAAG,EAAEC,KAAK;EACVC,GAAG,EAAEC,KAAK;EACVL,IAAI,EAAEC,MAAM;EACZK,MAAM,EAAEC,QAAQ;EAChBC,QAAQ,EAAEC,UAAU;EACpBC,SAAS,EAAEC;CACZ;AAED;AACA,OAAM,SAAUiC,UAAUA,CACxBC,IAAI,GAAG,KAAK,EACZC,QAAA,GAAyD,IAAI;EAE7D,IAAID,IAAI,KAAK,OAAO,EAAE;IACpB,OAAO,CAACE,GAAa,KAAKA,GAAG,CAACC,MAAM;;EAGtC,IAAIC,MAG8B;EAElC,IAAIJ,IAAI,IAAIP,WAAW,EAAE;IACvBW,MAAM,GAAGA,CAACF,GAAG,EAAEG,GAA+C,KAAI;MAChE,IAAIC,SAAS;MACb,IAAIL,QAAQ,EAAE;QACZK,SAAS,GAAGJ,GAAG,CAACK,IAAI,CAAC,CAACC,EAAc,EAAEC,EAAc,KAClD3D,WAAW,CAACmD,QAAQ,CAACO,EAAE,CAAC,EAAEP,QAAQ,CAACQ,EAAE,CAAC,CAAC,CACxC;OACF;MAAM;QACLH,SAAS,GAAGJ,GAAG,CAACK,IAAI,CAACzD,WAAW,CAAC;;MAGnC,OAAOE,UAAU,CACfsD,SAAS,EACTb,WAAW,CAACO,IAAgC,CAAC,EAC7CK,GAAG,CACJ;IACH,CAAC;GACF;EAAM,IAAIL,IAAI,IAAIF,WAAW,EAAE;IAC9BM,MAAM,GAAGN,WAAW,CAACE,IAAI,CAAC;GAC3B;EAAM;IACL,MAAM,IAAIU,KAAK,CAAC,iCAAiCV,IAAI,EAAE,CAAC;;EAG1D,IAAI,CAACC,QAAQ,EAAE;IACb,OAAO,CAACC,GAAa,KAAKE,MAAM,CAACF,GAAG,CAAC;;EAGvC,OAAO,CAACA,GAAa,KAAKE,MAAM,CAACF,GAAG,CAACS,GAAG,CAAC,CAAA/B,CAAC,KAAIqB,QAAQ,CAACrB,CAAC,CAAC,CAAC,CAAC;AAC7D,CAAC,mBAAAgC,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAC,OAAA,GAAA1B,SAAA,MAAAwB,cAAA,WAAAA,cAAA,CAAAG,QAAA,CA3Ge/C,gBAAgB,6HAAA4C,cAAA,CAAAG,QAAA,CA+C1BtB,WAAW,wHAAAmB,cAAA,CAAAG,QAAA,CAQXjB,WAAW,wHAAAc,cAAA,CAAAG,QAAA,CAWDhB,UAAU,+IAAAiB,WAAA,UAAAH,oBAAA,mBAAAA,oBAAA,CAAAG,WAAA,GAAA5B,SAAA,CAAA4B,WAAA,IAAAA,WAAA,CAAAC,MAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}