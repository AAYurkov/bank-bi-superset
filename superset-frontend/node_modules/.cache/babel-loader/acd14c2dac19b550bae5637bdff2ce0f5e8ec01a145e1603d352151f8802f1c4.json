{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { isAppliedCrossFilterType, isAppliedNativeFilterType, isNativeFilter } from '@superset-ui/core';\nfunction isGlobalScope(scope, slices) {\n  return scope.length === Object.keys(slices).length;\n}\nfunction getRelatedChartsForSelectFilter(slices, chartsInScope) {\n  // all have been selected, always apply\n  if (isGlobalScope(chartsInScope, slices)) {\n    return Object.keys(slices).map(Number);\n  }\n  const chartsInScopeSet = new Set(chartsInScope);\n  return Object.values(slices).reduce((result, slice) => {\n    if (chartsInScopeSet.has(slice.slice_id)) {\n      result.push(slice.slice_id);\n    }\n    return result;\n  }, []);\n}\nfunction getRelatedChartsForCrossFilter(filterKey, slices, scope) {\n  const sourceSlice = slices[filterKey];\n  if (!sourceSlice)\n  return [];\n  const fullScope = [\n  ...scope.filter((s) => String(s) !== filterKey),\n  Number(filterKey)];\n\n  const scopeSet = new Set(scope);\n  return Object.values(slices).reduce((result, slice) => {\n    if (slice.slice_id === Number(filterKey)) {\n      return result;\n    }\n    // Check if it's in the global scope\n    if (isGlobalScope(fullScope, slices)) {\n      result.push(slice.slice_id);\n      return result;\n    }\n    // Check if it's hand-picked in scope\n    if (scopeSet.has(slice.slice_id)) {\n      result.push(slice.slice_id);\n    }\n    return result;\n  }, []);\n}\nexport function getRelatedCharts(filterKey, filter, slices) {var _filter$chartsInScope;\n  let related = [];\n  const isCrossFilter = Object.keys(slices).includes(filterKey) && isAppliedCrossFilterType(filter);\n  const chartsInScope = Array.isArray(filter.scope) ?\n  filter.scope : (_filter$chartsInScope =\n  filter.chartsInScope) != null ? _filter$chartsInScope : [];\n  if (isCrossFilter) {\n    related = getRelatedChartsForCrossFilter(filterKey, slices, chartsInScope);\n  }\n  const nativeFilter = filter;\n  // on highlight, a standard native filter is passed\n  // on apply, an applied native filter is passed\n  if (!isCrossFilter ||\n  isAppliedNativeFilterType(nativeFilter) ||\n  isNativeFilter(nativeFilter)) {\n    related = getRelatedChartsForSelectFilter(slices, chartsInScope);\n  }\n  return related;\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(isGlobalScope, \"isGlobalScope\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/util/getRelatedCharts.ts\");reactHotLoader.register(getRelatedChartsForSelectFilter, \"getRelatedChartsForSelectFilter\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/util/getRelatedCharts.ts\");reactHotLoader.register(getRelatedChartsForCrossFilter, \"getRelatedChartsForCrossFilter\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/util/getRelatedCharts.ts\");reactHotLoader.register(getRelatedCharts, \"getRelatedCharts\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/util/getRelatedCharts.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["isAppliedCrossFilterType","isAppliedNativeFilterType","isNativeFilter","isGlobalScope","scope","slices","length","Object","keys","getRelatedChartsForSelectFilter","chartsInScope","map","Number","chartsInScopeSet","Set","values","reduce","result","slice","has","slice_id","push","getRelatedChartsForCrossFilter","filterKey","sourceSlice","fullScope","filter","s","String","scopeSet","getRelatedCharts","_filter$chartsInScope","related","isCrossFilter","includes","Array","isArray","nativeFilter","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/src/dashboard/util/getRelatedCharts.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  AppliedCrossFilterType,\n  AppliedNativeFilterType,\n  Filter,\n  isAppliedCrossFilterType,\n  isAppliedNativeFilterType,\n  isNativeFilter,\n} from '@superset-ui/core';\nimport { Slice } from 'src/types/Chart';\n\nfunction isGlobalScope(scope: number[], slices: Record<string, Slice>) {\n  return scope.length === Object.keys(slices).length;\n}\n\nfunction getRelatedChartsForSelectFilter(\n  slices: Record<string, Slice>,\n  chartsInScope: number[],\n): number[] {\n  // all have been selected, always apply\n  if (isGlobalScope(chartsInScope, slices)) {\n    return Object.keys(slices).map(Number);\n  }\n\n  const chartsInScopeSet = new Set(chartsInScope);\n\n  return Object.values(slices).reduce((result: number[], slice) => {\n    if (chartsInScopeSet.has(slice.slice_id)) {\n      result.push(slice.slice_id);\n    }\n    return result;\n  }, []);\n}\nfunction getRelatedChartsForCrossFilter(\n  filterKey: string,\n  slices: Record<string, Slice>,\n  scope: number[],\n): number[] {\n  const sourceSlice = slices[filterKey];\n\n  if (!sourceSlice) return [];\n\n  const fullScope = [\n    ...scope.filter(s => String(s) !== filterKey),\n    Number(filterKey),\n  ];\n  const scopeSet = new Set(scope);\n\n  return Object.values(slices).reduce((result: number[], slice) => {\n    if (slice.slice_id === Number(filterKey)) {\n      return result;\n    }\n    // Check if it's in the global scope\n    if (isGlobalScope(fullScope, slices)) {\n      result.push(slice.slice_id);\n      return result;\n    }\n    // Check if it's hand-picked in scope\n    if (scopeSet.has(slice.slice_id)) {\n      result.push(slice.slice_id);\n    }\n    return result;\n  }, []);\n}\n\nexport function getRelatedCharts(\n  filterKey: string,\n  filter: AppliedNativeFilterType | AppliedCrossFilterType | Filter,\n  slices: Record<string, Slice>,\n) {\n  let related: number[] = [];\n  const isCrossFilter =\n    Object.keys(slices).includes(filterKey) && isAppliedCrossFilterType(filter);\n\n  const chartsInScope = Array.isArray(filter.scope)\n    ? filter.scope\n    : ((filter as Filter).chartsInScope ?? []);\n\n  if (isCrossFilter) {\n    related = getRelatedChartsForCrossFilter(filterKey, slices, chartsInScope);\n  }\n\n  const nativeFilter = filter as AppliedNativeFilterType | Filter;\n  // on highlight, a standard native filter is passed\n  // on apply, an applied native filter is passed\n  if (\n    !isCrossFilter ||\n    isAppliedNativeFilterType(nativeFilter) ||\n    isNativeFilter(nativeFilter)\n  ) {\n    related = getRelatedChartsForSelectFilter(slices, chartsInScope);\n  }\n\n  return related;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}