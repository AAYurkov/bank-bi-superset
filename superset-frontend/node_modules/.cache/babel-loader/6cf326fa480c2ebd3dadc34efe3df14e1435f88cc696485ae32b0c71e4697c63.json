{"ast":null,"code":"import { css as _css } from \"@emotion/react\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { Component } from 'react';\nimport rison from 'rison';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { css, DatasourceType, isDefined, logging, styled, SupersetClient, t } from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport { Form, FormItem } from 'src/components/Form';\nimport Alert from 'src/components/Alert';\nimport Modal from 'src/components/Modal';\nimport { Radio } from 'src/components/Radio';\nimport Button from 'src/components/Button';\nimport { AsyncSelect } from 'src/components';\nimport Loading from 'src/components/Loading';\nimport { canUserEditDashboard } from 'src/dashboard/util/permissionUtils';\nimport { setSaveChartModalVisibility } from 'src/explore/actions/saveModalActions';\n// Session storage key for recent dashboard\nimport { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";const SK_DASHBOARD_ID = 'save_chart_recent_dashboard';\nexport const StyledModal = styled(Modal)`\n  .antd5-modal-body {\n    overflow: visible;\n  }\n  i {\n    position: absolute;\n    top: -${({ theme }) => theme.gridUnit * 5.25}px;\n    left: ${({ theme }) => theme.gridUnit * 26.75}px;\n  }\n`;\nclass SaveModal extends Component {\n  constructor(props) {var _props$datasource;\n    super(props);this.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    handleDatasetNameChange = (e) => {\n      // @ts-expect-error\n      this.setState({ datasetName: e.target.value });\n    };this.\n\n\n\n\n\n\n\n\n\n\n\n\n    handleRedirect = (windowLocationSearch, chart) => {\n      const searchParams = new URLSearchParams(windowLocationSearch);\n      searchParams.set('save_action', this.state.action);\n      if (this.state.action !== 'overwrite') {\n        searchParams.delete('form_data_key');\n      }\n      searchParams.set('slice_id', chart.id.toString());\n      return searchParams;\n    };this.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    loadDashboard = async (id) => {\n      const response = await SupersetClient.get({\n        endpoint: `/api/v1/dashboard/${id}`\n      });\n      return response.json.result;\n    };this.\n    loadDashboards = async (search, page, pageSize) => {\n      const queryParams = rison.encode({\n        columns: ['id', 'dashboard_title'],\n        filters: [\n        {\n          col: 'dashboard_title',\n          opr: 'ct',\n          value: search\n        },\n        {\n          col: 'owners',\n          opr: 'rel_m_m',\n          value: this.props.user.userId\n        }],\n\n        page,\n        page_size: pageSize,\n        order_column: 'dashboard_title'\n      });\n      const { json } = await SupersetClient.get({\n        endpoint: `/api/v1/dashboard/?q=${queryParams}`\n      });\n      const { result, count } = json;\n      return {\n        data: result.map((dashboard) => ({\n          value: dashboard.id,\n          label: dashboard.dashboard_title\n        })),\n        totalCount: count\n      };\n    };this.\n    renderSaveChartModal = () => {var _this$props$datasourc;\n      const info = this.info();\n      return _jsxs(Form, { \"data-test\": \"save-modal-body\", layout: \"vertical\", children: [\n        _jsxs(FormItem, { \"data-test\": \"radio-group\", children: [\n          _jsx(Radio, { id: \"overwrite-radio\", disabled: !this.canOverwriteSlice(), checked: this.state.action === 'overwrite', onChange: () => this.changeAction('overwrite'), \"data-test\": \"save-overwrite-radio\", children:\n            t('Save (Overwrite)') }\n          ),\n          _jsx(Radio, { id: \"saveas-radio\", \"data-test\": \"saveas-radio\", checked: this.state.action === 'saveas', onChange: () => this.changeAction('saveas'), children:\n            t('Save as...') }\n          )] }\n        ),\n        _jsx(\"hr\", {}),\n        _jsx(FormItem, { label: t('Chart name'), required: true, children:\n          _jsx(Input, { name: \"new_slice_name\", type: \"text\", placeholder: \"Name\", value: this.state.newSliceName, onChange: this.onSliceNameChange, \"data-test\": \"new-chart-name\" }) }\n        ),\n        ((_this$props$datasourc = this.props.datasource) == null ? void 0 : _this$props$datasourc.type) === 'query' && _jsxs(FormItem, { label: t('Dataset Name'), required: true, children: [\n          _jsx(InfoTooltipWithTrigger, { tooltip: t('A reusable dataset will be saved with your chart.'), placement: \"right\" }),\n          _jsx(Input, { name: \"dataset_name\", type: \"text\", placeholder: \"Dataset Name\", value: this.state.datasetName, onChange: this.handleDatasetNameChange, \"data-test\": \"new-dataset-name\" })] }\n        ),\n        _jsx(FormItem, { label: t('Add to dashboard'), \"data-test\": \"save-chart-modal-select-dashboard-form\", children:\n          _jsx(AsyncSelect, { allowClear: true, allowNewOptions: true, ariaLabel: t('Select a dashboard'), options: this.loadDashboards, onChange: this.onDashboardChange, value: this.state.dashboard, placeholder: _jsxs(\"div\", { children: [\n              _jsx(\"b\", { children: t('Select') }),\n              t(' a dashboard OR '),\n              _jsx(\"b\", { children: t('create') }),\n              t(' a new one')] }\n            ) }) }\n        ),\n        info && _jsx(Alert, { type: \"info\", message: info, closable: false }),\n        this.props.alert && _jsx(Alert, { css: /*#__PURE__*/_css({ marginTop: info ? 16 : undefined }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:SaveModal;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hcnl1cmtvdi9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvZXhwbG9yZS9jb21wb25lbnRzL1NhdmVNb2RhbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBb1JxQyIsImZpbGUiOiIvVXNlcnMvYXJ5dXJrb3Yvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2V4cGxvcmUvY29tcG9uZW50cy9TYXZlTW9kYWwudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyogZXNsaW50IGNhbWVsY2FzZTogMCAqL1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHJpc29uIGZyb20gJ3Jpc29uJztcbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgeyB3aXRoUm91dGVyIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5pbXBvcnQgeyBJbmZvVG9vbHRpcFdpdGhUcmlnZ2VyIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NoYXJ0LWNvbnRyb2xzJztcbmltcG9ydCB7IGNzcywgRGF0YXNvdXJjZVR5cGUsIGlzRGVmaW5lZCwgbG9nZ2luZywgc3R5bGVkLCBTdXBlcnNldENsaWVudCwgdCwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0lucHV0JztcbmltcG9ydCB7IEZvcm0sIEZvcm1JdGVtIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvRm9ybSc7XG5pbXBvcnQgQWxlcnQgZnJvbSAnc3JjL2NvbXBvbmVudHMvQWxlcnQnO1xuaW1wb3J0IE1vZGFsIGZyb20gJ3NyYy9jb21wb25lbnRzL01vZGFsJztcbmltcG9ydCB7IFJhZGlvIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvUmFkaW8nO1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdzcmMvY29tcG9uZW50cy9CdXR0b24nO1xuaW1wb3J0IHsgQXN5bmNTZWxlY3QgfSBmcm9tICdzcmMvY29tcG9uZW50cyc7XG5pbXBvcnQgTG9hZGluZyBmcm9tICdzcmMvY29tcG9uZW50cy9Mb2FkaW5nJztcbmltcG9ydCB7IGNhblVzZXJFZGl0RGFzaGJvYXJkIH0gZnJvbSAnc3JjL2Rhc2hib2FyZC91dGlsL3Blcm1pc3Npb25VdGlscyc7XG5pbXBvcnQgeyBzZXRTYXZlQ2hhcnRNb2RhbFZpc2liaWxpdHkgfSBmcm9tICdzcmMvZXhwbG9yZS9hY3Rpb25zL3NhdmVNb2RhbEFjdGlvbnMnO1xuLy8gU2Vzc2lvbiBzdG9yYWdlIGtleSBmb3IgcmVjZW50IGRhc2hib2FyZFxuY29uc3QgU0tfREFTSEJPQVJEX0lEID0gJ3NhdmVfY2hhcnRfcmVjZW50X2Rhc2hib2FyZCc7XG5leHBvcnQgY29uc3QgU3R5bGVkTW9kYWwgPSBzdHlsZWQoTW9kYWwpIGBcbiAgLmFudGQ1LW1vZGFsLWJvZHkge1xuICAgIG92ZXJmbG93OiB2aXNpYmxlO1xuICB9XG4gIGkge1xuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICB0b3A6IC0keyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogNS4yNX1weDtcbiAgICBsZWZ0OiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMjYuNzV9cHg7XG4gIH1cbmA7XG5jbGFzcyBTYXZlTW9kYWwgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIG5ld1NsaWNlTmFtZTogcHJvcHMuc2xpY2VOYW1lLFxuICAgICAgICAgICAgZGF0YXNldE5hbWU6IHByb3BzLmRhdGFzb3VyY2U/Lm5hbWUsXG4gICAgICAgICAgICBhY3Rpb246IHRoaXMuY2FuT3ZlcndyaXRlU2xpY2UoKSA/ICdvdmVyd3JpdGUnIDogJ3NhdmVhcycsXG4gICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgZGFzaGJvYXJkOiB1bmRlZmluZWQsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub25EYXNoYm9hcmRDaGFuZ2UgPSB0aGlzLm9uRGFzaGJvYXJkQ2hhbmdlLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMub25TbGljZU5hbWVDaGFuZ2UgPSB0aGlzLm9uU2xpY2VOYW1lQ2hhbmdlLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuY2hhbmdlQWN0aW9uID0gdGhpcy5jaGFuZ2VBY3Rpb24uYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5zYXZlT3JPdmVyd3JpdGUgPSB0aGlzLnNhdmVPck92ZXJ3cml0ZS5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmlzTmV3RGFzaGJvYXJkID0gdGhpcy5pc05ld0Rhc2hib2FyZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm9uSGlkZSA9IHRoaXMub25IaWRlLmJpbmQodGhpcyk7XG4gICAgfVxuICAgIGlzTmV3RGFzaGJvYXJkKCkge1xuICAgICAgICBjb25zdCB7IGRhc2hib2FyZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBkYXNoYm9hcmQ/LnZhbHVlID09PSAnc3RyaW5nJztcbiAgICB9XG4gICAgY2FuT3ZlcndyaXRlU2xpY2UoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5wcm9wcy5zbGljZT8ub3duZXJzPy5pbmNsdWRlcyh0aGlzLnByb3BzLnVzZXIudXNlcklkKSAmJlxuICAgICAgICAgICAgIXRoaXMucHJvcHMuc2xpY2U/LmlzX21hbmFnZWRfZXh0ZXJuYWxseSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBsZXQgeyBkYXNoYm9hcmRJZCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFkYXNoYm9hcmRJZCkge1xuICAgICAgICAgICAgbGV0IGxhc3REYXNoYm9hcmQgPSBudWxsO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBsYXN0RGFzaGJvYXJkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShTS19EQVNIQk9BUkRfSUQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgLy8gY29udGludWUgcmVnYXJkbGVzcyBvZiBlcnJvclxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGFzaGJvYXJkSWQgPSBsYXN0RGFzaGJvYXJkICYmIHBhcnNlSW50KGxhc3REYXNoYm9hcmQsIDEwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGFzaGJvYXJkSWQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gKGF3YWl0IHRoaXMubG9hZERhc2hib2FyZChkYXNoYm9hcmRJZCkpO1xuICAgICAgICAgICAgICAgIGlmIChjYW5Vc2VyRWRpdERhc2hib2FyZChyZXN1bHQsIHRoaXMucHJvcHMudXNlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXNoYm9hcmQ6IHsgbGFiZWw6IHJlc3VsdC5kYXNoYm9hcmRfdGl0bGUsIHZhbHVlOiByZXN1bHQuaWQgfSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2luZy53YXJuKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmFkZERhbmdlclRvYXN0KHQoJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIGxvYWRpbmcgZGFzaGJvYXJkIGluZm9ybWF0aW9uLicpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVEYXRhc2V0TmFtZUNoYW5nZSA9IChlKSA9PiB7XG4gICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGRhdGFzZXROYW1lOiBlLnRhcmdldC52YWx1ZSB9KTtcbiAgICB9O1xuICAgIG9uU2xpY2VOYW1lQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBuZXdTbGljZU5hbWU6IGV2ZW50LnRhcmdldC52YWx1ZSB9KTtcbiAgICB9XG4gICAgb25EYXNoYm9hcmRDaGFuZ2UoZGFzaGJvYXJkKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBkYXNoYm9hcmQgfSk7XG4gICAgfVxuICAgIGNoYW5nZUFjdGlvbihhY3Rpb24pIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGFjdGlvbiB9KTtcbiAgICB9XG4gICAgb25IaWRlKCkge1xuICAgICAgICB0aGlzLnByb3BzLmRpc3BhdGNoKHNldFNhdmVDaGFydE1vZGFsVmlzaWJpbGl0eShmYWxzZSkpO1xuICAgIH1cbiAgICBoYW5kbGVSZWRpcmVjdCA9ICh3aW5kb3dMb2NhdGlvblNlYXJjaCwgY2hhcnQpID0+IHtcbiAgICAgICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3dMb2NhdGlvblNlYXJjaCk7XG4gICAgICAgIHNlYXJjaFBhcmFtcy5zZXQoJ3NhdmVfYWN0aW9uJywgdGhpcy5zdGF0ZS5hY3Rpb24pO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5hY3Rpb24gIT09ICdvdmVyd3JpdGUnKSB7XG4gICAgICAgICAgICBzZWFyY2hQYXJhbXMuZGVsZXRlKCdmb3JtX2RhdGFfa2V5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgc2VhcmNoUGFyYW1zLnNldCgnc2xpY2VfaWQnLCBjaGFydC5pZC50b1N0cmluZygpKTtcbiAgICAgICAgcmV0dXJuIHNlYXJjaFBhcmFtcztcbiAgICB9O1xuICAgIGFzeW5jIHNhdmVPck92ZXJ3cml0ZShnb3RvZGFzaCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaXNMb2FkaW5nOiB0cnVlIH0pO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuZGF0YXNvdXJjZT8udHlwZSA9PT0gRGF0YXNvdXJjZVR5cGUuUXVlcnkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHNjaGVtYSwgc3FsLCBkYXRhYmFzZSB9ID0gdGhpcy5wcm9wcy5kYXRhc291cmNlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgdGVtcGxhdGVQYXJhbXMgfSA9IHRoaXMucHJvcHMuZGF0YXNvdXJjZTtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnByb3BzLmFjdGlvbnMuc2F2ZURhdGFzZXQoe1xuICAgICAgICAgICAgICAgICAgICBzY2hlbWEsXG4gICAgICAgICAgICAgICAgICAgIHNxbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YWJhc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlUGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICBkYXRhc291cmNlTmFtZTogdGhpcy5zdGF0ZS5kYXRhc2V0TmFtZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vICBHZXQgY2hhcnQgZGFzaGJvYXJkc1xuICAgICAgICAgICAgbGV0IHNsaWNlRGFzaGJvYXJkcyA9IFtdO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuc2xpY2UgJiYgdGhpcy5zdGF0ZS5hY3Rpb24gPT09ICdvdmVyd3JpdGUnKSB7XG4gICAgICAgICAgICAgICAgc2xpY2VEYXNoYm9hcmRzID0gYXdhaXQgdGhpcy5wcm9wcy5hY3Rpb25zLmdldFNsaWNlRGFzaGJvYXJkcyh0aGlzLnByb3BzLnNsaWNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGZvcm1EYXRhID0gdGhpcy5wcm9wcy5mb3JtX2RhdGEgfHwge307XG4gICAgICAgICAgICBkZWxldGUgZm9ybURhdGEudXJsX3BhcmFtcztcbiAgICAgICAgICAgIGxldCBkYXNoYm9hcmQgPSBudWxsO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuZGFzaGJvYXJkKSB7XG4gICAgICAgICAgICAgICAgbGV0IHZhbGlkSWQgPSB0aGlzLnN0YXRlLmRhc2hib2FyZC52YWx1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc05ld0Rhc2hib2FyZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5wcm9wcy5hY3Rpb25zLmNyZWF0ZURhc2hib2FyZCh0aGlzLnN0YXRlLmRhc2hib2FyZC5sYWJlbCk7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkSWQgPSByZXNwb25zZS5pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgZGFzaGJvYXJkID0gYXdhaXQgdGhpcy5sb2FkRGFzaGJvYXJkKHZhbGlkSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5hY3Rpb25zLnNhdmVTbGljZUZhaWxlZCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpc0RlZmluZWQoZGFzaGJvYXJkKSAmJiBpc0RlZmluZWQoZGFzaGJvYXJkPy5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpY2VEYXNoYm9hcmRzID0gc2xpY2VEYXNoYm9hcmRzLmluY2x1ZGVzKGRhc2hib2FyZC5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgID8gc2xpY2VEYXNoYm9hcmRzXG4gICAgICAgICAgICAgICAgICAgICAgICA6IFsuLi5zbGljZURhc2hib2FyZHMsIGRhc2hib2FyZC5pZF07XG4gICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmRhc2hib2FyZHMgPSBzbGljZURhc2hib2FyZHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU2V0cyB0aGUgZm9ybSBkYXRhXG4gICAgICAgICAgICB0aGlzLnByb3BzLmFjdGlvbnMuc2V0Rm9ybURhdGEoeyAuLi5mb3JtRGF0YSB9KTtcbiAgICAgICAgICAgIC8vICBVcGRhdGUgb3IgY3JlYXRlIHNsaWNlXG4gICAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5hY3Rpb24gPT09ICdvdmVyd3JpdGUnKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBhd2FpdCB0aGlzLnByb3BzLmFjdGlvbnMudXBkYXRlU2xpY2UodGhpcy5wcm9wcy5zbGljZSwgdGhpcy5zdGF0ZS5uZXdTbGljZU5hbWUsIHNsaWNlRGFzaGJvYXJkcywgZGFzaGJvYXJkXG4gICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGRhc2hib2FyZC5kYXNoYm9hcmRfdGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXc6IHRoaXMuaXNOZXdEYXNoYm9hcmQoKSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA6IG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBhd2FpdCB0aGlzLnByb3BzLmFjdGlvbnMuY3JlYXRlU2xpY2UodGhpcy5zdGF0ZS5uZXdTbGljZU5hbWUsIHNsaWNlRGFzaGJvYXJkcywgZGFzaGJvYXJkXG4gICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGRhc2hib2FyZC5kYXNoYm9hcmRfdGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXc6IHRoaXMuaXNOZXdEYXNoYm9hcmQoKSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA6IG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoZGFzaGJvYXJkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oU0tfREFTSEJPQVJEX0lELCBgJHtkYXNoYm9hcmQuaWR9YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKFNLX0RBU0hCT0FSRF9JRCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgLy8gY29udGludWUgcmVnYXJkbGVzcyBvZiBlcnJvclxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gR28gdG8gbmV3IGRhc2hib2FyZCB1cmxcbiAgICAgICAgICAgIGlmIChnb3RvZGFzaCAmJiBkYXNoYm9hcmQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmhpc3RvcnkucHVzaChkYXNoYm9hcmQudXJsKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSB0aGlzLmhhbmRsZVJlZGlyZWN0KHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gsIHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuaGlzdG9yeS5yZXBsYWNlKGAvZXhwbG9yZS8/JHtzZWFyY2hQYXJhbXMudG9TdHJpbmcoKX1gKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpc0xvYWRpbmc6IGZhbHNlIH0pO1xuICAgICAgICAgICAgdGhpcy5vbkhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpc0xvYWRpbmc6IGZhbHNlIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxvYWREYXNoYm9hcmQgPSBhc3luYyAoaWQpID0+IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBTdXBlcnNldENsaWVudC5nZXQoe1xuICAgICAgICAgICAgZW5kcG9pbnQ6IGAvYXBpL3YxL2Rhc2hib2FyZC8ke2lkfWAsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbi5yZXN1bHQ7XG4gICAgfTtcbiAgICBsb2FkRGFzaGJvYXJkcyA9IGFzeW5jIChzZWFyY2gsIHBhZ2UsIHBhZ2VTaXplKSA9PiB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gcmlzb24uZW5jb2RlKHtcbiAgICAgICAgICAgIGNvbHVtbnM6IFsnaWQnLCAnZGFzaGJvYXJkX3RpdGxlJ10sXG4gICAgICAgICAgICBmaWx0ZXJzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb2w6ICdkYXNoYm9hcmRfdGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICBvcHI6ICdjdCcsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBzZWFyY2gsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbDogJ293bmVycycsXG4gICAgICAgICAgICAgICAgICAgIG9wcjogJ3JlbF9tX20nLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wcm9wcy51c2VyLnVzZXJJZCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIHBhZ2UsXG4gICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2VTaXplLFxuICAgICAgICAgICAgb3JkZXJfY29sdW1uOiAnZGFzaGJvYXJkX3RpdGxlJyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHsganNvbiB9ID0gYXdhaXQgU3VwZXJzZXRDbGllbnQuZ2V0KHtcbiAgICAgICAgICAgIGVuZHBvaW50OiBgL2FwaS92MS9kYXNoYm9hcmQvP3E9JHtxdWVyeVBhcmFtc31gLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyByZXN1bHQsIGNvdW50IH0gPSBqc29uO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGF0YTogcmVzdWx0Lm1hcCgoZGFzaGJvYXJkKSA9PiAoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBkYXNoYm9hcmQuaWQsXG4gICAgICAgICAgICAgICAgbGFiZWw6IGRhc2hib2FyZC5kYXNoYm9hcmRfdGl0bGUsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgICB0b3RhbENvdW50OiBjb3VudCxcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHJlbmRlclNhdmVDaGFydE1vZGFsID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBpbmZvID0gdGhpcy5pbmZvKCk7XG4gICAgICAgIHJldHVybiAoPEZvcm0gZGF0YS10ZXN0PVwic2F2ZS1tb2RhbC1ib2R5XCIgbGF5b3V0PVwidmVydGljYWxcIj5cbiAgICAgICAgPEZvcm1JdGVtIGRhdGEtdGVzdD1cInJhZGlvLWdyb3VwXCI+XG4gICAgICAgICAgPFJhZGlvIGlkPVwib3ZlcndyaXRlLXJhZGlvXCIgZGlzYWJsZWQ9eyF0aGlzLmNhbk92ZXJ3cml0ZVNsaWNlKCl9IGNoZWNrZWQ9e3RoaXMuc3RhdGUuYWN0aW9uID09PSAnb3ZlcndyaXRlJ30gb25DaGFuZ2U9eygpID0+IHRoaXMuY2hhbmdlQWN0aW9uKCdvdmVyd3JpdGUnKX0gZGF0YS10ZXN0PVwic2F2ZS1vdmVyd3JpdGUtcmFkaW9cIj5cbiAgICAgICAgICAgIHt0KCdTYXZlIChPdmVyd3JpdGUpJyl9XG4gICAgICAgICAgPC9SYWRpbz5cbiAgICAgICAgICA8UmFkaW8gaWQ9XCJzYXZlYXMtcmFkaW9cIiBkYXRhLXRlc3Q9XCJzYXZlYXMtcmFkaW9cIiBjaGVja2VkPXt0aGlzLnN0YXRlLmFjdGlvbiA9PT0gJ3NhdmVhcyd9IG9uQ2hhbmdlPXsoKSA9PiB0aGlzLmNoYW5nZUFjdGlvbignc2F2ZWFzJyl9PlxuICAgICAgICAgICAge3QoJ1NhdmUgYXMuLi4nKX1cbiAgICAgICAgICA8L1JhZGlvPlxuICAgICAgICA8L0Zvcm1JdGVtPlxuICAgICAgICA8aHIgLz5cbiAgICAgICAgPEZvcm1JdGVtIGxhYmVsPXt0KCdDaGFydCBuYW1lJyl9IHJlcXVpcmVkPlxuICAgICAgICAgIDxJbnB1dCBuYW1lPVwibmV3X3NsaWNlX25hbWVcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiTmFtZVwiIHZhbHVlPXt0aGlzLnN0YXRlLm5ld1NsaWNlTmFtZX0gb25DaGFuZ2U9e3RoaXMub25TbGljZU5hbWVDaGFuZ2V9IGRhdGEtdGVzdD1cIm5ldy1jaGFydC1uYW1lXCIvPlxuICAgICAgICA8L0Zvcm1JdGVtPlxuICAgICAgICB7dGhpcy5wcm9wcy5kYXRhc291cmNlPy50eXBlID09PSAncXVlcnknICYmICg8Rm9ybUl0ZW0gbGFiZWw9e3QoJ0RhdGFzZXQgTmFtZScpfSByZXF1aXJlZD5cbiAgICAgICAgICAgIDxJbmZvVG9vbHRpcFdpdGhUcmlnZ2VyIHRvb2x0aXA9e3QoJ0EgcmV1c2FibGUgZGF0YXNldCB3aWxsIGJlIHNhdmVkIHdpdGggeW91ciBjaGFydC4nKX0gcGxhY2VtZW50PVwicmlnaHRcIi8+XG4gICAgICAgICAgICA8SW5wdXQgbmFtZT1cImRhdGFzZXRfbmFtZVwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJEYXRhc2V0IE5hbWVcIiB2YWx1ZT17dGhpcy5zdGF0ZS5kYXRhc2V0TmFtZX0gb25DaGFuZ2U9e3RoaXMuaGFuZGxlRGF0YXNldE5hbWVDaGFuZ2V9IGRhdGEtdGVzdD1cIm5ldy1kYXRhc2V0LW5hbWVcIi8+XG4gICAgICAgICAgPC9Gb3JtSXRlbT4pfVxuICAgICAgICA8Rm9ybUl0ZW0gbGFiZWw9e3QoJ0FkZCB0byBkYXNoYm9hcmQnKX0gZGF0YS10ZXN0PVwic2F2ZS1jaGFydC1tb2RhbC1zZWxlY3QtZGFzaGJvYXJkLWZvcm1cIj5cbiAgICAgICAgICA8QXN5bmNTZWxlY3QgYWxsb3dDbGVhciBhbGxvd05ld09wdGlvbnMgYXJpYUxhYmVsPXt0KCdTZWxlY3QgYSBkYXNoYm9hcmQnKX0gb3B0aW9ucz17dGhpcy5sb2FkRGFzaGJvYXJkc30gb25DaGFuZ2U9e3RoaXMub25EYXNoYm9hcmRDaGFuZ2V9IHZhbHVlPXt0aGlzLnN0YXRlLmRhc2hib2FyZH0gcGxhY2Vob2xkZXI9ezxkaXY+XG4gICAgICAgICAgICAgICAgPGI+e3QoJ1NlbGVjdCcpfTwvYj5cbiAgICAgICAgICAgICAgICB7dCgnIGEgZGFzaGJvYXJkIE9SICcpfVxuICAgICAgICAgICAgICAgIDxiPnt0KCdjcmVhdGUnKX08L2I+XG4gICAgICAgICAgICAgICAge3QoJyBhIG5ldyBvbmUnKX1cbiAgICAgICAgICAgICAgPC9kaXY+fS8+XG4gICAgICAgIDwvRm9ybUl0ZW0+XG4gICAgICAgIHtpbmZvICYmIDxBbGVydCB0eXBlPVwiaW5mb1wiIG1lc3NhZ2U9e2luZm99IGNsb3NhYmxlPXtmYWxzZX0vPn1cbiAgICAgICAge3RoaXMucHJvcHMuYWxlcnQgJiYgKDxBbGVydCBjc3M9e3sgbWFyZ2luVG9wOiBpbmZvID8gMTYgOiB1bmRlZmluZWQgfX0gdHlwZT1cIndhcm5pbmdcIiBtZXNzYWdlPXt0aGlzLnByb3BzLmFsZXJ0fSBjbG9zYWJsZT17ZmFsc2V9Lz4pfVxuICAgICAgPC9Gb3JtPik7XG4gICAgfTtcbiAgICBpbmZvID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBpc05ld0Rhc2hib2FyZCA9IHRoaXMuaXNOZXdEYXNoYm9hcmQoKTtcbiAgICAgICAgbGV0IGNoYXJ0V2lsbEJlQ3JlYXRlZCA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5zbGljZSAmJlxuICAgICAgICAgICAgKHRoaXMuc3RhdGUuYWN0aW9uICE9PSAnb3ZlcndyaXRlJyB8fCAhdGhpcy5jYW5PdmVyd3JpdGVTbGljZSgpKSkge1xuICAgICAgICAgICAgY2hhcnRXaWxsQmVDcmVhdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhcnRXaWxsQmVDcmVhdGVkICYmIGlzTmV3RGFzaGJvYXJkKSB7XG4gICAgICAgICAgICByZXR1cm4gdCgnQSBuZXcgY2hhcnQgYW5kIGRhc2hib2FyZCB3aWxsIGJlIGNyZWF0ZWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXJ0V2lsbEJlQ3JlYXRlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHQoJ0EgbmV3IGNoYXJ0IHdpbGwgYmUgY3JlYXRlZC4nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNOZXdEYXNoYm9hcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB0KCdBIG5ldyBkYXNoYm9hcmQgd2lsbCBiZSBjcmVhdGVkLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgcmVuZGVyRm9vdGVyID0gKCkgPT4gKDxkaXYgZGF0YS10ZXN0PVwic2F2ZS1tb2RhbC1mb290ZXJcIj5cbiAgICAgIDxCdXR0b24gaWQ9XCJidG5fY2FuY2VsXCIgYnV0dG9uU2l6ZT1cInNtYWxsXCIgb25DbGljaz17dGhpcy5vbkhpZGV9PlxuICAgICAgICB7dCgnQ2FuY2VsJyl9XG4gICAgICA8L0J1dHRvbj5cbiAgICAgIDxCdXR0b24gaWQ9XCJidG5fbW9kYWxfc2F2ZV9nb3RvX2Rhc2hcIiBidXR0b25TaXplPVwic21hbGxcIiBkaXNhYmxlZD17IXRoaXMuc3RhdGUubmV3U2xpY2VOYW1lIHx8XG4gICAgICAgICAgICAhdGhpcy5zdGF0ZS5kYXNoYm9hcmQgfHxcbiAgICAgICAgICAgICh0aGlzLnByb3BzLmRhdGFzb3VyY2U/LnR5cGUgIT09IERhdGFzb3VyY2VUeXBlLlRhYmxlICYmXG4gICAgICAgICAgICAgICAgIXRoaXMuc3RhdGUuZGF0YXNldE5hbWUpfSBvbkNsaWNrPXsoKSA9PiB0aGlzLnNhdmVPck92ZXJ3cml0ZSh0cnVlKX0+XG4gICAgICAgIHt0KCdTYXZlICYgZ28gdG8gZGFzaGJvYXJkJyl9XG4gICAgICA8L0J1dHRvbj5cbiAgICAgIDxCdXR0b24gaWQ9XCJidG5fbW9kYWxfc2F2ZVwiIGJ1dHRvblNpemU9XCJzbWFsbFwiIGJ1dHRvblN0eWxlPVwicHJpbWFyeVwiIG9uQ2xpY2s9eygpID0+IHRoaXMuc2F2ZU9yT3ZlcndyaXRlKGZhbHNlKX0gZGlzYWJsZWQ9e3RoaXMuc3RhdGUuaXNMb2FkaW5nIHx8XG4gICAgICAgICAgICAhdGhpcy5zdGF0ZS5uZXdTbGljZU5hbWUgfHxcbiAgICAgICAgICAgICh0aGlzLnByb3BzLmRhdGFzb3VyY2U/LnR5cGUgIT09IERhdGFzb3VyY2VUeXBlLlRhYmxlICYmXG4gICAgICAgICAgICAgICAgIXRoaXMuc3RhdGUuZGF0YXNldE5hbWUpfSBkYXRhLXRlc3Q9XCJidG4tbW9kYWwtc2F2ZVwiPlxuICAgICAgICB7dCgnU2F2ZScpfVxuICAgICAgPC9CdXR0b24+XG4gICAgPC9kaXY+KTtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoPFN0eWxlZE1vZGFsIHNob3c9e3RoaXMucHJvcHMuaXNWaXNpYmxlfSBvbkhpZGU9e3RoaXMub25IaWRlfSB0aXRsZT17dCgnU2F2ZSBjaGFydCcpfSBmb290ZXI9e3RoaXMucmVuZGVyRm9vdGVyKCl9PlxuICAgICAgICB7dGhpcy5zdGF0ZS5pc0xvYWRpbmcgPyAoPGRpdiBjc3M9e2NzcyBgXG4gICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICA8TG9hZGluZyBwb3NpdGlvbj1cIm5vcm1hbFwiLz5cbiAgICAgICAgICA8L2Rpdj4pIDogKHRoaXMucmVuZGVyU2F2ZUNoYXJ0TW9kYWwoKSl9XG4gICAgICA8L1N0eWxlZE1vZGFsPik7XG4gICAgfVxufVxuZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKHsgZXhwbG9yZSwgc2F2ZU1vZGFsLCB1c2VyLCB9KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YXNvdXJjZTogZXhwbG9yZS5kYXRhc291cmNlLFxuICAgICAgICBzbGljZTogZXhwbG9yZS5zbGljZSxcbiAgICAgICAgdXNlcixcbiAgICAgICAgZGFzaGJvYXJkczogc2F2ZU1vZGFsLmRhc2hib2FyZHMsXG4gICAgICAgIGFsZXJ0OiBzYXZlTW9kYWwuc2F2ZU1vZGFsQWxlcnQsXG4gICAgICAgIGlzVmlzaWJsZTogc2F2ZU1vZGFsLmlzVmlzaWJsZSxcbiAgICB9O1xufVxuZXhwb3J0IGRlZmF1bHQgd2l0aFJvdXRlcihjb25uZWN0KG1hcFN0YXRlVG9Qcm9wcykoU2F2ZU1vZGFsKSk7XG4vLyBVc2VyIGZvciB0ZXN0aW5nIHB1cnBvc2VzIG5lZWQgdG8gcmV2aXNpdCBvbmNlIHdlIGNvbnZlcnQgdGhpcyB0byBmdW5jdGlvbmFsIGNvbXBvbmVudFxuZXhwb3J0IHsgU2F2ZU1vZGFsIGFzIFB1cmVTYXZlTW9kYWwgfTtcbiJdfQ== */\"), type: \"warning\", message: this.props.alert, closable: false })] }\n      );\n    };this.\n    info = () => {\n      const isNewDashboard = this.isNewDashboard();\n      let chartWillBeCreated = false;\n      if (this.props.slice && (\n      this.state.action !== 'overwrite' || !this.canOverwriteSlice())) {\n        chartWillBeCreated = true;\n      }\n      if (chartWillBeCreated && isNewDashboard) {\n        return t('A new chart and dashboard will be created.');\n      }\n      if (chartWillBeCreated) {\n        return t('A new chart will be created.');\n      }\n      if (isNewDashboard) {\n        return t('A new dashboard will be created.');\n      }\n      return null;\n    };this.\n    renderFooter = () => {var _this$props$datasourc2, _this$props$datasourc3;return _jsxs(\"div\", { \"data-test\": \"save-modal-footer\", children: [\n        _jsx(Button, { id: \"btn_cancel\", buttonSize: \"small\", onClick: this.onHide, children:\n          t('Cancel') }\n        ),\n        _jsx(Button, { id: \"btn_modal_save_goto_dash\", buttonSize: \"small\", disabled: !this.state.newSliceName ||\n          !this.state.dashboard ||\n          ((_this$props$datasourc2 = this.props.datasource) == null ? void 0 : _this$props$datasourc2.type) !== DatasourceType.Table &&\n          !this.state.datasetName, onClick: () => this.saveOrOverwrite(true), children:\n          t('Save & go to dashboard') }\n        ),\n        _jsx(Button, { id: \"btn_modal_save\", buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => this.saveOrOverwrite(false), disabled: this.state.isLoading ||\n          !this.state.newSliceName ||\n          ((_this$props$datasourc3 = this.props.datasource) == null ? void 0 : _this$props$datasourc3.type) !== DatasourceType.Table &&\n          !this.state.datasetName, \"data-test\": \"btn-modal-save\", children:\n          t('Save') }\n        )] }\n      );};this.state = { newSliceName: props.sliceName, datasetName: (_props$datasource = props.datasource) == null ? void 0 : _props$datasource.name, action: this.canOverwriteSlice() ? 'overwrite' : 'saveas', isLoading: false, dashboard: undefined };this.onDashboardChange = this.onDashboardChange.bind(this);this.onSliceNameChange = this.onSliceNameChange.bind(this);this.changeAction = this.changeAction.bind(this);this.saveOrOverwrite = this.saveOrOverwrite.bind(this);this.isNewDashboard = this.isNewDashboard.bind(this);this.onHide = this.onHide.bind(this);}isNewDashboard() {const { dashboard } = this.state;return typeof (dashboard == null ? void 0 : dashboard.value) === 'string';}canOverwriteSlice() {var _this$props$slice, _this$props$slice$own, _this$props$slice2;return ((_this$props$slice = this.props.slice) == null ? void 0 : (_this$props$slice$own = _this$props$slice.owners) == null ? void 0 : _this$props$slice$own.includes(this.props.user.userId)) && !((_this$props$slice2 = this.props.slice) != null && _this$props$slice2.is_managed_externally);}async componentDidMount() {let { dashboardId } = this.props;if (!dashboardId) {let lastDashboard = null;try {lastDashboard = sessionStorage.getItem(SK_DASHBOARD_ID);} catch (error) {// continue regardless of error\n      }dashboardId = lastDashboard && parseInt(lastDashboard, 10);}if (dashboardId) {try {const result = await this.loadDashboard(dashboardId);if (canUserEditDashboard(result, this.props.user)) {this.setState({ dashboard: { label: result.dashboard_title, value: result.id } });}} catch (error) {logging.warn(error);this.props.addDangerToast(t('An error occurred while loading dashboard information.'));}}}onSliceNameChange(event) {this.setState({ newSliceName: event.target.value });}onDashboardChange(dashboard) {this.setState({ dashboard });}changeAction(action) {this.setState({ action });}onHide() {this.props.dispatch(setSaveChartModalVisibility(false));}async saveOrOverwrite(gotodash) {this.setState({ isLoading: true });try {var _this$props$datasourc4;if (((_this$props$datasourc4 = this.props.datasource) == null ? void 0 : _this$props$datasourc4.type) === DatasourceType.Query) {const { schema, sql, database } = this.props.datasource;const { templateParams } = this.props.datasource;await this.props.actions.saveDataset({ schema, sql, database, templateParams, datasourceName: this.state.datasetName });} //  Get chart dashboards\n      let sliceDashboards = [];if (this.props.slice && this.state.action === 'overwrite') {sliceDashboards = await this.props.actions.getSliceDashboards(this.props.slice);}const formData = this.props.form_data || {};delete formData.url_params;let dashboard = null;if (this.state.dashboard) {var _dashboard;let validId = this.state.dashboard.value;if (this.isNewDashboard()) {const response = await this.props.actions.createDashboard(this.state.dashboard.label);validId = response.id;}try {dashboard = await this.loadDashboard(validId);} catch (error) {this.props.actions.saveSliceFailed();return;}if (isDefined(dashboard) && isDefined((_dashboard = dashboard) == null ? void 0 : _dashboard.id)) {sliceDashboards = sliceDashboards.includes(dashboard.id) ? sliceDashboards : [...sliceDashboards, dashboard.id];formData.dashboards = sliceDashboards;}} // Sets the form data\n      this.props.actions.setFormData({ ...formData }); //  Update or create slice\n      let value;if (this.state.action === 'overwrite') {value = await this.props.actions.updateSlice(this.props.slice, this.state.newSliceName, sliceDashboards, dashboard ? { title: dashboard.dashboard_title, new: this.isNewDashboard() } : null);} else {value = await this.props.actions.createSlice(this.state.newSliceName, sliceDashboards, dashboard ? { title: dashboard.dashboard_title, new: this.isNewDashboard() } : null);}try {if (dashboard) {sessionStorage.setItem(SK_DASHBOARD_ID, `${dashboard.id}`);} else {sessionStorage.removeItem(SK_DASHBOARD_ID);}} catch (error) {// continue regardless of error\n      } // Go to new dashboard url\n      if (gotodash && dashboard) {this.props.history.push(dashboard.url);return;}const searchParams = this.handleRedirect(window.location.search, value);this.props.history.replace(`/explore/?${searchParams.toString()}`);this.setState({ isLoading: false });this.onHide();} finally {this.setState({ isLoading: false });}}render() {return _jsx(StyledModal, { show: this.props.isVisible, onHide: this.onHide, title: t('Save chart'), footer: this.renderFooter(), children: this.state.isLoading ? _jsx(\"div\", { css: css`\n              display: flex;\n              justify-content: center;\n            `, children: _jsx(Loading, { position: \"normal\" }) }) : this.renderSaveChartModal() });\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}function mapStateToProps({ explore, saveModal, user }) {\n  return {\n    datasource: explore.datasource,\n    slice: explore.slice,\n    user,\n    dashboards: saveModal.dashboards,\n    alert: saveModal.saveModalAlert,\n    isVisible: saveModal.isVisible\n  };\n}const _default =\nwithRouter(connect(mapStateToProps)(SaveModal));export default _default;\n// User for testing purposes need to revisit once we convert this to functional component\nexport { SaveModal as PureSaveModal };;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(SK_DASHBOARD_ID, \"SK_DASHBOARD_ID\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(StyledModal, \"StyledModal\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(SaveModal, \"SaveModal\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/SaveModal.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["Component","rison","connect","withRouter","InfoTooltipWithTrigger","css","DatasourceType","isDefined","logging","styled","SupersetClient","t","Input","Form","FormItem","Alert","Modal","Radio","Button","AsyncSelect","Loading","canUserEditDashboard","setSaveChartModalVisibility","jsx","_jsx","jsxs","_jsxs","SK_DASHBOARD_ID","StyledModal","theme","gridUnit","SaveModal","constructor","props","_props$datasource","handleDatasetNameChange","e","setState","datasetName","target","value","handleRedirect","windowLocationSearch","chart","searchParams","URLSearchParams","set","state","action","delete","id","toString","loadDashboard","response","get","endpoint","json","result","loadDashboards","search","page","pageSize","queryParams","encode","columns","filters","col","opr","user","userId","page_size","order_column","count","data","map","dashboard","label","dashboard_title","totalCount","renderSaveChartModal","_this$props$datasourc","info","layout","children","disabled","canOverwriteSlice","checked","onChange","changeAction","required","name","type","placeholder","newSliceName","onSliceNameChange","datasource","tooltip","placement","allowClear","allowNewOptions","ariaLabel","options","onDashboardChange","message","closable","alert","_css","marginTop","undefined","process","env","NODE_ENV","isNewDashboard","chartWillBeCreated","slice","renderFooter","_this$props$datasourc2","_this$props$datasourc3","buttonSize","onClick","onHide","Table","saveOrOverwrite","buttonStyle","isLoading","sliceName","bind","_this$props$slice","_this$props$slice$own","_this$props$slice2","owners","includes","is_managed_externally","componentDidMount","dashboardId","lastDashboard","sessionStorage","getItem","error","parseInt","warn","addDangerToast","event","dispatch","gotodash","_this$props$datasourc4","Query","schema","sql","database","templateParams","actions","saveDataset","datasourceName","sliceDashboards","getSliceDashboards","formData","form_data","url_params","_dashboard","validId","createDashboard","saveSliceFailed","dashboards","setFormData","updateSlice","title","new","createSlice","setItem","removeItem","history","push","url","window","location","replace","render","show","isVisible","footer","position","__reactstandin__regenerateByEval","key","code","eval","mapStateToProps","explore","saveModal","saveModalAlert","_default","PureSaveModal","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/src/explore/components/SaveModal.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { ChangeEvent, FormEvent, Component } from 'react';\nimport { Dispatch } from 'redux';\nimport rison from 'rison';\nimport { connect } from 'react-redux';\nimport { withRouter, RouteComponentProps } from 'react-router-dom';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport {\n  css,\n  DatasourceType,\n  isDefined,\n  logging,\n  styled,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport { Form, FormItem } from 'src/components/Form';\nimport Alert from 'src/components/Alert';\nimport Modal from 'src/components/Modal';\nimport { Radio } from 'src/components/Radio';\nimport Button from 'src/components/Button';\nimport { AsyncSelect } from 'src/components';\nimport Loading from 'src/components/Loading';\nimport { canUserEditDashboard } from 'src/dashboard/util/permissionUtils';\nimport { setSaveChartModalVisibility } from 'src/explore/actions/saveModalActions';\nimport { SaveActionType } from 'src/explore/types';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport { Dashboard } from 'src/types/Dashboard';\n\n// Session storage key for recent dashboard\nconst SK_DASHBOARD_ID = 'save_chart_recent_dashboard';\n\ninterface SaveModalProps extends RouteComponentProps {\n  addDangerToast: (msg: string) => void;\n  actions: Record<string, any>;\n  form_data?: Record<string, any>;\n  user: UserWithPermissionsAndRoles;\n  alert?: string;\n  sliceName?: string;\n  slice?: Record<string, any>;\n  datasource?: Record<string, any>;\n  dashboardId: '' | number | null;\n  isVisible: boolean;\n  dispatch: Dispatch;\n}\n\ntype SaveModalState = {\n  newSliceName?: string;\n  datasetName: string;\n  action: SaveActionType;\n  isLoading: boolean;\n  saveStatus?: string | null;\n  dashboard?: { label: string; value: string | number };\n};\n\nexport const StyledModal = styled(Modal)`\n  .antd5-modal-body {\n    overflow: visible;\n  }\n  i {\n    position: absolute;\n    top: -${({ theme }) => theme.gridUnit * 5.25}px;\n    left: ${({ theme }) => theme.gridUnit * 26.75}px;\n  }\n`;\n\nclass SaveModal extends Component<SaveModalProps, SaveModalState> {\n  constructor(props: SaveModalProps) {\n    super(props);\n    this.state = {\n      newSliceName: props.sliceName,\n      datasetName: props.datasource?.name,\n      action: this.canOverwriteSlice() ? 'overwrite' : 'saveas',\n      isLoading: false,\n      dashboard: undefined,\n    };\n    this.onDashboardChange = this.onDashboardChange.bind(this);\n    this.onSliceNameChange = this.onSliceNameChange.bind(this);\n    this.changeAction = this.changeAction.bind(this);\n    this.saveOrOverwrite = this.saveOrOverwrite.bind(this);\n    this.isNewDashboard = this.isNewDashboard.bind(this);\n    this.onHide = this.onHide.bind(this);\n  }\n\n  isNewDashboard(): boolean {\n    const { dashboard } = this.state;\n    return typeof dashboard?.value === 'string';\n  }\n\n  canOverwriteSlice(): boolean {\n    return (\n      this.props.slice?.owners?.includes(this.props.user.userId) &&\n      !this.props.slice?.is_managed_externally\n    );\n  }\n\n  async componentDidMount() {\n    let { dashboardId } = this.props;\n    if (!dashboardId) {\n      let lastDashboard = null;\n      try {\n        lastDashboard = sessionStorage.getItem(SK_DASHBOARD_ID);\n      } catch (error) {\n        // continue regardless of error\n      }\n      dashboardId = lastDashboard && parseInt(lastDashboard, 10);\n    }\n    if (dashboardId) {\n      try {\n        const result = (await this.loadDashboard(dashboardId)) as Dashboard;\n        if (canUserEditDashboard(result, this.props.user)) {\n          this.setState({\n            dashboard: { label: result.dashboard_title, value: result.id },\n          });\n        }\n      } catch (error) {\n        logging.warn(error);\n        this.props.addDangerToast(\n          t('An error occurred while loading dashboard information.'),\n        );\n      }\n    }\n  }\n\n  handleDatasetNameChange = (e: FormEvent<HTMLInputElement>) => {\n    // @ts-expect-error\n    this.setState({ datasetName: e.target.value });\n  };\n\n  onSliceNameChange(event: ChangeEvent<HTMLInputElement>) {\n    this.setState({ newSliceName: event.target.value });\n  }\n\n  onDashboardChange(dashboard: { label: string; value: string | number }) {\n    this.setState({ dashboard });\n  }\n\n  changeAction(action: SaveActionType) {\n    this.setState({ action });\n  }\n\n  onHide() {\n    this.props.dispatch(setSaveChartModalVisibility(false));\n  }\n\n  handleRedirect = (windowLocationSearch: string, chart: any) => {\n    const searchParams = new URLSearchParams(windowLocationSearch);\n    searchParams.set('save_action', this.state.action);\n    if (this.state.action !== 'overwrite') {\n      searchParams.delete('form_data_key');\n    }\n\n    searchParams.set('slice_id', chart.id.toString());\n    return searchParams;\n  };\n\n  async saveOrOverwrite(gotodash: boolean) {\n    this.setState({ isLoading: true });\n\n    //  Create or retrieve dashboard\n    type DashboardGetResponse = {\n      id: number;\n      url: string;\n      dashboard_title: string;\n    };\n\n    try {\n      if (this.props.datasource?.type === DatasourceType.Query) {\n        const { schema, sql, database } = this.props.datasource;\n        const { templateParams } = this.props.datasource;\n\n        await this.props.actions.saveDataset({\n          schema,\n          sql,\n          database,\n          templateParams,\n          datasourceName: this.state.datasetName,\n        });\n      }\n\n      //  Get chart dashboards\n      let sliceDashboards: number[] = [];\n      if (this.props.slice && this.state.action === 'overwrite') {\n        sliceDashboards = await this.props.actions.getSliceDashboards(\n          this.props.slice,\n        );\n      }\n\n      const formData = this.props.form_data || {};\n      delete formData.url_params;\n\n      let dashboard: DashboardGetResponse | null = null;\n      if (this.state.dashboard) {\n        let validId = this.state.dashboard.value;\n        if (this.isNewDashboard()) {\n          const response = await this.props.actions.createDashboard(\n            this.state.dashboard.label,\n          );\n          validId = response.id;\n        }\n\n        try {\n          dashboard = await this.loadDashboard(validId as number);\n        } catch (error) {\n          this.props.actions.saveSliceFailed();\n          return;\n        }\n\n        if (isDefined(dashboard) && isDefined(dashboard?.id)) {\n          sliceDashboards = sliceDashboards.includes(dashboard.id)\n            ? sliceDashboards\n            : [...sliceDashboards, dashboard.id];\n          formData.dashboards = sliceDashboards;\n        }\n      }\n\n      // Sets the form data\n      this.props.actions.setFormData({ ...formData });\n\n      //  Update or create slice\n      let value: { id: number };\n      if (this.state.action === 'overwrite') {\n        value = await this.props.actions.updateSlice(\n          this.props.slice,\n          this.state.newSliceName,\n          sliceDashboards,\n          dashboard\n            ? {\n                title: dashboard.dashboard_title,\n                new: this.isNewDashboard(),\n              }\n            : null,\n        );\n      } else {\n        value = await this.props.actions.createSlice(\n          this.state.newSliceName,\n          sliceDashboards,\n          dashboard\n            ? {\n                title: dashboard.dashboard_title,\n                new: this.isNewDashboard(),\n              }\n            : null,\n        );\n      }\n\n      try {\n        if (dashboard) {\n          sessionStorage.setItem(SK_DASHBOARD_ID, `${dashboard.id}`);\n        } else {\n          sessionStorage.removeItem(SK_DASHBOARD_ID);\n        }\n      } catch (error) {\n        // continue regardless of error\n      }\n\n      // Go to new dashboard url\n      if (gotodash && dashboard) {\n        this.props.history.push(dashboard.url);\n        return;\n      }\n\n      const searchParams = this.handleRedirect(window.location.search, value);\n      this.props.history.replace(`/explore/?${searchParams.toString()}`);\n\n      this.setState({ isLoading: false });\n      this.onHide();\n    } finally {\n      this.setState({ isLoading: false });\n    }\n  }\n\n  loadDashboard = async (id: number) => {\n    const response = await SupersetClient.get({\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n    return response.json.result;\n  };\n\n  loadDashboards = async (search: string, page: number, pageSize: number) => {\n    const queryParams = rison.encode({\n      columns: ['id', 'dashboard_title'],\n      filters: [\n        {\n          col: 'dashboard_title',\n          opr: 'ct',\n          value: search,\n        },\n        {\n          col: 'owners',\n          opr: 'rel_m_m',\n          value: this.props.user.userId,\n        },\n      ],\n      page,\n      page_size: pageSize,\n      order_column: 'dashboard_title',\n    });\n\n    const { json } = await SupersetClient.get({\n      endpoint: `/api/v1/dashboard/?q=${queryParams}`,\n    });\n    const { result, count } = json;\n    return {\n      data: result.map(\n        (dashboard: { id: number; dashboard_title: string }) => ({\n          value: dashboard.id,\n          label: dashboard.dashboard_title,\n        }),\n      ),\n      totalCount: count,\n    };\n  };\n\n  renderSaveChartModal = () => {\n    const info = this.info();\n    return (\n      <Form data-test=\"save-modal-body\" layout=\"vertical\">\n        <FormItem data-test=\"radio-group\">\n          <Radio\n            id=\"overwrite-radio\"\n            disabled={!this.canOverwriteSlice()}\n            checked={this.state.action === 'overwrite'}\n            onChange={() => this.changeAction('overwrite')}\n            data-test=\"save-overwrite-radio\"\n          >\n            {t('Save (Overwrite)')}\n          </Radio>\n          <Radio\n            id=\"saveas-radio\"\n            data-test=\"saveas-radio\"\n            checked={this.state.action === 'saveas'}\n            onChange={() => this.changeAction('saveas')}\n          >\n            {t('Save as...')}\n          </Radio>\n        </FormItem>\n        <hr />\n        <FormItem label={t('Chart name')} required>\n          <Input\n            name=\"new_slice_name\"\n            type=\"text\"\n            placeholder=\"Name\"\n            value={this.state.newSliceName}\n            onChange={this.onSliceNameChange}\n            data-test=\"new-chart-name\"\n          />\n        </FormItem>\n        {this.props.datasource?.type === 'query' && (\n          <FormItem label={t('Dataset Name')} required>\n            <InfoTooltipWithTrigger\n              tooltip={t('A reusable dataset will be saved with your chart.')}\n              placement=\"right\"\n            />\n            <Input\n              name=\"dataset_name\"\n              type=\"text\"\n              placeholder=\"Dataset Name\"\n              value={this.state.datasetName}\n              onChange={this.handleDatasetNameChange}\n              data-test=\"new-dataset-name\"\n            />\n          </FormItem>\n        )}\n        <FormItem\n          label={t('Add to dashboard')}\n          data-test=\"save-chart-modal-select-dashboard-form\"\n        >\n          <AsyncSelect\n            allowClear\n            allowNewOptions\n            ariaLabel={t('Select a dashboard')}\n            options={this.loadDashboards}\n            onChange={this.onDashboardChange}\n            value={this.state.dashboard}\n            placeholder={\n              <div>\n                <b>{t('Select')}</b>\n                {t(' a dashboard OR ')}\n                <b>{t('create')}</b>\n                {t(' a new one')}\n              </div>\n            }\n          />\n        </FormItem>\n        {info && <Alert type=\"info\" message={info} closable={false} />}\n        {this.props.alert && (\n          <Alert\n            css={{ marginTop: info ? 16 : undefined }}\n            type=\"warning\"\n            message={this.props.alert}\n            closable={false}\n          />\n        )}\n      </Form>\n    );\n  };\n\n  info = () => {\n    const isNewDashboard = this.isNewDashboard();\n    let chartWillBeCreated = false;\n    if (\n      this.props.slice &&\n      (this.state.action !== 'overwrite' || !this.canOverwriteSlice())\n    ) {\n      chartWillBeCreated = true;\n    }\n    if (chartWillBeCreated && isNewDashboard) {\n      return t('A new chart and dashboard will be created.');\n    }\n    if (chartWillBeCreated) {\n      return t('A new chart will be created.');\n    }\n    if (isNewDashboard) {\n      return t('A new dashboard will be created.');\n    }\n    return null;\n  };\n\n  renderFooter = () => (\n    <div data-test=\"save-modal-footer\">\n      <Button id=\"btn_cancel\" buttonSize=\"small\" onClick={this.onHide}>\n        {t('Cancel')}\n      </Button>\n      <Button\n        id=\"btn_modal_save_goto_dash\"\n        buttonSize=\"small\"\n        disabled={\n          !this.state.newSliceName ||\n          !this.state.dashboard ||\n          (this.props.datasource?.type !== DatasourceType.Table &&\n            !this.state.datasetName)\n        }\n        onClick={() => this.saveOrOverwrite(true)}\n      >\n        {t('Save & go to dashboard')}\n      </Button>\n      <Button\n        id=\"btn_modal_save\"\n        buttonSize=\"small\"\n        buttonStyle=\"primary\"\n        onClick={() => this.saveOrOverwrite(false)}\n        disabled={\n          this.state.isLoading ||\n          !this.state.newSliceName ||\n          (this.props.datasource?.type !== DatasourceType.Table &&\n            !this.state.datasetName)\n        }\n        data-test=\"btn-modal-save\"\n      >\n        {t('Save')}\n      </Button>\n    </div>\n  );\n\n  render() {\n    return (\n      <StyledModal\n        show={this.props.isVisible}\n        onHide={this.onHide}\n        title={t('Save chart')}\n        footer={this.renderFooter()}\n      >\n        {this.state.isLoading ? (\n          <div\n            css={css`\n              display: flex;\n              justify-content: center;\n            `}\n          >\n            <Loading position=\"normal\" />\n          </div>\n        ) : (\n          this.renderSaveChartModal()\n        )}\n      </StyledModal>\n    );\n  }\n}\n\ninterface StateProps {\n  datasource: any;\n  slice: any;\n  user: UserWithPermissionsAndRoles;\n  dashboards: any;\n  alert: any;\n  isVisible: boolean;\n}\n\nfunction mapStateToProps({\n  explore,\n  saveModal,\n  user,\n}: Record<string, any>): StateProps {\n  return {\n    datasource: explore.datasource,\n    slice: explore.slice,\n    user,\n    dashboards: saveModal.dashboards,\n    alert: saveModal.saveModalAlert,\n    isVisible: saveModal.isVisible,\n  };\n}\n\nexport default withRouter(connect(mapStateToProps)(SaveModal));\n\n// User for testing purposes need to revisit once we convert this to functional component\nexport { SaveModal as PureSaveModal };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}