{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useSelector } from 'react-redux';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { useFilters, useNativeFiltersDataMask } from '../nativeFilters/FilterBar/state';\n// eslint-disable-next-line import/prefer-default-export\nexport const useNativeFilters = () => {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const showNativeFilters = useSelector((state) => {var _getUrlParam;return (_getUrlParam = getUrlParam(URL_PARAMS.showFilters)) != null ? _getUrlParam : true;});\n  const canEdit = useSelector(({ dashboardInfo }) => dashboardInfo.dash_edit_perm);\n  const filters = useFilters();\n  const filterValues = useMemo(() => Object.values(filters), [filters]);\n  const expandFilters = getUrlParam(URL_PARAMS.expandFilters);\n  const [dashboardFiltersOpen, setDashboardFiltersOpen] = useState(expandFilters != null ? expandFilters : !!filterValues.length);\n  const nativeFiltersEnabled = showNativeFilters && (canEdit || !canEdit && filterValues.length !== 0);\n  const requiredFirstFilter = useMemo(() => filterValues.filter((filter) => filter.requiredFirst), [filterValues]);\n  const dataMask = useNativeFiltersDataMask();\n  const missingInitialFilters = useMemo(() => requiredFirstFilter.\n  filter(({ id }) => {var _dataMask$id, _dataMask$id$filterSt;return ((_dataMask$id = dataMask[id]) == null ? void 0 : (_dataMask$id$filterSt = _dataMask$id.filterState) == null ? void 0 : _dataMask$id$filterSt.value) === undefined;}).\n  map(({ name }) => name), [requiredFirstFilter, dataMask]);\n  const showDashboard = isInitialized ||\n  !nativeFiltersEnabled ||\n  missingInitialFilters.length === 0;\n  const toggleDashboardFiltersOpen = useCallback((visible) => {\n    setDashboardFiltersOpen((prevState) => visible != null ? visible : !prevState);\n  }, []);\n  useEffect(() => {\n    if (expandFilters === false ||\n    filterValues.length === 0 && nativeFiltersEnabled) {\n      toggleDashboardFiltersOpen(false);\n    } else\n    {\n      toggleDashboardFiltersOpen(true);\n    }\n  }, [filterValues.length]);\n  useEffect(() => {\n    if (showDashboard) {\n      setIsInitialized(true);\n    }\n  }, [showDashboard]);\n  return {\n    showDashboard,\n    missingInitialFilters,\n    dashboardFiltersOpen,\n    toggleDashboardFiltersOpen,\n    nativeFiltersEnabled\n  };\n};__signature__(useNativeFilters, \"useState{[isInitialized, setIsInitialized](false)}\\nuseSelector{showNativeFilters}\\nuseSelector{canEdit}\\nuseFilters{filters}\\nuseMemo{filterValues}\\nuseState{[dashboardFiltersOpen, setDashboardFiltersOpen](expandFilters ?? !!filterValues.length)}\\nuseMemo{requiredFirstFilter}\\nuseNativeFiltersDataMask{dataMask}\\nuseMemo{missingInitialFilters}\\nuseCallback{toggleDashboardFiltersOpen}\\nuseEffect{}\\nuseEffect{}\", () => [useSelector, useSelector, useFilters, useNativeFiltersDataMask]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(useNativeFilters, \"useNativeFilters\", \"/Users/aryurkov/superset/superset-frontend/src/dashboard/components/DashboardBuilder/state.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useSelector","useCallback","useEffect","useMemo","useState","URL_PARAMS","getUrlParam","useFilters","useNativeFiltersDataMask","useNativeFilters","isInitialized","setIsInitialized","showNativeFilters","state","_getUrlParam","showFilters","canEdit","dashboardInfo","dash_edit_perm","filters","filterValues","Object","values","expandFilters","dashboardFiltersOpen","setDashboardFiltersOpen","length","nativeFiltersEnabled","requiredFirstFilter","filter","requiredFirst","dataMask","missingInitialFilters","id","_dataMask$id","_dataMask$id$filterSt","filterState","value","undefined","map","name","showDashboard","toggleDashboardFiltersOpen","visible","prevState","__signature__","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/src/dashboard/components/DashboardBuilder/state.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useSelector } from 'react-redux';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { RootState } from 'src/dashboard/types';\nimport {\n  useFilters,\n  useNativeFiltersDataMask,\n} from '../nativeFilters/FilterBar/state';\n\n// eslint-disable-next-line import/prefer-default-export\nexport const useNativeFilters = () => {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const showNativeFilters = useSelector<RootState, boolean>(\n    state => getUrlParam(URL_PARAMS.showFilters) ?? true,\n  );\n  const canEdit = useSelector<RootState, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.dash_edit_perm,\n  );\n\n  const filters = useFilters();\n  const filterValues = useMemo(() => Object.values(filters), [filters]);\n  const expandFilters = getUrlParam(URL_PARAMS.expandFilters);\n  const [dashboardFiltersOpen, setDashboardFiltersOpen] = useState(\n    expandFilters ?? !!filterValues.length,\n  );\n\n  const nativeFiltersEnabled =\n    showNativeFilters && (canEdit || (!canEdit && filterValues.length !== 0));\n\n  const requiredFirstFilter = useMemo(\n    () => filterValues.filter(filter => filter.requiredFirst),\n    [filterValues],\n  );\n  const dataMask = useNativeFiltersDataMask();\n\n  const missingInitialFilters = useMemo(\n    () =>\n      requiredFirstFilter\n        .filter(({ id }) => dataMask[id]?.filterState?.value === undefined)\n        .map(({ name }) => name),\n    [requiredFirstFilter, dataMask],\n  );\n\n  const showDashboard =\n    isInitialized ||\n    !nativeFiltersEnabled ||\n    missingInitialFilters.length === 0;\n\n  const toggleDashboardFiltersOpen = useCallback((visible?: boolean) => {\n    setDashboardFiltersOpen(prevState => visible ?? !prevState);\n  }, []);\n\n  useEffect(() => {\n    if (\n      expandFilters === false ||\n      (filterValues.length === 0 && nativeFiltersEnabled)\n    ) {\n      toggleDashboardFiltersOpen(false);\n    } else {\n      toggleDashboardFiltersOpen(true);\n    }\n  }, [filterValues.length]);\n\n  useEffect(() => {\n    if (showDashboard) {\n      setIsInitialized(true);\n    }\n  }, [showDashboard]);\n\n  return {\n    showDashboard,\n    missingInitialFilters,\n    dashboardFiltersOpen,\n    toggleDashboardFiltersOpen,\n    nativeFiltersEnabled,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}