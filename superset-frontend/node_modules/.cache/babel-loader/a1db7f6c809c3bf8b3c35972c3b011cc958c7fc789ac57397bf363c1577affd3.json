{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  isDefined,\n  t,\n  styled,\n  ensureIsArray,\n  DatasourceType } from\n'@superset-ui/core';\nimport Tabs from 'src/components/Tabs';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { EmptyState } from 'src/components/EmptyState';\nimport { Form, FormItem } from 'src/components/Form';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\nimport { noOp } from 'src/utils/common';\nimport {\n  AGGREGATES_OPTIONS,\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH } from\n'src/explore/constants';\nimport columnType from 'src/explore/components/controls/MetricControl/columnType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric, {\n  EXPRESSION_TYPES } from\n'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  StyledMetricOption,\n  StyledColumnOption } from\n'src/explore/components/optionRenderers';\nimport { getColumnKeywords } from 'src/explore/controlUtils/getColumnKeywords';import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\n\nconst propTypes = {\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  getCurrentTab: PropTypes.func,\n  getCurrentLabel: PropTypes.func,\n  adhocMetric: PropTypes.instanceOf(AdhocMetric).isRequired,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  savedMetric: savedMetricType,\n  datasource: PropTypes.object,\n  isNewMetric: PropTypes.bool,\n  isLabelModified: PropTypes.bool\n};\n\nconst defaultProps = {\n  columns: [],\n  getCurrentTab: noOp,\n  isNewMetric: false\n};\n\nconst StyledSelect = styled(Select)`\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\nexport const SAVED_TAB_KEY = 'SAVED';\n\nexport default class AdhocMetricEditPopover extends PureComponent {\n\n\n\n  constructor(props) {\n    super(props); // \"Saved\" is a default tab unless there are no saved metrics for dataset\n    this.defaultActiveTabKey = this.getDefaultTab();this.onSave = this.onSave.bind(this);\n    this.onResetStateAndClose = this.onResetStateAndClose.bind(this);\n    this.onColumnChange = this.onColumnChange.bind(this);\n    this.onAggregateChange = this.onAggregateChange.bind(this);\n    this.onSavedMetricChange = this.onSavedMetricChange.bind(this);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n    this.refreshAceEditor = this.refreshAceEditor.bind(this);\n    this.getDefaultTab = this.getDefaultTab.bind(this);\n\n    this.state = {\n      adhocMetric: this.props.adhocMetric,\n      savedMetric: this.props.savedMetric,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT\n    };\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentDidMount() {\n    this.props.getCurrentTab(this.defaultActiveTabKey);\n  }\n\n  componentDidUpdate(prevProps, prevState) {var _prevState$adhocMetri, _this$state$adhocMetr, _prevState$adhocMetri2, _this$state$adhocMetr2, _prevState$adhocMetri3, _prevState$adhocMetri4, _this$state$adhocMetr3, _this$state$adhocMetr4, _prevState$savedMetri, _this$state$savedMetr;\n    if (\n    ((_prevState$adhocMetri = prevState.adhocMetric) == null ? void 0 : _prevState$adhocMetri.sqlExpression) !== ((_this$state$adhocMetr =\n    this.state.adhocMetric) == null ? void 0 : _this$state$adhocMetr.sqlExpression) ||\n    ((_prevState$adhocMetri2 = prevState.adhocMetric) == null ? void 0 : _prevState$adhocMetri2.aggregate) !== ((_this$state$adhocMetr2 = this.state.adhocMetric) == null ? void 0 : _this$state$adhocMetr2.aggregate) ||\n    ((_prevState$adhocMetri3 = prevState.adhocMetric) == null ? void 0 : (_prevState$adhocMetri4 = _prevState$adhocMetri3.column) == null ? void 0 : _prevState$adhocMetri4.column_name) !== ((_this$state$adhocMetr3 =\n    this.state.adhocMetric) == null ? void 0 : (_this$state$adhocMetr4 = _this$state$adhocMetr3.column) == null ? void 0 : _this$state$adhocMetr4.column_name) ||\n    ((_prevState$savedMetri = prevState.savedMetric) == null ? void 0 : _prevState$savedMetri.metric_name) !== ((_this$state$savedMetr = this.state.savedMetric) == null ? void 0 : _this$state$savedMetr.metric_name))\n    {var _this$state$savedMetr2, _this$state$savedMetr3, _this$state$adhocMetr5;\n      this.props.getCurrentLabel({\n        savedMetricLabel:\n        ((_this$state$savedMetr2 = this.state.savedMetric) == null ? void 0 : _this$state$savedMetr2.verbose_name) || ((_this$state$savedMetr3 =\n        this.state.savedMetric) == null ? void 0 : _this$state$savedMetr3.metric_name),\n        adhocMetricLabel: (_this$state$adhocMetr5 = this.state.adhocMetric) == null ? void 0 : _this$state$adhocMetr5.getDefaultLabel()\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  getDefaultTab() {\n    const { adhocMetric, savedMetric, savedMetricsOptions, isNewMetric } =\n    this.props;\n    if (isDefined(adhocMetric.column) || isDefined(adhocMetric.sqlExpression)) {\n      return adhocMetric.expressionType;\n    }\n    if (\n    (isNewMetric || savedMetric.metric_name) &&\n    Array.isArray(savedMetricsOptions) &&\n    savedMetricsOptions.length > 0)\n    {\n      return SAVED_TAB_KEY;\n    }\n    return adhocMetric.expressionType;\n  }\n\n  onSave() {var _this$props$savedMetr;\n    const { adhocMetric, savedMetric } = this.state;\n\n    const metric = savedMetric != null && savedMetric.metric_name ? savedMetric : adhocMetric;\n    const oldMetric = (_this$props$savedMetr = this.props.savedMetric) != null && _this$props$savedMetr.metric_name ?\n    this.props.savedMetric :\n    this.props.adhocMetric;\n    this.props.onChange(\n      {\n        ...metric\n      },\n      oldMetric\n    );\n    this.props.onClose();\n  }\n\n  onResetStateAndClose() {\n    this.setState(\n      {\n        adhocMetric: this.props.adhocMetric,\n        savedMetric: this.props.savedMetric\n      },\n      this.props.onClose\n    );\n  }\n\n  onColumnChange(columnName) {\n    const column = this.props.columns.find(\n      (column) => column.column_name === columnName\n    );\n    this.setState((prevState) => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column,\n        expressionType: EXPRESSION_TYPES.SIMPLE\n      }),\n      savedMetric: undefined\n    }));\n  }\n\n  onAggregateChange(aggregate) {\n    // we construct this object explicitly to overwrite the value in the case aggregate is null\n    this.setState((prevState) => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        aggregate,\n        expressionType: EXPRESSION_TYPES.SIMPLE\n      }),\n      savedMetric: undefined\n    }));\n  }\n\n  onSavedMetricChange(savedMetricName) {\n    const savedMetric = this.props.savedMetricsOptions.find(\n      (metric) => metric.metric_name === savedMetricName\n    );\n    this.setState((prevState) => ({\n      savedMetric,\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column: undefined,\n        aggregate: undefined,\n        sqlExpression: undefined,\n        expressionType: EXPRESSION_TYPES.SIMPLE\n      })\n    }));\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.setState((prevState) => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL\n      }),\n      savedMetric: undefined\n    }));\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY),\n        POPOVER_INITIAL_HEIGHT\n      )\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(tab) {\n    this.refreshAceEditor();\n    this.props.getCurrentTab(tab);\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  refreshAceEditor() {\n    setTimeout(() => {\n      if (this.aceEditorRef) {var _this$aceEditorRef$ed;\n        (_this$aceEditorRef$ed = this.aceEditorRef.editor) == null ? void 0 : _this$aceEditorRef$ed.resize == null ? void 0 : _this$aceEditorRef$ed.resize();\n      }\n    }, 0);\n  }\n\n  renderColumnOption(option) {\n    const column = { ...option };\n    if (column.metric_name && !column.verbose_name) {\n      column.verbose_name = column.metric_name;\n    }\n    return _jsx(StyledColumnOption, { column: column, showType: true });\n  }\n\n  renderMetricOption(savedMetric) {\n    return _jsx(StyledMetricOption, { metric: savedMetric, showType: true });\n  }\n\n  render() {var _savedMetricsOptions$;\n    const {\n      adhocMetric: propsAdhocMetric,\n      savedMetric: propsSavedMetric,\n      columns,\n      savedMetricsOptions,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      isNewMetric,\n      isLabelModified,\n      ...popoverProps\n    } = this.props;\n    const { adhocMetric, savedMetric } = this.state;\n    const keywords = sqlKeywords.concat(getColumnKeywords(columns));\n\n    const columnValue =\n    adhocMetric.column && adhocMetric.column.column_name ||\n    adhocMetric.inferSqlExpressionColumn();\n\n    // autofocus on column if there's no value in column; otherwise autofocus on aggregate\n    const columnSelectProps = {\n      ariaLabel: t('Select column'),\n      placeholder: t('%s column(s)', columns.length),\n      value: columnValue,\n      onChange: this.onColumnChange,\n      allowClear: true,\n      autoFocus: !columnValue\n    };\n\n    const aggregateSelectProps = {\n      ariaLabel: t('Select aggregate options'),\n      placeholder: t('%s aggregates(s)', AGGREGATES_OPTIONS.length),\n      value: adhocMetric.aggregate || adhocMetric.inferSqlExpressionAggregate(),\n      onChange: this.onAggregateChange,\n      allowClear: true,\n      autoFocus: !!columnValue\n    };\n\n    const savedSelectProps = {\n      ariaLabel: t('Select saved metrics'),\n      placeholder: t('%s saved metric(s)', (_savedMetricsOptions$ = savedMetricsOptions == null ? void 0 : savedMetricsOptions.length) != null ? _savedMetricsOptions$ : 0),\n      value: savedMetric == null ? void 0 : savedMetric.metric_name,\n      onChange: this.onSavedMetricChange,\n      allowClear: true,\n      autoFocus: true\n    };\n\n    const stateIsValid = adhocMetric.isValid() || (savedMetric == null ? void 0 : savedMetric.metric_name);\n    const hasUnsavedChanges =\n    isLabelModified ||\n    isNewMetric ||\n    !adhocMetric.equals(propsAdhocMetric) ||\n    !(\n    typeof (savedMetric == null ? void 0 : savedMetric.metric_name) === 'undefined' &&\n    typeof (propsSavedMetric == null ? void 0 : propsSavedMetric.metric_name) === 'undefined') &&\n\n    (savedMetric == null ? void 0 : savedMetric.metric_name) !== (propsSavedMetric == null ? void 0 : propsSavedMetric.metric_name);\n\n    let extra = {};\n    if (datasource != null && datasource.extra) {\n      try {\n        extra = JSON.parse(datasource.extra);\n      } catch {} // eslint-disable-line no-empty\n    }\n\n    return (\n      _jsxs(Form, {\n        layout: \"vertical\",\n        id: \"metrics-edit-popover\",\n        \"data-test\": \"metrics-edit-popover\", ...\n        popoverProps, children: [\n\n        _jsxs(Tabs, {\n          id: \"adhoc-metric-edit-tabs\",\n          \"data-test\": \"adhoc-metric-edit-tabs\",\n          defaultActiveKey: this.defaultActiveTabKey,\n          className: \"adhoc-metric-edit-tabs\",\n          style: { height: this.state.height, width: this.state.width },\n          onChange: this.onTabChange,\n          allowOverflow: true, children: [\n\n          _jsx(Tabs.TabPane, { tab: t('Saved'), children:\n            ensureIsArray(savedMetricsOptions).length > 0 ?\n            _jsx(FormItem, { label: t('Saved metric'), children:\n              _jsx(StyledSelect, {\n                options: ensureIsArray(savedMetricsOptions).map(\n                  (savedMetric) => ({\n                    value: savedMetric.metric_name,\n                    label: savedMetric.metric_name,\n                    customLabel: this.renderMetricOption(savedMetric),\n                    key: savedMetric.id\n                  })\n                ), ...\n                savedSelectProps }\n              ) }\n            ) :\n            datasource.type === DatasourceType.Table ?\n            _jsx(EmptyState, {\n              image: \"empty.svg\",\n              size: \"small\",\n              title: t('No saved metrics found'),\n              description: t(\n                'Add metrics to dataset in \"Edit datasource\" modal'\n              ) }\n            ) :\n\n            _jsx(EmptyState, {\n              image: \"empty.svg\",\n              size: \"small\",\n              title: t('No saved metrics found'),\n              description:\n              _jsxs(_Fragment, { children: [\n                _jsx(\"span\", {\n                  tabIndex: 0,\n                  role: \"button\",\n                  onClick: () => {\n                    this.props.handleDatasetModal(true);\n                    this.props.onClose();\n                  }, children:\n\n                  t('Create a dataset') }\n                ),\n                t(' to add metrics')] }\n              ) }\n\n            ) }, SAVED_TAB_KEY\n\n          ),\n          _jsxs(Tabs.TabPane, {\n\n            tab:\n            extra.disallow_adhoc_metrics ?\n            _jsx(Tooltip, {\n              title: t(\n                'Simple ad-hoc metrics are not enabled for this dataset'\n              ), children:\n\n              t('Simple') }\n            ) :\n\n            t('Simple'),\n\n\n            disabled: extra.disallow_adhoc_metrics, children: [\n\n            _jsx(FormItem, { label: t('column'), children:\n              _jsx(Select, {\n                options: columns.map((column) => ({\n                  value: column.column_name,\n                  label: column.verbose_name || column.column_name,\n                  key: column.id,\n                  customLabel: this.renderColumnOption(column)\n                })), ...\n                columnSelectProps }\n              ) }\n            ),\n            _jsx(FormItem, { label: t('aggregate'), children:\n              _jsx(Select, {\n                options: AGGREGATES_OPTIONS.map((option) => ({\n                  value: option,\n                  label: option,\n                  key: option\n                })), ...\n                aggregateSelectProps }\n              ) }\n            )] }, EXPRESSION_TYPES.SIMPLE\n          ),\n          _jsx(Tabs.TabPane, {\n\n            tab:\n            extra.disallow_adhoc_metrics ?\n            _jsx(Tooltip, {\n              title: t(\n                'Custom SQL ad-hoc metrics are not enabled for this dataset'\n              ), children:\n\n              t('Custom SQL') }\n            ) :\n\n            t('Custom SQL'),\n\n\n            \"data-test\": \"adhoc-metric-edit-tab#custom\",\n            disabled: extra.disallow_adhoc_metrics, children:\n\n            _jsx(SQLEditor, {\n              \"data-test\": \"sql-editor\",\n              showLoadingForImport: true,\n              ref: this.handleAceEditorRef,\n              keywords: keywords,\n              height: `${this.state.height - 80}px`,\n              onChange: this.onSqlExpressionChange,\n              width: \"100%\",\n              showGutter: false,\n              value:\n              adhocMetric.sqlExpression ||\n              adhocMetric.translateToSql({ transformCountDistinct: true }),\n\n              editorProps: { $blockScrolling: true },\n              enableLiveAutocompletion: true,\n              className: \"filter-sql-editor\",\n              wrapEnabled: true }\n            ) }, EXPRESSION_TYPES.SQL\n          )] }\n        ),\n        _jsxs(\"div\", { children: [\n          _jsx(Button, {\n            buttonSize: \"small\",\n            onClick: this.onResetStateAndClose,\n            \"data-test\": \"AdhocMetricEdit#cancel\",\n            cta: true, children:\n\n            t('Close') }\n          ),\n          _jsx(Button, {\n            disabled: !stateIsValid || !hasUnsavedChanges,\n            buttonStyle: \"primary\",\n            buttonSize: \"small\",\n            \"data-test\": \"AdhocMetricEdit#save\",\n            onClick: this.onSave,\n            cta: true, children:\n\n            t('Save') }\n          ),\n\n\n          _jsx(\"i\", {\n            role: \"button\",\n            \"aria-label\": \"Resize\",\n            tabIndex: 0,\n            onMouseDown: this.onDragDown,\n            className: \"fa fa-expand edit-popover-resize text-muted\" }\n          )] }\n        )] }\n      ));\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}AdhocMetricEditPopover.propTypes = propTypes;\nAdhocMetricEditPopover.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx\");reactHotLoader.register(StyledSelect, \"StyledSelect\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx\");reactHotLoader.register(SAVED_TAB_KEY, \"SAVED_TAB_KEY\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx\");reactHotLoader.register(AdhocMetricEditPopover, \"AdhocMetricEditPopover\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["PureComponent","PropTypes","isDefined","t","styled","ensureIsArray","DatasourceType","Tabs","Button","Select","Tooltip","EmptyState","Form","FormItem","SQLEditor","sqlKeywords","noOp","AGGREGATES_OPTIONS","POPOVER_INITIAL_HEIGHT","POPOVER_INITIAL_WIDTH","columnType","savedMetricType","AdhocMetric","EXPRESSION_TYPES","StyledMetricOption","StyledColumnOption","getColumnKeywords","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","propTypes","onChange","func","isRequired","onClose","onResize","getCurrentTab","getCurrentLabel","adhocMetric","instanceOf","columns","arrayOf","savedMetricsOptions","savedMetric","datasource","object","isNewMetric","bool","isLabelModified","defaultProps","StyledSelect","theme","gridUnit","SAVED_TAB_KEY","AdhocMetricEditPopover","constructor","props","defaultActiveTabKey","getDefaultTab","onSave","bind","onResetStateAndClose","onColumnChange","onAggregateChange","onSavedMetricChange","onSqlExpressionChange","onDragDown","onMouseMove","onMouseUp","onTabChange","handleAceEditorRef","refreshAceEditor","state","width","height","document","addEventListener","componentDidMount","componentDidUpdate","prevProps","prevState","_prevState$adhocMetri","_this$state$adhocMetr","_prevState$adhocMetri2","_this$state$adhocMetr2","_prevState$adhocMetri3","_prevState$adhocMetri4","_this$state$adhocMetr3","_this$state$adhocMetr4","_prevState$savedMetri","_this$state$savedMetr","sqlExpression","aggregate","column","column_name","metric_name","_this$state$savedMetr2","_this$state$savedMetr3","_this$state$adhocMetr5","savedMetricLabel","verbose_name","adhocMetricLabel","getDefaultLabel","componentWillUnmount","removeEventListener","expressionType","Array","isArray","length","_this$props$savedMetr","metric","oldMetric","setState","columnName","find","duplicateWith","SIMPLE","undefined","savedMetricName","SQL","e","dragStartX","clientX","dragStartY","clientY","dragStartWidth","dragStartHeight","Math","max","tab","ref","aceEditorRef","setTimeout","_this$aceEditorRef$ed","editor","resize","renderColumnOption","option","showType","renderMetricOption","render","_savedMetricsOptions$","propsAdhocMetric","propsSavedMetric","popoverProps","keywords","concat","columnValue","inferSqlExpressionColumn","columnSelectProps","ariaLabel","placeholder","value","allowClear","autoFocus","aggregateSelectProps","inferSqlExpressionAggregate","savedSelectProps","stateIsValid","isValid","hasUnsavedChanges","equals","extra","JSON","parse","layout","id","children","defaultActiveKey","className","style","allowOverflow","TabPane","label","options","map","customLabel","key","type","Table","image","size","title","description","tabIndex","role","onClick","handleDatasetModal","disallow_adhoc_metrics","disabled","showLoadingForImport","showGutter","translateToSql","transformCountDistinct","editorProps","$blockScrolling","enableLiveAutocompletion","wrapEnabled","buttonSize","cta","buttonStyle","onMouseDown","__reactstandin__regenerateByEval","code","eval","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  isDefined,\n  t,\n  styled,\n  ensureIsArray,\n  DatasourceType,\n} from '@superset-ui/core';\nimport Tabs from 'src/components/Tabs';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { EmptyState } from 'src/components/EmptyState';\nimport { Form, FormItem } from 'src/components/Form';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\nimport { noOp } from 'src/utils/common';\nimport {\n  AGGREGATES_OPTIONS,\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\nimport columnType from 'src/explore/components/controls/MetricControl/columnType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric, {\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  StyledMetricOption,\n  StyledColumnOption,\n} from 'src/explore/components/optionRenderers';\nimport { getColumnKeywords } from 'src/explore/controlUtils/getColumnKeywords';\n\nconst propTypes = {\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  getCurrentTab: PropTypes.func,\n  getCurrentLabel: PropTypes.func,\n  adhocMetric: PropTypes.instanceOf(AdhocMetric).isRequired,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  savedMetric: savedMetricType,\n  datasource: PropTypes.object,\n  isNewMetric: PropTypes.bool,\n  isLabelModified: PropTypes.bool,\n};\n\nconst defaultProps = {\n  columns: [],\n  getCurrentTab: noOp,\n  isNewMetric: false,\n};\n\nconst StyledSelect = styled(Select)`\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\nexport const SAVED_TAB_KEY = 'SAVED';\n\nexport default class AdhocMetricEditPopover extends PureComponent {\n  // \"Saved\" is a default tab unless there are no saved metrics for dataset\n  defaultActiveTabKey = this.getDefaultTab();\n\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onResetStateAndClose = this.onResetStateAndClose.bind(this);\n    this.onColumnChange = this.onColumnChange.bind(this);\n    this.onAggregateChange = this.onAggregateChange.bind(this);\n    this.onSavedMetricChange = this.onSavedMetricChange.bind(this);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n    this.refreshAceEditor = this.refreshAceEditor.bind(this);\n    this.getDefaultTab = this.getDefaultTab.bind(this);\n\n    this.state = {\n      adhocMetric: this.props.adhocMetric,\n      savedMetric: this.props.savedMetric,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT,\n    };\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentDidMount() {\n    this.props.getCurrentTab(this.defaultActiveTabKey);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      prevState.adhocMetric?.sqlExpression !==\n        this.state.adhocMetric?.sqlExpression ||\n      prevState.adhocMetric?.aggregate !== this.state.adhocMetric?.aggregate ||\n      prevState.adhocMetric?.column?.column_name !==\n        this.state.adhocMetric?.column?.column_name ||\n      prevState.savedMetric?.metric_name !== this.state.savedMetric?.metric_name\n    ) {\n      this.props.getCurrentLabel({\n        savedMetricLabel:\n          this.state.savedMetric?.verbose_name ||\n          this.state.savedMetric?.metric_name,\n        adhocMetricLabel: this.state.adhocMetric?.getDefaultLabel(),\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  getDefaultTab() {\n    const { adhocMetric, savedMetric, savedMetricsOptions, isNewMetric } =\n      this.props;\n    if (isDefined(adhocMetric.column) || isDefined(adhocMetric.sqlExpression)) {\n      return adhocMetric.expressionType;\n    }\n    if (\n      (isNewMetric || savedMetric.metric_name) &&\n      Array.isArray(savedMetricsOptions) &&\n      savedMetricsOptions.length > 0\n    ) {\n      return SAVED_TAB_KEY;\n    }\n    return adhocMetric.expressionType;\n  }\n\n  onSave() {\n    const { adhocMetric, savedMetric } = this.state;\n\n    const metric = savedMetric?.metric_name ? savedMetric : adhocMetric;\n    const oldMetric = this.props.savedMetric?.metric_name\n      ? this.props.savedMetric\n      : this.props.adhocMetric;\n    this.props.onChange(\n      {\n        ...metric,\n      },\n      oldMetric,\n    );\n    this.props.onClose();\n  }\n\n  onResetStateAndClose() {\n    this.setState(\n      {\n        adhocMetric: this.props.adhocMetric,\n        savedMetric: this.props.savedMetric,\n      },\n      this.props.onClose,\n    );\n  }\n\n  onColumnChange(columnName) {\n    const column = this.props.columns.find(\n      column => column.column_name === columnName,\n    );\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onAggregateChange(aggregate) {\n    // we construct this object explicitly to overwrite the value in the case aggregate is null\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        aggregate,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onSavedMetricChange(savedMetricName) {\n    const savedMetric = this.props.savedMetricsOptions.find(\n      metric => metric.metric_name === savedMetricName,\n    );\n    this.setState(prevState => ({\n      savedMetric,\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column: undefined,\n        aggregate: undefined,\n        sqlExpression: undefined,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    }));\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY),\n        POPOVER_INITIAL_HEIGHT,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(tab) {\n    this.refreshAceEditor();\n    this.props.getCurrentTab(tab);\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  refreshAceEditor() {\n    setTimeout(() => {\n      if (this.aceEditorRef) {\n        this.aceEditorRef.editor?.resize?.();\n      }\n    }, 0);\n  }\n\n  renderColumnOption(option) {\n    const column = { ...option };\n    if (column.metric_name && !column.verbose_name) {\n      column.verbose_name = column.metric_name;\n    }\n    return <StyledColumnOption column={column} showType />;\n  }\n\n  renderMetricOption(savedMetric) {\n    return <StyledMetricOption metric={savedMetric} showType />;\n  }\n\n  render() {\n    const {\n      adhocMetric: propsAdhocMetric,\n      savedMetric: propsSavedMetric,\n      columns,\n      savedMetricsOptions,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      isNewMetric,\n      isLabelModified,\n      ...popoverProps\n    } = this.props;\n    const { adhocMetric, savedMetric } = this.state;\n    const keywords = sqlKeywords.concat(getColumnKeywords(columns));\n\n    const columnValue =\n      (adhocMetric.column && adhocMetric.column.column_name) ||\n      adhocMetric.inferSqlExpressionColumn();\n\n    // autofocus on column if there's no value in column; otherwise autofocus on aggregate\n    const columnSelectProps = {\n      ariaLabel: t('Select column'),\n      placeholder: t('%s column(s)', columns.length),\n      value: columnValue,\n      onChange: this.onColumnChange,\n      allowClear: true,\n      autoFocus: !columnValue,\n    };\n\n    const aggregateSelectProps = {\n      ariaLabel: t('Select aggregate options'),\n      placeholder: t('%s aggregates(s)', AGGREGATES_OPTIONS.length),\n      value: adhocMetric.aggregate || adhocMetric.inferSqlExpressionAggregate(),\n      onChange: this.onAggregateChange,\n      allowClear: true,\n      autoFocus: !!columnValue,\n    };\n\n    const savedSelectProps = {\n      ariaLabel: t('Select saved metrics'),\n      placeholder: t('%s saved metric(s)', savedMetricsOptions?.length ?? 0),\n      value: savedMetric?.metric_name,\n      onChange: this.onSavedMetricChange,\n      allowClear: true,\n      autoFocus: true,\n    };\n\n    const stateIsValid = adhocMetric.isValid() || savedMetric?.metric_name;\n    const hasUnsavedChanges =\n      isLabelModified ||\n      isNewMetric ||\n      !adhocMetric.equals(propsAdhocMetric) ||\n      (!(\n        typeof savedMetric?.metric_name === 'undefined' &&\n        typeof propsSavedMetric?.metric_name === 'undefined'\n      ) &&\n        savedMetric?.metric_name !== propsSavedMetric?.metric_name);\n\n    let extra = {};\n    if (datasource?.extra) {\n      try {\n        extra = JSON.parse(datasource.extra);\n      } catch {} // eslint-disable-line no-empty\n    }\n\n    return (\n      <Form\n        layout=\"vertical\"\n        id=\"metrics-edit-popover\"\n        data-test=\"metrics-edit-popover\"\n        {...popoverProps}\n      >\n        <Tabs\n          id=\"adhoc-metric-edit-tabs\"\n          data-test=\"adhoc-metric-edit-tabs\"\n          defaultActiveKey={this.defaultActiveTabKey}\n          className=\"adhoc-metric-edit-tabs\"\n          style={{ height: this.state.height, width: this.state.width }}\n          onChange={this.onTabChange}\n          allowOverflow\n        >\n          <Tabs.TabPane key={SAVED_TAB_KEY} tab={t('Saved')}>\n            {ensureIsArray(savedMetricsOptions).length > 0 ? (\n              <FormItem label={t('Saved metric')}>\n                <StyledSelect\n                  options={ensureIsArray(savedMetricsOptions).map(\n                    savedMetric => ({\n                      value: savedMetric.metric_name,\n                      label: savedMetric.metric_name,\n                      customLabel: this.renderMetricOption(savedMetric),\n                      key: savedMetric.id,\n                    }),\n                  )}\n                  {...savedSelectProps}\n                />\n              </FormItem>\n            ) : datasource.type === DatasourceType.Table ? (\n              <EmptyState\n                image=\"empty.svg\"\n                size=\"small\"\n                title={t('No saved metrics found')}\n                description={t(\n                  'Add metrics to dataset in \"Edit datasource\" modal',\n                )}\n              />\n            ) : (\n              <EmptyState\n                image=\"empty.svg\"\n                size=\"small\"\n                title={t('No saved metrics found')}\n                description={\n                  <>\n                    <span\n                      tabIndex={0}\n                      role=\"button\"\n                      onClick={() => {\n                        this.props.handleDatasetModal(true);\n                        this.props.onClose();\n                      }}\n                    >\n                      {t('Create a dataset')}\n                    </span>\n                    {t(' to add metrics')}\n                  </>\n                }\n              />\n            )}\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            key={EXPRESSION_TYPES.SIMPLE}\n            tab={\n              extra.disallow_adhoc_metrics ? (\n                <Tooltip\n                  title={t(\n                    'Simple ad-hoc metrics are not enabled for this dataset',\n                  )}\n                >\n                  {t('Simple')}\n                </Tooltip>\n              ) : (\n                t('Simple')\n              )\n            }\n            disabled={extra.disallow_adhoc_metrics}\n          >\n            <FormItem label={t('column')}>\n              <Select\n                options={columns.map(column => ({\n                  value: column.column_name,\n                  label: column.verbose_name || column.column_name,\n                  key: column.id,\n                  customLabel: this.renderColumnOption(column),\n                }))}\n                {...columnSelectProps}\n              />\n            </FormItem>\n            <FormItem label={t('aggregate')}>\n              <Select\n                options={AGGREGATES_OPTIONS.map(option => ({\n                  value: option,\n                  label: option,\n                  key: option,\n                }))}\n                {...aggregateSelectProps}\n              />\n            </FormItem>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            key={EXPRESSION_TYPES.SQL}\n            tab={\n              extra.disallow_adhoc_metrics ? (\n                <Tooltip\n                  title={t(\n                    'Custom SQL ad-hoc metrics are not enabled for this dataset',\n                  )}\n                >\n                  {t('Custom SQL')}\n                </Tooltip>\n              ) : (\n                t('Custom SQL')\n              )\n            }\n            data-test=\"adhoc-metric-edit-tab#custom\"\n            disabled={extra.disallow_adhoc_metrics}\n          >\n            <SQLEditor\n              data-test=\"sql-editor\"\n              showLoadingForImport\n              ref={this.handleAceEditorRef}\n              keywords={keywords}\n              height={`${this.state.height - 80}px`}\n              onChange={this.onSqlExpressionChange}\n              width=\"100%\"\n              showGutter={false}\n              value={\n                adhocMetric.sqlExpression ||\n                adhocMetric.translateToSql({ transformCountDistinct: true })\n              }\n              editorProps={{ $blockScrolling: true }}\n              enableLiveAutocompletion\n              className=\"filter-sql-editor\"\n              wrapEnabled\n            />\n          </Tabs.TabPane>\n        </Tabs>\n        <div>\n          <Button\n            buttonSize=\"small\"\n            onClick={this.onResetStateAndClose}\n            data-test=\"AdhocMetricEdit#cancel\"\n            cta\n          >\n            {t('Close')}\n          </Button>\n          <Button\n            disabled={!stateIsValid || !hasUnsavedChanges}\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            data-test=\"AdhocMetricEdit#save\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          {/* TODO: Remove fa-icon */}\n          {/* eslint-disable-next-line icons/no-fa-icons-usage */}\n          <i\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </div>\n      </Form>\n    );\n  }\n}\nAdhocMetricEditPopover.propTypes = propTypes;\nAdhocMetricEditPopover.defaultProps = defaultProps;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}