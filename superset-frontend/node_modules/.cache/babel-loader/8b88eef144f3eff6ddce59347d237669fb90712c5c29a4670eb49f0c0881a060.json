{"ast":null,"code":"import _mergeWith from \"lodash/mergeWith\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useMemo, useState } from 'react';\nimport rehypeSanitize, { defaultSchema } from 'rehype-sanitize';\nimport remarkGfm from 'remark-gfm';\n\nimport { FeatureFlag, isFeatureEnabled } from '../utils';import { jsx as _jsx } from \"@emotion/react/jsx-runtime\";\nexport function getOverrideHtmlSchema(originalSchema, htmlSchemaOverrides) {\n  return _mergeWith(originalSchema, htmlSchemaOverrides, (objValue, srcValue) => Array.isArray(objValue) ? objValue.concat(srcValue) : undefined);\n}\nfunction SafeMarkdown({ source, htmlSanitization = true, htmlSchemaOverrides = {} }) {\n  const escapeHtml = isFeatureEnabled(FeatureFlag.EscapeMarkdownHtml);\n  const [rehypeRawPlugin, setRehypeRawPlugin] = useState(null);\n  const [ReactMarkdown, setReactMarkdown] = useState(null);\n  useEffect(() => {\n    Promise.all([import('rehype-raw'), import('react-markdown')]).then(([rehypeRaw, ReactMarkdown]) => {\n      setRehypeRawPlugin(() => rehypeRaw.default);\n      setReactMarkdown(() => ReactMarkdown.default);\n    });\n  }, []);\n  const rehypePlugins = useMemo(() => {\n    const rehypePlugins = [];\n    if (!escapeHtml && rehypeRawPlugin) {\n      rehypePlugins.push(rehypeRawPlugin);\n      if (htmlSanitization) {\n        const schema = getOverrideHtmlSchema(defaultSchema, htmlSchemaOverrides);\n        rehypePlugins.push([rehypeSanitize, schema]);\n      }\n    }\n    return rehypePlugins;\n  }, [escapeHtml, htmlSanitization, htmlSchemaOverrides, rehypeRawPlugin]);\n  if (!ReactMarkdown || !rehypeRawPlugin) {\n    return null;\n  }\n  // React Markdown escapes HTML by default\n  return _jsx(ReactMarkdown, { rehypePlugins: rehypePlugins, remarkPlugins: [remarkGfm], skipHtml: false, transformLinkUri: null, children:\n    source }\n  );\n}__signature__(SafeMarkdown, \"useState{[rehypeRawPlugin, setRehypeRawPlugin](null)}\\nuseState{[ReactMarkdown, setReactMarkdown](null)}\\nuseEffect{}\\nuseMemo{rehypePlugins}\");const _default =\nSafeMarkdown;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(getOverrideHtmlSchema, \"getOverrideHtmlSchema\", \"/Users/aryurkov/superset/superset-frontend/packages/superset-ui-core/src/components/SafeMarkdown.tsx\");reactHotLoader.register(SafeMarkdown, \"SafeMarkdown\", \"/Users/aryurkov/superset/superset-frontend/packages/superset-ui-core/src/components/SafeMarkdown.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/aryurkov/superset/superset-frontend/packages/superset-ui-core/src/components/SafeMarkdown.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useEffect","useMemo","useState","rehypeSanitize","defaultSchema","remarkGfm","FeatureFlag","isFeatureEnabled","jsx","_jsx","getOverrideHtmlSchema","originalSchema","htmlSchemaOverrides","_mergeWith","objValue","srcValue","Array","isArray","concat","undefined","SafeMarkdown","source","htmlSanitization","escapeHtml","EscapeMarkdownHtml","rehypeRawPlugin","setRehypeRawPlugin","ReactMarkdown","setReactMarkdown","Promise","all","then","rehypeRaw","default","rehypePlugins","push","schema","remarkPlugins","skipHtml","transformLinkUri","children","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/packages/superset-ui-core/src/components/SafeMarkdown.tsx"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useMemo, useState } from 'react';\nimport rehypeSanitize, { defaultSchema } from 'rehype-sanitize';\nimport remarkGfm from 'remark-gfm';\nimport { mergeWith } from 'lodash';\nimport { FeatureFlag, isFeatureEnabled } from '../utils';\n\ninterface SafeMarkdownProps {\n  source: string;\n  htmlSanitization?: boolean;\n  htmlSchemaOverrides?: typeof defaultSchema;\n}\n\nexport function getOverrideHtmlSchema(\n  originalSchema: typeof defaultSchema,\n  htmlSchemaOverrides: SafeMarkdownProps['htmlSchemaOverrides'],\n) {\n  return mergeWith(originalSchema, htmlSchemaOverrides, (objValue, srcValue) =>\n    Array.isArray(objValue) ? objValue.concat(srcValue) : undefined,\n  );\n}\n\nfunction SafeMarkdown({\n  source,\n  htmlSanitization = true,\n  htmlSchemaOverrides = {},\n}: SafeMarkdownProps) {\n  const escapeHtml = isFeatureEnabled(FeatureFlag.EscapeMarkdownHtml);\n  const [rehypeRawPlugin, setRehypeRawPlugin] = useState<any>(null);\n  const [ReactMarkdown, setReactMarkdown] = useState<any>(null);\n  useEffect(() => {\n    Promise.all([import('rehype-raw'), import('react-markdown')]).then(\n      ([rehypeRaw, ReactMarkdown]) => {\n        setRehypeRawPlugin(() => rehypeRaw.default);\n        setReactMarkdown(() => ReactMarkdown.default);\n      },\n    );\n  }, []);\n\n  const rehypePlugins = useMemo(() => {\n    const rehypePlugins: any = [];\n    if (!escapeHtml && rehypeRawPlugin) {\n      rehypePlugins.push(rehypeRawPlugin);\n      if (htmlSanitization) {\n        const schema = getOverrideHtmlSchema(\n          defaultSchema,\n          htmlSchemaOverrides,\n        );\n        rehypePlugins.push([rehypeSanitize, schema]);\n      }\n    }\n    return rehypePlugins;\n  }, [escapeHtml, htmlSanitization, htmlSchemaOverrides, rehypeRawPlugin]);\n\n  if (!ReactMarkdown || !rehypeRawPlugin) {\n    return null;\n  }\n\n  // React Markdown escapes HTML by default\n  return (\n    <ReactMarkdown\n      rehypePlugins={rehypePlugins}\n      remarkPlugins={[remarkGfm]}\n      skipHtml={false}\n      transformLinkUri={null}\n    >\n      {source}\n    </ReactMarkdown>\n  );\n}\n\nexport default SafeMarkdown;\n"],"mappings":"kVAAA;;;;;;;;;;;;;;;;;;AAkBA,SAASA,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AACpD,OAAOC,cAAc,IAAIC,aAAa,QAAQ,iBAAiB;AAC/D,OAAOC,SAAS,MAAM,YAAY;;AAElC,SAASC,WAAW,EAAEC,gBAAgB,QAAQ,UAAU,CAAC,SAAAC,GAAA,IAAAC,IAAA;AAQzD,OAAM,SAAUC,qBAAqBA,CACnCC,cAAoC,EACpCC,mBAA6D;EAE7D,OAAOC,UAAA,CAAUF,cAAc,EAAEC,mBAAmB,EAAE,CAACE,QAAQ,EAAEC,QAAQ,KACvEC,KAAK,CAACC,OAAO,CAACH,QAAQ,CAAC,GAAGA,QAAQ,CAACI,MAAM,CAACH,QAAQ,CAAC,GAAGI,SAAS,CAChE;AACH;AAEA,SAASC,YAAYA,CAAC,EACpBC,MAAM,EACNC,gBAAgB,GAAG,IAAI,EACvBV,mBAAmB,GAAG,EAAE,EACN;EAClB,MAAMW,UAAU,GAAGhB,gBAAgB,CAACD,WAAW,CAACkB,kBAAkB,CAAC;EACnE,MAAM,CAACC,eAAe,EAAEC,kBAAkB,CAAC,GAAGxB,QAAQ,CAAM,IAAI,CAAC;EACjE,MAAM,CAACyB,aAAa,EAAEC,gBAAgB,CAAC,GAAG1B,QAAQ,CAAM,IAAI,CAAC;EAC7DF,SAAS,CAAC,MAAK;IACb6B,OAAO,CAACC,GAAG,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE,MAAM,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAACC,IAAI,CAChE,CAAC,CAACC,SAAS,EAAEL,aAAa,CAAC,KAAI;MAC7BD,kBAAkB,CAAC,MAAMM,SAAS,CAACC,OAAO,CAAC;MAC3CL,gBAAgB,CAAC,MAAMD,aAAa,CAACM,OAAO,CAAC;IAC/C,CAAC,CACF;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMC,aAAa,GAAGjC,OAAO,CAAC,MAAK;IACjC,MAAMiC,aAAa,GAAQ,EAAE;IAC7B,IAAI,CAACX,UAAU,IAAIE,eAAe,EAAE;MAClCS,aAAa,CAACC,IAAI,CAACV,eAAe,CAAC;MACnC,IAAIH,gBAAgB,EAAE;QACpB,MAAMc,MAAM,GAAG1B,qBAAqB,CAClCN,aAAa,EACbQ,mBAAmB,CACpB;QACDsB,aAAa,CAACC,IAAI,CAAC,CAAChC,cAAc,EAAEiC,MAAM,CAAC,CAAC;;;IAGhD,OAAOF,aAAa;EACtB,CAAC,EAAE,CAACX,UAAU,EAAED,gBAAgB,EAAEV,mBAAmB,EAAEa,eAAe,CAAC,CAAC;EAExE,IAAI,CAACE,aAAa,IAAI,CAACF,eAAe,EAAE;IACtC,OAAO,IAAI;;EAGb;EACA,OACEhB,IAAA,CAACkB,aAAa,IACZO,aAAa,EAAEA,aAAc,EAC7BG,aAAa,EAAE,CAAChC,SAAS,CAAE,EAC3BiC,QAAQ,EAAE,KAAM,EAChBC,gBAAgB,EAAE,IAAK,EAAAC,QAAA;IAEtBnB,MAAM;EACM,CAAC;AAEpB,CAACoB,aAAA,CA/CQrB,YAAY,yJAAAsB,QAAA;AAiDNtB,YAAY,CAA3B,eAAAsB,QAAA,CAA4B,mBAAAC,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAX,OAAA,GAAAd,SAAA,MAAAwB,cAAA,WAAAA,cAAA,CAAAE,QAAA,CA1DZnC,qBAAqB,mIAAAiC,cAAA,CAAAE,QAAA,CAS5BzB,YAAY,0HAAAuB,cAAA,CAAAE,QAAA,CAAAH,QAAA,6IAAAI,WAAA,UAAAF,oBAAA,mBAAAA,oBAAA,CAAAE,WAAA,GAAA3B,SAAA,CAAA2B,WAAA,IAAAA,WAAA,CAAAC,MAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}