{"ast":null,"code":"import _isPlainObject from \"lodash/isPlainObject\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SafeMarkdown, styled, t } from '@superset-ui/core';\nimport Handlebars from 'handlebars';\nimport dayjs from 'dayjs';\nimport { useMemo, useState } from 'react';\n\nimport Helpers from 'just-handlebars-helpers';\nimport HandlebarsGroupBy from 'handlebars-group-by';import { jsx as _jsx } from \"@emotion/react/jsx-runtime\";\nexport const HandlebarsViewer = ({ templateSource, data }) => {var _common$conf$HTML_SAN, _common$conf, _common$conf2;\n  const [renderedTemplate, setRenderedTemplate] = useState('');\n  const [error, setError] = useState('');\n  const appContainer = document.getElementById('app');\n  const { common } = JSON.parse((appContainer == null ? void 0 : appContainer.getAttribute('data-bootstrap')) || '{}');\n  const htmlSanitization = (_common$conf$HTML_SAN = common == null ? void 0 : (_common$conf = common.conf) == null ? void 0 : _common$conf.HTML_SANITIZATION) != null ? _common$conf$HTML_SAN : true;\n  const htmlSchemaOverrides = (common == null ? void 0 : (_common$conf2 = common.conf) == null ? void 0 : _common$conf2.HTML_SANITIZATION_SCHEMA_EXTENSIONS) || {};\n  useMemo(() => {\n    try {\n      const template = Handlebars.compile(templateSource);\n      const result = template(data);\n      setRenderedTemplate(result);\n      setError('');\n    }\n    catch (error) {\n      setRenderedTemplate('');\n      setError(error.message);\n    }\n  }, [templateSource, data]);\n  const Error = styled.pre`\n    white-space: pre-wrap;\n  `;\n  if (error) {\n    return _jsx(Error, { children: error });\n  }\n  if (renderedTemplate) {\n    return _jsx(SafeMarkdown, { source: renderedTemplate, htmlSanitization: htmlSanitization, htmlSchemaOverrides: htmlSchemaOverrides });\n  }\n  return _jsx(\"p\", { children: t('Loading...') });\n};\n//  usage: {{dateFormat my_date format=\"MMMM YYYY\"}}\n__signature__(HandlebarsViewer, \"useState{[renderedTemplate, setRenderedTemplate]('')}\\nuseState{[error, setError]('')}\\nuseMemo{}\");Handlebars.registerHelper('dateFormat', function (context, block) {\n  const f = block.hash.format || 'YYYY-MM-DD';\n  return dayjs(context).format(f);\n});\n// usage: {{  }}\nHandlebars.registerHelper('stringify', (obj, obj2) => {\n  // calling without an argument\n  if (obj2 === undefined)\n  throw Error('Please call with an object. Example: `stringify myObj`');\n  return _isPlainObject(obj) ? JSON.stringify(obj) : String(obj);\n});\nHandlebars.registerHelper('formatNumber', function (number, locale = 'en-US') {\n  if (typeof number !== 'number') {\n    return number;\n  }\n  return number.toLocaleString(locale);\n});\n// usage: {{parseJson jsonString}}\nHandlebars.registerHelper('parseJson', (jsonString) => {\n  try {\n    return JSON.parse(jsonString);\n  }\n  catch (error) {\n    if (error instanceof Error) {\n      error.message = `Invalid JSON string: ${error.message}`;\n      throw error;\n    }\n    throw new Error(`Invalid JSON string: ${String(error)}`);\n  }\n});\nHelpers.registerHelpers(Handlebars);\nHandlebarsGroupBy.register(Handlebars);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(HandlebarsViewer, \"HandlebarsViewer\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-handlebars/src/components/Handlebars/HandlebarsViewer.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["SafeMarkdown","styled","t","Handlebars","dayjs","useMemo","useState","Helpers","HandlebarsGroupBy","jsx","_jsx","HandlebarsViewer","templateSource","data","_common$conf$HTML_SAN","_common$conf","_common$conf2","renderedTemplate","setRenderedTemplate","error","setError","appContainer","document","getElementById","common","JSON","parse","getAttribute","htmlSanitization","conf","HTML_SANITIZATION","htmlSchemaOverrides","HTML_SANITIZATION_SCHEMA_EXTENSIONS","template","compile","result","message","Error","pre","children","source","__signature__","registerHelper","context","block","f","hash","format","obj","obj2","undefined","_isPlainObject","stringify","String","number","locale","toLocaleString","jsonString","registerHelpers","register","reactHotLoader","reactHotLoaderGlobal","default","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-handlebars/src/components/Handlebars/HandlebarsViewer.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SafeMarkdown, styled, t } from '@superset-ui/core';\nimport Handlebars from 'handlebars';\nimport dayjs from 'dayjs';\nimport { useMemo, useState } from 'react';\nimport { isPlainObject } from 'lodash';\nimport Helpers from 'just-handlebars-helpers';\nimport HandlebarsGroupBy from 'handlebars-group-by';\n\nexport interface HandlebarsViewerProps {\n  templateSource: string;\n  data: any;\n}\n\nexport const HandlebarsViewer = ({\n  templateSource,\n  data,\n}: HandlebarsViewerProps) => {\n  const [renderedTemplate, setRenderedTemplate] = useState('');\n  const [error, setError] = useState('');\n  const appContainer = document.getElementById('app');\n  const { common } = JSON.parse(\n    appContainer?.getAttribute('data-bootstrap') || '{}',\n  );\n  const htmlSanitization = common?.conf?.HTML_SANITIZATION ?? true;\n  const htmlSchemaOverrides =\n    common?.conf?.HTML_SANITIZATION_SCHEMA_EXTENSIONS || {};\n\n  useMemo(() => {\n    try {\n      const template = Handlebars.compile(templateSource);\n      const result = template(data);\n      setRenderedTemplate(result);\n      setError('');\n    } catch (error) {\n      setRenderedTemplate('');\n      setError(error.message);\n    }\n  }, [templateSource, data]);\n\n  const Error = styled.pre`\n    white-space: pre-wrap;\n  `;\n\n  if (error) {\n    return <Error>{error}</Error>;\n  }\n\n  if (renderedTemplate) {\n    return (\n      <SafeMarkdown\n        source={renderedTemplate}\n        htmlSanitization={htmlSanitization}\n        htmlSchemaOverrides={htmlSchemaOverrides}\n      />\n    );\n  }\n  return <p>{t('Loading...')}</p>;\n};\n\n//  usage: {{dateFormat my_date format=\"MMMM YYYY\"}}\nHandlebars.registerHelper('dateFormat', function (context, block) {\n  const f = block.hash.format || 'YYYY-MM-DD';\n  return dayjs(context).format(f);\n});\n\n// usage: {{  }}\nHandlebars.registerHelper('stringify', (obj: any, obj2: any) => {\n  // calling without an argument\n  if (obj2 === undefined)\n    throw Error('Please call with an object. Example: `stringify myObj`');\n  return isPlainObject(obj) ? JSON.stringify(obj) : String(obj);\n});\n\nHandlebars.registerHelper(\n  'formatNumber',\n  function (number: any, locale = 'en-US') {\n    if (typeof number !== 'number') {\n      return number;\n    }\n    return number.toLocaleString(locale);\n  },\n);\n\n// usage: {{parseJson jsonString}}\nHandlebars.registerHelper('parseJson', (jsonString: string) => {\n  try {\n    return JSON.parse(jsonString);\n  } catch (error) {\n    if (error instanceof Error) {\n      error.message = `Invalid JSON string: ${error.message}`;\n      throw error;\n    }\n    throw new Error(`Invalid JSON string: ${String(error)}`);\n  }\n});\n\nHelpers.registerHelpers(Handlebars);\nHandlebarsGroupBy.register(Handlebars);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}