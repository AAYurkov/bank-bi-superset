{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _pick from \"lodash/pick\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useEffect, useState, memo } from 'react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\n\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport { nanoid } from 'nanoid';\nimport { QueryState, styled, t, tn, useTheme, usePrevious, css, getNumberFormatter, getExtensionsRegistry, ErrorTypeEnum } from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport { EXPLORE_CHART_DEFAULT } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport Card from 'src/components/Card';\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport { getItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\nimport Modal from 'src/components/Modal';\nimport { addQueryEditor, clearQueryResults, CtasEnum, fetchQueryResults, reFetchQueryResults, reRunQuery } from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport useLogAction from 'src/logger/useLogAction';\nimport { LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD, LOG_ACTIONS_SQLLAB_CREATE_CHART, LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV } from 'src/logger/LogUtils';\nimport { Icons } from 'src/components/Icons';\nimport { findPermission } from 'src/utils/findPermission';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nvar LimitingFactor;\n(function (LimitingFactor) {\n  LimitingFactor[\"Query\"] = \"QUERY\";\n  LimitingFactor[\"QueryAndDropdown\"] = \"QUERY_AND_DROPDOWN\";\n  LimitingFactor[\"Dropdown\"] = \"DROPDOWN\";\n  LimitingFactor[\"NotLimited\"] = \"NOT_LIMITED\";\n})(LimitingFactor || (LimitingFactor = {}));\nconst ResultContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  row-gap: ${({ theme }) => theme.gridUnit * 2}px;\n`;\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${({ theme }) => theme.gridUnit * 25}px;\n  [role='alert'] {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n`;\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\nconst ReturnedRows = styled.div`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  line-height: 1;\n`;\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n`;\nconst copyButtonStyles = css`\n  &:hover {\n    text-decoration: unset;\n  }\n  span > :first-of-type {\n    margin: 0px;\n  }\n`;\nconst ROWS_CHIP_WIDTH = 100;\nconst GAP = 8;\nconst extensionsRegistry = getExtensionsRegistry();\nconst ResultSet = ({ cache = false, csv = true, database = {}, displayLimit, height, queryId, search = true, showSql = false, showSqlInline = false, visualize = true, defaultQueryLimit }) => {var _extensionsRegistry$g, _query$results2, _query$extra$progress, _query$extra2;\n  const user = useSelector(({ user }) => user, shallowEqual);\n  const query = useSelector(({ sqlLab: { queries } }) => _pick(queries[queryId], [\n  'id',\n  'errorMessage',\n  'cached',\n  'results',\n  'resultsKey',\n  'dbId',\n  'tab',\n  'sql',\n  'sqlEditorId',\n  'templateParams',\n  'schema',\n  'rows',\n  'queryLimit',\n  'limitingFactor',\n  'trackingUrl',\n  'state',\n  'errors',\n  'link',\n  'ctas',\n  'ctas_method',\n  'tempSchema',\n  'tempTable',\n  'isDataPreview',\n  'progress',\n  'extra']\n  ), shallowEqual);\n  const ResultTable = (_extensionsRegistry$g = extensionsRegistry.get('sqleditor.extension.resultTable')) != null ? _extensionsRegistry$g :\n  FilterableTable;\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const logAction = useLogAction({ queryId, sqlEditorId: query.sqlEditorId });\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (query.errorMessage &&\n    query.errorMessage.indexOf('session timed out') > 0) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n  const fetchResults = (q, timeout) => {\n    dispatch(fetchQueryResults(q, displayLimit, timeout));\n  };\n  const prevQuery = usePrevious(query);\n  useEffect(() => {var _query$results, _query$results$data;\n    if (cache && query.cached && (query == null ? void 0 : (_query$results = query.results) == null ? void 0 : (_query$results$data = _query$results.data) == null ? void 0 : _query$results$data.length) > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== (prevQuery == null ? void 0 : prevQuery.resultsKey)) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n  const calculateAlertRefHeight = (alertElement) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else\n    {\n      setAlertIsOpen(false);\n    }\n  };\n  const popSelectStar = (tempSchema, tempTable) => {\n    const qe = {\n      id: nanoid(11),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}`\n    };\n    dispatch(addQueryEditor(qe));\n  };\n  const changeSearch = (event) => {\n    setSearchText(event.target.value);\n  };\n  const createExploreResultsOnClick = async (clickEvent) => {\n    const { results } = query;\n    const openInNewWindow = clickEvent.metaKey;\n    logAction(LOG_ACTIONS_SQLLAB_CREATE_CHART, {});\n    if (results != null && results.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map((column) => column.column_name)\n        }\n      });\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key\n      });\n      if (openInNewWindow) {\n        window.open(url, '_blank', 'noreferrer');\n      } else\n      {\n        history.push(url);\n      }\n    } else\n    {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n  const getExportCsvUrl = (clientId) => `/api/v1/sqllab/export/${clientId}/`;\n  const renderControls = () => {\n    if (search || visualize || csv) {var _results$data;\n      const { results, queryLimit, limitingFactor, rows } = query;\n      const limit = queryLimit || results.query.limit;\n      const rowsCount = Math.min(rows || 0, (results == null ? void 0 : (_results$data = results.data) == null ? void 0 : _results$data.length) || 0);\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n      const datasource = {\n        columns: query.results.columns,\n        name: (query == null ? void 0 : query.tab) || 'Untitled',\n        dbId: query == null ? void 0 : query.dbId,\n        sql: query == null ? void 0 : query.sql,\n        templateParams: query == null ? void 0 : query.templateParams,\n        schema: query == null ? void 0 : query.schema\n      };\n      const canExportData = findPermission('can_export_csv', 'SQLLab', user == null ? void 0 : user.roles);\n      return _jsxs(ResultSetControls, { children: [\n        _jsx(SaveDatasetModal, { visible: showSaveDatasetModal, onHide: () => setShowSaveDatasetModal(false), buttonTextOnSave: t('Save & Explore'), buttonTextOnOverwrite: t('Overwrite & Explore'), modalDescription: t('Save this query as a virtual dataset to continue exploring'), datasource: datasource }),\n        _jsxs(ResultSetButtons, { children: [\n          visualize && (database == null ? void 0 : database.allows_virtual_table_explore) && _jsx(ExploreResultsButton, { database: database, onClick: createExploreResultsOnClick }),\n          csv && canExportData && _jsxs(Button, { css: copyButtonStyles, buttonSize: \"small\", href: getExportCsvUrl(query.id), \"data-test\": \"export-csv-button\", onClick: () => {\n              logAction(LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV, {});\n              if (limitingFactor === LimitingFactor.Dropdown &&\n              limit === rowsCount) {\n                Modal.warning({\n                  title: t('Download is on the way'),\n                  content: t('Downloading %(rows)s rows based on the LIMIT configuration. If you want the entire result set, you need to adjust the LIMIT.', { rows: rowsCount.toLocaleString() })\n                });\n              }\n            }, children: [\n            _jsx(Icons.DownloadOutlined, { iconSize: \"m\", iconColor: theme.colors.primary.dark2 }), ' ',\n            t('Download to CSV')] }\n          ),\n\n          canExportData && _jsx(CopyToClipboard, { text: prepareCopyToClipboardTabularData(data, columns), wrapped: false, copyNode: _jsxs(Button, { css: copyButtonStyles, buttonSize: \"small\", \"data-test\": \"copy-to-clipboard-button\", children: [\n              _jsx(Icons.CopyOutlined, { iconSize: \"s\", iconColor: theme.colors.primary.dark2 }), ' ',\n              t('Copy to Clipboard')] }\n            ), hideTooltip: true, onCopyEnd: () => logAction(LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD, {}) })] }\n        ),\n        search && _jsx(\"input\", { type: \"text\", onChange: changeSearch, value: searchText, className: \"form-control input-sm\", placeholder: t('Filter results') })] }\n      );\n    }\n    return _jsx(\"div\", {});\n  };\n  const renderRowsReturned = (alertMessage) => {var _user$roles, _results$data2;\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage = '';\n    const limitReached = results == null ? void 0 : results.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!(user != null && (_user$roles = user.roles) != null && _user$roles.Admin);\n    const rowsCount = Math.min(rows || 0, (results == null ? void 0 : (_results$data2 = results.data) == null ? void 0 : _results$data2.length) || 0);\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t('The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n      'Please add additional limits/filters or download to csv to see more rows up to ' +\n      'the %(limit)d limit.', { rows: rowsCount, limit }),\n      withoutAdmin: t('The number of results displayed is limited to %(rows)d. ' +\n      'Please add additional limits/filters, download to csv, or contact an admin ' +\n      'to see more rows up to the %(limit)d limit.', { rows: rowsCount, limit })\n    };\n    const shouldUseDefaultDropdownAlert = limit === defaultQueryLimit && limitingFactor === LimitingFactor.Dropdown;\n    if (limitingFactor === LimitingFactor.Query && csv) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query', { rows });\n    } else\n    if (limitingFactor === LimitingFactor.Dropdown &&\n    !shouldUseDefaultDropdownAlert) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the limit dropdown.', { rows });\n    } else\n    if (limitingFactor === LimitingFactor.QueryAndDropdown) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query and limit dropdown.', { rows });\n    }\n    const formattedRowCount = getNumberFormatter()(rows);\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows\n    });\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n    if (alertMessage) {\n      return _jsxs(_Fragment, { children: [\n        !limitReached && shouldUseDefaultDropdownAlert && _jsx(\"div\", { ref: calculateAlertRefHeight, children:\n          _jsx(Alert, { type: \"warning\", message: t('%(rows)d rows returned', { rows }), onClose: () => setAlertIsOpen(false), description: t('The number of rows displayed is limited to %(rows)d by the dropdown.', { rows }) }) }\n        ),\n        limitReached && _jsx(\"div\", { ref: calculateAlertRefHeight, children:\n          _jsx(Alert, { type: \"warning\", onClose: () => setAlertIsOpen(false), message: t('%(rows)d rows returned', { rows: rowsCount }), description: isAdmin ?\n            displayMaxRowsReachedMessage.withAdmin :\n            displayMaxRowsReachedMessage.withoutAdmin }) }\n        )] }\n      );\n    }\n    const showRowsReturned = showSqlInline || !limitReached && !shouldUseDefaultDropdownAlert;\n    return _jsx(_Fragment, { children:\n      showRowsReturned && _jsx(ReturnedRows, { children:\n        _jsx(Tooltip, { id: \"sqllab-rowcount-tooltip\", title: tooltipText, placement: \"left\", children:\n          _jsxs(Label, { css: css`\n                  line-height: ${theme.typography.sizes.l}px;\n                `, children: [\n            limitMessage && _jsx(Icons.ExclamationCircleOutlined, { css: css`\n                      font-size: ${theme.typography.sizes.m}px;\n                      margin-right: ${theme.gridUnit}px;\n                    ` }),\n            tn('%s row', '%s rows', rows, formattedRowCount)] }\n          ) }\n        ) }\n      ) }\n    );\n  };\n  const limitReached = query == null ? void 0 : (_query$results2 = query.results) == null ? void 0 : _query$results2.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database != null && database.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n  let trackingUrl;\n  if (query.trackingUrl &&\n  query.state !== QueryState.Success &&\n  query.state !== QueryState.Fetching) {\n    trackingUrl = _jsx(Button, { className: \"sql-result-track-job\", buttonSize: \"small\", href: query.trackingUrl, target: \"_blank\", children:\n      query.state === QueryState.Running ?\n      t('Track job') :\n      t('See query details') }\n    );\n  }\n  if (showSql) {\n    sql = _jsx(HighlightedSql, { sql: query.sql, ...(showSqlInline && { maxLines: 1, maxWidth: 60 }) });\n  }\n  if (query.state === QueryState.Stopped) {\n    return _jsx(Alert, { type: \"warning\", message: t('Query was stopped') });\n  }\n  if (query.state === QueryState.Failed) {var _query$extra;\n    const errors = [...(((_query$extra = query.extra) == null ? void 0 : _query$extra.errors) || []), ...(query.errors || [])];\n    return _jsxs(ResultlessStyles, { children: [\n      errors.map((error, index) => _jsx(ErrorMessageWithStackTrace, { title: t('Database error'), error: error, subtitle: _jsx(MonospaceDiv, { children: error.message }), copyText: error.message || undefined, link: query.link, source: \"sqllab\" }, index)),\n      errors.some((error) => (error == null ? void 0 : error.error_type) === ErrorTypeEnum.FRONTEND_TIMEOUT_ERROR) ? _jsx(Button, { className: \"sql-result-track-job\", buttonSize: \"small\", onClick: () => fetchResults(query, 0), children:\n        t('Retry fetching results') }\n      ) : trackingUrl] }\n    );\n  }\n  if (query.state === QueryState.Success && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.View) {\n      object = 'View';\n    }\n    return _jsx(\"div\", { children:\n      _jsx(Alert, { type: \"info\", message: _jsxs(_Fragment, { children: [\n          t(object), \" [\",\n          _jsxs(\"strong\", { children: [\n            tempSchema ? `${tempSchema}.` : '',\n            tempTable] }\n          ), \"] \",\n          t('was created'), \" \\xA0\",\n          _jsxs(ButtonGroup, { children: [\n            _jsx(Button, { buttonSize: \"small\", css: /*#__PURE__*/_css({ marginRight: theme.gridUnit }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ResultSet;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hcnl1cmtvdi9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvUmVzdWx0U2V0L2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFvWDJDIiwiZmlsZSI6Ii9Vc2Vycy9hcnl1cmtvdi9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvUmVzdWx0U2V0L2luZGV4LnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVN0YXRlLCBtZW1vLCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHNoYWxsb3dFcXVhbCwgdXNlRGlzcGF0Y2gsIHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHsgdXNlSGlzdG9yeSB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xuaW1wb3J0IHsgcGljayB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQnV0dG9uR3JvdXAgZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uR3JvdXAnO1xuaW1wb3J0IEFsZXJ0IGZyb20gJ3NyYy9jb21wb25lbnRzL0FsZXJ0JztcbmltcG9ydCBCdXR0b24gZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uJztcbmltcG9ydCB7IG5hbm9pZCB9IGZyb20gJ25hbm9pZCc7XG5pbXBvcnQgeyBRdWVyeVN0YXRlLCBzdHlsZWQsIHQsIHRuLCB1c2VUaGVtZSwgdXNlUHJldmlvdXMsIGNzcywgZ2V0TnVtYmVyRm9ybWF0dGVyLCBnZXRFeHRlbnNpb25zUmVnaXN0cnksIEVycm9yVHlwZUVudW0sIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IEVycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlIGZyb20gJ3NyYy9jb21wb25lbnRzL0Vycm9yTWVzc2FnZS9FcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSc7XG5pbXBvcnQgeyBTYXZlRGF0YXNldE1vZGFsLCB9IGZyb20gJ3NyYy9TcWxMYWIvY29tcG9uZW50cy9TYXZlRGF0YXNldE1vZGFsJztcbmltcG9ydCB7IEVYUExPUkVfQ0hBUlRfREVGQVVMVCB9IGZyb20gJ3NyYy9TcWxMYWIvdHlwZXMnO1xuaW1wb3J0IHsgbW91bnRFeHBsb3JlVXJsIH0gZnJvbSAnc3JjL2V4cGxvcmUvZXhwbG9yZVV0aWxzJztcbmltcG9ydCB7IHBvc3RGb3JtRGF0YSB9IGZyb20gJ3NyYy9leHBsb3JlL2V4cGxvcmVVdGlscy9mb3JtRGF0YSc7XG5pbXBvcnQgUHJvZ3Jlc3NCYXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvUHJvZ3Jlc3NCYXInO1xuaW1wb3J0IExvYWRpbmcgZnJvbSAnc3JjL2NvbXBvbmVudHMvTG9hZGluZyc7XG5pbXBvcnQgQ2FyZCBmcm9tICdzcmMvY29tcG9uZW50cy9DYXJkJztcbmltcG9ydCBMYWJlbCBmcm9tICdzcmMvY29tcG9uZW50cy9MYWJlbCc7XG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvVG9vbHRpcCc7XG5pbXBvcnQgRmlsdGVyYWJsZVRhYmxlIGZyb20gJ3NyYy9jb21wb25lbnRzL0ZpbHRlcmFibGVUYWJsZSc7XG5pbXBvcnQgQ29weVRvQ2xpcGJvYXJkIGZyb20gJ3NyYy9jb21wb25lbnRzL0NvcHlUb0NsaXBib2FyZCc7XG5pbXBvcnQgeyBhZGREYW5nZXJUb2FzdCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lc3NhZ2VUb2FzdHMvYWN0aW9ucyc7XG5pbXBvcnQgeyBwcmVwYXJlQ29weVRvQ2xpcGJvYXJkVGFidWxhckRhdGEgfSBmcm9tICdzcmMvdXRpbHMvY29tbW9uJztcbmltcG9ydCB7IGdldEl0ZW0sIExvY2FsU3RvcmFnZUtleXMgfSBmcm9tICdzcmMvdXRpbHMvbG9jYWxTdG9yYWdlSGVscGVycyc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnc3JjL2NvbXBvbmVudHMvTW9kYWwnO1xuaW1wb3J0IHsgYWRkUXVlcnlFZGl0b3IsIGNsZWFyUXVlcnlSZXN1bHRzLCBDdGFzRW51bSwgZmV0Y2hRdWVyeVJlc3VsdHMsIHJlRmV0Y2hRdWVyeVJlc3VsdHMsIHJlUnVuUXVlcnksIH0gZnJvbSAnc3JjL1NxbExhYi9hY3Rpb25zL3NxbExhYic7XG5pbXBvcnQgeyBVUkxfUEFSQU1TIH0gZnJvbSAnc3JjL2NvbnN0YW50cyc7XG5pbXBvcnQgdXNlTG9nQWN0aW9uIGZyb20gJ3NyYy9sb2dnZXIvdXNlTG9nQWN0aW9uJztcbmltcG9ydCB7IExPR19BQ1RJT05TX1NRTExBQl9DT1BZX1JFU1VMVF9UT19DTElQQk9BUkQsIExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfQ0hBUlQsIExPR19BQ1RJT05TX1NRTExBQl9ET1dOTE9BRF9DU1YsIH0gZnJvbSAnc3JjL2xvZ2dlci9Mb2dVdGlscyc7XG5pbXBvcnQgeyBJY29ucyB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IGZpbmRQZXJtaXNzaW9uIH0gZnJvbSAnc3JjL3V0aWxzL2ZpbmRQZXJtaXNzaW9uJztcbmltcG9ydCBFeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24gZnJvbSAnLi4vRXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uJztcbmltcG9ydCBFeHBsb3JlUmVzdWx0c0J1dHRvbiBmcm9tICcuLi9FeHBsb3JlUmVzdWx0c0J1dHRvbic7XG5pbXBvcnQgSGlnaGxpZ2h0ZWRTcWwgZnJvbSAnLi4vSGlnaGxpZ2h0ZWRTcWwnO1xuaW1wb3J0IFF1ZXJ5U3RhdGVMYWJlbCBmcm9tICcuLi9RdWVyeVN0YXRlTGFiZWwnO1xudmFyIExpbWl0aW5nRmFjdG9yO1xuKGZ1bmN0aW9uIChMaW1pdGluZ0ZhY3Rvcikge1xuICAgIExpbWl0aW5nRmFjdG9yW1wiUXVlcnlcIl0gPSBcIlFVRVJZXCI7XG4gICAgTGltaXRpbmdGYWN0b3JbXCJRdWVyeUFuZERyb3Bkb3duXCJdID0gXCJRVUVSWV9BTkRfRFJPUERPV05cIjtcbiAgICBMaW1pdGluZ0ZhY3RvcltcIkRyb3Bkb3duXCJdID0gXCJEUk9QRE9XTlwiO1xuICAgIExpbWl0aW5nRmFjdG9yW1wiTm90TGltaXRlZFwiXSA9IFwiTk9UX0xJTUlURURcIjtcbn0pKExpbWl0aW5nRmFjdG9yIHx8IChMaW1pdGluZ0ZhY3RvciA9IHt9KSk7XG5jb25zdCBSZXN1bHRDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgcm93LWdhcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG5gO1xuY29uc3QgUmVzdWx0bGVzc1N0eWxlcyA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG1pbi1oZWlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyNX1weDtcbiAgW3JvbGU9J2FsZXJ0J10ge1xuICAgIG1hcmdpbi10b3A6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICB9XG4gIC5zcWwtcmVzdWx0LXRyYWNrLWpvYiB7XG4gICAgbWFyZ2luLXRvcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIH1cbmA7XG4vLyBNYWtpbmcgdGV4dCByZW5kZXIgbGluZSBicmVha3MvdGFicyBhcyBpcyBhcyBtb25vc3BhY2UsXG4vLyBidXQgd3JhcHBpbmcgdGV4dCB0b28gc28gdGV4dCBkb2Vzbid0IG92ZXJmbG93XG5jb25zdCBNb25vc3BhY2VEaXYgPSBzdHlsZWQuZGl2IGBcbiAgZm9udC1mYW1pbHk6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUudHlwb2dyYXBoeS5mYW1pbGllcy5tb25vc3BhY2V9O1xuICB3aGl0ZS1zcGFjZTogcHJlO1xuICB3b3JkLWJyZWFrOiBicmVhay13b3JkO1xuICBvdmVyZmxvdy14OiBhdXRvO1xuICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XG5gO1xuY29uc3QgUmV0dXJuZWRSb3dzID0gc3R5bGVkLmRpdiBgXG4gIGZvbnQtc2l6ZTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS50eXBvZ3JhcGh5LnNpemVzLnN9cHg7XG4gIGxpbmUtaGVpZ2h0OiAxO1xuYDtcbmNvbnN0IFJlc3VsdFNldENvbnRyb2xzID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbmA7XG5jb25zdCBSZXN1bHRTZXRCdXR0b25zID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtYXV0by1mbG93OiBjb2x1bW47XG4gIHBhZGRpbmctcmlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4O1xuYDtcbmNvbnN0IGNvcHlCdXR0b25TdHlsZXMgPSBjc3MgYFxuICAmOmhvdmVyIHtcbiAgICB0ZXh0LWRlY29yYXRpb246IHVuc2V0O1xuICB9XG4gIHNwYW4gPiA6Zmlyc3Qtb2YtdHlwZSB7XG4gICAgbWFyZ2luOiAwcHg7XG4gIH1cbmA7XG5jb25zdCBST1dTX0NISVBfV0lEVEggPSAxMDA7XG5jb25zdCBHQVAgPSA4O1xuY29uc3QgZXh0ZW5zaW9uc1JlZ2lzdHJ5ID0gZ2V0RXh0ZW5zaW9uc1JlZ2lzdHJ5KCk7XG5jb25zdCBSZXN1bHRTZXQgPSAoeyBjYWNoZSA9IGZhbHNlLCBjc3YgPSB0cnVlLCBkYXRhYmFzZSA9IHt9LCBkaXNwbGF5TGltaXQsIGhlaWdodCwgcXVlcnlJZCwgc2VhcmNoID0gdHJ1ZSwgc2hvd1NxbCA9IGZhbHNlLCBzaG93U3FsSW5saW5lID0gZmFsc2UsIHZpc3VhbGl6ZSA9IHRydWUsIGRlZmF1bHRRdWVyeUxpbWl0LCB9KSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZVNlbGVjdG9yKCh7IHVzZXIgfSkgPT4gdXNlciwgc2hhbGxvd0VxdWFsKTtcbiAgICBjb25zdCBxdWVyeSA9IHVzZVNlbGVjdG9yKCh7IHNxbExhYjogeyBxdWVyaWVzIH0gfSkgPT4gcGljayhxdWVyaWVzW3F1ZXJ5SWRdLCBbXG4gICAgICAgICdpZCcsXG4gICAgICAgICdlcnJvck1lc3NhZ2UnLFxuICAgICAgICAnY2FjaGVkJyxcbiAgICAgICAgJ3Jlc3VsdHMnLFxuICAgICAgICAncmVzdWx0c0tleScsXG4gICAgICAgICdkYklkJyxcbiAgICAgICAgJ3RhYicsXG4gICAgICAgICdzcWwnLFxuICAgICAgICAnc3FsRWRpdG9ySWQnLFxuICAgICAgICAndGVtcGxhdGVQYXJhbXMnLFxuICAgICAgICAnc2NoZW1hJyxcbiAgICAgICAgJ3Jvd3MnLFxuICAgICAgICAncXVlcnlMaW1pdCcsXG4gICAgICAgICdsaW1pdGluZ0ZhY3RvcicsXG4gICAgICAgICd0cmFja2luZ1VybCcsXG4gICAgICAgICdzdGF0ZScsXG4gICAgICAgICdlcnJvcnMnLFxuICAgICAgICAnbGluaycsXG4gICAgICAgICdjdGFzJyxcbiAgICAgICAgJ2N0YXNfbWV0aG9kJyxcbiAgICAgICAgJ3RlbXBTY2hlbWEnLFxuICAgICAgICAndGVtcFRhYmxlJyxcbiAgICAgICAgJ2lzRGF0YVByZXZpZXcnLFxuICAgICAgICAncHJvZ3Jlc3MnLFxuICAgICAgICAnZXh0cmEnLFxuICAgIF0pLCBzaGFsbG93RXF1YWwpO1xuICAgIGNvbnN0IFJlc3VsdFRhYmxlID0gZXh0ZW5zaW9uc1JlZ2lzdHJ5LmdldCgnc3FsZWRpdG9yLmV4dGVuc2lvbi5yZXN1bHRUYWJsZScpID8/XG4gICAgICAgIEZpbHRlcmFibGVUYWJsZTtcbiAgICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gdXNlU3RhdGUoJycpO1xuICAgIGNvbnN0IFtjYWNoZWREYXRhLCBzZXRDYWNoZWREYXRhXSA9IHVzZVN0YXRlKFtdKTtcbiAgICBjb25zdCBbc2hvd1NhdmVEYXRhc2V0TW9kYWwsIHNldFNob3dTYXZlRGF0YXNldE1vZGFsXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbYWxlcnRJc09wZW4sIHNldEFsZXJ0SXNPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBoaXN0b3J5ID0gdXNlSGlzdG9yeSgpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgICBjb25zdCBsb2dBY3Rpb24gPSB1c2VMb2dBY3Rpb24oeyBxdWVyeUlkLCBzcWxFZGl0b3JJZDogcXVlcnkuc3FsRWRpdG9ySWQgfSk7XG4gICAgY29uc3QgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIGlmIChxdWVyeS5lcnJvck1lc3NhZ2UgJiZcbiAgICAgICAgICAgIHF1ZXJ5LmVycm9yTWVzc2FnZS5pbmRleE9mKCdzZXNzaW9uIHRpbWVkIG91dCcpID4gMCkge1xuICAgICAgICAgICAgZGlzcGF0Y2gocmVSdW5RdWVyeShxdWVyeSkpO1xuICAgICAgICB9XG4gICAgfSwgW10pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIG9ubHkgZG8gdGhpcyB0aGUgZmlyc3QgdGltZSB0aGUgY29tcG9uZW50IGlzIHJlbmRlcmVkL21vdW50ZWRcbiAgICAgICAgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQoKTtcbiAgICB9LCBbcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnRdKTtcbiAgICBjb25zdCBmZXRjaFJlc3VsdHMgPSAocSwgdGltZW91dCkgPT4ge1xuICAgICAgICBkaXNwYXRjaChmZXRjaFF1ZXJ5UmVzdWx0cyhxLCBkaXNwbGF5TGltaXQsIHRpbWVvdXQpKTtcbiAgICB9O1xuICAgIGNvbnN0IHByZXZRdWVyeSA9IHVzZVByZXZpb3VzKHF1ZXJ5KTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkICYmIHF1ZXJ5Py5yZXN1bHRzPy5kYXRhPy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzZXRDYWNoZWREYXRhKHF1ZXJ5LnJlc3VsdHMuZGF0YSk7XG4gICAgICAgICAgICBkaXNwYXRjaChjbGVhclF1ZXJ5UmVzdWx0cyhxdWVyeSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeS5yZXN1bHRzS2V5ICYmIHF1ZXJ5LnJlc3VsdHNLZXkgIT09IHByZXZRdWVyeT8ucmVzdWx0c0tleSkge1xuICAgICAgICAgICAgZmV0Y2hSZXN1bHRzKHF1ZXJ5KTtcbiAgICAgICAgfVxuICAgIH0sIFtxdWVyeSwgY2FjaGVdKTtcbiAgICBjb25zdCBjYWxjdWxhdGVBbGVydFJlZkhlaWdodCA9IChhbGVydEVsZW1lbnQpID0+IHtcbiAgICAgICAgaWYgKGFsZXJ0RWxlbWVudCkge1xuICAgICAgICAgICAgc2V0QWxlcnRJc09wZW4odHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZXRBbGVydElzT3BlbihmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHBvcFNlbGVjdFN0YXIgPSAodGVtcFNjaGVtYSwgdGVtcFRhYmxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHFlID0ge1xuICAgICAgICAgICAgaWQ6IG5hbm9pZCgxMSksXG4gICAgICAgICAgICBuYW1lOiB0ZW1wVGFibGUsXG4gICAgICAgICAgICBhdXRvcnVuOiBmYWxzZSxcbiAgICAgICAgICAgIGRiSWQ6IHF1ZXJ5LmRiSWQsXG4gICAgICAgICAgICBzcWw6IGBTRUxFQ1QgKiBGUk9NICR7dGVtcFNjaGVtYSA/IGAke3RlbXBTY2hlbWF9LmAgOiAnJ30ke3RlbXBUYWJsZX1gLFxuICAgICAgICB9O1xuICAgICAgICBkaXNwYXRjaChhZGRRdWVyeUVkaXRvcihxZSkpO1xuICAgIH07XG4gICAgY29uc3QgY2hhbmdlU2VhcmNoID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIHNldFNlYXJjaFRleHQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZUV4cGxvcmVSZXN1bHRzT25DbGljayA9IGFzeW5jIChjbGlja0V2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0cyB9ID0gcXVlcnk7XG4gICAgICAgIGNvbnN0IG9wZW5Jbk5ld1dpbmRvdyA9IGNsaWNrRXZlbnQubWV0YUtleTtcbiAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfQ0hBUlQsIHt9KTtcbiAgICAgICAgaWYgKHJlc3VsdHM/LnF1ZXJ5X2lkKSB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBhd2FpdCBwb3N0Rm9ybURhdGEocmVzdWx0cy5xdWVyeV9pZCwgJ3F1ZXJ5Jywge1xuICAgICAgICAgICAgICAgIC4uLkVYUExPUkVfQ0hBUlRfREVGQVVMVCxcbiAgICAgICAgICAgICAgICBkYXRhc291cmNlOiBgJHtyZXN1bHRzLnF1ZXJ5X2lkfV9fcXVlcnlgLFxuICAgICAgICAgICAgICAgIC4uLntcbiAgICAgICAgICAgICAgICAgICAgYWxsX2NvbHVtbnM6IHJlc3VsdHMuY29sdW1ucy5tYXAoY29sdW1uID0+IGNvbHVtbi5jb2x1bW5fbmFtZSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgdXJsID0gbW91bnRFeHBsb3JlVXJsKG51bGwsIHtcbiAgICAgICAgICAgICAgICBbVVJMX1BBUkFNUy5mb3JtRGF0YUtleS5uYW1lXToga2V5LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAob3BlbkluTmV3V2luZG93KSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lm9wZW4odXJsLCAnX2JsYW5rJywgJ25vcmVmZXJyZXInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaCh1cmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWRkRGFuZ2VyVG9hc3QodCgnVW5hYmxlIHRvIGNyZWF0ZSBjaGFydCB3aXRob3V0IGEgcXVlcnkgaWQuJykpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBnZXRFeHBvcnRDc3ZVcmwgPSAoY2xpZW50SWQpID0+IGAvYXBpL3YxL3NxbGxhYi9leHBvcnQvJHtjbGllbnRJZH0vYDtcbiAgICBjb25zdCByZW5kZXJDb250cm9scyA9ICgpID0+IHtcbiAgICAgICAgaWYgKHNlYXJjaCB8fCB2aXN1YWxpemUgfHwgY3N2KSB7XG4gICAgICAgICAgICBjb25zdCB7IHJlc3VsdHMsIHF1ZXJ5TGltaXQsIGxpbWl0aW5nRmFjdG9yLCByb3dzIH0gPSBxdWVyeTtcbiAgICAgICAgICAgIGNvbnN0IGxpbWl0ID0gcXVlcnlMaW1pdCB8fCByZXN1bHRzLnF1ZXJ5LmxpbWl0O1xuICAgICAgICAgICAgY29uc3Qgcm93c0NvdW50ID0gTWF0aC5taW4ocm93cyB8fCAwLCByZXN1bHRzPy5kYXRhPy5sZW5ndGggfHwgMCk7XG4gICAgICAgICAgICBsZXQgeyBkYXRhIH0gPSBxdWVyeS5yZXN1bHRzO1xuICAgICAgICAgICAgaWYgKGNhY2hlICYmIHF1ZXJ5LmNhY2hlZCkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBjYWNoZWREYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBjb2x1bW5zIH0gPSBxdWVyeS5yZXN1bHRzO1xuICAgICAgICAgICAgLy8gQWRkZWQgY29tcHV0ZSBsb2dpYyB0byBzdG9wIHVzZXIgZnJvbSBiZWluZyBhYmxlIHRvIFNhdmUgJiBFeHBsb3JlXG4gICAgICAgICAgICBjb25zdCBkYXRhc291cmNlID0ge1xuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHF1ZXJ5LnJlc3VsdHMuY29sdW1ucyxcbiAgICAgICAgICAgICAgICBuYW1lOiBxdWVyeT8udGFiIHx8ICdVbnRpdGxlZCcsXG4gICAgICAgICAgICAgICAgZGJJZDogcXVlcnk/LmRiSWQsXG4gICAgICAgICAgICAgICAgc3FsOiBxdWVyeT8uc3FsLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlUGFyYW1zOiBxdWVyeT8udGVtcGxhdGVQYXJhbXMsXG4gICAgICAgICAgICAgICAgc2NoZW1hOiBxdWVyeT8uc2NoZW1hLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGNhbkV4cG9ydERhdGEgPSBmaW5kUGVybWlzc2lvbignY2FuX2V4cG9ydF9jc3YnLCAnU1FMTGFiJywgdXNlcj8ucm9sZXMpO1xuICAgICAgICAgICAgcmV0dXJuICg8UmVzdWx0U2V0Q29udHJvbHM+XG4gICAgICAgICAgPFNhdmVEYXRhc2V0TW9kYWwgdmlzaWJsZT17c2hvd1NhdmVEYXRhc2V0TW9kYWx9IG9uSGlkZT17KCkgPT4gc2V0U2hvd1NhdmVEYXRhc2V0TW9kYWwoZmFsc2UpfSBidXR0b25UZXh0T25TYXZlPXt0KCdTYXZlICYgRXhwbG9yZScpfSBidXR0b25UZXh0T25PdmVyd3JpdGU9e3QoJ092ZXJ3cml0ZSAmIEV4cGxvcmUnKX0gbW9kYWxEZXNjcmlwdGlvbj17dCgnU2F2ZSB0aGlzIHF1ZXJ5IGFzIGEgdmlydHVhbCBkYXRhc2V0IHRvIGNvbnRpbnVlIGV4cGxvcmluZycpfSBkYXRhc291cmNlPXtkYXRhc291cmNlfS8+XG4gICAgICAgICAgPFJlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAgICB7dmlzdWFsaXplICYmIGRhdGFiYXNlPy5hbGxvd3NfdmlydHVhbF90YWJsZV9leHBsb3JlICYmICg8RXhwbG9yZVJlc3VsdHNCdXR0b24gZGF0YWJhc2U9e2RhdGFiYXNlfSBvbkNsaWNrPXtjcmVhdGVFeHBsb3JlUmVzdWx0c09uQ2xpY2t9Lz4pfVxuICAgICAgICAgICAge2NzdiAmJiBjYW5FeHBvcnREYXRhICYmICg8QnV0dG9uIGNzcz17Y29weUJ1dHRvblN0eWxlc30gYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17Z2V0RXhwb3J0Q3N2VXJsKHF1ZXJ5LmlkKX0gZGF0YS10ZXN0PVwiZXhwb3J0LWNzdi1idXR0b25cIiBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0RPV05MT0FEX0NTViwge30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbWl0aW5nRmFjdG9yID09PSBMaW1pdGluZ0ZhY3Rvci5Ecm9wZG93biAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbWl0ID09PSByb3dzQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2RhbC53YXJuaW5nKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHQoJ0Rvd25sb2FkIGlzIG9uIHRoZSB3YXknKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogdCgnRG93bmxvYWRpbmcgJShyb3dzKXMgcm93cyBiYXNlZCBvbiB0aGUgTElNSVQgY29uZmlndXJhdGlvbi4gSWYgeW91IHdhbnQgdGhlIGVudGlyZSByZXN1bHQgc2V0LCB5b3UgbmVlZCB0byBhZGp1c3QgdGhlIExJTUlULicsIHsgcm93czogcm93c0NvdW50LnRvTG9jYWxlU3RyaW5nKCkgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH19PlxuICAgICAgICAgICAgICAgIDxJY29ucy5Eb3dubG9hZE91dGxpbmVkIGljb25TaXplPVwibVwiIGljb25Db2xvcj17dGhlbWUuY29sb3JzLnByaW1hcnkuZGFyazJ9Lz57JyAnfVxuICAgICAgICAgICAgICAgIHt0KCdEb3dubG9hZCB0byBDU1YnKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+KX1cblxuICAgICAgICAgICAge2NhbkV4cG9ydERhdGEgJiYgKDxDb3B5VG9DbGlwYm9hcmQgdGV4dD17cHJlcGFyZUNvcHlUb0NsaXBib2FyZFRhYnVsYXJEYXRhKGRhdGEsIGNvbHVtbnMpfSB3cmFwcGVkPXtmYWxzZX0gY29weU5vZGU9ezxCdXR0b24gY3NzPXtjb3B5QnV0dG9uU3R5bGVzfSBidXR0b25TaXplPVwic21hbGxcIiBkYXRhLXRlc3Q9XCJjb3B5LXRvLWNsaXBib2FyZC1idXR0b25cIj5cbiAgICAgICAgICAgICAgICAgICAgPEljb25zLkNvcHlPdXRsaW5lZCBpY29uU2l6ZT1cInNcIiBpY29uQ29sb3I9e3RoZW1lLmNvbG9ycy5wcmltYXJ5LmRhcmsyfS8+eycgJ31cbiAgICAgICAgICAgICAgICAgICAge3QoJ0NvcHkgdG8gQ2xpcGJvYXJkJyl9XG4gICAgICAgICAgICAgICAgICA8L0J1dHRvbj59IGhpZGVUb29sdGlwIG9uQ29weUVuZD17KCkgPT4gbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9DT1BZX1JFU1VMVF9UT19DTElQQk9BUkQsIHt9KX0vPil9XG4gICAgICAgICAgPC9SZXN1bHRTZXRCdXR0b25zPlxuICAgICAgICAgIHtzZWFyY2ggJiYgKDxpbnB1dCB0eXBlPVwidGV4dFwiIG9uQ2hhbmdlPXtjaGFuZ2VTZWFyY2h9IHZhbHVlPXtzZWFyY2hUZXh0fSBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBwbGFjZWhvbGRlcj17dCgnRmlsdGVyIHJlc3VsdHMnKX0vPil9XG4gICAgICAgIDwvUmVzdWx0U2V0Q29udHJvbHM+KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gPGRpdiAvPjtcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlclJvd3NSZXR1cm5lZCA9IChhbGVydE1lc3NhZ2UpID0+IHtcbiAgICAgICAgY29uc3QgeyByZXN1bHRzLCByb3dzLCBxdWVyeUxpbWl0LCBsaW1pdGluZ0ZhY3RvciB9ID0gcXVlcnk7XG4gICAgICAgIGxldCBsaW1pdE1lc3NhZ2UgPSAnJztcbiAgICAgICAgY29uc3QgbGltaXRSZWFjaGVkID0gcmVzdWx0cz8uZGlzcGxheUxpbWl0UmVhY2hlZDtcbiAgICAgICAgY29uc3QgbGltaXQgPSBxdWVyeUxpbWl0IHx8IHJlc3VsdHMucXVlcnkubGltaXQ7XG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSAhIXVzZXI/LnJvbGVzPy5BZG1pbjtcbiAgICAgICAgY29uc3Qgcm93c0NvdW50ID0gTWF0aC5taW4ocm93cyB8fCAwLCByZXN1bHRzPy5kYXRhPy5sZW5ndGggfHwgMCk7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2UgPSB7XG4gICAgICAgICAgICB3aXRoQWRtaW46IHQoJ1RoZSBudW1iZXIgb2YgcmVzdWx0cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgY29uZmlndXJhdGlvbiBESVNQTEFZX01BWF9ST1cuICcgK1xuICAgICAgICAgICAgICAgICdQbGVhc2UgYWRkIGFkZGl0aW9uYWwgbGltaXRzL2ZpbHRlcnMgb3IgZG93bmxvYWQgdG8gY3N2IHRvIHNlZSBtb3JlIHJvd3MgdXAgdG8gJyArXG4gICAgICAgICAgICAgICAgJ3RoZSAlKGxpbWl0KWQgbGltaXQuJywgeyByb3dzOiByb3dzQ291bnQsIGxpbWl0IH0pLFxuICAgICAgICAgICAgd2l0aG91dEFkbWluOiB0KCdUaGUgbnVtYmVyIG9mIHJlc3VsdHMgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQuICcgK1xuICAgICAgICAgICAgICAgICdQbGVhc2UgYWRkIGFkZGl0aW9uYWwgbGltaXRzL2ZpbHRlcnMsIGRvd25sb2FkIHRvIGNzdiwgb3IgY29udGFjdCBhbiBhZG1pbiAnICtcbiAgICAgICAgICAgICAgICAndG8gc2VlIG1vcmUgcm93cyB1cCB0byB0aGUgJShsaW1pdClkIGxpbWl0LicsIHsgcm93czogcm93c0NvdW50LCBsaW1pdCB9KSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgc2hvdWxkVXNlRGVmYXVsdERyb3Bkb3duQWxlcnQgPSBsaW1pdCA9PT0gZGVmYXVsdFF1ZXJ5TGltaXQgJiYgbGltaXRpbmdGYWN0b3IgPT09IExpbWl0aW5nRmFjdG9yLkRyb3Bkb3duO1xuICAgICAgICBpZiAobGltaXRpbmdGYWN0b3IgPT09IExpbWl0aW5nRmFjdG9yLlF1ZXJ5ICYmIGNzdikge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBxdWVyeScsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuRHJvcGRvd24gJiZcbiAgICAgICAgICAgICFzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCkge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBsaW1pdCBkcm9wZG93bi4nLCB7IHJvd3MgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGltaXRpbmdGYWN0b3IgPT09IExpbWl0aW5nRmFjdG9yLlF1ZXJ5QW5kRHJvcGRvd24pIHtcbiAgICAgICAgICAgIGxpbWl0TWVzc2FnZSA9IHQoJ1RoZSBudW1iZXIgb2Ygcm93cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgcXVlcnkgYW5kIGxpbWl0IGRyb3Bkb3duLicsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmb3JtYXR0ZWRSb3dDb3VudCA9IGdldE51bWJlckZvcm1hdHRlcigpKHJvd3MpO1xuICAgICAgICBjb25zdCByb3dzUmV0dXJuZWRNZXNzYWdlID0gdCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHtcbiAgICAgICAgICAgIHJvd3MsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB0b29sdGlwVGV4dCA9IGAke3Jvd3NSZXR1cm5lZE1lc3NhZ2V9LiAke2xpbWl0TWVzc2FnZX1gO1xuICAgICAgICBpZiAoYWxlcnRNZXNzYWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gKDw+XG4gICAgICAgICAgeyFsaW1pdFJlYWNoZWQgJiYgc2hvdWxkVXNlRGVmYXVsdERyb3Bkb3duQWxlcnQgJiYgKDxkaXYgcmVmPXtjYWxjdWxhdGVBbGVydFJlZkhlaWdodH0+XG4gICAgICAgICAgICAgIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJyUocm93cylkIHJvd3MgcmV0dXJuZWQnLCB7IHJvd3MgfSl9IG9uQ2xvc2U9eygpID0+IHNldEFsZXJ0SXNPcGVuKGZhbHNlKX0gZGVzY3JpcHRpb249e3QoJ1RoZSBudW1iZXIgb2Ygcm93cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgZHJvcGRvd24uJywgeyByb3dzIH0pfS8+XG4gICAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICAgIHtsaW1pdFJlYWNoZWQgJiYgKDxkaXYgcmVmPXtjYWxjdWxhdGVBbGVydFJlZkhlaWdodH0+XG4gICAgICAgICAgICAgIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG9uQ2xvc2U9eygpID0+IHNldEFsZXJ0SXNPcGVuKGZhbHNlKX0gbWVzc2FnZT17dCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHsgcm93czogcm93c0NvdW50IH0pfSBkZXNjcmlwdGlvbj17aXNBZG1pblxuICAgICAgICAgICAgICAgICAgICAgICAgPyBkaXNwbGF5TWF4Um93c1JlYWNoZWRNZXNzYWdlLndpdGhBZG1pblxuICAgICAgICAgICAgICAgICAgICAgICAgOiBkaXNwbGF5TWF4Um93c1JlYWNoZWRNZXNzYWdlLndpdGhvdXRBZG1pbn0vPlxuICAgICAgICAgICAgPC9kaXY+KX1cbiAgICAgICAgPC8+KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaG93Um93c1JldHVybmVkID0gc2hvd1NxbElubGluZSB8fCAoIWxpbWl0UmVhY2hlZCAmJiAhc2hvdWxkVXNlRGVmYXVsdERyb3Bkb3duQWxlcnQpO1xuICAgICAgICByZXR1cm4gKDw+XG4gICAgICAgIHtzaG93Um93c1JldHVybmVkICYmICg8UmV0dXJuZWRSb3dzPlxuICAgICAgICAgICAgPFRvb2x0aXAgaWQ9XCJzcWxsYWItcm93Y291bnQtdG9vbHRpcFwiIHRpdGxlPXt0b29sdGlwVGV4dH0gcGxhY2VtZW50PVwibGVmdFwiPlxuICAgICAgICAgICAgICA8TGFiZWwgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgbGluZS1oZWlnaHQ6ICR7dGhlbWUudHlwb2dyYXBoeS5zaXplcy5sfXB4O1xuICAgICAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAgICAgIHtsaW1pdE1lc3NhZ2UgJiYgKDxJY29ucy5FeGNsYW1hdGlvbkNpcmNsZU91dGxpbmVkIGNzcz17Y3NzIGBcbiAgICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6ICR7dGhlbWUudHlwb2dyYXBoeS5zaXplcy5tfXB4O1xuICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogJHt0aGVtZS5ncmlkVW5pdH1weDtcbiAgICAgICAgICAgICAgICAgICAgYH0vPil9XG4gICAgICAgICAgICAgICAge3RuKCclcyByb3cnLCAnJXMgcm93cycsIHJvd3MsIGZvcm1hdHRlZFJvd0NvdW50KX1cbiAgICAgICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICA8L1JldHVybmVkUm93cz4pfVxuICAgICAgPC8+KTtcbiAgICB9O1xuICAgIGNvbnN0IGxpbWl0UmVhY2hlZCA9IHF1ZXJ5Py5yZXN1bHRzPy5kaXNwbGF5TGltaXRSZWFjaGVkO1xuICAgIGxldCBzcWw7XG4gICAgbGV0IGV4cGxvcmVEQklkID0gcXVlcnkuZGJJZDtcbiAgICBpZiAoZGF0YWJhc2U/LmV4cGxvcmVfZGF0YWJhc2VfaWQpIHtcbiAgICAgICAgZXhwbG9yZURCSWQgPSBkYXRhYmFzZS5leHBsb3JlX2RhdGFiYXNlX2lkO1xuICAgIH1cbiAgICBsZXQgdHJhY2tpbmdVcmw7XG4gICAgaWYgKHF1ZXJ5LnRyYWNraW5nVXJsICYmXG4gICAgICAgIHF1ZXJ5LnN0YXRlICE9PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiZcbiAgICAgICAgcXVlcnkuc3RhdGUgIT09IFF1ZXJ5U3RhdGUuRmV0Y2hpbmcpIHtcbiAgICAgICAgdHJhY2tpbmdVcmwgPSAoPEJ1dHRvbiBjbGFzc05hbWU9XCJzcWwtcmVzdWx0LXRyYWNrLWpvYlwiIGJ1dHRvblNpemU9XCJzbWFsbFwiIGhyZWY9e3F1ZXJ5LnRyYWNraW5nVXJsfSB0YXJnZXQ9XCJfYmxhbmtcIj5cbiAgICAgICAge3F1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlJ1bm5pbmdcbiAgICAgICAgICAgICAgICA/IHQoJ1RyYWNrIGpvYicpXG4gICAgICAgICAgICAgICAgOiB0KCdTZWUgcXVlcnkgZGV0YWlscycpfVxuICAgICAgPC9CdXR0b24+KTtcbiAgICB9XG4gICAgaWYgKHNob3dTcWwpIHtcbiAgICAgICAgc3FsID0gKDxIaWdobGlnaHRlZFNxbCBzcWw9e3F1ZXJ5LnNxbH0gey4uLihzaG93U3FsSW5saW5lICYmIHsgbWF4TGluZXM6IDEsIG1heFdpZHRoOiA2MCB9KX0vPik7XG4gICAgfVxuICAgIGlmIChxdWVyeS5zdGF0ZSA9PT0gUXVlcnlTdGF0ZS5TdG9wcGVkKSB7XG4gICAgICAgIHJldHVybiA8QWxlcnQgdHlwZT1cIndhcm5pbmdcIiBtZXNzYWdlPXt0KCdRdWVyeSB3YXMgc3RvcHBlZCcpfS8+O1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuRmFpbGVkKSB7XG4gICAgICAgIGNvbnN0IGVycm9ycyA9IFsuLi4ocXVlcnkuZXh0cmE/LmVycm9ycyB8fCBbXSksIC4uLihxdWVyeS5lcnJvcnMgfHwgW10pXTtcbiAgICAgICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgICAge2Vycm9ycy5tYXAoKGVycm9yLCBpbmRleCkgPT4gKDxFcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSBrZXk9e2luZGV4fSB0aXRsZT17dCgnRGF0YWJhc2UgZXJyb3InKX0gZXJyb3I9e2Vycm9yfSBzdWJ0aXRsZT17PE1vbm9zcGFjZURpdj57ZXJyb3IubWVzc2FnZX08L01vbm9zcGFjZURpdj59IGNvcHlUZXh0PXtlcnJvci5tZXNzYWdlIHx8IHVuZGVmaW5lZH0gbGluaz17cXVlcnkubGlua30gc291cmNlPVwic3FsbGFiXCIvPikpfVxuICAgICAgICB7ZXJyb3JzLnNvbWUoZXJyb3IgPT4gZXJyb3I/LmVycm9yX3R5cGUgPT09IEVycm9yVHlwZUVudW0uRlJPTlRFTkRfVElNRU9VVF9FUlJPUikgPyAoPEJ1dHRvbiBjbGFzc05hbWU9XCJzcWwtcmVzdWx0LXRyYWNrLWpvYlwiIGJ1dHRvblNpemU9XCJzbWFsbFwiIG9uQ2xpY2s9eygpID0+IGZldGNoUmVzdWx0cyhxdWVyeSwgMCl9PlxuICAgICAgICAgICAge3QoJ1JldHJ5IGZldGNoaW5nIHJlc3VsdHMnKX1cbiAgICAgICAgICA8L0J1dHRvbj4pIDogKHRyYWNraW5nVXJsKX1cbiAgICAgIDwvUmVzdWx0bGVzc1N0eWxlcz4pO1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJiBxdWVyeS5jdGFzKSB7XG4gICAgICAgIGNvbnN0IHsgdGVtcFNjaGVtYSwgdGVtcFRhYmxlIH0gPSBxdWVyeTtcbiAgICAgICAgbGV0IG9iamVjdCA9ICdUYWJsZSc7XG4gICAgICAgIGlmIChxdWVyeS5jdGFzX21ldGhvZCA9PT0gQ3Rhc0VudW0uVmlldykge1xuICAgICAgICAgICAgb2JqZWN0ID0gJ1ZpZXcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoPGRpdj5cbiAgICAgICAgPEFsZXJ0IHR5cGU9XCJpbmZvXCIgbWVzc2FnZT17PD5cbiAgICAgICAgICAgICAge3Qob2JqZWN0KX0gW1xuICAgICAgICAgICAgICA8c3Ryb25nPlxuICAgICAgICAgICAgICAgIHt0ZW1wU2NoZW1hID8gYCR7dGVtcFNjaGVtYX0uYCA6ICcnfVxuICAgICAgICAgICAgICAgIHt0ZW1wVGFibGV9XG4gICAgICAgICAgICAgIDwvc3Ryb25nPlxuICAgICAgICAgICAgICBdIHt0KCd3YXMgY3JlYXRlZCcpfSAmbmJzcDtcbiAgICAgICAgICAgICAgPEJ1dHRvbkdyb3VwPlxuICAgICAgICAgICAgICAgIDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgY3NzPXt7IG1hcmdpblJpZ2h0OiB0aGVtZS5ncmlkVW5pdCB9fSBvbkNsaWNrPXsoKSA9PiBwb3BTZWxlY3RTdGFyKHRlbXBTY2hlbWEsIHRlbXBUYWJsZSl9PlxuICAgICAgICAgICAgICAgICAge3QoJ1F1ZXJ5IGluIGEgbmV3IHRhYicpfVxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgIDxFeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24gdGFibGU9e3RlbXBUYWJsZX0gc2NoZW1hPXt0ZW1wU2NoZW1hfSBkYklkPXtleHBsb3JlREJJZH0vPlxuICAgICAgICAgICAgICA8L0J1dHRvbkdyb3VwPlxuICAgICAgICAgICAgPC8+fS8+XG4gICAgICA8L2Rpdj4pO1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJiBxdWVyeS5yZXN1bHRzKSB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0cyB9ID0gcXVlcnk7XG4gICAgICAgIC8vIEFjY291bnRzIGZvciBvZmZzZXQgbmVlZGVkIGZvciBoZWlnaHQgb2YgUmVzdWx0U2V0Um93c1JldHVybmVkIGNvbXBvbmVudCBpZiAhbGltaXRSZWFjaGVkXG4gICAgICAgIGNvbnN0IHJvd01lc3NhZ2VIZWlnaHQgPSAhbGltaXRSZWFjaGVkID8gMzIgOiAwO1xuICAgICAgICAvLyBBY2NvdW50cyBmb3Igb2Zmc2V0IG5lZWRlZCBmb3IgaGVpZ2h0IG9mIEFsZXJ0IGlmIHRoaXMuc3RhdGUuYWxlcnRJc09wZW5cbiAgICAgICAgY29uc3QgYWxlcnRDb250YWluZXJIZWlnaHQgPSA3MDtcbiAgICAgICAgLy8gV2UgbmVlZCB0byBjYWxjdWxhdGUgdGhlIGhlaWdodCBvZiB0aGlzLnJlbmRlclJvd3NSZXR1cm5lZCgpXG4gICAgICAgIC8vIGlmIHdlIHdhbnQgcmVzdWx0cyBwYW5lbCB0byBiZSBwcm9wZXIgaGVpZ2h0IGJlY2F1c2UgdGhlXG4gICAgICAgIC8vIEZpbHRlclRhYmxlIGNvbXBvbmVudCBuZWVkcyBhbiBleHBsaWNpdCBoZWlnaHQgdG8gcmVuZGVyXG4gICAgICAgIC8vIHRoZSBUYWJsZSBjb21wb25lbnRcbiAgICAgICAgY29uc3Qgcm93c0hlaWdodCA9IGFsZXJ0SXNPcGVuXG4gICAgICAgICAgICA/IGhlaWdodCAtIGFsZXJ0Q29udGFpbmVySGVpZ2h0XG4gICAgICAgICAgICA6IGhlaWdodCAtIHJvd01lc3NhZ2VIZWlnaHQ7XG4gICAgICAgIGxldCBkYXRhO1xuICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkKSB7XG4gICAgICAgICAgICBkYXRhID0gY2FjaGVkRGF0YTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXN1bHRzPy5kYXRhKSB7XG4gICAgICAgICAgICAoeyBkYXRhIH0gPSByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGV4cGFuZGVkQ29sdW1ucyA9IHJlc3VsdHMuZXhwYW5kZWRfY29sdW1uc1xuICAgICAgICAgICAgICAgID8gcmVzdWx0cy5leHBhbmRlZF9jb2x1bW5zLm1hcChjb2wgPT4gY29sLmNvbHVtbl9uYW1lKVxuICAgICAgICAgICAgICAgIDogW107XG4gICAgICAgICAgICBjb25zdCBhbGxvd0hUTUwgPSBnZXRJdGVtKExvY2FsU3RvcmFnZUtleXMuU3FsbGFiSXNSZW5kZXJIdG1sRW5hYmxlZCwgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm4gKDxSZXN1bHRDb250YWluZXI+XG4gICAgICAgICAge3JlbmRlckNvbnRyb2xzKCl9XG4gICAgICAgICAge3Nob3dTcWwgJiYgc2hvd1NxbElubGluZSA/ICg8PlxuICAgICAgICAgICAgICA8ZGl2IGNzcz17Y3NzIGBcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XG4gICAgICAgICAgICAgICAgICBnYXA6ICR7R0FQfXB4O1xuICAgICAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAgICAgIDxDYXJkIGNzcz17W1xuICAgICAgICAgICAgICAgICAgICAgICAgY3NzIGBcbiAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDI4cHg7XG4gICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGNhbGMoMTAwJSAtICR7Uk9XU19DSElQX1dJRFRIICsgR0FQfXB4KTtcbiAgICAgICAgICAgICAgICAgICAgICBjb2RlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXAgIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgICAgICAgICBdfT5cbiAgICAgICAgICAgICAgICAgIHtzcWx9XG4gICAgICAgICAgICAgICAgPC9DYXJkPlxuICAgICAgICAgICAgICAgIHtyZW5kZXJSb3dzUmV0dXJuZWQoZmFsc2UpfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZCh0cnVlKX1cbiAgICAgICAgICAgIDwvPikgOiAoPD5cbiAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZChmYWxzZSl9XG4gICAgICAgICAgICAgIHtyZW5kZXJSb3dzUmV0dXJuZWQodHJ1ZSl9XG4gICAgICAgICAgICAgIHtzcWx9XG4gICAgICAgICAgICA8Lz4pfVxuICAgICAgICAgIDxSZXN1bHRUYWJsZSBkYXRhPXtkYXRhfSBxdWVyeUlkPXtxdWVyeS5pZH0gb3JkZXJlZENvbHVtbktleXM9e3Jlc3VsdHMuY29sdW1ucy5tYXAoY29sID0+IGNvbC5jb2x1bW5fbmFtZSl9IGhlaWdodD17cm93c0hlaWdodH0gZmlsdGVyVGV4dD17c2VhcmNoVGV4dH0gZXhwYW5kZWRDb2x1bW5zPXtleHBhbmRlZENvbHVtbnN9IGFsbG93SFRNTD17YWxsb3dIVE1MfS8+XG4gICAgICAgIDwvUmVzdWx0Q29udGFpbmVyPik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA8QWxlcnQgdHlwZT1cIndhcm5pbmdcIiBtZXNzYWdlPXt0KCdUaGUgcXVlcnkgcmV0dXJuZWQgbm8gZGF0YScpfS8+O1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChxdWVyeS5jYWNoZWQgfHwgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgIXF1ZXJ5LnJlc3VsdHMpKSB7XG4gICAgICAgIGlmIChxdWVyeS5pc0RhdGFQcmV2aWV3KSB7XG4gICAgICAgICAgICByZXR1cm4gKDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgYnV0dG9uU3R5bGU9XCJwcmltYXJ5XCIgb25DbGljaz17KCkgPT4gZGlzcGF0Y2gocmVGZXRjaFF1ZXJ5UmVzdWx0cyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnF1ZXJ5LFxuICAgICAgICAgICAgICAgICAgICBpc0RhdGFQcmV2aWV3OiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pKX0+XG4gICAgICAgICAge3QoJ0ZldGNoIGRhdGEgcHJldmlldycpfVxuICAgICAgICA8L0J1dHRvbj4pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeS5yZXN1bHRzS2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gKDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgYnV0dG9uU3R5bGU9XCJwcmltYXJ5XCIgb25DbGljaz17KCkgPT4gZmV0Y2hSZXN1bHRzKHF1ZXJ5KX0+XG4gICAgICAgICAge3QoJ1JlZmV0Y2ggcmVzdWx0cycpfVxuICAgICAgICA8L0J1dHRvbj4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxldCBwcm9ncmVzc0JhcjtcbiAgICBpZiAocXVlcnkucHJvZ3Jlc3MgPiAwKSB7XG4gICAgICAgIHByb2dyZXNzQmFyID0gKDxQcm9ncmVzc0JhciBwZXJjZW50PXtwYXJzZUludChxdWVyeS5wcm9ncmVzcy50b0ZpeGVkKDApLCAxMCl9IHN0cmlwZWQvPik7XG4gICAgfVxuICAgIGNvbnN0IHByb2dyZXNzTXNnID0gcXVlcnk/LmV4dHJhPy5wcm9ncmVzcyA/PyBudWxsO1xuICAgIHJldHVybiAoPFJlc3VsdGxlc3NTdHlsZXM+XG4gICAgICA8ZGl2PnshcHJvZ3Jlc3NCYXIgJiYgPExvYWRpbmcgcG9zaXRpb249XCJub3JtYWxcIi8+fTwvZGl2PlxuICAgICAgey8qIHNob3cgbG9hZGluZyBiYXIgd2hlbmV2ZXIgcHJvZ3Jlc3MgYmFyIGlzIGNvbXBsZXRlZCBidXQgbmVlZHMgdGltZSB0byByZW5kZXIgKi99XG4gICAgICA8ZGl2PntxdWVyeS5wcm9ncmVzcyA9PT0gMTAwICYmIDxMb2FkaW5nIHBvc2l0aW9uPVwibm9ybWFsXCIvPn08L2Rpdj5cbiAgICAgIDxRdWVyeVN0YXRlTGFiZWwgcXVlcnk9e3F1ZXJ5fS8+XG4gICAgICA8ZGl2Pntwcm9ncmVzc01zZyAmJiA8QWxlcnQgdHlwZT1cInN1Y2Nlc3NcIiBtZXNzYWdlPXtwcm9ncmVzc01zZ30vPn08L2Rpdj5cbiAgICAgIDxkaXY+e3F1ZXJ5LnByb2dyZXNzICE9PSAxMDAgJiYgcHJvZ3Jlc3NCYXJ9PC9kaXY+XG4gICAgICB7dHJhY2tpbmdVcmwgJiYgPGRpdj57dHJhY2tpbmdVcmx9PC9kaXY+fVxuICAgIDwvUmVzdWx0bGVzc1N0eWxlcz4pO1xufTtcbmV4cG9ydCBkZWZhdWx0IG1lbW8oUmVzdWx0U2V0KTtcbiJdfQ== */\"), onClick: () => popSelectStar(tempSchema, tempTable), children:\n              t('Query in a new tab') }\n            ),\n            _jsx(ExploreCtasResultsButton, { table: tempTable, schema: tempSchema, dbId: exploreDBId })] }\n          )] }\n        ) }) }\n    );\n  }\n  if (query.state === QueryState.Success && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen ?\n    height - alertContainerHeight :\n    height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else\n    if (results != null && results.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns ?\n      results.expanded_columns.map((col) => col.column_name) :\n      [];\n      const allowHTML = getItem(LocalStorageKeys.SqllabIsRenderHtmlEnabled, true);\n      return _jsxs(ResultContainer, { children: [\n        renderControls(),\n        showSql && showSqlInline ? _jsxs(_Fragment, { children: [\n          _jsxs(\"div\", { css: css`\n                  display: flex;\n                  justify-content: space-between;\n                  gap: ${GAP}px;\n                `, children: [\n            _jsx(Card, { css: [\n              css`\n                      height: 28px;\n                      width: calc(100% - ${ROWS_CHIP_WIDTH + GAP}px);\n                      code {\n                        width: 100%;\n                        overflow: hidden;\n                        white-space: nowrap !important;\n                        text-overflow: ellipsis;\n                        display: block;\n                      }\n                    `, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ResultSet;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hcnl1cmtvdi9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvUmVzdWx0U2V0L2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE2WnNCIiwiZmlsZSI6Ii9Vc2Vycy9hcnl1cmtvdi9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvUmVzdWx0U2V0L2luZGV4LnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVN0YXRlLCBtZW1vLCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHNoYWxsb3dFcXVhbCwgdXNlRGlzcGF0Y2gsIHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHsgdXNlSGlzdG9yeSB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xuaW1wb3J0IHsgcGljayB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQnV0dG9uR3JvdXAgZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uR3JvdXAnO1xuaW1wb3J0IEFsZXJ0IGZyb20gJ3NyYy9jb21wb25lbnRzL0FsZXJ0JztcbmltcG9ydCBCdXR0b24gZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uJztcbmltcG9ydCB7IG5hbm9pZCB9IGZyb20gJ25hbm9pZCc7XG5pbXBvcnQgeyBRdWVyeVN0YXRlLCBzdHlsZWQsIHQsIHRuLCB1c2VUaGVtZSwgdXNlUHJldmlvdXMsIGNzcywgZ2V0TnVtYmVyRm9ybWF0dGVyLCBnZXRFeHRlbnNpb25zUmVnaXN0cnksIEVycm9yVHlwZUVudW0sIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IEVycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlIGZyb20gJ3NyYy9jb21wb25lbnRzL0Vycm9yTWVzc2FnZS9FcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSc7XG5pbXBvcnQgeyBTYXZlRGF0YXNldE1vZGFsLCB9IGZyb20gJ3NyYy9TcWxMYWIvY29tcG9uZW50cy9TYXZlRGF0YXNldE1vZGFsJztcbmltcG9ydCB7IEVYUExPUkVfQ0hBUlRfREVGQVVMVCB9IGZyb20gJ3NyYy9TcWxMYWIvdHlwZXMnO1xuaW1wb3J0IHsgbW91bnRFeHBsb3JlVXJsIH0gZnJvbSAnc3JjL2V4cGxvcmUvZXhwbG9yZVV0aWxzJztcbmltcG9ydCB7IHBvc3RGb3JtRGF0YSB9IGZyb20gJ3NyYy9leHBsb3JlL2V4cGxvcmVVdGlscy9mb3JtRGF0YSc7XG5pbXBvcnQgUHJvZ3Jlc3NCYXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvUHJvZ3Jlc3NCYXInO1xuaW1wb3J0IExvYWRpbmcgZnJvbSAnc3JjL2NvbXBvbmVudHMvTG9hZGluZyc7XG5pbXBvcnQgQ2FyZCBmcm9tICdzcmMvY29tcG9uZW50cy9DYXJkJztcbmltcG9ydCBMYWJlbCBmcm9tICdzcmMvY29tcG9uZW50cy9MYWJlbCc7XG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvVG9vbHRpcCc7XG5pbXBvcnQgRmlsdGVyYWJsZVRhYmxlIGZyb20gJ3NyYy9jb21wb25lbnRzL0ZpbHRlcmFibGVUYWJsZSc7XG5pbXBvcnQgQ29weVRvQ2xpcGJvYXJkIGZyb20gJ3NyYy9jb21wb25lbnRzL0NvcHlUb0NsaXBib2FyZCc7XG5pbXBvcnQgeyBhZGREYW5nZXJUb2FzdCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lc3NhZ2VUb2FzdHMvYWN0aW9ucyc7XG5pbXBvcnQgeyBwcmVwYXJlQ29weVRvQ2xpcGJvYXJkVGFidWxhckRhdGEgfSBmcm9tICdzcmMvdXRpbHMvY29tbW9uJztcbmltcG9ydCB7IGdldEl0ZW0sIExvY2FsU3RvcmFnZUtleXMgfSBmcm9tICdzcmMvdXRpbHMvbG9jYWxTdG9yYWdlSGVscGVycyc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnc3JjL2NvbXBvbmVudHMvTW9kYWwnO1xuaW1wb3J0IHsgYWRkUXVlcnlFZGl0b3IsIGNsZWFyUXVlcnlSZXN1bHRzLCBDdGFzRW51bSwgZmV0Y2hRdWVyeVJlc3VsdHMsIHJlRmV0Y2hRdWVyeVJlc3VsdHMsIHJlUnVuUXVlcnksIH0gZnJvbSAnc3JjL1NxbExhYi9hY3Rpb25zL3NxbExhYic7XG5pbXBvcnQgeyBVUkxfUEFSQU1TIH0gZnJvbSAnc3JjL2NvbnN0YW50cyc7XG5pbXBvcnQgdXNlTG9nQWN0aW9uIGZyb20gJ3NyYy9sb2dnZXIvdXNlTG9nQWN0aW9uJztcbmltcG9ydCB7IExPR19BQ1RJT05TX1NRTExBQl9DT1BZX1JFU1VMVF9UT19DTElQQk9BUkQsIExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfQ0hBUlQsIExPR19BQ1RJT05TX1NRTExBQl9ET1dOTE9BRF9DU1YsIH0gZnJvbSAnc3JjL2xvZ2dlci9Mb2dVdGlscyc7XG5pbXBvcnQgeyBJY29ucyB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IGZpbmRQZXJtaXNzaW9uIH0gZnJvbSAnc3JjL3V0aWxzL2ZpbmRQZXJtaXNzaW9uJztcbmltcG9ydCBFeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24gZnJvbSAnLi4vRXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uJztcbmltcG9ydCBFeHBsb3JlUmVzdWx0c0J1dHRvbiBmcm9tICcuLi9FeHBsb3JlUmVzdWx0c0J1dHRvbic7XG5pbXBvcnQgSGlnaGxpZ2h0ZWRTcWwgZnJvbSAnLi4vSGlnaGxpZ2h0ZWRTcWwnO1xuaW1wb3J0IFF1ZXJ5U3RhdGVMYWJlbCBmcm9tICcuLi9RdWVyeVN0YXRlTGFiZWwnO1xudmFyIExpbWl0aW5nRmFjdG9yO1xuKGZ1bmN0aW9uIChMaW1pdGluZ0ZhY3Rvcikge1xuICAgIExpbWl0aW5nRmFjdG9yW1wiUXVlcnlcIl0gPSBcIlFVRVJZXCI7XG4gICAgTGltaXRpbmdGYWN0b3JbXCJRdWVyeUFuZERyb3Bkb3duXCJdID0gXCJRVUVSWV9BTkRfRFJPUERPV05cIjtcbiAgICBMaW1pdGluZ0ZhY3RvcltcIkRyb3Bkb3duXCJdID0gXCJEUk9QRE9XTlwiO1xuICAgIExpbWl0aW5nRmFjdG9yW1wiTm90TGltaXRlZFwiXSA9IFwiTk9UX0xJTUlURURcIjtcbn0pKExpbWl0aW5nRmFjdG9yIHx8IChMaW1pdGluZ0ZhY3RvciA9IHt9KSk7XG5jb25zdCBSZXN1bHRDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgcm93LWdhcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG5gO1xuY29uc3QgUmVzdWx0bGVzc1N0eWxlcyA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG1pbi1oZWlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyNX1weDtcbiAgW3JvbGU9J2FsZXJ0J10ge1xuICAgIG1hcmdpbi10b3A6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICB9XG4gIC5zcWwtcmVzdWx0LXRyYWNrLWpvYiB7XG4gICAgbWFyZ2luLXRvcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIH1cbmA7XG4vLyBNYWtpbmcgdGV4dCByZW5kZXIgbGluZSBicmVha3MvdGFicyBhcyBpcyBhcyBtb25vc3BhY2UsXG4vLyBidXQgd3JhcHBpbmcgdGV4dCB0b28gc28gdGV4dCBkb2Vzbid0IG92ZXJmbG93XG5jb25zdCBNb25vc3BhY2VEaXYgPSBzdHlsZWQuZGl2IGBcbiAgZm9udC1mYW1pbHk6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUudHlwb2dyYXBoeS5mYW1pbGllcy5tb25vc3BhY2V9O1xuICB3aGl0ZS1zcGFjZTogcHJlO1xuICB3b3JkLWJyZWFrOiBicmVhay13b3JkO1xuICBvdmVyZmxvdy14OiBhdXRvO1xuICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XG5gO1xuY29uc3QgUmV0dXJuZWRSb3dzID0gc3R5bGVkLmRpdiBgXG4gIGZvbnQtc2l6ZTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS50eXBvZ3JhcGh5LnNpemVzLnN9cHg7XG4gIGxpbmUtaGVpZ2h0OiAxO1xuYDtcbmNvbnN0IFJlc3VsdFNldENvbnRyb2xzID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbmA7XG5jb25zdCBSZXN1bHRTZXRCdXR0b25zID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtYXV0by1mbG93OiBjb2x1bW47XG4gIHBhZGRpbmctcmlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4O1xuYDtcbmNvbnN0IGNvcHlCdXR0b25TdHlsZXMgPSBjc3MgYFxuICAmOmhvdmVyIHtcbiAgICB0ZXh0LWRlY29yYXRpb246IHVuc2V0O1xuICB9XG4gIHNwYW4gPiA6Zmlyc3Qtb2YtdHlwZSB7XG4gICAgbWFyZ2luOiAwcHg7XG4gIH1cbmA7XG5jb25zdCBST1dTX0NISVBfV0lEVEggPSAxMDA7XG5jb25zdCBHQVAgPSA4O1xuY29uc3QgZXh0ZW5zaW9uc1JlZ2lzdHJ5ID0gZ2V0RXh0ZW5zaW9uc1JlZ2lzdHJ5KCk7XG5jb25zdCBSZXN1bHRTZXQgPSAoeyBjYWNoZSA9IGZhbHNlLCBjc3YgPSB0cnVlLCBkYXRhYmFzZSA9IHt9LCBkaXNwbGF5TGltaXQsIGhlaWdodCwgcXVlcnlJZCwgc2VhcmNoID0gdHJ1ZSwgc2hvd1NxbCA9IGZhbHNlLCBzaG93U3FsSW5saW5lID0gZmFsc2UsIHZpc3VhbGl6ZSA9IHRydWUsIGRlZmF1bHRRdWVyeUxpbWl0LCB9KSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZVNlbGVjdG9yKCh7IHVzZXIgfSkgPT4gdXNlciwgc2hhbGxvd0VxdWFsKTtcbiAgICBjb25zdCBxdWVyeSA9IHVzZVNlbGVjdG9yKCh7IHNxbExhYjogeyBxdWVyaWVzIH0gfSkgPT4gcGljayhxdWVyaWVzW3F1ZXJ5SWRdLCBbXG4gICAgICAgICdpZCcsXG4gICAgICAgICdlcnJvck1lc3NhZ2UnLFxuICAgICAgICAnY2FjaGVkJyxcbiAgICAgICAgJ3Jlc3VsdHMnLFxuICAgICAgICAncmVzdWx0c0tleScsXG4gICAgICAgICdkYklkJyxcbiAgICAgICAgJ3RhYicsXG4gICAgICAgICdzcWwnLFxuICAgICAgICAnc3FsRWRpdG9ySWQnLFxuICAgICAgICAndGVtcGxhdGVQYXJhbXMnLFxuICAgICAgICAnc2NoZW1hJyxcbiAgICAgICAgJ3Jvd3MnLFxuICAgICAgICAncXVlcnlMaW1pdCcsXG4gICAgICAgICdsaW1pdGluZ0ZhY3RvcicsXG4gICAgICAgICd0cmFja2luZ1VybCcsXG4gICAgICAgICdzdGF0ZScsXG4gICAgICAgICdlcnJvcnMnLFxuICAgICAgICAnbGluaycsXG4gICAgICAgICdjdGFzJyxcbiAgICAgICAgJ2N0YXNfbWV0aG9kJyxcbiAgICAgICAgJ3RlbXBTY2hlbWEnLFxuICAgICAgICAndGVtcFRhYmxlJyxcbiAgICAgICAgJ2lzRGF0YVByZXZpZXcnLFxuICAgICAgICAncHJvZ3Jlc3MnLFxuICAgICAgICAnZXh0cmEnLFxuICAgIF0pLCBzaGFsbG93RXF1YWwpO1xuICAgIGNvbnN0IFJlc3VsdFRhYmxlID0gZXh0ZW5zaW9uc1JlZ2lzdHJ5LmdldCgnc3FsZWRpdG9yLmV4dGVuc2lvbi5yZXN1bHRUYWJsZScpID8/XG4gICAgICAgIEZpbHRlcmFibGVUYWJsZTtcbiAgICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gdXNlU3RhdGUoJycpO1xuICAgIGNvbnN0IFtjYWNoZWREYXRhLCBzZXRDYWNoZWREYXRhXSA9IHVzZVN0YXRlKFtdKTtcbiAgICBjb25zdCBbc2hvd1NhdmVEYXRhc2V0TW9kYWwsIHNldFNob3dTYXZlRGF0YXNldE1vZGFsXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbYWxlcnRJc09wZW4sIHNldEFsZXJ0SXNPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBoaXN0b3J5ID0gdXNlSGlzdG9yeSgpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgICBjb25zdCBsb2dBY3Rpb24gPSB1c2VMb2dBY3Rpb24oeyBxdWVyeUlkLCBzcWxFZGl0b3JJZDogcXVlcnkuc3FsRWRpdG9ySWQgfSk7XG4gICAgY29uc3QgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIGlmIChxdWVyeS5lcnJvck1lc3NhZ2UgJiZcbiAgICAgICAgICAgIHF1ZXJ5LmVycm9yTWVzc2FnZS5pbmRleE9mKCdzZXNzaW9uIHRpbWVkIG91dCcpID4gMCkge1xuICAgICAgICAgICAgZGlzcGF0Y2gocmVSdW5RdWVyeShxdWVyeSkpO1xuICAgICAgICB9XG4gICAgfSwgW10pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIG9ubHkgZG8gdGhpcyB0aGUgZmlyc3QgdGltZSB0aGUgY29tcG9uZW50IGlzIHJlbmRlcmVkL21vdW50ZWRcbiAgICAgICAgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQoKTtcbiAgICB9LCBbcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnRdKTtcbiAgICBjb25zdCBmZXRjaFJlc3VsdHMgPSAocSwgdGltZW91dCkgPT4ge1xuICAgICAgICBkaXNwYXRjaChmZXRjaFF1ZXJ5UmVzdWx0cyhxLCBkaXNwbGF5TGltaXQsIHRpbWVvdXQpKTtcbiAgICB9O1xuICAgIGNvbnN0IHByZXZRdWVyeSA9IHVzZVByZXZpb3VzKHF1ZXJ5KTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkICYmIHF1ZXJ5Py5yZXN1bHRzPy5kYXRhPy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzZXRDYWNoZWREYXRhKHF1ZXJ5LnJlc3VsdHMuZGF0YSk7XG4gICAgICAgICAgICBkaXNwYXRjaChjbGVhclF1ZXJ5UmVzdWx0cyhxdWVyeSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeS5yZXN1bHRzS2V5ICYmIHF1ZXJ5LnJlc3VsdHNLZXkgIT09IHByZXZRdWVyeT8ucmVzdWx0c0tleSkge1xuICAgICAgICAgICAgZmV0Y2hSZXN1bHRzKHF1ZXJ5KTtcbiAgICAgICAgfVxuICAgIH0sIFtxdWVyeSwgY2FjaGVdKTtcbiAgICBjb25zdCBjYWxjdWxhdGVBbGVydFJlZkhlaWdodCA9IChhbGVydEVsZW1lbnQpID0+IHtcbiAgICAgICAgaWYgKGFsZXJ0RWxlbWVudCkge1xuICAgICAgICAgICAgc2V0QWxlcnRJc09wZW4odHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZXRBbGVydElzT3BlbihmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHBvcFNlbGVjdFN0YXIgPSAodGVtcFNjaGVtYSwgdGVtcFRhYmxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHFlID0ge1xuICAgICAgICAgICAgaWQ6IG5hbm9pZCgxMSksXG4gICAgICAgICAgICBuYW1lOiB0ZW1wVGFibGUsXG4gICAgICAgICAgICBhdXRvcnVuOiBmYWxzZSxcbiAgICAgICAgICAgIGRiSWQ6IHF1ZXJ5LmRiSWQsXG4gICAgICAgICAgICBzcWw6IGBTRUxFQ1QgKiBGUk9NICR7dGVtcFNjaGVtYSA/IGAke3RlbXBTY2hlbWF9LmAgOiAnJ30ke3RlbXBUYWJsZX1gLFxuICAgICAgICB9O1xuICAgICAgICBkaXNwYXRjaChhZGRRdWVyeUVkaXRvcihxZSkpO1xuICAgIH07XG4gICAgY29uc3QgY2hhbmdlU2VhcmNoID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIHNldFNlYXJjaFRleHQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZUV4cGxvcmVSZXN1bHRzT25DbGljayA9IGFzeW5jIChjbGlja0V2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0cyB9ID0gcXVlcnk7XG4gICAgICAgIGNvbnN0IG9wZW5Jbk5ld1dpbmRvdyA9IGNsaWNrRXZlbnQubWV0YUtleTtcbiAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfQ0hBUlQsIHt9KTtcbiAgICAgICAgaWYgKHJlc3VsdHM/LnF1ZXJ5X2lkKSB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBhd2FpdCBwb3N0Rm9ybURhdGEocmVzdWx0cy5xdWVyeV9pZCwgJ3F1ZXJ5Jywge1xuICAgICAgICAgICAgICAgIC4uLkVYUExPUkVfQ0hBUlRfREVGQVVMVCxcbiAgICAgICAgICAgICAgICBkYXRhc291cmNlOiBgJHtyZXN1bHRzLnF1ZXJ5X2lkfV9fcXVlcnlgLFxuICAgICAgICAgICAgICAgIC4uLntcbiAgICAgICAgICAgICAgICAgICAgYWxsX2NvbHVtbnM6IHJlc3VsdHMuY29sdW1ucy5tYXAoY29sdW1uID0+IGNvbHVtbi5jb2x1bW5fbmFtZSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgdXJsID0gbW91bnRFeHBsb3JlVXJsKG51bGwsIHtcbiAgICAgICAgICAgICAgICBbVVJMX1BBUkFNUy5mb3JtRGF0YUtleS5uYW1lXToga2V5LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAob3BlbkluTmV3V2luZG93KSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lm9wZW4odXJsLCAnX2JsYW5rJywgJ25vcmVmZXJyZXInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaCh1cmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWRkRGFuZ2VyVG9hc3QodCgnVW5hYmxlIHRvIGNyZWF0ZSBjaGFydCB3aXRob3V0IGEgcXVlcnkgaWQuJykpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBnZXRFeHBvcnRDc3ZVcmwgPSAoY2xpZW50SWQpID0+IGAvYXBpL3YxL3NxbGxhYi9leHBvcnQvJHtjbGllbnRJZH0vYDtcbiAgICBjb25zdCByZW5kZXJDb250cm9scyA9ICgpID0+IHtcbiAgICAgICAgaWYgKHNlYXJjaCB8fCB2aXN1YWxpemUgfHwgY3N2KSB7XG4gICAgICAgICAgICBjb25zdCB7IHJlc3VsdHMsIHF1ZXJ5TGltaXQsIGxpbWl0aW5nRmFjdG9yLCByb3dzIH0gPSBxdWVyeTtcbiAgICAgICAgICAgIGNvbnN0IGxpbWl0ID0gcXVlcnlMaW1pdCB8fCByZXN1bHRzLnF1ZXJ5LmxpbWl0O1xuICAgICAgICAgICAgY29uc3Qgcm93c0NvdW50ID0gTWF0aC5taW4ocm93cyB8fCAwLCByZXN1bHRzPy5kYXRhPy5sZW5ndGggfHwgMCk7XG4gICAgICAgICAgICBsZXQgeyBkYXRhIH0gPSBxdWVyeS5yZXN1bHRzO1xuICAgICAgICAgICAgaWYgKGNhY2hlICYmIHF1ZXJ5LmNhY2hlZCkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBjYWNoZWREYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBjb2x1bW5zIH0gPSBxdWVyeS5yZXN1bHRzO1xuICAgICAgICAgICAgLy8gQWRkZWQgY29tcHV0ZSBsb2dpYyB0byBzdG9wIHVzZXIgZnJvbSBiZWluZyBhYmxlIHRvIFNhdmUgJiBFeHBsb3JlXG4gICAgICAgICAgICBjb25zdCBkYXRhc291cmNlID0ge1xuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHF1ZXJ5LnJlc3VsdHMuY29sdW1ucyxcbiAgICAgICAgICAgICAgICBuYW1lOiBxdWVyeT8udGFiIHx8ICdVbnRpdGxlZCcsXG4gICAgICAgICAgICAgICAgZGJJZDogcXVlcnk/LmRiSWQsXG4gICAgICAgICAgICAgICAgc3FsOiBxdWVyeT8uc3FsLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlUGFyYW1zOiBxdWVyeT8udGVtcGxhdGVQYXJhbXMsXG4gICAgICAgICAgICAgICAgc2NoZW1hOiBxdWVyeT8uc2NoZW1hLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGNhbkV4cG9ydERhdGEgPSBmaW5kUGVybWlzc2lvbignY2FuX2V4cG9ydF9jc3YnLCAnU1FMTGFiJywgdXNlcj8ucm9sZXMpO1xuICAgICAgICAgICAgcmV0dXJuICg8UmVzdWx0U2V0Q29udHJvbHM+XG4gICAgICAgICAgPFNhdmVEYXRhc2V0TW9kYWwgdmlzaWJsZT17c2hvd1NhdmVEYXRhc2V0TW9kYWx9IG9uSGlkZT17KCkgPT4gc2V0U2hvd1NhdmVEYXRhc2V0TW9kYWwoZmFsc2UpfSBidXR0b25UZXh0T25TYXZlPXt0KCdTYXZlICYgRXhwbG9yZScpfSBidXR0b25UZXh0T25PdmVyd3JpdGU9e3QoJ092ZXJ3cml0ZSAmIEV4cGxvcmUnKX0gbW9kYWxEZXNjcmlwdGlvbj17dCgnU2F2ZSB0aGlzIHF1ZXJ5IGFzIGEgdmlydHVhbCBkYXRhc2V0IHRvIGNvbnRpbnVlIGV4cGxvcmluZycpfSBkYXRhc291cmNlPXtkYXRhc291cmNlfS8+XG4gICAgICAgICAgPFJlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAgICB7dmlzdWFsaXplICYmIGRhdGFiYXNlPy5hbGxvd3NfdmlydHVhbF90YWJsZV9leHBsb3JlICYmICg8RXhwbG9yZVJlc3VsdHNCdXR0b24gZGF0YWJhc2U9e2RhdGFiYXNlfSBvbkNsaWNrPXtjcmVhdGVFeHBsb3JlUmVzdWx0c09uQ2xpY2t9Lz4pfVxuICAgICAgICAgICAge2NzdiAmJiBjYW5FeHBvcnREYXRhICYmICg8QnV0dG9uIGNzcz17Y29weUJ1dHRvblN0eWxlc30gYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17Z2V0RXhwb3J0Q3N2VXJsKHF1ZXJ5LmlkKX0gZGF0YS10ZXN0PVwiZXhwb3J0LWNzdi1idXR0b25cIiBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0RPV05MT0FEX0NTViwge30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbWl0aW5nRmFjdG9yID09PSBMaW1pdGluZ0ZhY3Rvci5Ecm9wZG93biAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbWl0ID09PSByb3dzQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2RhbC53YXJuaW5nKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHQoJ0Rvd25sb2FkIGlzIG9uIHRoZSB3YXknKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogdCgnRG93bmxvYWRpbmcgJShyb3dzKXMgcm93cyBiYXNlZCBvbiB0aGUgTElNSVQgY29uZmlndXJhdGlvbi4gSWYgeW91IHdhbnQgdGhlIGVudGlyZSByZXN1bHQgc2V0LCB5b3UgbmVlZCB0byBhZGp1c3QgdGhlIExJTUlULicsIHsgcm93czogcm93c0NvdW50LnRvTG9jYWxlU3RyaW5nKCkgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH19PlxuICAgICAgICAgICAgICAgIDxJY29ucy5Eb3dubG9hZE91dGxpbmVkIGljb25TaXplPVwibVwiIGljb25Db2xvcj17dGhlbWUuY29sb3JzLnByaW1hcnkuZGFyazJ9Lz57JyAnfVxuICAgICAgICAgICAgICAgIHt0KCdEb3dubG9hZCB0byBDU1YnKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+KX1cblxuICAgICAgICAgICAge2NhbkV4cG9ydERhdGEgJiYgKDxDb3B5VG9DbGlwYm9hcmQgdGV4dD17cHJlcGFyZUNvcHlUb0NsaXBib2FyZFRhYnVsYXJEYXRhKGRhdGEsIGNvbHVtbnMpfSB3cmFwcGVkPXtmYWxzZX0gY29weU5vZGU9ezxCdXR0b24gY3NzPXtjb3B5QnV0dG9uU3R5bGVzfSBidXR0b25TaXplPVwic21hbGxcIiBkYXRhLXRlc3Q9XCJjb3B5LXRvLWNsaXBib2FyZC1idXR0b25cIj5cbiAgICAgICAgICAgICAgICAgICAgPEljb25zLkNvcHlPdXRsaW5lZCBpY29uU2l6ZT1cInNcIiBpY29uQ29sb3I9e3RoZW1lLmNvbG9ycy5wcmltYXJ5LmRhcmsyfS8+eycgJ31cbiAgICAgICAgICAgICAgICAgICAge3QoJ0NvcHkgdG8gQ2xpcGJvYXJkJyl9XG4gICAgICAgICAgICAgICAgICA8L0J1dHRvbj59IGhpZGVUb29sdGlwIG9uQ29weUVuZD17KCkgPT4gbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9DT1BZX1JFU1VMVF9UT19DTElQQk9BUkQsIHt9KX0vPil9XG4gICAgICAgICAgPC9SZXN1bHRTZXRCdXR0b25zPlxuICAgICAgICAgIHtzZWFyY2ggJiYgKDxpbnB1dCB0eXBlPVwidGV4dFwiIG9uQ2hhbmdlPXtjaGFuZ2VTZWFyY2h9IHZhbHVlPXtzZWFyY2hUZXh0fSBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBwbGFjZWhvbGRlcj17dCgnRmlsdGVyIHJlc3VsdHMnKX0vPil9XG4gICAgICAgIDwvUmVzdWx0U2V0Q29udHJvbHM+KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gPGRpdiAvPjtcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlclJvd3NSZXR1cm5lZCA9IChhbGVydE1lc3NhZ2UpID0+IHtcbiAgICAgICAgY29uc3QgeyByZXN1bHRzLCByb3dzLCBxdWVyeUxpbWl0LCBsaW1pdGluZ0ZhY3RvciB9ID0gcXVlcnk7XG4gICAgICAgIGxldCBsaW1pdE1lc3NhZ2UgPSAnJztcbiAgICAgICAgY29uc3QgbGltaXRSZWFjaGVkID0gcmVzdWx0cz8uZGlzcGxheUxpbWl0UmVhY2hlZDtcbiAgICAgICAgY29uc3QgbGltaXQgPSBxdWVyeUxpbWl0IHx8IHJlc3VsdHMucXVlcnkubGltaXQ7XG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSAhIXVzZXI/LnJvbGVzPy5BZG1pbjtcbiAgICAgICAgY29uc3Qgcm93c0NvdW50ID0gTWF0aC5taW4ocm93cyB8fCAwLCByZXN1bHRzPy5kYXRhPy5sZW5ndGggfHwgMCk7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2UgPSB7XG4gICAgICAgICAgICB3aXRoQWRtaW46IHQoJ1RoZSBudW1iZXIgb2YgcmVzdWx0cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgY29uZmlndXJhdGlvbiBESVNQTEFZX01BWF9ST1cuICcgK1xuICAgICAgICAgICAgICAgICdQbGVhc2UgYWRkIGFkZGl0aW9uYWwgbGltaXRzL2ZpbHRlcnMgb3IgZG93bmxvYWQgdG8gY3N2IHRvIHNlZSBtb3JlIHJvd3MgdXAgdG8gJyArXG4gICAgICAgICAgICAgICAgJ3RoZSAlKGxpbWl0KWQgbGltaXQuJywgeyByb3dzOiByb3dzQ291bnQsIGxpbWl0IH0pLFxuICAgICAgICAgICAgd2l0aG91dEFkbWluOiB0KCdUaGUgbnVtYmVyIG9mIHJlc3VsdHMgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQuICcgK1xuICAgICAgICAgICAgICAgICdQbGVhc2UgYWRkIGFkZGl0aW9uYWwgbGltaXRzL2ZpbHRlcnMsIGRvd25sb2FkIHRvIGNzdiwgb3IgY29udGFjdCBhbiBhZG1pbiAnICtcbiAgICAgICAgICAgICAgICAndG8gc2VlIG1vcmUgcm93cyB1cCB0byB0aGUgJShsaW1pdClkIGxpbWl0LicsIHsgcm93czogcm93c0NvdW50LCBsaW1pdCB9KSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgc2hvdWxkVXNlRGVmYXVsdERyb3Bkb3duQWxlcnQgPSBsaW1pdCA9PT0gZGVmYXVsdFF1ZXJ5TGltaXQgJiYgbGltaXRpbmdGYWN0b3IgPT09IExpbWl0aW5nRmFjdG9yLkRyb3Bkb3duO1xuICAgICAgICBpZiAobGltaXRpbmdGYWN0b3IgPT09IExpbWl0aW5nRmFjdG9yLlF1ZXJ5ICYmIGNzdikge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBxdWVyeScsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuRHJvcGRvd24gJiZcbiAgICAgICAgICAgICFzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCkge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBsaW1pdCBkcm9wZG93bi4nLCB7IHJvd3MgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGltaXRpbmdGYWN0b3IgPT09IExpbWl0aW5nRmFjdG9yLlF1ZXJ5QW5kRHJvcGRvd24pIHtcbiAgICAgICAgICAgIGxpbWl0TWVzc2FnZSA9IHQoJ1RoZSBudW1iZXIgb2Ygcm93cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgcXVlcnkgYW5kIGxpbWl0IGRyb3Bkb3duLicsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmb3JtYXR0ZWRSb3dDb3VudCA9IGdldE51bWJlckZvcm1hdHRlcigpKHJvd3MpO1xuICAgICAgICBjb25zdCByb3dzUmV0dXJuZWRNZXNzYWdlID0gdCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHtcbiAgICAgICAgICAgIHJvd3MsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB0b29sdGlwVGV4dCA9IGAke3Jvd3NSZXR1cm5lZE1lc3NhZ2V9LiAke2xpbWl0TWVzc2FnZX1gO1xuICAgICAgICBpZiAoYWxlcnRNZXNzYWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gKDw+XG4gICAgICAgICAgeyFsaW1pdFJlYWNoZWQgJiYgc2hvdWxkVXNlRGVmYXVsdERyb3Bkb3duQWxlcnQgJiYgKDxkaXYgcmVmPXtjYWxjdWxhdGVBbGVydFJlZkhlaWdodH0+XG4gICAgICAgICAgICAgIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJyUocm93cylkIHJvd3MgcmV0dXJuZWQnLCB7IHJvd3MgfSl9IG9uQ2xvc2U9eygpID0+IHNldEFsZXJ0SXNPcGVuKGZhbHNlKX0gZGVzY3JpcHRpb249e3QoJ1RoZSBudW1iZXIgb2Ygcm93cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgZHJvcGRvd24uJywgeyByb3dzIH0pfS8+XG4gICAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICAgIHtsaW1pdFJlYWNoZWQgJiYgKDxkaXYgcmVmPXtjYWxjdWxhdGVBbGVydFJlZkhlaWdodH0+XG4gICAgICAgICAgICAgIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG9uQ2xvc2U9eygpID0+IHNldEFsZXJ0SXNPcGVuKGZhbHNlKX0gbWVzc2FnZT17dCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHsgcm93czogcm93c0NvdW50IH0pfSBkZXNjcmlwdGlvbj17aXNBZG1pblxuICAgICAgICAgICAgICAgICAgICAgICAgPyBkaXNwbGF5TWF4Um93c1JlYWNoZWRNZXNzYWdlLndpdGhBZG1pblxuICAgICAgICAgICAgICAgICAgICAgICAgOiBkaXNwbGF5TWF4Um93c1JlYWNoZWRNZXNzYWdlLndpdGhvdXRBZG1pbn0vPlxuICAgICAgICAgICAgPC9kaXY+KX1cbiAgICAgICAgPC8+KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaG93Um93c1JldHVybmVkID0gc2hvd1NxbElubGluZSB8fCAoIWxpbWl0UmVhY2hlZCAmJiAhc2hvdWxkVXNlRGVmYXVsdERyb3Bkb3duQWxlcnQpO1xuICAgICAgICByZXR1cm4gKDw+XG4gICAgICAgIHtzaG93Um93c1JldHVybmVkICYmICg8UmV0dXJuZWRSb3dzPlxuICAgICAgICAgICAgPFRvb2x0aXAgaWQ9XCJzcWxsYWItcm93Y291bnQtdG9vbHRpcFwiIHRpdGxlPXt0b29sdGlwVGV4dH0gcGxhY2VtZW50PVwibGVmdFwiPlxuICAgICAgICAgICAgICA8TGFiZWwgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgbGluZS1oZWlnaHQ6ICR7dGhlbWUudHlwb2dyYXBoeS5zaXplcy5sfXB4O1xuICAgICAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAgICAgIHtsaW1pdE1lc3NhZ2UgJiYgKDxJY29ucy5FeGNsYW1hdGlvbkNpcmNsZU91dGxpbmVkIGNzcz17Y3NzIGBcbiAgICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6ICR7dGhlbWUudHlwb2dyYXBoeS5zaXplcy5tfXB4O1xuICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogJHt0aGVtZS5ncmlkVW5pdH1weDtcbiAgICAgICAgICAgICAgICAgICAgYH0vPil9XG4gICAgICAgICAgICAgICAge3RuKCclcyByb3cnLCAnJXMgcm93cycsIHJvd3MsIGZvcm1hdHRlZFJvd0NvdW50KX1cbiAgICAgICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICA8L1JldHVybmVkUm93cz4pfVxuICAgICAgPC8+KTtcbiAgICB9O1xuICAgIGNvbnN0IGxpbWl0UmVhY2hlZCA9IHF1ZXJ5Py5yZXN1bHRzPy5kaXNwbGF5TGltaXRSZWFjaGVkO1xuICAgIGxldCBzcWw7XG4gICAgbGV0IGV4cGxvcmVEQklkID0gcXVlcnkuZGJJZDtcbiAgICBpZiAoZGF0YWJhc2U/LmV4cGxvcmVfZGF0YWJhc2VfaWQpIHtcbiAgICAgICAgZXhwbG9yZURCSWQgPSBkYXRhYmFzZS5leHBsb3JlX2RhdGFiYXNlX2lkO1xuICAgIH1cbiAgICBsZXQgdHJhY2tpbmdVcmw7XG4gICAgaWYgKHF1ZXJ5LnRyYWNraW5nVXJsICYmXG4gICAgICAgIHF1ZXJ5LnN0YXRlICE9PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiZcbiAgICAgICAgcXVlcnkuc3RhdGUgIT09IFF1ZXJ5U3RhdGUuRmV0Y2hpbmcpIHtcbiAgICAgICAgdHJhY2tpbmdVcmwgPSAoPEJ1dHRvbiBjbGFzc05hbWU9XCJzcWwtcmVzdWx0LXRyYWNrLWpvYlwiIGJ1dHRvblNpemU9XCJzbWFsbFwiIGhyZWY9e3F1ZXJ5LnRyYWNraW5nVXJsfSB0YXJnZXQ9XCJfYmxhbmtcIj5cbiAgICAgICAge3F1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlJ1bm5pbmdcbiAgICAgICAgICAgICAgICA/IHQoJ1RyYWNrIGpvYicpXG4gICAgICAgICAgICAgICAgOiB0KCdTZWUgcXVlcnkgZGV0YWlscycpfVxuICAgICAgPC9CdXR0b24+KTtcbiAgICB9XG4gICAgaWYgKHNob3dTcWwpIHtcbiAgICAgICAgc3FsID0gKDxIaWdobGlnaHRlZFNxbCBzcWw9e3F1ZXJ5LnNxbH0gey4uLihzaG93U3FsSW5saW5lICYmIHsgbWF4TGluZXM6IDEsIG1heFdpZHRoOiA2MCB9KX0vPik7XG4gICAgfVxuICAgIGlmIChxdWVyeS5zdGF0ZSA9PT0gUXVlcnlTdGF0ZS5TdG9wcGVkKSB7XG4gICAgICAgIHJldHVybiA8QWxlcnQgdHlwZT1cIndhcm5pbmdcIiBtZXNzYWdlPXt0KCdRdWVyeSB3YXMgc3RvcHBlZCcpfS8+O1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuRmFpbGVkKSB7XG4gICAgICAgIGNvbnN0IGVycm9ycyA9IFsuLi4ocXVlcnkuZXh0cmE/LmVycm9ycyB8fCBbXSksIC4uLihxdWVyeS5lcnJvcnMgfHwgW10pXTtcbiAgICAgICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgICAge2Vycm9ycy5tYXAoKGVycm9yLCBpbmRleCkgPT4gKDxFcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSBrZXk9e2luZGV4fSB0aXRsZT17dCgnRGF0YWJhc2UgZXJyb3InKX0gZXJyb3I9e2Vycm9yfSBzdWJ0aXRsZT17PE1vbm9zcGFjZURpdj57ZXJyb3IubWVzc2FnZX08L01vbm9zcGFjZURpdj59IGNvcHlUZXh0PXtlcnJvci5tZXNzYWdlIHx8IHVuZGVmaW5lZH0gbGluaz17cXVlcnkubGlua30gc291cmNlPVwic3FsbGFiXCIvPikpfVxuICAgICAgICB7ZXJyb3JzLnNvbWUoZXJyb3IgPT4gZXJyb3I/LmVycm9yX3R5cGUgPT09IEVycm9yVHlwZUVudW0uRlJPTlRFTkRfVElNRU9VVF9FUlJPUikgPyAoPEJ1dHRvbiBjbGFzc05hbWU9XCJzcWwtcmVzdWx0LXRyYWNrLWpvYlwiIGJ1dHRvblNpemU9XCJzbWFsbFwiIG9uQ2xpY2s9eygpID0+IGZldGNoUmVzdWx0cyhxdWVyeSwgMCl9PlxuICAgICAgICAgICAge3QoJ1JldHJ5IGZldGNoaW5nIHJlc3VsdHMnKX1cbiAgICAgICAgICA8L0J1dHRvbj4pIDogKHRyYWNraW5nVXJsKX1cbiAgICAgIDwvUmVzdWx0bGVzc1N0eWxlcz4pO1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJiBxdWVyeS5jdGFzKSB7XG4gICAgICAgIGNvbnN0IHsgdGVtcFNjaGVtYSwgdGVtcFRhYmxlIH0gPSBxdWVyeTtcbiAgICAgICAgbGV0IG9iamVjdCA9ICdUYWJsZSc7XG4gICAgICAgIGlmIChxdWVyeS5jdGFzX21ldGhvZCA9PT0gQ3Rhc0VudW0uVmlldykge1xuICAgICAgICAgICAgb2JqZWN0ID0gJ1ZpZXcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoPGRpdj5cbiAgICAgICAgPEFsZXJ0IHR5cGU9XCJpbmZvXCIgbWVzc2FnZT17PD5cbiAgICAgICAgICAgICAge3Qob2JqZWN0KX0gW1xuICAgICAgICAgICAgICA8c3Ryb25nPlxuICAgICAgICAgICAgICAgIHt0ZW1wU2NoZW1hID8gYCR7dGVtcFNjaGVtYX0uYCA6ICcnfVxuICAgICAgICAgICAgICAgIHt0ZW1wVGFibGV9XG4gICAgICAgICAgICAgIDwvc3Ryb25nPlxuICAgICAgICAgICAgICBdIHt0KCd3YXMgY3JlYXRlZCcpfSAmbmJzcDtcbiAgICAgICAgICAgICAgPEJ1dHRvbkdyb3VwPlxuICAgICAgICAgICAgICAgIDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgY3NzPXt7IG1hcmdpblJpZ2h0OiB0aGVtZS5ncmlkVW5pdCB9fSBvbkNsaWNrPXsoKSA9PiBwb3BTZWxlY3RTdGFyKHRlbXBTY2hlbWEsIHRlbXBUYWJsZSl9PlxuICAgICAgICAgICAgICAgICAge3QoJ1F1ZXJ5IGluIGEgbmV3IHRhYicpfVxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgIDxFeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24gdGFibGU9e3RlbXBUYWJsZX0gc2NoZW1hPXt0ZW1wU2NoZW1hfSBkYklkPXtleHBsb3JlREJJZH0vPlxuICAgICAgICAgICAgICA8L0J1dHRvbkdyb3VwPlxuICAgICAgICAgICAgPC8+fS8+XG4gICAgICA8L2Rpdj4pO1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJiBxdWVyeS5yZXN1bHRzKSB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0cyB9ID0gcXVlcnk7XG4gICAgICAgIC8vIEFjY291bnRzIGZvciBvZmZzZXQgbmVlZGVkIGZvciBoZWlnaHQgb2YgUmVzdWx0U2V0Um93c1JldHVybmVkIGNvbXBvbmVudCBpZiAhbGltaXRSZWFjaGVkXG4gICAgICAgIGNvbnN0IHJvd01lc3NhZ2VIZWlnaHQgPSAhbGltaXRSZWFjaGVkID8gMzIgOiAwO1xuICAgICAgICAvLyBBY2NvdW50cyBmb3Igb2Zmc2V0IG5lZWRlZCBmb3IgaGVpZ2h0IG9mIEFsZXJ0IGlmIHRoaXMuc3RhdGUuYWxlcnRJc09wZW5cbiAgICAgICAgY29uc3QgYWxlcnRDb250YWluZXJIZWlnaHQgPSA3MDtcbiAgICAgICAgLy8gV2UgbmVlZCB0byBjYWxjdWxhdGUgdGhlIGhlaWdodCBvZiB0aGlzLnJlbmRlclJvd3NSZXR1cm5lZCgpXG4gICAgICAgIC8vIGlmIHdlIHdhbnQgcmVzdWx0cyBwYW5lbCB0byBiZSBwcm9wZXIgaGVpZ2h0IGJlY2F1c2UgdGhlXG4gICAgICAgIC8vIEZpbHRlclRhYmxlIGNvbXBvbmVudCBuZWVkcyBhbiBleHBsaWNpdCBoZWlnaHQgdG8gcmVuZGVyXG4gICAgICAgIC8vIHRoZSBUYWJsZSBjb21wb25lbnRcbiAgICAgICAgY29uc3Qgcm93c0hlaWdodCA9IGFsZXJ0SXNPcGVuXG4gICAgICAgICAgICA/IGhlaWdodCAtIGFsZXJ0Q29udGFpbmVySGVpZ2h0XG4gICAgICAgICAgICA6IGhlaWdodCAtIHJvd01lc3NhZ2VIZWlnaHQ7XG4gICAgICAgIGxldCBkYXRhO1xuICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkKSB7XG4gICAgICAgICAgICBkYXRhID0gY2FjaGVkRGF0YTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXN1bHRzPy5kYXRhKSB7XG4gICAgICAgICAgICAoeyBkYXRhIH0gPSByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGV4cGFuZGVkQ29sdW1ucyA9IHJlc3VsdHMuZXhwYW5kZWRfY29sdW1uc1xuICAgICAgICAgICAgICAgID8gcmVzdWx0cy5leHBhbmRlZF9jb2x1bW5zLm1hcChjb2wgPT4gY29sLmNvbHVtbl9uYW1lKVxuICAgICAgICAgICAgICAgIDogW107XG4gICAgICAgICAgICBjb25zdCBhbGxvd0hUTUwgPSBnZXRJdGVtKExvY2FsU3RvcmFnZUtleXMuU3FsbGFiSXNSZW5kZXJIdG1sRW5hYmxlZCwgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm4gKDxSZXN1bHRDb250YWluZXI+XG4gICAgICAgICAge3JlbmRlckNvbnRyb2xzKCl9XG4gICAgICAgICAge3Nob3dTcWwgJiYgc2hvd1NxbElubGluZSA/ICg8PlxuICAgICAgICAgICAgICA8ZGl2IGNzcz17Y3NzIGBcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XG4gICAgICAgICAgICAgICAgICBnYXA6ICR7R0FQfXB4O1xuICAgICAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAgICAgIDxDYXJkIGNzcz17W1xuICAgICAgICAgICAgICAgICAgICAgICAgY3NzIGBcbiAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDI4cHg7XG4gICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGNhbGMoMTAwJSAtICR7Uk9XU19DSElQX1dJRFRIICsgR0FQfXB4KTtcbiAgICAgICAgICAgICAgICAgICAgICBjb2RlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXAgIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgICAgICAgICBdfT5cbiAgICAgICAgICAgICAgICAgIHtzcWx9XG4gICAgICAgICAgICAgICAgPC9DYXJkPlxuICAgICAgICAgICAgICAgIHtyZW5kZXJSb3dzUmV0dXJuZWQoZmFsc2UpfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZCh0cnVlKX1cbiAgICAgICAgICAgIDwvPikgOiAoPD5cbiAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZChmYWxzZSl9XG4gICAgICAgICAgICAgIHtyZW5kZXJSb3dzUmV0dXJuZWQodHJ1ZSl9XG4gICAgICAgICAgICAgIHtzcWx9XG4gICAgICAgICAgICA8Lz4pfVxuICAgICAgICAgIDxSZXN1bHRUYWJsZSBkYXRhPXtkYXRhfSBxdWVyeUlkPXtxdWVyeS5pZH0gb3JkZXJlZENvbHVtbktleXM9e3Jlc3VsdHMuY29sdW1ucy5tYXAoY29sID0+IGNvbC5jb2x1bW5fbmFtZSl9IGhlaWdodD17cm93c0hlaWdodH0gZmlsdGVyVGV4dD17c2VhcmNoVGV4dH0gZXhwYW5kZWRDb2x1bW5zPXtleHBhbmRlZENvbHVtbnN9IGFsbG93SFRNTD17YWxsb3dIVE1MfS8+XG4gICAgICAgIDwvUmVzdWx0Q29udGFpbmVyPik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA8QWxlcnQgdHlwZT1cIndhcm5pbmdcIiBtZXNzYWdlPXt0KCdUaGUgcXVlcnkgcmV0dXJuZWQgbm8gZGF0YScpfS8+O1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChxdWVyeS5jYWNoZWQgfHwgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgIXF1ZXJ5LnJlc3VsdHMpKSB7XG4gICAgICAgIGlmIChxdWVyeS5pc0RhdGFQcmV2aWV3KSB7XG4gICAgICAgICAgICByZXR1cm4gKDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgYnV0dG9uU3R5bGU9XCJwcmltYXJ5XCIgb25DbGljaz17KCkgPT4gZGlzcGF0Y2gocmVGZXRjaFF1ZXJ5UmVzdWx0cyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnF1ZXJ5LFxuICAgICAgICAgICAgICAgICAgICBpc0RhdGFQcmV2aWV3OiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pKX0+XG4gICAgICAgICAge3QoJ0ZldGNoIGRhdGEgcHJldmlldycpfVxuICAgICAgICA8L0J1dHRvbj4pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeS5yZXN1bHRzS2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gKDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgYnV0dG9uU3R5bGU9XCJwcmltYXJ5XCIgb25DbGljaz17KCkgPT4gZmV0Y2hSZXN1bHRzKHF1ZXJ5KX0+XG4gICAgICAgICAge3QoJ1JlZmV0Y2ggcmVzdWx0cycpfVxuICAgICAgICA8L0J1dHRvbj4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxldCBwcm9ncmVzc0JhcjtcbiAgICBpZiAocXVlcnkucHJvZ3Jlc3MgPiAwKSB7XG4gICAgICAgIHByb2dyZXNzQmFyID0gKDxQcm9ncmVzc0JhciBwZXJjZW50PXtwYXJzZUludChxdWVyeS5wcm9ncmVzcy50b0ZpeGVkKDApLCAxMCl9IHN0cmlwZWQvPik7XG4gICAgfVxuICAgIGNvbnN0IHByb2dyZXNzTXNnID0gcXVlcnk/LmV4dHJhPy5wcm9ncmVzcyA/PyBudWxsO1xuICAgIHJldHVybiAoPFJlc3VsdGxlc3NTdHlsZXM+XG4gICAgICA8ZGl2PnshcHJvZ3Jlc3NCYXIgJiYgPExvYWRpbmcgcG9zaXRpb249XCJub3JtYWxcIi8+fTwvZGl2PlxuICAgICAgey8qIHNob3cgbG9hZGluZyBiYXIgd2hlbmV2ZXIgcHJvZ3Jlc3MgYmFyIGlzIGNvbXBsZXRlZCBidXQgbmVlZHMgdGltZSB0byByZW5kZXIgKi99XG4gICAgICA8ZGl2PntxdWVyeS5wcm9ncmVzcyA9PT0gMTAwICYmIDxMb2FkaW5nIHBvc2l0aW9uPVwibm9ybWFsXCIvPn08L2Rpdj5cbiAgICAgIDxRdWVyeVN0YXRlTGFiZWwgcXVlcnk9e3F1ZXJ5fS8+XG4gICAgICA8ZGl2Pntwcm9ncmVzc01zZyAmJiA8QWxlcnQgdHlwZT1cInN1Y2Nlc3NcIiBtZXNzYWdlPXtwcm9ncmVzc01zZ30vPn08L2Rpdj5cbiAgICAgIDxkaXY+e3F1ZXJ5LnByb2dyZXNzICE9PSAxMDAgJiYgcHJvZ3Jlc3NCYXJ9PC9kaXY+XG4gICAgICB7dHJhY2tpbmdVcmwgJiYgPGRpdj57dHJhY2tpbmdVcmx9PC9kaXY+fVxuICAgIDwvUmVzdWx0bGVzc1N0eWxlcz4pO1xufTtcbmV4cG9ydCBkZWZhdWx0IG1lbW8oUmVzdWx0U2V0KTtcbiJdfQ== */\"], children:\n\n              sql }\n            ),\n            renderRowsReturned(false)] }\n          ),\n          renderRowsReturned(true)] }\n        ) : _jsxs(_Fragment, { children: [\n          renderRowsReturned(false),\n          renderRowsReturned(true),\n          sql] }\n        ),\n        _jsx(ResultTable, { data: data, queryId: query.id, orderedColumnKeys: results.columns.map((col) => col.column_name), height: rowsHeight, filterText: searchText, expandedColumns: expandedColumns, allowHTML: allowHTML })] }\n      );\n    }\n    if (data && data.length === 0) {\n      return _jsx(Alert, { type: \"warning\", message: t('The query returned no data') });\n    }\n  }\n  if (query.cached || query.state === QueryState.Success && !query.results) {\n    if (query.isDataPreview) {\n      return _jsx(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => dispatch(reFetchQueryResults({\n          ...query,\n          isDataPreview: true\n        })), children:\n        t('Fetch data preview') }\n      );\n    }\n    if (query.resultsKey) {\n      return _jsx(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => fetchResults(query), children:\n        t('Refetch results') }\n      );\n    }\n  }\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = _jsx(ProgressBar, { percent: parseInt(query.progress.toFixed(0), 10), striped: true });\n  }\n  const progressMsg = (_query$extra$progress = query == null ? void 0 : (_query$extra2 = query.extra) == null ? void 0 : _query$extra2.progress) != null ? _query$extra$progress : null;\n  return _jsxs(ResultlessStyles, { children: [\n    _jsx(\"div\", { children: !progressBar && _jsx(Loading, { position: \"normal\" }) }),\n\n    _jsx(\"div\", { children: query.progress === 100 && _jsx(Loading, { position: \"normal\" }) }),\n    _jsx(QueryStateLabel, { query: query }),\n    _jsx(\"div\", { children: progressMsg && _jsx(Alert, { type: \"success\", message: progressMsg }) }),\n    _jsx(\"div\", { children: query.progress !== 100 && progressBar }),\n    trackingUrl && _jsx(\"div\", { children: trackingUrl })] }\n  );\n};__signature__(ResultSet, \"useSelector{user}\\nuseSelector{query}\\nuseTheme{theme}\\nuseState{[searchText, setSearchText]('')}\\nuseState{[cachedData, setCachedData]([])}\\nuseState{[showSaveDatasetModal, setShowSaveDatasetModal](false)}\\nuseState{[alertIsOpen, setAlertIsOpen](false)}\\nuseHistory{history}\\nuseDispatch{dispatch}\\nuseLogAction{logAction}\\nuseCallback{reRunQueryIfSessionTimeoutErrorOnMount}\\nuseEffect{}\\nusePrevious{prevQuery}\\nuseEffect{}\", () => [useSelector, useSelector, useTheme, useHistory, useDispatch, useLogAction, usePrevious]);const _default = /*#__PURE__*/\nmemo(ResultSet);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(LimitingFactor, \"LimitingFactor\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultContainer, \"ResultContainer\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultlessStyles, \"ResultlessStyles\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(MonospaceDiv, \"MonospaceDiv\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ReturnedRows, \"ReturnedRows\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSetControls, \"ResultSetControls\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSetButtons, \"ResultSetButtons\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(copyButtonStyles, \"copyButtonStyles\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ROWS_CHIP_WIDTH, \"ROWS_CHIP_WIDTH\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(GAP, \"GAP\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(extensionsRegistry, \"extensionsRegistry\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSet, \"ResultSet\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useCallback","useEffect","useState","memo","shallowEqual","useDispatch","useSelector","useHistory","ButtonGroup","Alert","Button","nanoid","QueryState","styled","t","tn","useTheme","usePrevious","css","getNumberFormatter","getExtensionsRegistry","ErrorTypeEnum","ErrorMessageWithStackTrace","SaveDatasetModal","EXPLORE_CHART_DEFAULT","mountExploreUrl","postFormData","ProgressBar","Loading","Card","Label","Tooltip","FilterableTable","CopyToClipboard","addDangerToast","prepareCopyToClipboardTabularData","getItem","LocalStorageKeys","Modal","addQueryEditor","clearQueryResults","CtasEnum","fetchQueryResults","reFetchQueryResults","reRunQuery","URL_PARAMS","useLogAction","LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD","LOG_ACTIONS_SQLLAB_CREATE_CHART","LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV","Icons","findPermission","ExploreCtasResultsButton","ExploreResultsButton","HighlightedSql","QueryStateLabel","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LimitingFactor","ResultContainer","div","theme","gridUnit","ResultlessStyles","MonospaceDiv","typography","families","monospace","ReturnedRows","sizes","s","ResultSetControls","ResultSetButtons","copyButtonStyles","ROWS_CHIP_WIDTH","GAP","extensionsRegistry","ResultSet","cache","csv","database","displayLimit","height","queryId","search","showSql","showSqlInline","visualize","defaultQueryLimit","_extensionsRegistry$g","_query$results2","_query$extra$progress","_query$extra2","user","query","sqlLab","queries","_pick","ResultTable","get","searchText","setSearchText","cachedData","setCachedData","showSaveDatasetModal","setShowSaveDatasetModal","alertIsOpen","setAlertIsOpen","history","dispatch","logAction","sqlEditorId","reRunQueryIfSessionTimeoutErrorOnMount","errorMessage","indexOf","fetchResults","q","timeout","prevQuery","_query$results","_query$results$data","cached","results","data","length","resultsKey","calculateAlertRefHeight","alertElement","popSelectStar","tempSchema","tempTable","qe","id","name","autorun","dbId","sql","changeSearch","event","target","value","createExploreResultsOnClick","clickEvent","openInNewWindow","metaKey","query_id","key","datasource","all_columns","columns","map","column","column_name","url","formDataKey","window","open","push","getExportCsvUrl","clientId","renderControls","_results$data","queryLimit","limitingFactor","rows","limit","rowsCount","Math","min","tab","templateParams","schema","canExportData","roles","children","visible","onHide","buttonTextOnSave","buttonTextOnOverwrite","modalDescription","allows_virtual_table_explore","onClick","buttonSize","href","Dropdown","warning","title","content","toLocaleString","DownloadOutlined","iconSize","iconColor","colors","primary","dark2","text","wrapped","copyNode","CopyOutlined","hideTooltip","onCopyEnd","type","onChange","className","placeholder","renderRowsReturned","alertMessage","_user$roles","_results$data2","limitMessage","limitReached","displayLimitReached","isAdmin","Admin","displayMaxRowsReachedMessage","withAdmin","withoutAdmin","shouldUseDefaultDropdownAlert","Query","QueryAndDropdown","formattedRowCount","rowsReturnedMessage","tooltipText","ref","message","onClose","description","showRowsReturned","placement","l","ExclamationCircleOutlined","m","exploreDBId","explore_database_id","trackingUrl","state","Success","Fetching","Running","maxLines","maxWidth","Stopped","Failed","_query$extra","errors","extra","error","index","subtitle","copyText","undefined","link","source","some","error_type","FRONTEND_TIMEOUT_ERROR","ctas","object","ctas_method","View","_css","marginRight","process","env","NODE_ENV","table","rowMessageHeight","alertContainerHeight","rowsHeight","expandedColumns","expanded_columns","col","allowHTML","SqllabIsRenderHtmlEnabled","orderedColumnKeys","filterText","isDataPreview","buttonStyle","progressBar","progress","percent","parseInt","toFixed","striped","progressMsg","position","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  useCallback,\n  useEffect,\n  useState,\n  memo,\n  ChangeEvent,\n  MouseEvent,\n} from 'react';\n\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\nimport { pick } from 'lodash';\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport { nanoid } from 'nanoid';\nimport {\n  QueryState,\n  styled,\n  t,\n  tn,\n  useTheme,\n  usePrevious,\n  css,\n  getNumberFormatter,\n  getExtensionsRegistry,\n  ErrorTypeEnum,\n} from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport {\n  ISaveableDatasource,\n  ISimpleColumn,\n  SaveDatasetModal,\n} from 'src/SqlLab/components/SaveDatasetModal';\nimport { EXPLORE_CHART_DEFAULT, SqlLabRootState } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport Card from 'src/components/Card';\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport { getItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\nimport Modal from 'src/components/Modal';\nimport {\n  addQueryEditor,\n  clearQueryResults,\n  CtasEnum,\n  fetchQueryResults,\n  reFetchQueryResults,\n  reRunQuery,\n} from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport useLogAction from 'src/logger/useLogAction';\nimport {\n  LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD,\n  LOG_ACTIONS_SQLLAB_CREATE_CHART,\n  LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV,\n} from 'src/logger/LogUtils';\nimport { Icons } from 'src/components/Icons';\nimport { findPermission } from 'src/utils/findPermission';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';\n\nenum LimitingFactor {\n  Query = 'QUERY',\n  QueryAndDropdown = 'QUERY_AND_DROPDOWN',\n  Dropdown = 'DROPDOWN',\n  NotLimited = 'NOT_LIMITED',\n}\n\nexport interface ResultSetProps {\n  cache?: boolean;\n  csv?: boolean;\n  database?: Record<string, any>;\n  displayLimit: number;\n  height: number;\n  queryId: string;\n  search?: boolean;\n  showSql?: boolean;\n  showSqlInline?: boolean;\n  visualize?: boolean;\n  defaultQueryLimit: number;\n}\n\nconst ResultContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  row-gap: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${({ theme }) => theme.gridUnit * 25}px;\n  [role='alert'] {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n`;\n\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\n\nconst ReturnedRows = styled.div`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  line-height: 1;\n`;\n\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n`;\n\nconst copyButtonStyles = css`\n  &:hover {\n    text-decoration: unset;\n  }\n  span > :first-of-type {\n    margin: 0px;\n  }\n`;\n\nconst ROWS_CHIP_WIDTH = 100;\nconst GAP = 8;\n\nconst extensionsRegistry = getExtensionsRegistry();\n\nconst ResultSet = ({\n  cache = false,\n  csv = true,\n  database = {},\n  displayLimit,\n  height,\n  queryId,\n  search = true,\n  showSql = false,\n  showSqlInline = false,\n  visualize = true,\n  defaultQueryLimit,\n}: ResultSetProps) => {\n  const user = useSelector(({ user }: SqlLabRootState) => user, shallowEqual);\n  const query = useSelector(\n    ({ sqlLab: { queries } }: SqlLabRootState) =>\n      pick(queries[queryId], [\n        'id',\n        'errorMessage',\n        'cached',\n        'results',\n        'resultsKey',\n        'dbId',\n        'tab',\n        'sql',\n        'sqlEditorId',\n        'templateParams',\n        'schema',\n        'rows',\n        'queryLimit',\n        'limitingFactor',\n        'trackingUrl',\n        'state',\n        'errors',\n        'link',\n        'ctas',\n        'ctas_method',\n        'tempSchema',\n        'tempTable',\n        'isDataPreview',\n        'progress',\n        'extra',\n      ]),\n    shallowEqual,\n  );\n  const ResultTable =\n    extensionsRegistry.get('sqleditor.extension.resultTable') ??\n    FilterableTable;\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState<Record<string, unknown>[]>([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const logAction = useLogAction({ queryId, sqlEditorId: query.sqlEditorId });\n\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (\n      query.errorMessage &&\n      query.errorMessage.indexOf('session timed out') > 0\n    ) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n\n  const fetchResults = (q: typeof query, timeout?: number) => {\n    dispatch(fetchQueryResults(q, displayLimit, timeout));\n  };\n\n  const prevQuery = usePrevious(query);\n  useEffect(() => {\n    if (cache && query.cached && query?.results?.data?.length > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== prevQuery?.resultsKey) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n\n  const calculateAlertRefHeight = (alertElement: HTMLElement | null) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else {\n      setAlertIsOpen(false);\n    }\n  };\n\n  const popSelectStar = (tempSchema: string | null, tempTable: string) => {\n    const qe = {\n      id: nanoid(11),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}`,\n    };\n    dispatch(addQueryEditor(qe));\n  };\n\n  const changeSearch = (event: ChangeEvent<HTMLInputElement>) => {\n    setSearchText(event.target.value);\n  };\n\n  const createExploreResultsOnClick = async (clickEvent: MouseEvent) => {\n    const { results } = query;\n\n    const openInNewWindow = clickEvent.metaKey;\n    logAction(LOG_ACTIONS_SQLLAB_CREATE_CHART, {});\n    if (results?.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map(column => column.column_name),\n        },\n      });\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key,\n      });\n      if (openInNewWindow) {\n        window.open(url, '_blank', 'noreferrer');\n      } else {\n        history.push(url);\n      }\n    } else {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n\n  const getExportCsvUrl = (clientId: string) =>\n    `/api/v1/sqllab/export/${clientId}/`;\n\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      const { results, queryLimit, limitingFactor, rows } = query;\n      const limit = queryLimit || results.query.limit;\n      const rowsCount = Math.min(rows || 0, results?.data?.length || 0);\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n\n      const datasource: ISaveableDatasource = {\n        columns: query.results.columns as ISimpleColumn[],\n        name: query?.tab || 'Untitled',\n        dbId: query?.dbId,\n        sql: query?.sql,\n        templateParams: query?.templateParams,\n        schema: query?.schema,\n      };\n\n      const canExportData = findPermission(\n        'can_export_csv',\n        'SQLLab',\n        user?.roles,\n      );\n\n      return (\n        <ResultSetControls>\n          <SaveDatasetModal\n            visible={showSaveDatasetModal}\n            onHide={() => setShowSaveDatasetModal(false)}\n            buttonTextOnSave={t('Save & Explore')}\n            buttonTextOnOverwrite={t('Overwrite & Explore')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={datasource}\n          />\n          <ResultSetButtons>\n            {visualize && database?.allows_virtual_table_explore && (\n              <ExploreResultsButton\n                database={database}\n                onClick={createExploreResultsOnClick}\n              />\n            )}\n            {csv && canExportData && (\n              <Button\n                css={copyButtonStyles}\n                buttonSize=\"small\"\n                href={getExportCsvUrl(query.id)}\n                data-test=\"export-csv-button\"\n                onClick={() => {\n                  logAction(LOG_ACTIONS_SQLLAB_DOWNLOAD_CSV, {});\n                  if (\n                    limitingFactor === LimitingFactor.Dropdown &&\n                    limit === rowsCount\n                  ) {\n                    Modal.warning({\n                      title: t('Download is on the way'),\n                      content: t(\n                        'Downloading %(rows)s rows based on the LIMIT configuration. If you want the entire result set, you need to adjust the LIMIT.',\n                        { rows: rowsCount.toLocaleString() },\n                      ),\n                    });\n                  }\n                }}\n              >\n                <Icons.DownloadOutlined\n                  iconSize=\"m\"\n                  iconColor={theme.colors.primary.dark2}\n                />{' '}\n                {t('Download to CSV')}\n              </Button>\n            )}\n\n            {canExportData && (\n              <CopyToClipboard\n                text={prepareCopyToClipboardTabularData(data, columns)}\n                wrapped={false}\n                copyNode={\n                  <Button\n                    css={copyButtonStyles}\n                    buttonSize=\"small\"\n                    data-test=\"copy-to-clipboard-button\"\n                  >\n                    <Icons.CopyOutlined\n                      iconSize=\"s\"\n                      iconColor={theme.colors.primary.dark2}\n                    />{' '}\n                    {t('Copy to Clipboard')}\n                  </Button>\n                }\n                hideTooltip\n                onCopyEnd={() =>\n                  logAction(LOG_ACTIONS_SQLLAB_COPY_RESULT_TO_CLIPBOARD, {})\n                }\n              />\n            )}\n          </ResultSetButtons>\n          {search && (\n            <input\n              type=\"text\"\n              onChange={changeSearch}\n              value={searchText}\n              className=\"form-control input-sm\"\n              placeholder={t('Filter results')}\n            />\n          )}\n        </ResultSetControls>\n      );\n    }\n    return <div />;\n  };\n\n  const renderRowsReturned = (alertMessage: boolean) => {\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage = '';\n    const limitReached = results?.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!user?.roles?.Admin;\n    const rowsCount = Math.min(rows || 0, results?.data?.length || 0);\n\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t(\n        'The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n          'Please add additional limits/filters or download to csv to see more rows up to ' +\n          'the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n      withoutAdmin: t(\n        'The number of results displayed is limited to %(rows)d. ' +\n          'Please add additional limits/filters, download to csv, or contact an admin ' +\n          'to see more rows up to the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n    };\n    const shouldUseDefaultDropdownAlert =\n      limit === defaultQueryLimit && limitingFactor === LimitingFactor.Dropdown;\n\n    if (limitingFactor === LimitingFactor.Query && csv) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query',\n        { rows },\n      );\n    } else if (\n      limitingFactor === LimitingFactor.Dropdown &&\n      !shouldUseDefaultDropdownAlert\n    ) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the limit dropdown.',\n        { rows },\n      );\n    } else if (limitingFactor === LimitingFactor.QueryAndDropdown) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query and limit dropdown.',\n        { rows },\n      );\n    }\n    const formattedRowCount = getNumberFormatter()(rows);\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows,\n    });\n\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n\n    if (alertMessage) {\n      return (\n        <>\n          {!limitReached && shouldUseDefaultDropdownAlert && (\n            <div ref={calculateAlertRefHeight}>\n              <Alert\n                type=\"warning\"\n                message={t('%(rows)d rows returned', { rows })}\n                onClose={() => setAlertIsOpen(false)}\n                description={t(\n                  'The number of rows displayed is limited to %(rows)d by the dropdown.',\n                  { rows },\n                )}\n              />\n            </div>\n          )}\n          {limitReached && (\n            <div ref={calculateAlertRefHeight}>\n              <Alert\n                type=\"warning\"\n                onClose={() => setAlertIsOpen(false)}\n                message={t('%(rows)d rows returned', { rows: rowsCount })}\n                description={\n                  isAdmin\n                    ? displayMaxRowsReachedMessage.withAdmin\n                    : displayMaxRowsReachedMessage.withoutAdmin\n                }\n              />\n            </div>\n          )}\n        </>\n      );\n    }\n    const showRowsReturned =\n      showSqlInline || (!limitReached && !shouldUseDefaultDropdownAlert);\n\n    return (\n      <>\n        {showRowsReturned && (\n          <ReturnedRows>\n            <Tooltip\n              id=\"sqllab-rowcount-tooltip\"\n              title={tooltipText}\n              placement=\"left\"\n            >\n              <Label\n                css={css`\n                  line-height: ${theme.typography.sizes.l}px;\n                `}\n              >\n                {limitMessage && (\n                  <Icons.ExclamationCircleOutlined\n                    css={css`\n                      font-size: ${theme.typography.sizes.m}px;\n                      margin-right: ${theme.gridUnit}px;\n                    `}\n                  />\n                )}\n                {tn('%s row', '%s rows', rows, formattedRowCount)}\n              </Label>\n            </Tooltip>\n          </ReturnedRows>\n        )}\n      </>\n    );\n  };\n\n  const limitReached = query?.results?.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database?.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n\n  let trackingUrl;\n  if (\n    query.trackingUrl &&\n    query.state !== QueryState.Success &&\n    query.state !== QueryState.Fetching\n  ) {\n    trackingUrl = (\n      <Button\n        className=\"sql-result-track-job\"\n        buttonSize=\"small\"\n        href={query.trackingUrl}\n        target=\"_blank\"\n      >\n        {query.state === QueryState.Running\n          ? t('Track job')\n          : t('See query details')}\n      </Button>\n    );\n  }\n\n  if (showSql) {\n    sql = (\n      <HighlightedSql\n        sql={query.sql}\n        {...(showSqlInline && { maxLines: 1, maxWidth: 60 })}\n      />\n    );\n  }\n\n  if (query.state === QueryState.Stopped) {\n    return <Alert type=\"warning\" message={t('Query was stopped')} />;\n  }\n\n  if (query.state === QueryState.Failed) {\n    const errors = [...(query.extra?.errors || []), ...(query.errors || [])];\n\n    return (\n      <ResultlessStyles>\n        {errors.map((error, index) => (\n          <ErrorMessageWithStackTrace\n            key={index}\n            title={t('Database error')}\n            error={error}\n            subtitle={<MonospaceDiv>{error.message}</MonospaceDiv>}\n            copyText={error.message || undefined}\n            link={query.link}\n            source=\"sqllab\"\n          />\n        ))}\n        {errors.some(\n          error => error?.error_type === ErrorTypeEnum.FRONTEND_TIMEOUT_ERROR,\n        ) ? (\n          <Button\n            className=\"sql-result-track-job\"\n            buttonSize=\"small\"\n            onClick={() => fetchResults(query, 0)}\n          >\n            {t('Retry fetching results')}\n          </Button>\n        ) : (\n          trackingUrl\n        )}\n      </ResultlessStyles>\n    );\n  }\n\n  if (query.state === QueryState.Success && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.View) {\n      object = 'View';\n    }\n    return (\n      <div>\n        <Alert\n          type=\"info\"\n          message={\n            <>\n              {t(object)} [\n              <strong>\n                {tempSchema ? `${tempSchema}.` : ''}\n                {tempTable}\n              </strong>\n              ] {t('was created')} &nbsp;\n              <ButtonGroup>\n                <Button\n                  buttonSize=\"small\"\n                  css={{ marginRight: theme.gridUnit }}\n                  onClick={() => popSelectStar(tempSchema, tempTable)}\n                >\n                  {t('Query in a new tab')}\n                </Button>\n                <ExploreCtasResultsButton\n                  table={tempTable}\n                  schema={tempSchema}\n                  dbId={exploreDBId}\n                />\n              </ButtonGroup>\n            </>\n          }\n        />\n      </div>\n    );\n  }\n\n  if (query.state === QueryState.Success && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen\n      ? height - alertContainerHeight\n      : height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else if (results?.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns\n        ? results.expanded_columns.map(col => col.column_name)\n        : [];\n      const allowHTML = getItem(\n        LocalStorageKeys.SqllabIsRenderHtmlEnabled,\n        true,\n      );\n      return (\n        <ResultContainer>\n          {renderControls()}\n          {showSql && showSqlInline ? (\n            <>\n              <div\n                css={css`\n                  display: flex;\n                  justify-content: space-between;\n                  gap: ${GAP}px;\n                `}\n              >\n                <Card\n                  css={[\n                    css`\n                      height: 28px;\n                      width: calc(100% - ${ROWS_CHIP_WIDTH + GAP}px);\n                      code {\n                        width: 100%;\n                        overflow: hidden;\n                        white-space: nowrap !important;\n                        text-overflow: ellipsis;\n                        display: block;\n                      }\n                    `,\n                  ]}\n                >\n                  {sql}\n                </Card>\n                {renderRowsReturned(false)}\n              </div>\n              {renderRowsReturned(true)}\n            </>\n          ) : (\n            <>\n              {renderRowsReturned(false)}\n              {renderRowsReturned(true)}\n              {sql}\n            </>\n          )}\n          <ResultTable\n            data={data}\n            queryId={query.id}\n            orderedColumnKeys={results.columns.map(col => col.column_name)}\n            height={rowsHeight}\n            filterText={searchText}\n            expandedColumns={expandedColumns}\n            allowHTML={allowHTML}\n          />\n        </ResultContainer>\n      );\n    }\n    if (data && data.length === 0) {\n      return <Alert type=\"warning\" message={t('The query returned no data')} />;\n    }\n  }\n\n  if (query.cached || (query.state === QueryState.Success && !query.results)) {\n    if (query.isDataPreview) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() =>\n            dispatch(\n              reFetchQueryResults({\n                ...query,\n                isDataPreview: true,\n              }),\n            )\n          }\n        >\n          {t('Fetch data preview')}\n        </Button>\n      );\n    }\n    if (query.resultsKey) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() => fetchResults(query)}\n        >\n          {t('Refetch results')}\n        </Button>\n      );\n    }\n  }\n\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = (\n      <ProgressBar percent={parseInt(query.progress.toFixed(0), 10)} striped />\n    );\n  }\n\n  const progressMsg = query?.extra?.progress ?? null;\n\n  return (\n    <ResultlessStyles>\n      <div>{!progressBar && <Loading position=\"normal\" />}</div>\n      {/* show loading bar whenever progress bar is completed but needs time to render */}\n      <div>{query.progress === 100 && <Loading position=\"normal\" />}</div>\n      <QueryStateLabel query={query} />\n      <div>{progressMsg && <Alert type=\"success\" message={progressMsg} />}</div>\n      <div>{query.progress !== 100 && progressBar}</div>\n      {trackingUrl && <div>{trackingUrl}</div>}\n    </ResultlessStyles>\n  );\n};\n\nexport default memo(ResultSet);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}