{"ast":null,"code":"import _isEmpty from \"lodash/isEmpty\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";}var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useLayoutEffect, useMemo, useState } from 'react';\nimport { extent as d3Extent, max as d3Max } from 'd3-array';\nimport { FaSort } from '@react-icons/all-files/fa/FaSort';\nimport { FaSortDown as FaSortDesc } from '@react-icons/all-files/fa/FaSortDown';\nimport { FaSortUp as FaSortAsc } from '@react-icons/all-files/fa/FaSortUp';\nimport cx from 'classnames';\nimport { DTTM_ALIAS, ensureIsArray, GenericDataType, getSelectedText, getTimeFormatterForGranularity, styled, css, t, tn, useTheme } from '@superset-ui/core';\nimport { Dropdown, Menu, Tooltip } from '@superset-ui/chart-controls';\nimport { CheckOutlined, InfoCircleOutlined, DownOutlined, MinusCircleOutlined, PlusCircleOutlined, TableOutlined } from '@ant-design/icons';\n\nimport { ColorSchemeEnum } from './types';\nimport DataTable from './DataTable';\nimport Styles from './Styles';\nimport { formatColumnValue } from './utils/formatValue';\nimport { PAGE_SIZE_OPTIONS } from './consts';\nimport { updateExternalFormData } from './DataTable/utils/externalAPIs';\nimport getScrollBarSize from './DataTable/utils/getScrollBarSize';import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nconst ACTION_KEYS = {\n  enter: 'Enter',\n  spacebar: 'Spacebar',\n  space: ' '\n};\n/**\n * Return sortType based on data type\n */\nfunction getSortTypeByDataType(dataType) {\n  if (dataType === GenericDataType.Temporal) {\n    return 'datetime';\n  }\n  if (dataType === GenericDataType.String) {\n    return 'alphanumeric';\n  }\n  return 'basic';\n}\n/**\n * Cell background width calculation for horizontal bar chart\n */\nfunction cellWidth({ value, valueRange, alignPositiveNegative }) {\n  const [minValue, maxValue] = valueRange;\n  if (alignPositiveNegative) {\n    const perc = Math.abs(Math.round(value / maxValue * 100));\n    return perc;\n  }\n  const posExtent = Math.abs(Math.max(maxValue, 0));\n  const negExtent = Math.abs(Math.min(minValue, 0));\n  const tot = posExtent + negExtent;\n  const perc2 = Math.round(Math.abs(value) / tot * 100);\n  return perc2;\n}\n/**\n * Cell left margin (offset) calculation for horizontal bar chart elements\n * when alignPositiveNegative is not set\n */\nfunction cellOffset({ value, valueRange, alignPositiveNegative }) {\n  if (alignPositiveNegative) {\n    return 0;\n  }\n  const [minValue, maxValue] = valueRange;\n  const posExtent = Math.abs(Math.max(maxValue, 0));\n  const negExtent = Math.abs(Math.min(minValue, 0));\n  const tot = posExtent + negExtent;\n  return Math.round(Math.min(negExtent + value, negExtent) / tot * 100);\n}\n/**\n * Cell background color calculation for horizontal bar chart\n */\nfunction cellBackground({ value, colorPositiveNegative = false }) {\n  const r = colorPositiveNegative && value < 0 ? 150 : 0;\n  return `rgba(${r},0,0,0.2)`;\n}\nfunction SortIcon({ column }) {\n  const { isSorted, isSortedDesc } = column;\n  let sortIcon = _jsx(FaSort, {});\n  if (isSorted) {\n    sortIcon = isSortedDesc ? _jsx(FaSortDesc, {}) : _jsx(FaSortAsc, {});\n  }\n  return sortIcon;\n}\nfunction SearchInput({ count, value, onChange }) {\n  return _jsxs(\"span\", { className: \"dt-global-filter\", children: [\n    t('Search'), ' ',\n    _jsx(\"input\", { \"aria-label\": t('Search %s records', count), className: \"form-control input-sm\", placeholder: tn('search.num_records', count), value: value, onChange: onChange })] }\n  );\n}\nfunction SelectPageSize({ options, current, onChange }) {\n  return _jsxs(\"span\", { className: \"dt-select-page-size form-inline\", role: \"group\", \"aria-label\": t('Select page size'), children: [\n    _jsx(\"label\", { htmlFor: \"pageSizeSelect\", className: \"sr-only\", children:\n      t('Select page size') }\n    ),\n    t('Show'), ' ',\n    _jsx(\"select\", { id: \"pageSizeSelect\", className: \"form-control input-sm\", value: current, onChange: (e) => {\n        onChange(Number(e.target.value));\n      }, \"aria-label\": t('Show entries per page'), children:\n      options.map((option) => {\n        const [size, text] = Array.isArray(option) ?\n        option :\n        [option, option];\n        return _jsx(\"option\", { value: size, children:\n          text }, size\n        );\n      }) }\n    ), ' ',\n    t('entries per page')] }\n  );\n}\nconst getNoResultsMessage = (filter) => filter ? t('No matching records found') : t('No records found');var _ref = process.env.NODE_ENV === \"production\" ? { name: \"tvoj80\", styles: \"display:inline-flex;align-items:flex-end\" } : { name: \"1f5n49p-Header\", styles: \"display:inline-flex;align-items:flex-end;label:Header;/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hcnl1cmtvdi9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9wbHVnaW5zL3BsdWdpbi1jaGFydC10YWJsZS9zcmMvVGFibGVDaGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBK25CMkMiLCJmaWxlIjoiL1VzZXJzL2FyeXVya292L3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3BsdWdpbnMvcGx1Z2luLWNoYXJ0LXRhYmxlL3NyYy9UYWJsZUNoYXJ0LnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VMYXlvdXRFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlLCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGV4dGVudCBhcyBkM0V4dGVudCwgbWF4IGFzIGQzTWF4IH0gZnJvbSAnZDMtYXJyYXknO1xuaW1wb3J0IHsgRmFTb3J0IH0gZnJvbSAnQHJlYWN0LWljb25zL2FsbC1maWxlcy9mYS9GYVNvcnQnO1xuaW1wb3J0IHsgRmFTb3J0RG93biBhcyBGYVNvcnREZXNjIH0gZnJvbSAnQHJlYWN0LWljb25zL2FsbC1maWxlcy9mYS9GYVNvcnREb3duJztcbmltcG9ydCB7IEZhU29ydFVwIGFzIEZhU29ydEFzYyB9IGZyb20gJ0ByZWFjdC1pY29ucy9hbGwtZmlsZXMvZmEvRmFTb3J0VXAnO1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IHsgRFRUTV9BTElBUywgZW5zdXJlSXNBcnJheSwgR2VuZXJpY0RhdGFUeXBlLCBnZXRTZWxlY3RlZFRleHQsIGdldFRpbWVGb3JtYXR0ZXJGb3JHcmFudWxhcml0eSwgc3R5bGVkLCBjc3MsIHQsIHRuLCB1c2VUaGVtZSwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBEcm9wZG93biwgTWVudSwgVG9vbHRpcCB9IGZyb20gJ0BzdXBlcnNldC11aS9jaGFydC1jb250cm9scyc7XG5pbXBvcnQgeyBDaGVja091dGxpbmVkLCBJbmZvQ2lyY2xlT3V0bGluZWQsIERvd25PdXRsaW5lZCwgTWludXNDaXJjbGVPdXRsaW5lZCwgUGx1c0NpcmNsZU91dGxpbmVkLCBUYWJsZU91dGxpbmVkLCB9IGZyb20gJ0BhbnQtZGVzaWduL2ljb25zJztcbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgQ29sb3JTY2hlbWVFbnVtLCB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IERhdGFUYWJsZSBmcm9tICcuL0RhdGFUYWJsZSc7XG5pbXBvcnQgU3R5bGVzIGZyb20gJy4vU3R5bGVzJztcbmltcG9ydCB7IGZvcm1hdENvbHVtblZhbHVlIH0gZnJvbSAnLi91dGlscy9mb3JtYXRWYWx1ZSc7XG5pbXBvcnQgeyBQQUdFX1NJWkVfT1BUSU9OUyB9IGZyb20gJy4vY29uc3RzJztcbmltcG9ydCB7IHVwZGF0ZUV4dGVybmFsRm9ybURhdGEgfSBmcm9tICcuL0RhdGFUYWJsZS91dGlscy9leHRlcm5hbEFQSXMnO1xuaW1wb3J0IGdldFNjcm9sbEJhclNpemUgZnJvbSAnLi9EYXRhVGFibGUvdXRpbHMvZ2V0U2Nyb2xsQmFyU2l6ZSc7XG5jb25zdCBBQ1RJT05fS0VZUyA9IHtcbiAgICBlbnRlcjogJ0VudGVyJyxcbiAgICBzcGFjZWJhcjogJ1NwYWNlYmFyJyxcbiAgICBzcGFjZTogJyAnLFxufTtcbi8qKlxuICogUmV0dXJuIHNvcnRUeXBlIGJhc2VkIG9uIGRhdGEgdHlwZVxuICovXG5mdW5jdGlvbiBnZXRTb3J0VHlwZUJ5RGF0YVR5cGUoZGF0YVR5cGUpIHtcbiAgICBpZiAoZGF0YVR5cGUgPT09IEdlbmVyaWNEYXRhVHlwZS5UZW1wb3JhbCkge1xuICAgICAgICByZXR1cm4gJ2RhdGV0aW1lJztcbiAgICB9XG4gICAgaWYgKGRhdGFUeXBlID09PSBHZW5lcmljRGF0YVR5cGUuU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiAnYWxwaGFudW1lcmljJztcbiAgICB9XG4gICAgcmV0dXJuICdiYXNpYyc7XG59XG4vKipcbiAqIENlbGwgYmFja2dyb3VuZCB3aWR0aCBjYWxjdWxhdGlvbiBmb3IgaG9yaXpvbnRhbCBiYXIgY2hhcnRcbiAqL1xuZnVuY3Rpb24gY2VsbFdpZHRoKHsgdmFsdWUsIHZhbHVlUmFuZ2UsIGFsaWduUG9zaXRpdmVOZWdhdGl2ZSwgfSkge1xuICAgIGNvbnN0IFttaW5WYWx1ZSwgbWF4VmFsdWVdID0gdmFsdWVSYW5nZTtcbiAgICBpZiAoYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlKSB7XG4gICAgICAgIGNvbnN0IHBlcmMgPSBNYXRoLmFicyhNYXRoLnJvdW5kKCh2YWx1ZSAvIG1heFZhbHVlKSAqIDEwMCkpO1xuICAgICAgICByZXR1cm4gcGVyYztcbiAgICB9XG4gICAgY29uc3QgcG9zRXh0ZW50ID0gTWF0aC5hYnMoTWF0aC5tYXgobWF4VmFsdWUsIDApKTtcbiAgICBjb25zdCBuZWdFeHRlbnQgPSBNYXRoLmFicyhNYXRoLm1pbihtaW5WYWx1ZSwgMCkpO1xuICAgIGNvbnN0IHRvdCA9IHBvc0V4dGVudCArIG5lZ0V4dGVudDtcbiAgICBjb25zdCBwZXJjMiA9IE1hdGgucm91bmQoKE1hdGguYWJzKHZhbHVlKSAvIHRvdCkgKiAxMDApO1xuICAgIHJldHVybiBwZXJjMjtcbn1cbi8qKlxuICogQ2VsbCBsZWZ0IG1hcmdpbiAob2Zmc2V0KSBjYWxjdWxhdGlvbiBmb3IgaG9yaXpvbnRhbCBiYXIgY2hhcnQgZWxlbWVudHNcbiAqIHdoZW4gYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlIGlzIG5vdCBzZXRcbiAqL1xuZnVuY3Rpb24gY2VsbE9mZnNldCh7IHZhbHVlLCB2YWx1ZVJhbmdlLCBhbGlnblBvc2l0aXZlTmVnYXRpdmUsIH0pIHtcbiAgICBpZiAoYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBjb25zdCBbbWluVmFsdWUsIG1heFZhbHVlXSA9IHZhbHVlUmFuZ2U7XG4gICAgY29uc3QgcG9zRXh0ZW50ID0gTWF0aC5hYnMoTWF0aC5tYXgobWF4VmFsdWUsIDApKTtcbiAgICBjb25zdCBuZWdFeHRlbnQgPSBNYXRoLmFicyhNYXRoLm1pbihtaW5WYWx1ZSwgMCkpO1xuICAgIGNvbnN0IHRvdCA9IHBvc0V4dGVudCArIG5lZ0V4dGVudDtcbiAgICByZXR1cm4gTWF0aC5yb3VuZCgoTWF0aC5taW4obmVnRXh0ZW50ICsgdmFsdWUsIG5lZ0V4dGVudCkgLyB0b3QpICogMTAwKTtcbn1cbi8qKlxuICogQ2VsbCBiYWNrZ3JvdW5kIGNvbG9yIGNhbGN1bGF0aW9uIGZvciBob3Jpem9udGFsIGJhciBjaGFydFxuICovXG5mdW5jdGlvbiBjZWxsQmFja2dyb3VuZCh7IHZhbHVlLCBjb2xvclBvc2l0aXZlTmVnYXRpdmUgPSBmYWxzZSwgfSkge1xuICAgIGNvbnN0IHIgPSBjb2xvclBvc2l0aXZlTmVnYXRpdmUgJiYgdmFsdWUgPCAwID8gMTUwIDogMDtcbiAgICByZXR1cm4gYHJnYmEoJHtyfSwwLDAsMC4yKWA7XG59XG5mdW5jdGlvbiBTb3J0SWNvbih7IGNvbHVtbiB9KSB7XG4gICAgY29uc3QgeyBpc1NvcnRlZCwgaXNTb3J0ZWREZXNjIH0gPSBjb2x1bW47XG4gICAgbGV0IHNvcnRJY29uID0gPEZhU29ydCAvPjtcbiAgICBpZiAoaXNTb3J0ZWQpIHtcbiAgICAgICAgc29ydEljb24gPSBpc1NvcnRlZERlc2MgPyA8RmFTb3J0RGVzYyAvPiA6IDxGYVNvcnRBc2MgLz47XG4gICAgfVxuICAgIHJldHVybiBzb3J0SWNvbjtcbn1cbmZ1bmN0aW9uIFNlYXJjaElucHV0KHsgY291bnQsIHZhbHVlLCBvbkNoYW5nZSB9KSB7XG4gICAgcmV0dXJuICg8c3BhbiBjbGFzc05hbWU9XCJkdC1nbG9iYWwtZmlsdGVyXCI+XG4gICAgICB7dCgnU2VhcmNoJyl9eycgJ31cbiAgICAgIDxpbnB1dCBhcmlhLWxhYmVsPXt0KCdTZWFyY2ggJXMgcmVjb3JkcycsIGNvdW50KX0gY2xhc3NOYW1lPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgcGxhY2Vob2xkZXI9e3RuKCdzZWFyY2gubnVtX3JlY29yZHMnLCBjb3VudCl9IHZhbHVlPXt2YWx1ZX0gb25DaGFuZ2U9e29uQ2hhbmdlfS8+XG4gICAgPC9zcGFuPik7XG59XG5mdW5jdGlvbiBTZWxlY3RQYWdlU2l6ZSh7IG9wdGlvbnMsIGN1cnJlbnQsIG9uQ2hhbmdlLCB9KSB7XG4gICAgcmV0dXJuICg8c3BhbiBjbGFzc05hbWU9XCJkdC1zZWxlY3QtcGFnZS1zaXplIGZvcm0taW5saW5lXCIgcm9sZT1cImdyb3VwXCIgYXJpYS1sYWJlbD17dCgnU2VsZWN0IHBhZ2Ugc2l6ZScpfT5cbiAgICAgIDxsYWJlbCBodG1sRm9yPVwicGFnZVNpemVTZWxlY3RcIiBjbGFzc05hbWU9XCJzci1vbmx5XCI+XG4gICAgICAgIHt0KCdTZWxlY3QgcGFnZSBzaXplJyl9XG4gICAgICA8L2xhYmVsPlxuICAgICAge3QoJ1Nob3cnKX17JyAnfVxuICAgICAgPHNlbGVjdCBpZD1cInBhZ2VTaXplU2VsZWN0XCIgY2xhc3NOYW1lPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgdmFsdWU9e2N1cnJlbnR9IG9uQ2hhbmdlPXtlID0+IHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKE51bWJlcihlLnRhcmdldC52YWx1ZSkpO1xuICAgICAgICB9fSBhcmlhLWxhYmVsPXt0KCdTaG93IGVudHJpZXMgcGVyIHBhZ2UnKX0+XG4gICAgICAgIHtvcHRpb25zLm1hcChvcHRpb24gPT4ge1xuICAgICAgICAgICAgY29uc3QgW3NpemUsIHRleHRdID0gQXJyYXkuaXNBcnJheShvcHRpb24pXG4gICAgICAgICAgICAgICAgPyBvcHRpb25cbiAgICAgICAgICAgICAgICA6IFtvcHRpb24sIG9wdGlvbl07XG4gICAgICAgICAgICByZXR1cm4gKDxvcHRpb24ga2V5PXtzaXplfSB2YWx1ZT17c2l6ZX0+XG4gICAgICAgICAgICAgIHt0ZXh0fVxuICAgICAgICAgICAgPC9vcHRpb24+KTtcbiAgICAgICAgfSl9XG4gICAgICA8L3NlbGVjdD57JyAnfVxuICAgICAge3QoJ2VudHJpZXMgcGVyIHBhZ2UnKX1cbiAgICA8L3NwYW4+KTtcbn1cbmNvbnN0IGdldE5vUmVzdWx0c01lc3NhZ2UgPSAoZmlsdGVyKSA9PiBmaWx0ZXIgPyB0KCdObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kJykgOiB0KCdObyByZWNvcmRzIGZvdW5kJyk7XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBUYWJsZUNoYXJ0KHByb3BzKSB7XG4gICAgY29uc3QgeyB0aW1lR3JhaW4sIGhlaWdodCwgd2lkdGgsIGRhdGEsIHRvdGFscywgaXNSYXdSZWNvcmRzLCByb3dDb3VudCA9IDAsIGNvbHVtbnM6IGNvbHVtbnNNZXRhLCBhbGlnblBvc2l0aXZlTmVnYXRpdmU6IGRlZmF1bHRBbGlnblBOID0gZmFsc2UsIGNvbG9yUG9zaXRpdmVOZWdhdGl2ZTogZGVmYXVsdENvbG9yUE4gPSBmYWxzZSwgaW5jbHVkZVNlYXJjaCA9IGZhbHNlLCBwYWdlU2l6ZSA9IDAsIHNlcnZlclBhZ2luYXRpb24gPSBmYWxzZSwgc2VydmVyUGFnaW5hdGlvbkRhdGEsIHNldERhdGFNYXNrLCBzaG93Q2VsbEJhcnMgPSB0cnVlLCBzb3J0RGVzYyA9IGZhbHNlLCBmaWx0ZXJzLCBzdGlja3kgPSB0cnVlLCAvLyB3aGV0aGVyIHRvIHVzZSBzdGlja3kgaGVhZGVyXG4gICAgY29sdW1uQ29sb3JGb3JtYXR0ZXJzLCBhbGxvd1JlYXJyYW5nZUNvbHVtbnMgPSBmYWxzZSwgYWxsb3dSZW5kZXJIdG1sID0gdHJ1ZSwgb25Db250ZXh0TWVudSwgZW1pdENyb3NzRmlsdGVycywgaXNVc2luZ1RpbWVDb21wYXJpc29uLCBiYXNpY0NvbG9yRm9ybWF0dGVycywgYmFzaWNDb2xvckNvbHVtbkZvcm1hdHRlcnMsIH0gPSBwcm9wcztcbiAgICBjb25zdCBjb21wYXJpc29uQ29sdW1ucyA9IFtcbiAgICAgICAgeyBrZXk6ICdhbGwnLCBsYWJlbDogdCgnRGlzcGxheSBhbGwnKSB9LFxuICAgICAgICB7IGtleTogJyMnLCBsYWJlbDogJyMnIH0sXG4gICAgICAgIHsga2V5OiAn4pazJywgbGFiZWw6ICfilrMnIH0sXG4gICAgICAgIHsga2V5OiAnJScsIGxhYmVsOiAnJScgfSxcbiAgICBdO1xuICAgIGNvbnN0IHRpbWVzdGFtcEZvcm1hdHRlciA9IHVzZUNhbGxiYWNrKHZhbHVlID0+IGdldFRpbWVGb3JtYXR0ZXJGb3JHcmFudWxhcml0eSh0aW1lR3JhaW4pKHZhbHVlKSwgW3RpbWVHcmFpbl0pO1xuICAgIGNvbnN0IFt0YWJsZVNpemUsIHNldFRhYmxlU2l6ZV0gPSB1c2VTdGF0ZSh7XG4gICAgICAgIHdpZHRoOiAwLFxuICAgICAgICBoZWlnaHQ6IDAsXG4gICAgfSk7XG4gICAgLy8ga2VlcCB0cmFjayBvZiB3aGV0aGVyIGNvbHVtbiBvcmRlciBjaGFuZ2VkLCBzbyB0aGF0IGNvbHVtbiB3aWR0aHMgY2FuIHRvb1xuICAgIGNvbnN0IFtjb2x1bW5PcmRlclRvZ2dsZSwgc2V0Q29sdW1uT3JkZXJUb2dnbGVdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtzaG93Q29tcGFyaXNvbkRyb3Bkb3duLCBzZXRTaG93Q29tcGFyaXNvbkRyb3Bkb3duXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbc2VsZWN0ZWRDb21wYXJpc29uQ29sdW1ucywgc2V0U2VsZWN0ZWRDb21wYXJpc29uQ29sdW1uc10gPSB1c2VTdGF0ZShbXG4gICAgICAgIGNvbXBhcmlzb25Db2x1bW5zWzBdLmtleSxcbiAgICBdKTtcbiAgICBjb25zdCBbaGlkZUNvbXBhcmlzb25LZXlzLCBzZXRIaWRlQ29tcGFyaXNvbktleXNdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IHRoZW1lID0gdXNlVGhlbWUoKTtcbiAgICAvLyBvbmx5IHRha2UgcmVsZXZhbnQgcGFnZSBzaXplIG9wdGlvbnNcbiAgICBjb25zdCBwYWdlU2l6ZU9wdGlvbnMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgICAgY29uc3QgZ2V0U2VydmVyUGFnaW5hdGlvbiA9IChuKSA9PiBuIDw9IHJvd0NvdW50O1xuICAgICAgICByZXR1cm4gUEFHRV9TSVpFX09QVElPTlMuZmlsdGVyKChbbl0pID0+IHNlcnZlclBhZ2luYXRpb24gPyBnZXRTZXJ2ZXJQYWdpbmF0aW9uKG4pIDogbiA8PSAyICogZGF0YS5sZW5ndGgpO1xuICAgIH0sIFtkYXRhLmxlbmd0aCwgcm93Q291bnQsIHNlcnZlclBhZ2luYXRpb25dKTtcbiAgICBjb25zdCBnZXRWYWx1ZVJhbmdlID0gdXNlQ2FsbGJhY2soZnVuY3Rpb24gZ2V0VmFsdWVSYW5nZShrZXksIGFsaWduUG9zaXRpdmVOZWdhdGl2ZSkge1xuICAgICAgICBpZiAodHlwZW9mIGRhdGE/LlswXT8uW2tleV0gPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBjb25zdCBudW1zID0gZGF0YS5tYXAocm93ID0+IHJvd1trZXldKTtcbiAgICAgICAgICAgIHJldHVybiAoYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlXG4gICAgICAgICAgICAgICAgPyBbMCwgZDNNYXgobnVtcy5tYXAoTWF0aC5hYnMpKV1cbiAgICAgICAgICAgICAgICA6IGQzRXh0ZW50KG51bXMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LCBbZGF0YV0pO1xuICAgIGNvbnN0IGlzQWN0aXZlRmlsdGVyVmFsdWUgPSB1c2VDYWxsYmFjayhmdW5jdGlvbiBpc0FjdGl2ZUZpbHRlclZhbHVlKGtleSwgdmFsKSB7XG4gICAgICAgIHJldHVybiAhIWZpbHRlcnMgJiYgZmlsdGVyc1trZXldPy5pbmNsdWRlcyh2YWwpO1xuICAgIH0sIFtmaWx0ZXJzXSk7XG4gICAgY29uc3QgZ2V0Q3Jvc3NGaWx0ZXJEYXRhTWFzayA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICAgIGxldCB1cGRhdGVkRmlsdGVycyA9IHsgLi4uKGZpbHRlcnMgfHwge30pIH07XG4gICAgICAgIGlmIChmaWx0ZXJzICYmIGlzQWN0aXZlRmlsdGVyVmFsdWUoa2V5LCB2YWx1ZSkpIHtcbiAgICAgICAgICAgIHVwZGF0ZWRGaWx0ZXJzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB1cGRhdGVkRmlsdGVycyA9IHtcbiAgICAgICAgICAgICAgICBba2V5XTogW3ZhbHVlXSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXBkYXRlZEZpbHRlcnNba2V5XSkgJiZcbiAgICAgICAgICAgIHVwZGF0ZWRGaWx0ZXJzW2tleV0ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBkZWxldGUgdXBkYXRlZEZpbHRlcnNba2V5XTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBncm91cEJ5ID0gT2JqZWN0LmtleXModXBkYXRlZEZpbHRlcnMpO1xuICAgICAgICBjb25zdCBncm91cEJ5VmFsdWVzID0gT2JqZWN0LnZhbHVlcyh1cGRhdGVkRmlsdGVycyk7XG4gICAgICAgIGNvbnN0IGxhYmVsRWxlbWVudHMgPSBbXTtcbiAgICAgICAgZ3JvdXBCeS5mb3JFYWNoKGNvbCA9PiB7XG4gICAgICAgICAgICBjb25zdCBpc1RpbWVzdGFtcCA9IGNvbCA9PT0gRFRUTV9BTElBUztcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlclZhbHVlcyA9IGVuc3VyZUlzQXJyYXkodXBkYXRlZEZpbHRlcnM/Lltjb2xdKTtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJWYWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWVMYWJlbHMgPSBmaWx0ZXJWYWx1ZXMubWFwKHZhbHVlID0+IGlzVGltZXN0YW1wID8gdGltZXN0YW1wRm9ybWF0dGVyKHZhbHVlKSA6IHZhbHVlKTtcbiAgICAgICAgICAgICAgICBsYWJlbEVsZW1lbnRzLnB1c2goYCR7dmFsdWVMYWJlbHMuam9pbignLCAnKX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkYXRhTWFzazoge1xuICAgICAgICAgICAgICAgIGV4dHJhRm9ybURhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogZ3JvdXBCeS5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICAgICAgICAgID8gW11cbiAgICAgICAgICAgICAgICAgICAgICAgIDogZ3JvdXBCeS5tYXAoY29sID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSBlbnN1cmVJc0FycmF5KHVwZGF0ZWRGaWx0ZXJzPy5bY29sXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWwubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3A6ICdJUyBOVUxMJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wOiAnSU4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbC5tYXAoZWwgPT4gZWwgaW5zdGFuY2VvZiBEYXRlID8gZWwuZ2V0VGltZSgpIDogZWwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFpbjogY29sID09PSBEVFRNX0FMSUFTID8gdGltZUdyYWluIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZpbHRlclN0YXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbEVsZW1lbnRzLmpvaW4oJywgJyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBncm91cEJ5VmFsdWVzLmxlbmd0aCA/IGdyb3VwQnlWYWx1ZXMgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiB1cGRhdGVkRmlsdGVycyAmJiBPYmplY3Qua2V5cyh1cGRhdGVkRmlsdGVycykubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHVwZGF0ZWRGaWx0ZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0N1cnJlbnRWYWx1ZVNlbGVjdGVkOiBpc0FjdGl2ZUZpbHRlclZhbHVlKGtleSwgdmFsdWUpLFxuICAgICAgICB9O1xuICAgIH07XG4gICAgY29uc3QgdG9nZ2xlRmlsdGVyID0gdXNlQ2FsbGJhY2soZnVuY3Rpb24gdG9nZ2xlRmlsdGVyKGtleSwgdmFsKSB7XG4gICAgICAgIGlmICghZW1pdENyb3NzRmlsdGVycykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHNldERhdGFNYXNrKGdldENyb3NzRmlsdGVyRGF0YU1hc2soa2V5LCB2YWwpLmRhdGFNYXNrKTtcbiAgICB9LCBbZW1pdENyb3NzRmlsdGVycywgZ2V0Q3Jvc3NGaWx0ZXJEYXRhTWFzaywgc2V0RGF0YU1hc2tdKTtcbiAgICBjb25zdCBnZXRTaGFyZWRTdHlsZSA9IChjb2x1bW4pID0+IHtcbiAgICAgICAgY29uc3QgeyBpc051bWVyaWMsIGNvbmZpZyA9IHt9IH0gPSBjb2x1bW47XG4gICAgICAgIGNvbnN0IHRleHRBbGlnbiA9IGNvbmZpZy5ob3Jpem9udGFsQWxpZ24gfHxcbiAgICAgICAgICAgIChpc051bWVyaWMgJiYgIWlzVXNpbmdUaW1lQ29tcGFyaXNvbiA/ICdyaWdodCcgOiAnbGVmdCcpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGV4dEFsaWduLFxuICAgICAgICB9O1xuICAgIH07XG4gICAgY29uc3QgY29tcGFyaXNvbkxhYmVscyA9IFt0KCdNYWluJyksICcjJywgJ+KWsycsICclJ107XG4gICAgY29uc3QgZmlsdGVyZWRDb2x1bW5zTWV0YSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgICBpZiAoIWlzVXNpbmdUaW1lQ29tcGFyaXNvbikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbHVtbnNNZXRhO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFsbENvbHVtbnMgPSBjb21wYXJpc29uQ29sdW1uc1swXS5rZXk7XG4gICAgICAgIGNvbnN0IG1haW4gPSBjb21wYXJpc29uTGFiZWxzWzBdO1xuICAgICAgICBjb25zdCBzaG93QWxsQ29sdW1ucyA9IHNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMuaW5jbHVkZXMoYWxsQ29sdW1ucyk7XG4gICAgICAgIHJldHVybiBjb2x1bW5zTWV0YS5maWx0ZXIoKHsgbGFiZWwsIGtleSB9KSA9PiB7XG4gICAgICAgICAgICAvLyBFeHRyYWN0IHRoZSBrZXkgcG9ydGlvbiBhZnRlciB0aGUgc3BhY2UsIGFzc3VtaW5nIHRoZSBmb3JtYXQgaXMgYWx3YXlzIFwibGFiZWwga2V5XCJcbiAgICAgICAgICAgIGNvbnN0IGtleVBvcnRpb24gPSBrZXkuc3Vic3RyaW5nKGxhYmVsLmxlbmd0aCk7XG4gICAgICAgICAgICBjb25zdCBpc0tleUhpZGRlZCA9IGhpZGVDb21wYXJpc29uS2V5cy5pbmNsdWRlcyhrZXlQb3J0aW9uKTtcbiAgICAgICAgICAgIGNvbnN0IGlzTGFibGVNYWluID0gbGFiZWwgPT09IG1haW47XG4gICAgICAgICAgICByZXR1cm4gKGlzTGFibGVNYWluIHx8XG4gICAgICAgICAgICAgICAgKCFpc0tleUhpZGRlZCAmJlxuICAgICAgICAgICAgICAgICAgICAoIWNvbXBhcmlzb25MYWJlbHMuaW5jbHVkZXMobGFiZWwpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93QWxsQ29sdW1ucyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDb21wYXJpc29uQ29sdW1ucy5pbmNsdWRlcyhsYWJlbCkpKSk7XG4gICAgICAgIH0pO1xuICAgIH0sIFtcbiAgICAgICAgY29sdW1uc01ldGEsXG4gICAgICAgIGNvbXBhcmlzb25Db2x1bW5zLFxuICAgICAgICBjb21wYXJpc29uTGFiZWxzLFxuICAgICAgICBpc1VzaW5nVGltZUNvbXBhcmlzb24sXG4gICAgICAgIGhpZGVDb21wYXJpc29uS2V5cyxcbiAgICAgICAgc2VsZWN0ZWRDb21wYXJpc29uQ29sdW1ucyxcbiAgICBdKTtcbiAgICBjb25zdCBoYW5kbGVDb250ZXh0TWVudSA9IG9uQ29udGV4dE1lbnUgJiYgIWlzUmF3UmVjb3Jkc1xuICAgICAgICA/ICh2YWx1ZSwgY2VsbFBvaW50LCBjbGllbnRYLCBjbGllbnRZKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkcmlsbFRvRGV0YWlsRmlsdGVycyA9IFtdO1xuICAgICAgICAgICAgZmlsdGVyZWRDb2x1bW5zTWV0YS5mb3JFYWNoKGNvbCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFjb2wuaXNNZXRyaWMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YVJlY29yZFZhbHVlID0gdmFsdWVbY29sLmtleV07XG4gICAgICAgICAgICAgICAgICAgIGRyaWxsVG9EZXRhaWxGaWx0ZXJzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBjb2wua2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgb3A6ICc9PScsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWw6IGRhdGFSZWNvcmRWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFZhbDogZm9ybWF0Q29sdW1uVmFsdWUoY29sLCBkYXRhUmVjb3JkVmFsdWUpWzFdLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG9uQ29udGV4dE1lbnUoY2xpZW50WCwgY2xpZW50WSwge1xuICAgICAgICAgICAgICAgIGRyaWxsVG9EZXRhaWw6IGRyaWxsVG9EZXRhaWxGaWx0ZXJzLFxuICAgICAgICAgICAgICAgIGNyb3NzRmlsdGVyOiBjZWxsUG9pbnQuaXNNZXRyaWNcbiAgICAgICAgICAgICAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgOiBnZXRDcm9zc0ZpbHRlckRhdGFNYXNrKGNlbGxQb2ludC5rZXksIGNlbGxQb2ludC52YWx1ZSksXG4gICAgICAgICAgICAgICAgZHJpbGxCeTogY2VsbFBvaW50LmlzTWV0cmljXG4gICAgICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBjZWxsUG9pbnQua2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcDogJz09JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiBjZWxsUG9pbnQudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cGJ5RmllbGROYW1lOiAnZ3JvdXBieScsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBnZXRIZWFkZXJDb2x1bW5zID0gKGNvbHVtbnNNZXRhLCBlbmFibGVUaW1lQ29tcGFyaXNvbikgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHRNYXAgPSB7fTtcbiAgICAgICAgaWYgKCFlbmFibGVUaW1lQ29tcGFyaXNvbikge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdE1hcDtcbiAgICAgICAgfVxuICAgICAgICBjb2x1bW5zTWV0YS5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZWxlbWVudCdzIGxhYmVsIGlzIG9uZSBvZiB0aGUgY29tcGFyaXNvbiBsYWJlbHNcbiAgICAgICAgICAgIGlmIChjb21wYXJpc29uTGFiZWxzLmluY2x1ZGVzKGVsZW1lbnQubGFiZWwpKSB7XG4gICAgICAgICAgICAgICAgLy8gRXh0cmFjdCB0aGUga2V5IHBvcnRpb24gYWZ0ZXIgdGhlIHNwYWNlLCBhc3N1bWluZyB0aGUgZm9ybWF0IGlzIGFsd2F5cyBcImxhYmVsIGtleVwiXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5UG9ydGlvbiA9IGVsZW1lbnQua2V5LnN1YnN0cmluZyhlbGVtZW50LmxhYmVsLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIGtleSBwb3J0aW9uIGlzIG5vdCBpbiB0aGUgbWFwLCBpbml0aWFsaXplIGl0IHdpdGggdGhlIGN1cnJlbnQgaW5kZXhcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdE1hcFtrZXlQb3J0aW9uXSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRNYXBba2V5UG9ydGlvbl0gPSBbaW5kZXhdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBpbmRleCB0byB0aGUgZXhpc3RpbmcgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWFwW2tleVBvcnRpb25dLnB1c2goaW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHRNYXA7XG4gICAgfTtcbiAgICBjb25zdCByZW5kZXJUaW1lQ29tcGFyaXNvbkRyb3Bkb3duID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBhbGxLZXkgPSBjb21wYXJpc29uQ29sdW1uc1swXS5rZXk7XG4gICAgICAgIGNvbnN0IGhhbmRsZU9uQ2xpY2sgPSAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBrZXkgfSA9IGRhdGE7XG4gICAgICAgICAgICAvLyBUb2dnbGUgJ0FsbCcga2V5IHNlbGVjdGlvblxuICAgICAgICAgICAgaWYgKGtleSA9PT0gYWxsS2V5KSB7XG4gICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRDb21wYXJpc29uQ29sdW1ucyhbYWxsS2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zLmluY2x1ZGVzKGFsbEtleSkpIHtcbiAgICAgICAgICAgICAgICBzZXRTZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zKFtrZXldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRvZ2dsZSBzZWxlY3Rpb24gZm9yIG90aGVyIGtleXNcbiAgICAgICAgICAgICAgICBzZXRTZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zKHNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMuaW5jbHVkZXMoa2V5KVxuICAgICAgICAgICAgICAgICAgICA/IHNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMuZmlsdGVyKGsgPT4gayAhPT0ga2V5KSAvLyBEZXNlbGVjdCBpZiBhbHJlYWR5IHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICAgIDogWy4uLnNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMsIGtleV0pOyAvLyBTZWxlY3QgaWYgbm90IGFscmVhZHkgc2VsZWN0ZWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaGFuZGxlT25CbHVyID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRDb21wYXJpc29uQ29sdW1ucyhbY29tcGFyaXNvbkNvbHVtbnNbMF0ua2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiAoPERyb3Bkb3duIHBsYWNlbWVudD1cImJvdHRvbVJpZ2h0XCIgdmlzaWJsZT17c2hvd0NvbXBhcmlzb25Ecm9wZG93bn0gb25WaXNpYmxlQ2hhbmdlPXsoZmxhZykgPT4ge1xuICAgICAgICAgICAgICAgIHNldFNob3dDb21wYXJpc29uRHJvcGRvd24oZmxhZyk7XG4gICAgICAgICAgICB9fSBvdmVybGF5PXs8TWVudSBtdWx0aXBsZSBvbkNsaWNrPXtoYW5kbGVPbkNsaWNrfSBvbkJsdXI9e2hhbmRsZU9uQmx1cn0gc2VsZWN0ZWRLZXlzPXtzZWxlY3RlZENvbXBhcmlzb25Db2x1bW5zfT5cbiAgICAgICAgICAgIDxkaXYgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgIG1heC13aWR0aDogMjQycHg7XG4gICAgICAgICAgICAgICAgcGFkZGluZzogMCAke3RoZW1lLmdyaWRVbml0ICogMn1weDtcbiAgICAgICAgICAgICAgICBjb2xvcjogJHt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmJhc2V9O1xuICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLnN9cHg7XG4gICAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAgICB7dCgnU2VsZWN0IGNvbHVtbnMgdGhhdCB3aWxsIGJlIGRpc3BsYXllZCBpbiB0aGUgdGFibGUuIFlvdSBjYW4gbXVsdGlzZWxlY3QgY29sdW1ucy4nKX1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAge2NvbXBhcmlzb25Db2x1bW5zLm1hcChjb2x1bW4gPT4gKDxNZW51Lkl0ZW0ga2V5PXtjb2x1bW4ua2V5fT5cbiAgICAgICAgICAgICAgICA8c3BhbiBjc3M9e2NzcyBgXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUuZGFyazJ9O1xuICAgICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAgICB7Y29sdW1uLmxhYmVsfVxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjc3M9e2NzcyBgXG4gICAgICAgICAgICAgICAgICAgIGZsb2F0OiByaWdodDtcbiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAke3RoZW1lLnR5cG9ncmFwaHkuc2l6ZXMuc31weDtcbiAgICAgICAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAgICAgICAge3NlbGVjdGVkQ29tcGFyaXNvbkNvbHVtbnMuaW5jbHVkZXMoY29sdW1uLmtleSkgJiYgKDxDaGVja091dGxpbmVkIC8+KX1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIDwvTWVudS5JdGVtPikpfVxuICAgICAgICAgIDwvTWVudT59IHRyaWdnZXI9e1snY2xpY2snXX0+XG4gICAgICAgIDxzcGFuPlxuICAgICAgICAgIDxUYWJsZU91dGxpbmVkIC8+IDxEb3duT3V0bGluZWQgLz5cbiAgICAgICAgPC9zcGFuPlxuICAgICAgPC9Ecm9wZG93bj4pO1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyR3JvdXBpbmdIZWFkZXJzID0gKCkgPT4ge1xuICAgICAgICAvLyBUT0RPOiBNYWtlIHVzZSBvZiBDb2x1bW5Hcm91cCB0byByZW5kZXIgdGhlIGFkaXRpb25hbCBoZWFkZXJzXG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSBbXTtcbiAgICAgICAgbGV0IGN1cnJlbnRDb2x1bW5JbmRleCA9IDA7XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGdyb3VwSGVhZGVyQ29sdW1ucyB8fCB7fSkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIG51bWJlciBvZiBwbGFjZWhvbGRlciBjb2x1bW5zIG5lZWRlZCBiZWZvcmUgdGhlIGN1cnJlbnQgaGVhZGVyXG4gICAgICAgICAgICBjb25zdCBzdGFydFBvc2l0aW9uID0gdmFsdWVbMF07XG4gICAgICAgICAgICBjb25zdCBjb2xTcGFuID0gdmFsdWUubGVuZ3RoO1xuICAgICAgICAgICAgLy8gUmV0cmlldmUgdGhlIG9yaWdpbmFsTGFiZWwgZnJvbSB0aGUgZmlyc3QgY29sdW1uIGluIHRoaXMgZ3JvdXBcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsTGFiZWwgPSBjb2x1bW5zTWV0YVt2YWx1ZVswXV0/Lm9yaWdpbmFsTGFiZWwgfHwga2V5O1xuICAgICAgICAgICAgLy8gQWRkIHBsYWNlaG9sZGVyIDx0aD4gZm9yIGNvbHVtbnMgYmVmb3JlIHRoaXMgaGVhZGVyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gY3VycmVudENvbHVtbkluZGV4OyBpIDwgc3RhcnRQb3NpdGlvbjsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVycy5wdXNoKDx0aCBrZXk9e2BwbGFjZWhvbGRlci0ke2l9YH0gc3R5bGU9e3sgYm9yZGVyQm90dG9tOiAwIH19IGFyaWEtbGFiZWw9e2BIZWFkZXItJHtpfWB9Lz4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQWRkIHRoZSBjdXJyZW50IGhlYWRlciA8dGg+XG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goPHRoIGtleT17YGhlYWRlci0ke2tleX1gfSBjb2xTcGFuPXtjb2xTcGFufSBzdHlsZT17eyBib3JkZXJCb3R0b206IDAgfX0+XG4gICAgICAgICAge29yaWdpbmFsTGFiZWx9XG4gICAgICAgICAgPHNwYW4gY3NzPXtjc3MgYFxuICAgICAgICAgICAgICBmbG9hdDogcmlnaHQ7XG4gICAgICAgICAgICAgICYgc3ZnIHtcbiAgICAgICAgICAgICAgICBjb2xvcjogJHt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmJhc2V9ICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAge2hpZGVDb21wYXJpc29uS2V5cy5pbmNsdWRlcyhrZXkpID8gKDxQbHVzQ2lyY2xlT3V0bGluZWQgb25DbGljaz17KCkgPT4gc2V0SGlkZUNvbXBhcmlzb25LZXlzKGhpZGVDb21wYXJpc29uS2V5cy5maWx0ZXIoayA9PiBrICE9PSBrZXkpKX0vPikgOiAoPE1pbnVzQ2lyY2xlT3V0bGluZWQgb25DbGljaz17KCkgPT4gc2V0SGlkZUNvbXBhcmlzb25LZXlzKFsuLi5oaWRlQ29tcGFyaXNvbktleXMsIGtleV0pfS8+KX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvdGg+KTtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgY3VycmVudCBjb2x1bW4gaW5kZXhcbiAgICAgICAgICAgIGN1cnJlbnRDb2x1bW5JbmRleCA9IHN0YXJ0UG9zaXRpb24gKyBjb2xTcGFuO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICg8dHIgY3NzPXtjc3MgYFxuICAgICAgICAgIHRoIHtcbiAgICAgICAgICAgIGJvcmRlci1yaWdodDogMnB4IHNvbGlkICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aDpmaXJzdC1jaGlsZCB7XG4gICAgICAgICAgICBib3JkZXItbGVmdDogbm9uZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGg6bGFzdC1jaGlsZCB7XG4gICAgICAgICAgICBib3JkZXItcmlnaHQ6IG5vbmU7XG4gICAgICAgICAgfVxuICAgICAgICBgfT5cbiAgICAgICAge2hlYWRlcnN9XG4gICAgICA8L3RyPik7XG4gICAgfTtcbiAgICBjb25zdCBncm91cEhlYWRlckNvbHVtbnMgPSB1c2VNZW1vKCgpID0+IGdldEhlYWRlckNvbHVtbnMoZmlsdGVyZWRDb2x1bW5zTWV0YSwgaXNVc2luZ1RpbWVDb21wYXJpc29uKSwgW2ZpbHRlcmVkQ29sdW1uc01ldGEsIGlzVXNpbmdUaW1lQ29tcGFyaXNvbl0pO1xuICAgIGNvbnN0IGdldENvbHVtbkNvbmZpZ3MgPSB1c2VDYWxsYmFjaygoY29sdW1uLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHsga2V5LCBsYWJlbDogb3JpZ2luYWxMYWJlbCwgaXNOdW1lcmljLCBkYXRhVHlwZSwgaXNNZXRyaWMsIGlzUGVyY2VudE1ldHJpYywgY29uZmlnID0ge30sIH0gPSBjb2x1bW47XG4gICAgICAgIGNvbnN0IGxhYmVsID0gY29uZmlnLmN1c3RvbUNvbHVtbk5hbWUgfHwgb3JpZ2luYWxMYWJlbDtcbiAgICAgICAgbGV0IGRpc3BsYXlMYWJlbCA9IGxhYmVsO1xuICAgICAgICBjb25zdCBpc0NvbXBhcmlzb25Db2x1bW4gPSBbJyMnLCAn4pazJywgJyUnLCB0KCdNYWluJyldLmluY2x1ZGVzKGNvbHVtbi5sYWJlbCk7XG4gICAgICAgIGlmIChpc0NvbXBhcmlzb25Db2x1bW4pIHtcbiAgICAgICAgICAgIGlmIChjb2x1bW4ubGFiZWwgPT09IHQoJ01haW4nKSkge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlMYWJlbCA9IGNvbmZpZy5jdXN0b21Db2x1bW5OYW1lIHx8IGNvbHVtbi5vcmlnaW5hbExhYmVsIHx8ICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnLmN1c3RvbUNvbHVtbk5hbWUpIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5TGFiZWwgPVxuICAgICAgICAgICAgICAgICAgICBjb25maWcuZGlzcGxheVR5cGVJY29uICE9PSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBgJHtjb2x1bW4ubGFiZWx9ICR7Y29uZmlnLmN1c3RvbUNvbHVtbk5hbWV9YFxuICAgICAgICAgICAgICAgICAgICAgICAgOiBjb25maWcuY3VzdG9tQ29sdW1uTmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbmZpZy5kaXNwbGF5VHlwZUljb24gPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheUxhYmVsID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29sdW1uV2lkdGggPSBOdW1iZXIuaXNOYU4oTnVtYmVyKGNvbmZpZy5jb2x1bW5XaWR0aCkpXG4gICAgICAgICAgICA/IGNvbmZpZy5jb2x1bW5XaWR0aFxuICAgICAgICAgICAgOiBOdW1iZXIoY29uZmlnLmNvbHVtbldpZHRoKTtcbiAgICAgICAgLy8gaW5saW5lIHN0eWxlIGZvciBib3RoIHRoIGFuZCB0ZCBjZWxsXG4gICAgICAgIGNvbnN0IHNoYXJlZFN0eWxlID0gZ2V0U2hhcmVkU3R5bGUoY29sdW1uKTtcbiAgICAgICAgY29uc3QgYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlID0gY29uZmlnLmFsaWduUG9zaXRpdmVOZWdhdGl2ZSA9PT0gdW5kZWZpbmVkXG4gICAgICAgICAgICA/IGRlZmF1bHRBbGlnblBOXG4gICAgICAgICAgICA6IGNvbmZpZy5hbGlnblBvc2l0aXZlTmVnYXRpdmU7XG4gICAgICAgIGNvbnN0IGNvbG9yUG9zaXRpdmVOZWdhdGl2ZSA9IGNvbmZpZy5jb2xvclBvc2l0aXZlTmVnYXRpdmUgPT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgPyBkZWZhdWx0Q29sb3JQTlxuICAgICAgICAgICAgOiBjb25maWcuY29sb3JQb3NpdGl2ZU5lZ2F0aXZlO1xuICAgICAgICBjb25zdCB7IHRydW5jYXRlTG9uZ0NlbGxzIH0gPSBjb25maWc7XG4gICAgICAgIGNvbnN0IGhhc0NvbHVtbkNvbG9yRm9ybWF0dGVycyA9IGlzTnVtZXJpYyAmJlxuICAgICAgICAgICAgQXJyYXkuaXNBcnJheShjb2x1bW5Db2xvckZvcm1hdHRlcnMpICYmXG4gICAgICAgICAgICBjb2x1bW5Db2xvckZvcm1hdHRlcnMubGVuZ3RoID4gMDtcbiAgICAgICAgY29uc3QgaGFzQmFzaWNDb2xvckZvcm1hdHRlcnMgPSBpc1VzaW5nVGltZUNvbXBhcmlzb24gJiZcbiAgICAgICAgICAgIEFycmF5LmlzQXJyYXkoYmFzaWNDb2xvckZvcm1hdHRlcnMpICYmXG4gICAgICAgICAgICBiYXNpY0NvbG9yRm9ybWF0dGVycy5sZW5ndGggPiAwO1xuICAgICAgICBjb25zdCB2YWx1ZVJhbmdlID0gIWhhc0Jhc2ljQ29sb3JGb3JtYXR0ZXJzICYmXG4gICAgICAgICAgICAhaGFzQ29sdW1uQ29sb3JGb3JtYXR0ZXJzICYmXG4gICAgICAgICAgICAoY29uZmlnLnNob3dDZWxsQmFycyA9PT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgPyBzaG93Q2VsbEJhcnNcbiAgICAgICAgICAgICAgICA6IGNvbmZpZy5zaG93Q2VsbEJhcnMpICYmXG4gICAgICAgICAgICAoaXNNZXRyaWMgfHwgaXNSYXdSZWNvcmRzIHx8IGlzUGVyY2VudE1ldHJpYykgJiZcbiAgICAgICAgICAgIGdldFZhbHVlUmFuZ2Uoa2V5LCBhbGlnblBvc2l0aXZlTmVnYXRpdmUpO1xuICAgICAgICBsZXQgY2xhc3NOYW1lID0gJyc7XG4gICAgICAgIGlmIChlbWl0Q3Jvc3NGaWx0ZXJzICYmICFpc01ldHJpYykge1xuICAgICAgICAgICAgY2xhc3NOYW1lICs9ICcgZHQtaXMtZmlsdGVyJztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzTWV0cmljICYmICFpc1BlcmNlbnRNZXRyaWMpIHtcbiAgICAgICAgICAgIGNsYXNzTmFtZSArPSAnIHJpZ2h0LWJvcmRlci1vbmx5JztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb21wYXJpc29uTGFiZWxzLmluY2x1ZGVzKGxhYmVsKSkge1xuICAgICAgICAgICAgY29uc3QgZ3JvdXBpbkhlYWRlciA9IGtleS5zdWJzdHJpbmcobGFiZWwubGVuZ3RoKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbnNVbmRlckhlYWRlciA9IGdyb3VwSGVhZGVyQ29sdW1uc1tncm91cGluSGVhZGVyXSB8fCBbXTtcbiAgICAgICAgICAgIGlmIChpID09PSBjb2x1bW5zVW5kZXJIZWFkZXJbY29sdW1uc1VuZGVySGVhZGVyLmxlbmd0aCAtIDFdKSB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lICs9ICcgcmlnaHQtYm9yZGVyLW9ubHknO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogU3RyaW5nKGkpLFxuICAgICAgICAgICAgLy8gbXVzdCB1c2UgY3VzdG9tIGFjY2Vzc29yIHRvIGFsbG93IGAuYCBpbiBjb2x1bW4gbmFtZXNcbiAgICAgICAgICAgIC8vIHR5cGluZyBpcyBpbmNvcnJlY3QgaW4gY3VycmVudCB2ZXJzaW9uIG9mIGBAdHlwZXMvcmVhY3QtdGFibGVgXG4gICAgICAgICAgICAvLyBzbyB3ZSBhc2sgVFMgbm90IHRvIGNoZWNrLlxuICAgICAgICAgICAgYWNjZXNzb3I6ICgoZGF0dW0pID0+IGRhdHVtW2tleV0pLFxuICAgICAgICAgICAgQ2VsbDogKHsgdmFsdWUsIHJvdyB9KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgW2lzSHRtbCwgdGV4dF0gPSBmb3JtYXRDb2x1bW5WYWx1ZShjb2x1bW4sIHZhbHVlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBodG1sID0gaXNIdG1sICYmIGFsbG93UmVuZGVySHRtbCA/IHsgX19odG1sOiB0ZXh0IH0gOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgbGV0IGJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgICAgICAgICBsZXQgYXJyb3cgPSAnJztcbiAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5LZXkgPSBjb2x1bW4ua2V5LnN1YnN0cmluZyhjb2x1bW4ubGFiZWwubGVuZ3RoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgaWYgKCFoYXNDb2x1bW5Db2xvckZvcm1hdHRlcnMgJiYgaGFzQmFzaWNDb2xvckZvcm1hdHRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2ljQ29sb3JGb3JtYXR0ZXJzW3Jvdy5pbmRleF1bb3JpZ2luS2V5XT8uYmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgICAgICAgICAgICBhcnJvdyA9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4ubGFiZWwgPT09IGNvbXBhcmlzb25MYWJlbHNbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGJhc2ljQ29sb3JGb3JtYXR0ZXJzW3Jvdy5pbmRleF1bb3JpZ2luS2V5XT8ubWFpbkFycm93XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGhhc0NvbHVtbkNvbG9yRm9ybWF0dGVycykge1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW5Db2xvckZvcm1hdHRlcnNcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZm9ybWF0dGVyID0+IGZvcm1hdHRlci5jb2x1bW4gPT09IGNvbHVtbi5rZXkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaChmb3JtYXR0ZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVyUmVzdWx0ID0gdmFsdWUgfHwgdmFsdWUgPT09IDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGZvcm1hdHRlci5nZXRDb2xvckZyb21WYWx1ZSh2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdHRlclJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9IGZvcm1hdHRlclJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChiYXNpY0NvbG9yQ29sdW1uRm9ybWF0dGVycyAmJlxuICAgICAgICAgICAgICAgICAgICBiYXNpY0NvbG9yQ29sdW1uRm9ybWF0dGVycz8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IgPVxuICAgICAgICAgICAgICAgICAgICAgICAgYmFzaWNDb2xvckNvbHVtbkZvcm1hdHRlcnNbcm93LmluZGV4XVtjb2x1bW4ua2V5XVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8uYmFja2dyb3VuZENvbG9yIHx8IGJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgYXJyb3cgPVxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLmxhYmVsID09PSBjb21wYXJpc29uTGFiZWxzWzBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBiYXNpY0NvbG9yQ29sdW1uRm9ybWF0dGVyc1tyb3cuaW5kZXhdW2NvbHVtbi5rZXldPy5tYWluQXJyb3dcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBTdHlsZWRDZWxsID0gc3R5bGVkLnRkIGBcbiAgICAgICAgICAgIHRleHQtYWxpZ246ICR7c2hhcmVkU3R5bGUudGV4dEFsaWdufTtcbiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiAke3ZhbHVlIGluc3RhbmNlb2YgRGF0ZSA/ICdub3dyYXAnIDogdW5kZWZpbmVkfTtcbiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICR7YmFja2dyb3VuZENvbG9yIHx8IHVuZGVmaW5lZH07XG4gICAgICAgICAgICBwYWRkaW5nLWxlZnQ6ICR7Y29sdW1uLmlzQ2hpbGRDb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgPyBgJHt0aGVtZS5ncmlkVW5pdCAqIDV9cHhgXG4gICAgICAgICAgICAgICAgICAgIDogYCR7dGhlbWUuZ3JpZFVuaXR9cHhgfTtcbiAgICAgICAgICBgO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxCYXJTdHlsZXMgPSBjc3MgYFxuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgICAgICB0b3A6IDA7XG4gICAgICAgICAgICAke3ZhbHVlUmFuZ2UgJiZcbiAgICAgICAgICAgICAgICAgICAgYFxuICAgICAgICAgICAgICAgIHdpZHRoOiAke2Ake2NlbGxXaWR0aCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVJhbmdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxpZ25Qb3NpdGl2ZU5lZ2F0aXZlLFxuICAgICAgICAgICAgICAgICAgICB9KX0lYH07XG4gICAgICAgICAgICAgICAgbGVmdDogJHtgJHtjZWxsT2Zmc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlUmFuZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGlnblBvc2l0aXZlTmVnYXRpdmUsXG4gICAgICAgICAgICAgICAgICAgIH0pfSVgfTtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NlbGxCYWNrZ3JvdW5kKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yUG9zaXRpdmVOZWdhdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgfSl9O1xuICAgICAgICAgICAgICBgfVxuICAgICAgICAgIGA7XG4gICAgICAgICAgICAgICAgbGV0IGFycm93U3R5bGVzID0gY3NzIGBcbiAgICAgICAgICAgIGNvbG9yOiAke2Jhc2ljQ29sb3JGb3JtYXR0ZXJzICYmXG4gICAgICAgICAgICAgICAgICAgIGJhc2ljQ29sb3JGb3JtYXR0ZXJzW3Jvdy5pbmRleF1bb3JpZ2luS2V5XT8uYXJyb3dDb2xvciA9PT1cbiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yU2NoZW1lRW51bS5HcmVlblxuICAgICAgICAgICAgICAgICAgICA/IHRoZW1lLmNvbG9ycy5zdWNjZXNzLmJhc2VcbiAgICAgICAgICAgICAgICAgICAgOiB0aGVtZS5jb2xvcnMuZXJyb3IuYmFzZX07XG4gICAgICAgICAgICBtYXJnaW4tcmlnaHQ6ICR7dGhlbWUuZ3JpZFVuaXR9cHg7XG4gICAgICAgICAgYDtcbiAgICAgICAgICAgICAgICBpZiAoYmFzaWNDb2xvckNvbHVtbkZvcm1hdHRlcnMgJiZcbiAgICAgICAgICAgICAgICAgICAgYmFzaWNDb2xvckNvbHVtbkZvcm1hdHRlcnM/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyb3dTdHlsZXMgPSBjc3MgYFxuICAgICAgICAgICAgICBjb2xvcjogJHtiYXNpY0NvbG9yQ29sdW1uRm9ybWF0dGVyc1tyb3cuaW5kZXhdW2NvbHVtbi5rZXldXG4gICAgICAgICAgICAgICAgICAgICAgICA/LmFycm93Q29sb3IgPT09IENvbG9yU2NoZW1lRW51bS5HcmVlblxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGVtZS5jb2xvcnMuc3VjY2Vzcy5iYXNlXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHRoZW1lLmNvbG9ycy5lcnJvci5iYXNlfTtcbiAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAke3RoZW1lLmdyaWRVbml0fXB4O1xuICAgICAgICAgICAgYDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbFByb3BzID0ge1xuICAgICAgICAgICAgICAgICAgICAnYXJpYS1sYWJlbGxlZGJ5JzogYGhlYWRlci0ke2NvbHVtbi5rZXl9YCxcbiAgICAgICAgICAgICAgICAgICAgcm9sZTogJ2NlbGwnLFxuICAgICAgICAgICAgICAgICAgICAvLyBzaG93IHJhdyBudW1iZXIgaW4gdGl0bGUgaW4gY2FzZSBvZiBudW1lcmljIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyA/IFN0cmluZyh2YWx1ZSkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGVtaXRDcm9zc0ZpbHRlcnMgJiYgIXZhbHVlUmFuZ2UgJiYgIWlzTWV0cmljXG4gICAgICAgICAgICAgICAgICAgICAgICA/ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbGxvdyBzZWxlY3RpbmcgdGV4dCBpbiBhIGNlbGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWdldFNlbGVjdGVkVGV4dCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZpbHRlcihrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgb25Db250ZXh0TWVudTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVDb250ZXh0TWVudSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUNvbnRleHRNZW51KHJvdy5vcmlnaW5hbCwgeyBrZXksIHZhbHVlLCBpc01ldHJpYyB9LCBlLm5hdGl2ZUV2ZW50LmNsaWVudFgsIGUubmF0aXZlRXZlbnQuY2xpZW50WSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogW1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPT0gbnVsbCA/ICdkdC1pcy1udWxsJyA6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNBY3RpdmVGaWx0ZXJWYWx1ZShrZXksIHZhbHVlKSA/ICcgZHQtaXMtYWN0aXZlLWZpbHRlcicgOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksXG4gICAgICAgICAgICAgICAgICAgIHRhYkluZGV4OiAwLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKGh0bWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRydW5jYXRlTG9uZ0NlbGxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tZGFuZ2VyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDxTdHlsZWRDZWxsIHsuLi5jZWxsUHJvcHN9PlxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJkdC10cnVuY2F0ZS1jZWxsXCIgc3R5bGU9e2NvbHVtbldpZHRoID8geyB3aWR0aDogY29sdW1uV2lkdGggfSA6IHVuZGVmaW5lZH0gZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw9e2h0bWx9Lz5cbiAgICAgICAgICAgICAgICA8L1N0eWxlZENlbGw+KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tZGFuZ2VyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA8U3R5bGVkQ2VsbCB7Li4uY2VsbFByb3BzfSBkYW5nZXJvdXNseVNldElubmVySFRNTD17aHRtbH0vPjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gSWYgY2VsbFByb3BzIHJlbmRlcnMgdGV4dENvbnRlbnQgYWxyZWFkeSwgdGhlbiB3ZSBkb24ndCBoYXZlIHRvXG4gICAgICAgICAgICAgICAgLy8gcmVuZGVyIGBDZWxsYC4gVGhpcyBzYXZlcyBzb21lIHRpbWUgZm9yIGxhcmdlIHRhYmxlcy5cbiAgICAgICAgICAgICAgICByZXR1cm4gKDxTdHlsZWRDZWxsIHsuLi5jZWxsUHJvcHN9PlxuICAgICAgICAgICAgICB7dmFsdWVSYW5nZSAmJiAoPGRpdiBcbiAgICAgICAgICAgICAgICAgICAgLyogVGhlIGZvbGxvd2luZyBjbGFzc2VzIGFyZSBhZGRlZCB0byBzdXBwb3J0IGN1c3RvbSBDU1Mgc3R5bGluZyAqL1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2N4KCdjZWxsLWJhcicsIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgdmFsdWUgPCAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnbmVnYXRpdmUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAncG9zaXRpdmUnKX0gY3NzPXtjZWxsQmFyU3R5bGVzfSByb2xlPVwicHJlc2VudGF0aW9uXCIvPil9XG4gICAgICAgICAgICAgIHt0cnVuY2F0ZUxvbmdDZWxscyA/ICg8ZGl2IGNsYXNzTmFtZT1cImR0LXRydW5jYXRlLWNlbGxcIiBzdHlsZT17Y29sdW1uV2lkdGggPyB7IHdpZHRoOiBjb2x1bW5XaWR0aCB9IDogdW5kZWZpbmVkfT5cbiAgICAgICAgICAgICAgICAgIHthcnJvdyAmJiA8c3BhbiBjc3M9e2Fycm93U3R5bGVzfT57YXJyb3d9PC9zcGFuPn1cbiAgICAgICAgICAgICAgICAgIHt0ZXh0fVxuICAgICAgICAgICAgICAgIDwvZGl2PikgOiAoPD5cbiAgICAgICAgICAgICAgICAgIHthcnJvdyAmJiA8c3BhbiBjc3M9e2Fycm93U3R5bGVzfT57YXJyb3d9PC9zcGFuPn1cbiAgICAgICAgICAgICAgICAgIHt0ZXh0fVxuICAgICAgICAgICAgICAgIDwvPil9XG4gICAgICAgICAgICA8L1N0eWxlZENlbGw+KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBIZWFkZXI6ICh7IGNvbHVtbjogY29sLCBvbkNsaWNrLCBzdHlsZSwgb25EcmFnU3RhcnQsIG9uRHJvcCB9KSA9PiAoPHRoIGlkPXtgaGVhZGVyLSR7Y29sdW1uLmtleX1gfSB0aXRsZT17dCgnU2hpZnQgKyBDbGljayB0byBzb3J0IGJ5IG11bHRpcGxlIGNvbHVtbnMnKX0gY2xhc3NOYW1lPXtbY2xhc3NOYW1lLCBjb2wuaXNTb3J0ZWQgPyAnaXMtc29ydGVkJyA6ICcnXS5qb2luKCcgJyl9IHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgIC4uLnNoYXJlZFN0eWxlLFxuICAgICAgICAgICAgICAgICAgICAuLi5zdHlsZSxcbiAgICAgICAgICAgICAgICB9fSBvbktleURvd249eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHByb2dyYW1hdGljYWxseSBzb3J0IGNvbHVtbiBvbiBrZXlwcmVzc1xuICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyhBQ1RJT05fS0VZUykuaW5jbHVkZXMoZS5rZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wudG9nZ2xlU29ydEJ5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9fSByb2xlPVwiY29sdW1uaGVhZGVyIGJ1dHRvblwiIG9uQ2xpY2s9e29uQ2xpY2t9IGRhdGEtY29sdW1uLW5hbWU9e2NvbC5pZH0gey4uLihhbGxvd1JlYXJyYW5nZUNvbHVtbnMgJiYge1xuICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogJ3RydWUnLFxuICAgICAgICAgICAgICAgIG9uRHJhZ1N0YXJ0LFxuICAgICAgICAgICAgICAgIG9uRHJhZ092ZXI6IGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpLFxuICAgICAgICAgICAgICAgIG9uRHJhZ0VudGVyOiBlID0+IGUucHJldmVudERlZmF1bHQoKSxcbiAgICAgICAgICAgICAgICBvbkRyb3AsXG4gICAgICAgICAgICB9KX0gdGFiSW5kZXg9ezB9PlxuICAgICAgICAgICAgey8qIGNhbid0IHVzZSBgY29sdW1uV2lkdGggJiZgIGJlY2F1c2UgaXQgbWF5IGFsc28gYmUgemVybyAqL31cbiAgICAgICAgICAgIHtjb25maWcuY29sdW1uV2lkdGggPyAoXG4gICAgICAgICAgICAgICAgLy8gY29sdW1uIHdpZHRoIGhpbnRcbiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogY29sdW1uV2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDAuMDEsXG4gICAgICAgICAgICAgICAgICAgIH19Lz4pIDogbnVsbH1cbiAgICAgICAgICAgIDxkaXYgZGF0YS1jb2x1bW4tbmFtZT17Y29sLmlkfSBjc3M9e3tcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1mbGV4JyxcbiAgICAgICAgICAgICAgICAgICAgYWxpZ25JdGVtczogJ2ZsZXgtZW5kJyxcbiAgICAgICAgICAgICAgICB9fT5cbiAgICAgICAgICAgICAgPHNwYW4gZGF0YS1jb2x1bW4tbmFtZT17Y29sLmlkfT57ZGlzcGxheUxhYmVsfTwvc3Bhbj5cbiAgICAgICAgICAgICAgPFNvcnRJY29uIGNvbHVtbj17Y29sfS8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L3RoPiksXG4gICAgICAgICAgICBGb290ZXI6IHRvdGFscyA/IChpID09PSAwID8gKDx0aCBrZXk9e2Bmb290ZXItc3VtbWFyeS0ke2l9YH0+XG4gICAgICAgICAgICAgIDxkaXYgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgICAgICAgICAgICAmIHN2ZyB7XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiAke3RoZW1lLmdyaWRVbml0fXB4O1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogJHt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmRhcmsxfSAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGB9PlxuICAgICAgICAgICAgICAgIHt0KCdTdW1tYXJ5Jyl9XG4gICAgICAgICAgICAgICAgPFRvb2x0aXAgb3ZlcmxheT17dCgnU2hvdyB0b3RhbCBhZ2dyZWdhdGlvbnMgb2Ygc2VsZWN0ZWQgbWV0cmljcy4gTm90ZSB0aGF0IHJvdyBsaW1pdCBkb2VzIG5vdCBhcHBseSB0byB0aGUgcmVzdWx0LicpfT5cbiAgICAgICAgICAgICAgICAgIDxJbmZvQ2lyY2xlT3V0bGluZWQgLz5cbiAgICAgICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC90aD4pIDogKDx0ZCBrZXk9e2Bmb290ZXItdG90YWwtJHtpfWB9IHN0eWxlPXtzaGFyZWRTdHlsZX0+XG4gICAgICAgICAgICAgIDxzdHJvbmc+e2Zvcm1hdENvbHVtblZhbHVlKGNvbHVtbiwgdG90YWxzW2tleV0pWzFdfTwvc3Ryb25nPlxuICAgICAgICAgICAgPC90ZD4pKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHNvcnREZXNjRmlyc3Q6IHNvcnREZXNjLFxuICAgICAgICAgICAgc29ydFR5cGU6IGdldFNvcnRUeXBlQnlEYXRhVHlwZShkYXRhVHlwZSksXG4gICAgICAgIH07XG4gICAgfSwgW1xuICAgICAgICBkZWZhdWx0QWxpZ25QTixcbiAgICAgICAgZGVmYXVsdENvbG9yUE4sXG4gICAgICAgIGVtaXRDcm9zc0ZpbHRlcnMsXG4gICAgICAgIGdldFZhbHVlUmFuZ2UsXG4gICAgICAgIGlzQWN0aXZlRmlsdGVyVmFsdWUsXG4gICAgICAgIGlzUmF3UmVjb3JkcyxcbiAgICAgICAgc2hvd0NlbGxCYXJzLFxuICAgICAgICBzb3J0RGVzYyxcbiAgICAgICAgdG9nZ2xlRmlsdGVyLFxuICAgICAgICB0b3RhbHMsXG4gICAgICAgIGNvbHVtbkNvbG9yRm9ybWF0dGVycyxcbiAgICAgICAgY29sdW1uT3JkZXJUb2dnbGUsXG4gICAgXSk7XG4gICAgY29uc3QgdmlzaWJsZUNvbHVtbnNNZXRhID0gdXNlTWVtbygoKSA9PiBmaWx0ZXJlZENvbHVtbnNNZXRhLmZpbHRlcihjb2wgPT4gY29sLmNvbmZpZz8udmlzaWJsZSAhPT0gZmFsc2UpLCBbZmlsdGVyZWRDb2x1bW5zTWV0YV0pO1xuICAgIGNvbnN0IGNvbHVtbnMgPSB1c2VNZW1vKCgpID0+IHZpc2libGVDb2x1bW5zTWV0YS5tYXAoZ2V0Q29sdW1uQ29uZmlncyksIFt2aXNpYmxlQ29sdW1uc01ldGEsIGdldENvbHVtbkNvbmZpZ3NdKTtcbiAgICBjb25zdCBoYW5kbGVTZXJ2ZXJQYWdpbmF0aW9uQ2hhbmdlID0gdXNlQ2FsbGJhY2soKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSA9PiB7XG4gICAgICAgIHVwZGF0ZUV4dGVybmFsRm9ybURhdGEoc2V0RGF0YU1hc2ssIHBhZ2VOdW1iZXIsIHBhZ2VTaXplKTtcbiAgICB9LCBbc2V0RGF0YU1hc2tdKTtcbiAgICBjb25zdCBoYW5kbGVTaXplQ2hhbmdlID0gdXNlQ2FsbGJhY2soKHsgd2lkdGgsIGhlaWdodCB9KSA9PiB7XG4gICAgICAgIHNldFRhYmxlU2l6ZSh7IHdpZHRoLCBoZWlnaHQgfSk7XG4gICAgfSwgW10pO1xuICAgIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIEFmdGVyIGluaXRpYWwgbG9hZCB0aGUgdGFibGUgc2hvdWxkIHJlc2l6ZSBvbmx5IHdoZW4gdGhlIG5ldyBzaXplc1xuICAgICAgICAvLyBBcmUgbm90IG9ubHkgc2Nyb2xsYmFyIHVwZGF0ZXMsIG90aGVyd2lzZSwgdGhlIHRhYmxlIHdvdWxkIHR3aXRjaFxuICAgICAgICBjb25zdCBzY3JvbGxCYXJTaXplID0gZ2V0U2Nyb2xsQmFyU2l6ZSgpO1xuICAgICAgICBjb25zdCB7IHdpZHRoOiB0YWJsZVdpZHRoLCBoZWlnaHQ6IHRhYmxlSGVpZ2h0IH0gPSB0YWJsZVNpemU7XG4gICAgICAgIC8vIFRhYmxlIGlzIGluY3JlYXNpbmcgaXRzIG9yaWdpbmFsIHNpemVcbiAgICAgICAgaWYgKHdpZHRoIC0gdGFibGVXaWR0aCA+IHNjcm9sbEJhclNpemUgfHxcbiAgICAgICAgICAgIGhlaWdodCAtIHRhYmxlSGVpZ2h0ID4gc2Nyb2xsQmFyU2l6ZSkge1xuICAgICAgICAgICAgaGFuZGxlU2l6ZUNoYW5nZSh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoIC0gc2Nyb2xsQmFyU2l6ZSxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCAtIHNjcm9sbEJhclNpemUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0YWJsZVdpZHRoIC0gd2lkdGggPiBzY3JvbGxCYXJTaXplIHx8XG4gICAgICAgICAgICB0YWJsZUhlaWdodCAtIGhlaWdodCA+IHNjcm9sbEJhclNpemUpIHtcbiAgICAgICAgICAgIC8vIFRhYmxlIGlzIGRlY3JlYXNpbmcgaXRzIG9yaWdpbmFsIHNpemVcbiAgICAgICAgICAgIGhhbmRsZVNpemVDaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHdpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwgW3dpZHRoLCBoZWlnaHQsIGhhbmRsZVNpemVDaGFuZ2UsIHRhYmxlU2l6ZV0pO1xuICAgIGNvbnN0IHsgd2lkdGg6IHdpZHRoRnJvbVN0YXRlLCBoZWlnaHQ6IGhlaWdodEZyb21TdGF0ZSB9ID0gdGFibGVTaXplO1xuICAgIHJldHVybiAoPFN0eWxlcz5cbiAgICAgIDxEYXRhVGFibGUgY29sdW1ucz17Y29sdW1uc30gZGF0YT17ZGF0YX0gcm93Q291bnQ9e3Jvd0NvdW50fSB0YWJsZUNsYXNzTmFtZT1cInRhYmxlIHRhYmxlLXN0cmlwZWQgdGFibGUtY29uZGVuc2VkXCIgcGFnZVNpemU9e3BhZ2VTaXplfSBzZXJ2ZXJQYWdpbmF0aW9uRGF0YT17c2VydmVyUGFnaW5hdGlvbkRhdGF9IHBhZ2VTaXplT3B0aW9ucz17cGFnZVNpemVPcHRpb25zfSB3aWR0aD17d2lkdGhGcm9tU3RhdGV9IGhlaWdodD17aGVpZ2h0RnJvbVN0YXRlfSBzZXJ2ZXJQYWdpbmF0aW9uPXtzZXJ2ZXJQYWdpbmF0aW9ufSBvblNlcnZlclBhZ2luYXRpb25DaGFuZ2U9e2hhbmRsZVNlcnZlclBhZ2luYXRpb25DaGFuZ2V9IG9uQ29sdW1uT3JkZXJDaGFuZ2U9eygpID0+IHNldENvbHVtbk9yZGVyVG9nZ2xlKCFjb2x1bW5PcmRlclRvZ2dsZSl9IFxuICAgIC8vIDkgcGFnZSBpdGVtcyBpbiA+IDM0MHB4IHdvcmtzIHdlbGwgZXZlbiBmb3IgMTAwKyBwYWdlc1xuICAgIG1heFBhZ2VJdGVtQ291bnQ9e3dpZHRoID4gMzQwID8gOSA6IDd9IG5vUmVzdWx0cz17Z2V0Tm9SZXN1bHRzTWVzc2FnZX0gc2VhcmNoSW5wdXQ9e2luY2x1ZGVTZWFyY2ggJiYgU2VhcmNoSW5wdXR9IHNlbGVjdFBhZ2VTaXplPXtwYWdlU2l6ZSAhPT0gbnVsbCAmJiBTZWxlY3RQYWdlU2l6ZX0gXG4gICAgLy8gbm90IGluIHVzZSBpbiBTdXBlcnNldCwgYnV0IG5lZWRlZCBmb3IgdW5pdCB0ZXN0c1xuICAgIHN0aWNreT17c3RpY2t5fSByZW5kZXJHcm91cGluZ0hlYWRlcnM9eyFpc0VtcHR5KGdyb3VwSGVhZGVyQ29sdW1ucykgPyByZW5kZXJHcm91cGluZ0hlYWRlcnMgOiB1bmRlZmluZWR9IHJlbmRlclRpbWVDb21wYXJpc29uRHJvcGRvd249e2lzVXNpbmdUaW1lQ29tcGFyaXNvbiA/IHJlbmRlclRpbWVDb21wYXJpc29uRHJvcGRvd24gOiB1bmRlZmluZWR9Lz5cbiAgICA8L1N0eWxlcz4pO1xufVxuIl19 */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };\nexport default function TableChart(props) {\n  const { timeGrain, height, width, data, totals, isRawRecords, rowCount = 0, columns: columnsMeta, alignPositiveNegative: defaultAlignPN = false, colorPositiveNegative: defaultColorPN = false, includeSearch = false, pageSize = 0, serverPagination = false, serverPaginationData, setDataMask, showCellBars = true, sortDesc = false, filters, sticky = true, // whether to use sticky header\n    columnColorFormatters, allowRearrangeColumns = false, allowRenderHtml = true, onContextMenu, emitCrossFilters, isUsingTimeComparison, basicColorFormatters, basicColorColumnFormatters } = props;\n  const comparisonColumns = [\n  { key: 'all', label: t('Display all') },\n  { key: '#', label: '#' },\n  { key: '△', label: '△' },\n  { key: '%', label: '%' }];\n\n  const timestampFormatter = useCallback((value) => getTimeFormatterForGranularity(timeGrain)(value), [timeGrain]);\n  const [tableSize, setTableSize] = useState({\n    width: 0,\n    height: 0\n  });\n  // keep track of whether column order changed, so that column widths can too\n  const [columnOrderToggle, setColumnOrderToggle] = useState(false);\n  const [showComparisonDropdown, setShowComparisonDropdown] = useState(false);\n  const [selectedComparisonColumns, setSelectedComparisonColumns] = useState([\n  comparisonColumns[0].key]\n  );\n  const [hideComparisonKeys, setHideComparisonKeys] = useState([]);\n  const theme = useTheme();\n  // only take relevant page size options\n  const pageSizeOptions = useMemo(() => {\n    const getServerPagination = (n) => n <= rowCount;\n    return PAGE_SIZE_OPTIONS.filter(([n]) => serverPagination ? getServerPagination(n) : n <= 2 * data.length);\n  }, [data.length, rowCount, serverPagination]);\n  const getValueRange = useCallback(function getValueRange(key, alignPositiveNegative) {var _data$;\n    if (typeof (data == null ? void 0 : (_data$ = data[0]) == null ? void 0 : _data$[key]) === 'number') {\n      const nums = data.map((row) => row[key]);\n      return alignPositiveNegative ?\n      [0, d3Max(nums.map(Math.abs))] :\n      d3Extent(nums);\n    }\n    return null;\n  }, [data]);\n  const isActiveFilterValue = useCallback(function isActiveFilterValue(key, val) {var _filters$key;\n    return !!filters && ((_filters$key = filters[key]) == null ? void 0 : _filters$key.includes(val));\n  }, [filters]);\n  const getCrossFilterDataMask = (key, value) => {\n    let updatedFilters = { ...(filters || {}) };\n    if (filters && isActiveFilterValue(key, value)) {\n      updatedFilters = {};\n    } else\n    {\n      updatedFilters = {\n        [key]: [value]\n      };\n    }\n    if (Array.isArray(updatedFilters[key]) &&\n    updatedFilters[key].length === 0) {\n      delete updatedFilters[key];\n    }\n    const groupBy = Object.keys(updatedFilters);\n    const groupByValues = Object.values(updatedFilters);\n    const labelElements = [];\n    groupBy.forEach((col) => {var _updatedFilters;\n      const isTimestamp = col === DTTM_ALIAS;\n      const filterValues = ensureIsArray((_updatedFilters = updatedFilters) == null ? void 0 : _updatedFilters[col]);\n      if (filterValues.length) {\n        const valueLabels = filterValues.map((value) => isTimestamp ? timestampFormatter(value) : value);\n        labelElements.push(`${valueLabels.join(', ')}`);\n      }\n    });\n    return {\n      dataMask: {\n        extraFormData: {\n          filters: groupBy.length === 0 ?\n          [] :\n          groupBy.map((col) => {var _updatedFilters2;\n            const val = ensureIsArray((_updatedFilters2 = updatedFilters) == null ? void 0 : _updatedFilters2[col]);\n            if (!val.length)\n            return {\n              col,\n              op: 'IS NULL'\n            };\n            return {\n              col,\n              op: 'IN',\n              val: val.map((el) => el instanceof Date ? el.getTime() : el),\n              grain: col === DTTM_ALIAS ? timeGrain : undefined\n            };\n          })\n        },\n        filterState: {\n          label: labelElements.join(', '),\n          value: groupByValues.length ? groupByValues : null,\n          filters: updatedFilters && Object.keys(updatedFilters).length ?\n          updatedFilters :\n          null\n        }\n      },\n      isCurrentValueSelected: isActiveFilterValue(key, value)\n    };\n  };\n  const toggleFilter = useCallback(function toggleFilter(key, val) {\n    if (!emitCrossFilters) {\n      return;\n    }\n    setDataMask(getCrossFilterDataMask(key, val).dataMask);\n  }, [emitCrossFilters, getCrossFilterDataMask, setDataMask]);\n  const getSharedStyle = (column) => {\n    const { isNumeric, config = {} } = column;\n    const textAlign = config.horizontalAlign || (\n    isNumeric && !isUsingTimeComparison ? 'right' : 'left');\n    return {\n      textAlign\n    };\n  };\n  const comparisonLabels = [t('Main'), '#', '△', '%'];\n  const filteredColumnsMeta = useMemo(() => {\n    if (!isUsingTimeComparison) {\n      return columnsMeta;\n    }\n    const allColumns = comparisonColumns[0].key;\n    const main = comparisonLabels[0];\n    const showAllColumns = selectedComparisonColumns.includes(allColumns);\n    return columnsMeta.filter(({ label, key }) => {\n      // Extract the key portion after the space, assuming the format is always \"label key\"\n      const keyPortion = key.substring(label.length);\n      const isKeyHidded = hideComparisonKeys.includes(keyPortion);\n      const isLableMain = label === main;\n      return isLableMain ||\n      !isKeyHidded && (\n      !comparisonLabels.includes(label) ||\n      showAllColumns ||\n      selectedComparisonColumns.includes(label));\n    });\n  }, [\n  columnsMeta,\n  comparisonColumns,\n  comparisonLabels,\n  isUsingTimeComparison,\n  hideComparisonKeys,\n  selectedComparisonColumns]\n  );\n  const handleContextMenu = onContextMenu && !isRawRecords ?\n  (value, cellPoint, clientX, clientY) => {\n    const drillToDetailFilters = [];\n    filteredColumnsMeta.forEach((col) => {\n      if (!col.isMetric) {\n        const dataRecordValue = value[col.key];\n        drillToDetailFilters.push({\n          col: col.key,\n          op: '==',\n          val: dataRecordValue,\n          formattedVal: formatColumnValue(col, dataRecordValue)[1]\n        });\n      }\n    });\n    onContextMenu(clientX, clientY, {\n      drillToDetail: drillToDetailFilters,\n      crossFilter: cellPoint.isMetric ?\n      undefined :\n      getCrossFilterDataMask(cellPoint.key, cellPoint.value),\n      drillBy: cellPoint.isMetric ?\n      undefined :\n      {\n        filters: [\n        {\n          col: cellPoint.key,\n          op: '==',\n          val: cellPoint.value\n        }],\n\n        groupbyFieldName: 'groupby'\n      }\n    });\n  } :\n  undefined;\n  const getHeaderColumns = (columnsMeta, enableTimeComparison) => {\n    const resultMap = {};\n    if (!enableTimeComparison) {\n      return resultMap;\n    }\n    columnsMeta.forEach((element, index) => {\n      // Check if element's label is one of the comparison labels\n      if (comparisonLabels.includes(element.label)) {\n        // Extract the key portion after the space, assuming the format is always \"label key\"\n        const keyPortion = element.key.substring(element.label.length);\n        // If the key portion is not in the map, initialize it with the current index\n        if (!resultMap[keyPortion]) {\n          resultMap[keyPortion] = [index];\n        } else\n        {\n          // Add the index to the existing array\n          resultMap[keyPortion].push(index);\n        }\n      }\n    });\n    return resultMap;\n  };\n  const renderTimeComparisonDropdown = () => {\n    const allKey = comparisonColumns[0].key;\n    const handleOnClick = (data) => {\n      const { key } = data;\n      // Toggle 'All' key selection\n      if (key === allKey) {\n        setSelectedComparisonColumns([allKey]);\n      } else\n      if (selectedComparisonColumns.includes(allKey)) {\n        setSelectedComparisonColumns([key]);\n      } else\n      {\n        // Toggle selection for other keys\n        setSelectedComparisonColumns(selectedComparisonColumns.includes(key) ?\n        selectedComparisonColumns.filter((k) => k !== key) // Deselect if already selected\n        : [...selectedComparisonColumns, key]); // Select if not already selected\n      }\n    };\n    const handleOnBlur = () => {\n      if (selectedComparisonColumns.length === 3) {\n        setSelectedComparisonColumns([comparisonColumns[0].key]);\n      }\n    };\n    return _jsx(Dropdown, { placement: \"bottomRight\", visible: showComparisonDropdown, onVisibleChange: (flag) => {\n        setShowComparisonDropdown(flag);\n      }, overlay: _jsxs(Menu, { multiple: true, onClick: handleOnClick, onBlur: handleOnBlur, selectedKeys: selectedComparisonColumns, children: [\n        _jsx(\"div\", { css: css`\n                max-width: 242px;\n                padding: 0 ${theme.gridUnit * 2}px;\n                color: ${theme.colors.grayscale.base};\n                font-size: ${theme.typography.sizes.s}px;\n              `, children:\n          t('Select columns that will be displayed in the table. You can multiselect columns.') }\n        ),\n        comparisonColumns.map((column) => _jsxs(Menu.Item, { children: [\n          _jsx(\"span\", { css: css`\n                    color: ${theme.colors.grayscale.dark2};\n                  `, children:\n            column.label }\n          ),\n          _jsx(\"span\", { css: css`\n                    float: right;\n                    font-size: ${theme.typography.sizes.s}px;\n                  `, children:\n            selectedComparisonColumns.includes(column.key) && _jsx(CheckOutlined, {}) }\n          )] }, column.key\n        ))] }\n      ), trigger: ['click'], children:\n      _jsxs(\"span\", { children: [\n        _jsx(TableOutlined, {}), \" \", _jsx(DownOutlined, {})] }\n      ) }\n    );\n  };\n  const renderGroupingHeaders = () => {\n    // TODO: Make use of ColumnGroup to render the aditional headers\n    const headers = [];\n    let currentColumnIndex = 0;\n    Object.entries(groupHeaderColumns || {}).forEach(([key, value]) => {var _columnsMeta$value$;\n      // Calculate the number of placeholder columns needed before the current header\n      const startPosition = value[0];\n      const colSpan = value.length;\n      // Retrieve the originalLabel from the first column in this group\n      const originalLabel = ((_columnsMeta$value$ = columnsMeta[value[0]]) == null ? void 0 : _columnsMeta$value$.originalLabel) || key;\n      // Add placeholder <th> for columns before this header\n      for (let i = currentColumnIndex; i < startPosition; i += 1) {\n        headers.push(_jsx(\"th\", { style: { borderBottom: 0 }, \"aria-label\": `Header-${i}` }, `placeholder-${i}`));\n      }\n      // Add the current header <th>\n      headers.push(_jsxs(\"th\", { colSpan: colSpan, style: { borderBottom: 0 }, children: [\n        originalLabel,\n        _jsx(\"span\", { css: css`\n              float: right;\n              & svg {\n                color: ${theme.colors.grayscale.base} !important;\n              }\n            `, children:\n          hideComparisonKeys.includes(key) ? _jsx(PlusCircleOutlined, { onClick: () => setHideComparisonKeys(hideComparisonKeys.filter((k) => k !== key)) }) : _jsx(MinusCircleOutlined, { onClick: () => setHideComparisonKeys([...hideComparisonKeys, key]) }) }\n        )] }, `header-${key}`\n      ));\n      // Update the current column index\n      currentColumnIndex = startPosition + colSpan;\n    });\n    return _jsx(\"tr\", { css: css`\n          th {\n            border-right: 2px solid ${theme.colors.grayscale.light2};\n          }\n          th:first-child {\n            border-left: none;\n          }\n          th:last-child {\n            border-right: none;\n          }\n        `, children:\n      headers }\n    );\n  };\n  const groupHeaderColumns = useMemo(() => getHeaderColumns(filteredColumnsMeta, isUsingTimeComparison), [filteredColumnsMeta, isUsingTimeComparison]);\n  const getColumnConfigs = useCallback((column, i) => {\n    const { key, label: originalLabel, isNumeric, dataType, isMetric, isPercentMetric, config = {} } = column;\n    const label = config.customColumnName || originalLabel;\n    let displayLabel = label;\n    const isComparisonColumn = ['#', '△', '%', t('Main')].includes(column.label);\n    if (isComparisonColumn) {\n      if (column.label === t('Main')) {\n        displayLabel = config.customColumnName || column.originalLabel || '';\n      } else\n      if (config.customColumnName) {\n        displayLabel =\n        config.displayTypeIcon !== false ?\n        `${column.label} ${config.customColumnName}` :\n        config.customColumnName;\n      } else\n      if (config.displayTypeIcon === false) {\n        displayLabel = '';\n      }\n    }\n    const columnWidth = Number.isNaN(Number(config.columnWidth)) ?\n    config.columnWidth :\n    Number(config.columnWidth);\n    // inline style for both th and td cell\n    const sharedStyle = getSharedStyle(column);\n    const alignPositiveNegative = config.alignPositiveNegative === undefined ?\n    defaultAlignPN :\n    config.alignPositiveNegative;\n    const colorPositiveNegative = config.colorPositiveNegative === undefined ?\n    defaultColorPN :\n    config.colorPositiveNegative;\n    const { truncateLongCells } = config;\n    const hasColumnColorFormatters = isNumeric &&\n    Array.isArray(columnColorFormatters) &&\n    columnColorFormatters.length > 0;\n    const hasBasicColorFormatters = isUsingTimeComparison &&\n    Array.isArray(basicColorFormatters) &&\n    basicColorFormatters.length > 0;\n    const valueRange = !hasBasicColorFormatters &&\n    !hasColumnColorFormatters && (\n    config.showCellBars === undefined ?\n    showCellBars :\n    config.showCellBars) && (\n    isMetric || isRawRecords || isPercentMetric) &&\n    getValueRange(key, alignPositiveNegative);\n    let className = '';\n    if (emitCrossFilters && !isMetric) {\n      className += ' dt-is-filter';\n    }\n    if (!isMetric && !isPercentMetric) {\n      className += ' right-border-only';\n    } else\n    if (comparisonLabels.includes(label)) {\n      const groupinHeader = key.substring(label.length);\n      const columnsUnderHeader = groupHeaderColumns[groupinHeader] || [];\n      if (i === columnsUnderHeader[columnsUnderHeader.length - 1]) {\n        className += ' right-border-only';\n      }\n    }\n    return {\n      id: String(i),\n      // must use custom accessor to allow `.` in column names\n      // typing is incorrect in current version of `@types/react-table`\n      // so we ask TS not to check.\n      accessor: (datum) => datum[key],\n      Cell: ({ value, row }) => {var _basicColorFormatters3;\n        const [isHtml, text] = formatColumnValue(column, value);\n        const html = isHtml && allowRenderHtml ? { __html: text } : undefined;\n        let backgroundColor;\n        let arrow = '';\n        const originKey = column.key.substring(column.label.length).trim();\n        if (!hasColumnColorFormatters && hasBasicColorFormatters) {var _basicColorFormatters, _basicColorFormatters2;\n          backgroundColor = (_basicColorFormatters =\n          basicColorFormatters[row.index][originKey]) == null ? void 0 : _basicColorFormatters.backgroundColor;\n          arrow =\n          column.label === comparisonLabels[0] ? (_basicColorFormatters2 =\n          basicColorFormatters[row.index][originKey]) == null ? void 0 : _basicColorFormatters2.mainArrow :\n          '';\n        }\n        if (hasColumnColorFormatters) {\n          columnColorFormatters.\n          filter((formatter) => formatter.column === column.key).\n          forEach((formatter) => {\n            const formatterResult = value || value === 0 ?\n            formatter.getColorFromValue(value) :\n            false;\n            if (formatterResult) {\n              backgroundColor = formatterResult;\n            }\n          });\n        }\n        if (basicColorColumnFormatters &&\n        (basicColorColumnFormatters == null ? void 0 : basicColorColumnFormatters.length) > 0) {var _basicColorColumnForm, _basicColorColumnForm2;\n          backgroundColor =\n          ((_basicColorColumnForm = basicColorColumnFormatters[row.index][column.key]) == null ? void 0 : _basicColorColumnForm.\n          backgroundColor) || backgroundColor;\n          arrow =\n          column.label === comparisonLabels[0] ? (_basicColorColumnForm2 =\n          basicColorColumnFormatters[row.index][column.key]) == null ? void 0 : _basicColorColumnForm2.mainArrow :\n          '';\n        }\n        const StyledCell = styled.td`\n            text-align: ${sharedStyle.textAlign};\n            white-space: ${value instanceof Date ? 'nowrap' : undefined};\n            position: relative;\n            background: ${backgroundColor || undefined};\n            padding-left: ${column.isChildColumn ?\n        `${theme.gridUnit * 5}px` :\n        `${theme.gridUnit}px`};\n          `;\n        const cellBarStyles = css`\n            position: absolute;\n            height: 100%;\n            display: block;\n            top: 0;\n            ${valueRange &&\n        `\n                width: ${`${cellWidth({\n          value: value,\n          valueRange,\n          alignPositiveNegative\n        })}%`};\n                left: ${`${cellOffset({\n          value: value,\n          valueRange,\n          alignPositiveNegative\n        })}%`};\n                background-color: ${cellBackground({\n          value: value,\n          colorPositiveNegative\n        })};\n              `}\n          `;\n        let arrowStyles = css`\n            color: ${basicColorFormatters &&\n        ((_basicColorFormatters3 = basicColorFormatters[row.index][originKey]) == null ? void 0 : _basicColorFormatters3.arrowColor) ===\n        ColorSchemeEnum.Green ?\n        theme.colors.success.base :\n        theme.colors.error.base};\n            margin-right: ${theme.gridUnit}px;\n          `;\n        if (basicColorColumnFormatters &&\n        (basicColorColumnFormatters == null ? void 0 : basicColorColumnFormatters.length) > 0) {var _basicColorColumnForm3;\n          arrowStyles = css`\n              color: ${((_basicColorColumnForm3 = basicColorColumnFormatters[row.index][column.key]) == null ? void 0 : _basicColorColumnForm3.\n          arrowColor) === ColorSchemeEnum.Green ?\n          theme.colors.success.base :\n          theme.colors.error.base};\n              margin-right: ${theme.gridUnit}px;\n            `;\n        }\n        const cellProps = {\n          'aria-labelledby': `header-${column.key}`,\n          role: 'cell',\n          // show raw number in title in case of numeric values\n          title: typeof value === 'number' ? String(value) : undefined,\n          onClick: emitCrossFilters && !valueRange && !isMetric ?\n          () => {\n            // allow selecting text in a cell\n            if (!getSelectedText()) {\n              toggleFilter(key, value);\n            }\n          } :\n          undefined,\n          onContextMenu: (e) => {\n            if (handleContextMenu) {\n              e.preventDefault();\n              e.stopPropagation();\n              handleContextMenu(row.original, { key, value, isMetric }, e.nativeEvent.clientX, e.nativeEvent.clientY);\n            }\n          },\n          className: [\n          className,\n          value == null ? 'dt-is-null' : '',\n          isActiveFilterValue(key, value) ? ' dt-is-active-filter' : ''].\n          join(' '),\n          tabIndex: 0\n        };\n        if (html) {\n          if (truncateLongCells) {\n            // eslint-disable-next-line react/no-danger\n            return _jsx(StyledCell, { ...cellProps, children:\n              _jsx(\"div\", { className: \"dt-truncate-cell\", style: columnWidth ? { width: columnWidth } : undefined, dangerouslySetInnerHTML: html }) }\n            );\n          }\n          // eslint-disable-next-line react/no-danger\n          return _jsx(StyledCell, { ...cellProps, dangerouslySetInnerHTML: html });\n        }\n        // If cellProps renders textContent already, then we don't have to\n        // render `Cell`. This saves some time for large tables.\n        return _jsxs(StyledCell, { ...cellProps, children: [\n          valueRange && _jsx(\"div\", {\n            /* The following classes are added to support custom CSS styling */\n            className: cx('cell-bar', typeof value === 'number' && value < 0 ?\n            'negative' :\n            'positive'), css: cellBarStyles, role: \"presentation\" }),\n          truncateLongCells ? _jsxs(\"div\", { className: \"dt-truncate-cell\", style: columnWidth ? { width: columnWidth } : undefined, children: [\n            arrow && _jsx(\"span\", { css: arrowStyles, children: arrow }),\n            text] }\n          ) : _jsxs(_Fragment, { children: [\n            arrow && _jsx(\"span\", { css: arrowStyles, children: arrow }),\n            text] }\n          )] }\n        );\n      },\n      Header: ({ column: col, onClick, style, onDragStart, onDrop }) => _jsxs(\"th\", { id: `header-${column.key}`, title: t('Shift + Click to sort by multiple columns'), className: [className, col.isSorted ? 'is-sorted' : ''].join(' '), style: {\n          ...sharedStyle,\n          ...style\n        }, onKeyDown: (e) => {\n          // programatically sort column on keypress\n          if (Object.values(ACTION_KEYS).includes(e.key)) {\n            col.toggleSortBy();\n          }\n        }, role: \"columnheader button\", onClick: onClick, \"data-column-name\": col.id, ...(allowRearrangeColumns && {\n          draggable: 'true',\n          onDragStart,\n          onDragOver: (e) => e.preventDefault(),\n          onDragEnter: (e) => e.preventDefault(),\n          onDrop\n        }), tabIndex: 0, children: [\n\n        config.columnWidth ?\n        // column width hint\n        _jsx(\"div\", { style: {\n            width: columnWidth,\n            height: 0.01\n          } }) : null,\n        _jsxs(\"div\", { \"data-column-name\": col.id, css: _ref, children: [\n\n\n\n          _jsx(\"span\", { \"data-column-name\": col.id, children: displayLabel }),\n          _jsx(SortIcon, { column: col })] }\n        )] }\n      ),\n      Footer: totals ? i === 0 ? _jsx(\"th\", { children:\n        _jsxs(\"div\", { css: css`\n                  display: flex;\n                  align-items: center;\n                  & svg {\n                    margin-left: ${theme.gridUnit}px;\n                    color: ${theme.colors.grayscale.dark1} !important;\n                  }\n                `, children: [\n          t('Summary'),\n          _jsx(Tooltip, { overlay: t('Show total aggregations of selected metrics. Note that row limit does not apply to the result.'), children:\n            _jsx(InfoCircleOutlined, {}) }\n          )] }\n        ) }, `footer-summary-${i}`\n      ) : _jsx(\"td\", { style: sharedStyle, children:\n        _jsx(\"strong\", { children: formatColumnValue(column, totals[key])[1] }) }, `footer-total-${i}`\n      ) : undefined,\n      sortDescFirst: sortDesc,\n      sortType: getSortTypeByDataType(dataType)\n    };\n  }, [\n  defaultAlignPN,\n  defaultColorPN,\n  emitCrossFilters,\n  getValueRange,\n  isActiveFilterValue,\n  isRawRecords,\n  showCellBars,\n  sortDesc,\n  toggleFilter,\n  totals,\n  columnColorFormatters,\n  columnOrderToggle]\n  );\n  const visibleColumnsMeta = useMemo(() => filteredColumnsMeta.filter((col) => {var _col$config;return ((_col$config = col.config) == null ? void 0 : _col$config.visible) !== false;}), [filteredColumnsMeta]);\n  const columns = useMemo(() => visibleColumnsMeta.map(getColumnConfigs), [visibleColumnsMeta, getColumnConfigs]);\n  const handleServerPaginationChange = useCallback((pageNumber, pageSize) => {\n    updateExternalFormData(setDataMask, pageNumber, pageSize);\n  }, [setDataMask]);\n  const handleSizeChange = useCallback(({ width, height }) => {\n    setTableSize({ width, height });\n  }, []);\n  useLayoutEffect(() => {\n    // After initial load the table should resize only when the new sizes\n    // Are not only scrollbar updates, otherwise, the table would twitch\n    const scrollBarSize = getScrollBarSize();\n    const { width: tableWidth, height: tableHeight } = tableSize;\n    // Table is increasing its original size\n    if (width - tableWidth > scrollBarSize ||\n    height - tableHeight > scrollBarSize) {\n      handleSizeChange({\n        width: width - scrollBarSize,\n        height: height - scrollBarSize\n      });\n    } else\n    if (tableWidth - width > scrollBarSize ||\n    tableHeight - height > scrollBarSize) {\n      // Table is decreasing its original size\n      handleSizeChange({\n        width,\n        height\n      });\n    }\n  }, [width, height, handleSizeChange, tableSize]);\n  const { width: widthFromState, height: heightFromState } = tableSize;\n  return _jsx(Styles, { children:\n    _jsx(DataTable, { columns: columns, data: data, rowCount: rowCount, tableClassName: \"table table-striped table-condensed\", pageSize: pageSize, serverPaginationData: serverPaginationData, pageSizeOptions: pageSizeOptions, width: widthFromState, height: heightFromState, serverPagination: serverPagination, onServerPaginationChange: handleServerPaginationChange, onColumnOrderChange: () => setColumnOrderToggle(!columnOrderToggle)\n      // 9 page items in > 340px works well even for 100+ pages\n      , maxPageItemCount: width > 340 ? 9 : 7, noResults: getNoResultsMessage, searchInput: includeSearch && SearchInput, selectPageSize: pageSize !== null && SelectPageSize\n      // not in use in Superset, but needed for unit tests\n      , sticky: sticky, renderGroupingHeaders: !_isEmpty(groupHeaderColumns) ? renderGroupingHeaders : undefined, renderTimeComparisonDropdown: isUsingTimeComparison ? renderTimeComparisonDropdown : undefined }) }\n  );\n}__signature__(TableChart, \"useCallback{timestampFormatter}\\nuseState{[tableSize, setTableSize]({\\n        width: 0,\\n        height: 0,\\n    })}\\nuseState{[columnOrderToggle, setColumnOrderToggle](false)}\\nuseState{[showComparisonDropdown, setShowComparisonDropdown](false)}\\nuseState{[selectedComparisonColumns, setSelectedComparisonColumns]([\\n        comparisonColumns[0].key,\\n    ])}\\nuseState{[hideComparisonKeys, setHideComparisonKeys]([])}\\nuseTheme{theme}\\nuseMemo{pageSizeOptions}\\nuseCallback{getValueRange}\\nuseCallback{isActiveFilterValue}\\nuseCallback{toggleFilter}\\nuseMemo{filteredColumnsMeta}\\nuseMemo{groupHeaderColumns}\\nuseCallback{getColumnConfigs}\\nuseMemo{visibleColumnsMeta}\\nuseMemo{columns}\\nuseCallback{handleServerPaginationChange}\\nuseCallback{handleSizeChange}\\nuseLayoutEffect{}\", () => [useTheme]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(ACTION_KEYS, \"ACTION_KEYS\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(getSortTypeByDataType, \"getSortTypeByDataType\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(cellWidth, \"cellWidth\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(cellOffset, \"cellOffset\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(cellBackground, \"cellBackground\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(SortIcon, \"SortIcon\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(SearchInput, \"SearchInput\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(SelectPageSize, \"SelectPageSize\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(getNoResultsMessage, \"getNoResultsMessage\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");reactHotLoader.register(TableChart, \"TableChart\", \"/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useCallback","useLayoutEffect","useMemo","useState","extent","d3Extent","max","d3Max","FaSort","FaSortDown","FaSortDesc","FaSortUp","FaSortAsc","cx","DTTM_ALIAS","ensureIsArray","GenericDataType","getSelectedText","getTimeFormatterForGranularity","styled","css","t","tn","useTheme","Dropdown","Menu","Tooltip","CheckOutlined","InfoCircleOutlined","DownOutlined","MinusCircleOutlined","PlusCircleOutlined","TableOutlined","ColorSchemeEnum","DataTable","Styles","formatColumnValue","PAGE_SIZE_OPTIONS","updateExternalFormData","getScrollBarSize","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ACTION_KEYS","enter","spacebar","space","getSortTypeByDataType","dataType","Temporal","String","cellWidth","value","valueRange","alignPositiveNegative","minValue","maxValue","perc","Math","abs","round","posExtent","negExtent","min","tot","perc2","cellOffset","cellBackground","colorPositiveNegative","r","SortIcon","column","isSorted","isSortedDesc","sortIcon","SearchInput","count","onChange","className","children","placeholder","SelectPageSize","options","current","role","htmlFor","id","e","Number","target","map","option","size","text","Array","isArray","getNoResultsMessage","filter","_ref","process","env","NODE_ENV","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","TableChart","props","timeGrain","height","width","data","totals","isRawRecords","rowCount","columns","columnsMeta","defaultAlignPN","defaultColorPN","includeSearch","pageSize","serverPagination","serverPaginationData","setDataMask","showCellBars","sortDesc","filters","sticky","columnColorFormatters","allowRearrangeColumns","allowRenderHtml","onContextMenu","emitCrossFilters","isUsingTimeComparison","basicColorFormatters","basicColorColumnFormatters","comparisonColumns","key","label","timestampFormatter","tableSize","setTableSize","columnOrderToggle","setColumnOrderToggle","showComparisonDropdown","setShowComparisonDropdown","selectedComparisonColumns","setSelectedComparisonColumns","hideComparisonKeys","setHideComparisonKeys","theme","pageSizeOptions","getServerPagination","n","length","getValueRange","_data$","nums","row","isActiveFilterValue","val","_filters$key","includes","getCrossFilterDataMask","updatedFilters","groupBy","Object","keys","groupByValues","values","labelElements","forEach","col","_updatedFilters","isTimestamp","filterValues","valueLabels","push","join","dataMask","extraFormData","_updatedFilters2","op","el","Date","getTime","grain","undefined","filterState","isCurrentValueSelected","toggleFilter","getSharedStyle","isNumeric","config","textAlign","horizontalAlign","comparisonLabels","filteredColumnsMeta","allColumns","main","showAllColumns","keyPortion","substring","isKeyHidded","isLableMain","handleContextMenu","cellPoint","clientX","clientY","drillToDetailFilters","isMetric","dataRecordValue","formattedVal","drillToDetail","crossFilter","drillBy","groupbyFieldName","getHeaderColumns","enableTimeComparison","resultMap","element","index","renderTimeComparisonDropdown","allKey","handleOnClick","k","handleOnBlur","placement","visible","onVisibleChange","flag","overlay","multiple","onClick","onBlur","selectedKeys","gridUnit","colors","grayscale","base","typography","sizes","s","Item","dark2","trigger","renderGroupingHeaders","headers","currentColumnIndex","entries","groupHeaderColumns","_columnsMeta$value$","startPosition","colSpan","originalLabel","i","style","borderBottom","light2","getColumnConfigs","isPercentMetric","customColumnName","displayLabel","isComparisonColumn","displayTypeIcon","columnWidth","isNaN","sharedStyle","truncateLongCells","hasColumnColorFormatters","hasBasicColorFormatters","groupinHeader","columnsUnderHeader","accessor","datum","Cell","_basicColorFormatters3","isHtml","html","__html","backgroundColor","arrow","originKey","trim","_basicColorFormatters","_basicColorFormatters2","mainArrow","formatter","formatterResult","getColorFromValue","_basicColorColumnForm","_basicColorColumnForm2","StyledCell","td","isChildColumn","cellBarStyles","arrowStyles","arrowColor","Green","success","error","_basicColorColumnForm3","cellProps","title","preventDefault","stopPropagation","original","nativeEvent","tabIndex","dangerouslySetInnerHTML","Header","onDragStart","onDrop","onKeyDown","toggleSortBy","draggable","onDragOver","onDragEnter","Footer","dark1","sortDescFirst","sortType","visibleColumnsMeta","_col$config","handleServerPaginationChange","pageNumber","handleSizeChange","scrollBarSize","tableWidth","tableHeight","widthFromState","heightFromState","tableClassName","onServerPaginationChange","onColumnOrderChange","maxPageItemCount","noResults","searchInput","selectPageSize","_isEmpty","__signature__","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  CSSProperties,\n  useCallback,\n  useLayoutEffect,\n  useMemo,\n  useState,\n  MouseEvent,\n  KeyboardEvent as ReactKeyboardEvent,\n} from 'react';\n\nimport {\n  ColumnInstance,\n  ColumnWithLooseAccessor,\n  DefaultSortTypes,\n  Row,\n} from 'react-table';\nimport { extent as d3Extent, max as d3Max } from 'd3-array';\nimport { FaSort } from '@react-icons/all-files/fa/FaSort';\nimport { FaSortDown as FaSortDesc } from '@react-icons/all-files/fa/FaSortDown';\nimport { FaSortUp as FaSortAsc } from '@react-icons/all-files/fa/FaSortUp';\nimport cx from 'classnames';\nimport {\n  DataRecord,\n  DataRecordValue,\n  DTTM_ALIAS,\n  ensureIsArray,\n  GenericDataType,\n  getSelectedText,\n  getTimeFormatterForGranularity,\n  BinaryQueryObjectFilterClause,\n  styled,\n  css,\n  t,\n  tn,\n  useTheme,\n} from '@superset-ui/core';\nimport { Dropdown, Menu, Tooltip } from '@superset-ui/chart-controls';\nimport {\n  CheckOutlined,\n  InfoCircleOutlined,\n  DownOutlined,\n  MinusCircleOutlined,\n  PlusCircleOutlined,\n  TableOutlined,\n} from '@ant-design/icons';\nimport { isEmpty } from 'lodash';\nimport {\n  ColorSchemeEnum,\n  DataColumnMeta,\n  TableChartTransformedProps,\n} from './types';\nimport DataTable, {\n  DataTableProps,\n  SearchInputProps,\n  SelectPageSizeRendererProps,\n  SizeOption,\n} from './DataTable';\n\nimport Styles from './Styles';\nimport { formatColumnValue } from './utils/formatValue';\nimport { PAGE_SIZE_OPTIONS } from './consts';\nimport { updateExternalFormData } from './DataTable/utils/externalAPIs';\nimport getScrollBarSize from './DataTable/utils/getScrollBarSize';\n\ntype ValueRange = [number, number];\n\ninterface TableSize {\n  width: number;\n  height: number;\n}\n\nconst ACTION_KEYS = {\n  enter: 'Enter',\n  spacebar: 'Spacebar',\n  space: ' ',\n};\n\n/**\n * Return sortType based on data type\n */\nfunction getSortTypeByDataType(dataType: GenericDataType): DefaultSortTypes {\n  if (dataType === GenericDataType.Temporal) {\n    return 'datetime';\n  }\n  if (dataType === GenericDataType.String) {\n    return 'alphanumeric';\n  }\n  return 'basic';\n}\n\n/**\n * Cell background width calculation for horizontal bar chart\n */\nfunction cellWidth({\n  value,\n  valueRange,\n  alignPositiveNegative,\n}: {\n  value: number;\n  valueRange: ValueRange;\n  alignPositiveNegative: boolean;\n}) {\n  const [minValue, maxValue] = valueRange;\n  if (alignPositiveNegative) {\n    const perc = Math.abs(Math.round((value / maxValue) * 100));\n    return perc;\n  }\n  const posExtent = Math.abs(Math.max(maxValue, 0));\n  const negExtent = Math.abs(Math.min(minValue, 0));\n  const tot = posExtent + negExtent;\n  const perc2 = Math.round((Math.abs(value) / tot) * 100);\n  return perc2;\n}\n\n/**\n * Cell left margin (offset) calculation for horizontal bar chart elements\n * when alignPositiveNegative is not set\n */\nfunction cellOffset({\n  value,\n  valueRange,\n  alignPositiveNegative,\n}: {\n  value: number;\n  valueRange: ValueRange;\n  alignPositiveNegative: boolean;\n}) {\n  if (alignPositiveNegative) {\n    return 0;\n  }\n  const [minValue, maxValue] = valueRange;\n  const posExtent = Math.abs(Math.max(maxValue, 0));\n  const negExtent = Math.abs(Math.min(minValue, 0));\n  const tot = posExtent + negExtent;\n  return Math.round((Math.min(negExtent + value, negExtent) / tot) * 100);\n}\n\n/**\n * Cell background color calculation for horizontal bar chart\n */\nfunction cellBackground({\n  value,\n  colorPositiveNegative = false,\n}: {\n  value: number;\n  colorPositiveNegative: boolean;\n}) {\n  const r = colorPositiveNegative && value < 0 ? 150 : 0;\n  return `rgba(${r},0,0,0.2)`;\n}\n\nfunction SortIcon<D extends object>({ column }: { column: ColumnInstance<D> }) {\n  const { isSorted, isSortedDesc } = column;\n  let sortIcon = <FaSort />;\n  if (isSorted) {\n    sortIcon = isSortedDesc ? <FaSortDesc /> : <FaSortAsc />;\n  }\n  return sortIcon;\n}\n\nfunction SearchInput({ count, value, onChange }: SearchInputProps) {\n  return (\n    <span className=\"dt-global-filter\">\n      {t('Search')}{' '}\n      <input\n        aria-label={t('Search %s records', count)}\n        className=\"form-control input-sm\"\n        placeholder={tn('search.num_records', count)}\n        value={value}\n        onChange={onChange}\n      />\n    </span>\n  );\n}\n\nfunction SelectPageSize({\n  options,\n  current,\n  onChange,\n}: SelectPageSizeRendererProps) {\n  return (\n    <span\n      className=\"dt-select-page-size form-inline\"\n      role=\"group\"\n      aria-label={t('Select page size')}\n    >\n      <label htmlFor=\"pageSizeSelect\" className=\"sr-only\">\n        {t('Select page size')}\n      </label>\n      {t('Show')}{' '}\n      <select\n        id=\"pageSizeSelect\"\n        className=\"form-control input-sm\"\n        value={current}\n        onChange={e => {\n          onChange(Number((e.target as HTMLSelectElement).value));\n        }}\n        aria-label={t('Show entries per page')}\n      >\n        {options.map(option => {\n          const [size, text] = Array.isArray(option)\n            ? option\n            : [option, option];\n          return (\n            <option key={size} value={size}>\n              {text}\n            </option>\n          );\n        })}\n      </select>{' '}\n      {t('entries per page')}\n    </span>\n  );\n}\n\nconst getNoResultsMessage = (filter: string) =>\n  filter ? t('No matching records found') : t('No records found');\n\nexport default function TableChart<D extends DataRecord = DataRecord>(\n  props: TableChartTransformedProps<D> & {\n    sticky?: DataTableProps<D>['sticky'];\n  },\n) {\n  const {\n    timeGrain,\n    height,\n    width,\n    data,\n    totals,\n    isRawRecords,\n    rowCount = 0,\n    columns: columnsMeta,\n    alignPositiveNegative: defaultAlignPN = false,\n    colorPositiveNegative: defaultColorPN = false,\n    includeSearch = false,\n    pageSize = 0,\n    serverPagination = false,\n    serverPaginationData,\n    setDataMask,\n    showCellBars = true,\n    sortDesc = false,\n    filters,\n    sticky = true, // whether to use sticky header\n    columnColorFormatters,\n    allowRearrangeColumns = false,\n    allowRenderHtml = true,\n    onContextMenu,\n    emitCrossFilters,\n    isUsingTimeComparison,\n    basicColorFormatters,\n    basicColorColumnFormatters,\n  } = props;\n  const comparisonColumns = [\n    { key: 'all', label: t('Display all') },\n    { key: '#', label: '#' },\n    { key: '△', label: '△' },\n    { key: '%', label: '%' },\n  ];\n  const timestampFormatter = useCallback(\n    value => getTimeFormatterForGranularity(timeGrain)(value),\n    [timeGrain],\n  );\n  const [tableSize, setTableSize] = useState<TableSize>({\n    width: 0,\n    height: 0,\n  });\n  // keep track of whether column order changed, so that column widths can too\n  const [columnOrderToggle, setColumnOrderToggle] = useState(false);\n  const [showComparisonDropdown, setShowComparisonDropdown] = useState(false);\n  const [selectedComparisonColumns, setSelectedComparisonColumns] = useState([\n    comparisonColumns[0].key,\n  ]);\n  const [hideComparisonKeys, setHideComparisonKeys] = useState<string[]>([]);\n  const theme = useTheme();\n\n  // only take relevant page size options\n  const pageSizeOptions = useMemo(() => {\n    const getServerPagination = (n: number) => n <= rowCount;\n    return PAGE_SIZE_OPTIONS.filter(([n]) =>\n      serverPagination ? getServerPagination(n) : n <= 2 * data.length,\n    ) as SizeOption[];\n  }, [data.length, rowCount, serverPagination]);\n\n  const getValueRange = useCallback(\n    function getValueRange(key: string, alignPositiveNegative: boolean) {\n      if (typeof data?.[0]?.[key] === 'number') {\n        const nums = data.map(row => row[key]) as number[];\n        return (\n          alignPositiveNegative\n            ? [0, d3Max(nums.map(Math.abs))]\n            : d3Extent(nums)\n        ) as ValueRange;\n      }\n      return null;\n    },\n    [data],\n  );\n\n  const isActiveFilterValue = useCallback(\n    function isActiveFilterValue(key: string, val: DataRecordValue) {\n      return !!filters && filters[key]?.includes(val);\n    },\n    [filters],\n  );\n\n  const getCrossFilterDataMask = (key: string, value: DataRecordValue) => {\n    let updatedFilters = { ...(filters || {}) };\n    if (filters && isActiveFilterValue(key, value)) {\n      updatedFilters = {};\n    } else {\n      updatedFilters = {\n        [key]: [value],\n      };\n    }\n    if (\n      Array.isArray(updatedFilters[key]) &&\n      updatedFilters[key].length === 0\n    ) {\n      delete updatedFilters[key];\n    }\n\n    const groupBy = Object.keys(updatedFilters);\n    const groupByValues = Object.values(updatedFilters);\n    const labelElements: string[] = [];\n    groupBy.forEach(col => {\n      const isTimestamp = col === DTTM_ALIAS;\n      const filterValues = ensureIsArray(updatedFilters?.[col]);\n      if (filterValues.length) {\n        const valueLabels = filterValues.map(value =>\n          isTimestamp ? timestampFormatter(value) : value,\n        );\n        labelElements.push(`${valueLabels.join(', ')}`);\n      }\n    });\n\n    return {\n      dataMask: {\n        extraFormData: {\n          filters:\n            groupBy.length === 0\n              ? []\n              : groupBy.map(col => {\n                  const val = ensureIsArray(updatedFilters?.[col]);\n                  if (!val.length)\n                    return {\n                      col,\n                      op: 'IS NULL' as const,\n                    };\n                  return {\n                    col,\n                    op: 'IN' as const,\n                    val: val.map(el =>\n                      el instanceof Date ? el.getTime() : el!,\n                    ),\n                    grain: col === DTTM_ALIAS ? timeGrain : undefined,\n                  };\n                }),\n        },\n        filterState: {\n          label: labelElements.join(', '),\n          value: groupByValues.length ? groupByValues : null,\n          filters:\n            updatedFilters && Object.keys(updatedFilters).length\n              ? updatedFilters\n              : null,\n        },\n      },\n      isCurrentValueSelected: isActiveFilterValue(key, value),\n    };\n  };\n\n  const toggleFilter = useCallback(\n    function toggleFilter(key: string, val: DataRecordValue) {\n      if (!emitCrossFilters) {\n        return;\n      }\n      setDataMask(getCrossFilterDataMask(key, val).dataMask);\n    },\n    [emitCrossFilters, getCrossFilterDataMask, setDataMask],\n  );\n\n  const getSharedStyle = (column: DataColumnMeta): CSSProperties => {\n    const { isNumeric, config = {} } = column;\n    const textAlign =\n      config.horizontalAlign ||\n      (isNumeric && !isUsingTimeComparison ? 'right' : 'left');\n    return {\n      textAlign,\n    };\n  };\n\n  const comparisonLabels = [t('Main'), '#', '△', '%'];\n  const filteredColumnsMeta = useMemo(() => {\n    if (!isUsingTimeComparison) {\n      return columnsMeta;\n    }\n    const allColumns = comparisonColumns[0].key;\n    const main = comparisonLabels[0];\n    const showAllColumns = selectedComparisonColumns.includes(allColumns);\n\n    return columnsMeta.filter(({ label, key }) => {\n      // Extract the key portion after the space, assuming the format is always \"label key\"\n      const keyPortion = key.substring(label.length);\n      const isKeyHidded = hideComparisonKeys.includes(keyPortion);\n      const isLableMain = label === main;\n\n      return (\n        isLableMain ||\n        (!isKeyHidded &&\n          (!comparisonLabels.includes(label) ||\n            showAllColumns ||\n            selectedComparisonColumns.includes(label)))\n      );\n    });\n  }, [\n    columnsMeta,\n    comparisonColumns,\n    comparisonLabels,\n    isUsingTimeComparison,\n    hideComparisonKeys,\n    selectedComparisonColumns,\n  ]);\n\n  const handleContextMenu =\n    onContextMenu && !isRawRecords\n      ? (\n          value: D,\n          cellPoint: {\n            key: string;\n            value: DataRecordValue;\n            isMetric?: boolean;\n          },\n          clientX: number,\n          clientY: number,\n        ) => {\n          const drillToDetailFilters: BinaryQueryObjectFilterClause[] = [];\n          filteredColumnsMeta.forEach(col => {\n            if (!col.isMetric) {\n              const dataRecordValue = value[col.key];\n              drillToDetailFilters.push({\n                col: col.key,\n                op: '==',\n                val: dataRecordValue as string | number | boolean,\n                formattedVal: formatColumnValue(col, dataRecordValue)[1],\n              });\n            }\n          });\n          onContextMenu(clientX, clientY, {\n            drillToDetail: drillToDetailFilters,\n            crossFilter: cellPoint.isMetric\n              ? undefined\n              : getCrossFilterDataMask(cellPoint.key, cellPoint.value),\n            drillBy: cellPoint.isMetric\n              ? undefined\n              : {\n                  filters: [\n                    {\n                      col: cellPoint.key,\n                      op: '==',\n                      val: cellPoint.value as string | number | boolean,\n                    },\n                  ],\n                  groupbyFieldName: 'groupby',\n                },\n          });\n        }\n      : undefined;\n\n  const getHeaderColumns = (\n    columnsMeta: DataColumnMeta[],\n    enableTimeComparison?: boolean,\n  ) => {\n    const resultMap: Record<string, number[]> = {};\n\n    if (!enableTimeComparison) {\n      return resultMap;\n    }\n\n    columnsMeta.forEach((element, index) => {\n      // Check if element's label is one of the comparison labels\n      if (comparisonLabels.includes(element.label)) {\n        // Extract the key portion after the space, assuming the format is always \"label key\"\n        const keyPortion = element.key.substring(element.label.length);\n\n        // If the key portion is not in the map, initialize it with the current index\n        if (!resultMap[keyPortion]) {\n          resultMap[keyPortion] = [index];\n        } else {\n          // Add the index to the existing array\n          resultMap[keyPortion].push(index);\n        }\n      }\n    });\n\n    return resultMap;\n  };\n\n  const renderTimeComparisonDropdown = (): JSX.Element => {\n    const allKey = comparisonColumns[0].key;\n    const handleOnClick = (data: any) => {\n      const { key } = data;\n      // Toggle 'All' key selection\n      if (key === allKey) {\n        setSelectedComparisonColumns([allKey]);\n      } else if (selectedComparisonColumns.includes(allKey)) {\n        setSelectedComparisonColumns([key]);\n      } else {\n        // Toggle selection for other keys\n        setSelectedComparisonColumns(\n          selectedComparisonColumns.includes(key)\n            ? selectedComparisonColumns.filter(k => k !== key) // Deselect if already selected\n            : [...selectedComparisonColumns, key],\n        ); // Select if not already selected\n      }\n    };\n\n    const handleOnBlur = () => {\n      if (selectedComparisonColumns.length === 3) {\n        setSelectedComparisonColumns([comparisonColumns[0].key]);\n      }\n    };\n\n    return (\n      <Dropdown\n        placement=\"bottomRight\"\n        visible={showComparisonDropdown}\n        onVisibleChange={(flag: boolean) => {\n          setShowComparisonDropdown(flag);\n        }}\n        overlay={\n          <Menu\n            multiple\n            onClick={handleOnClick}\n            onBlur={handleOnBlur}\n            selectedKeys={selectedComparisonColumns}\n          >\n            <div\n              css={css`\n                max-width: 242px;\n                padding: 0 ${theme.gridUnit * 2}px;\n                color: ${theme.colors.grayscale.base};\n                font-size: ${theme.typography.sizes.s}px;\n              `}\n            >\n              {t(\n                'Select columns that will be displayed in the table. You can multiselect columns.',\n              )}\n            </div>\n            {comparisonColumns.map(column => (\n              <Menu.Item key={column.key}>\n                <span\n                  css={css`\n                    color: ${theme.colors.grayscale.dark2};\n                  `}\n                >\n                  {column.label}\n                </span>\n                <span\n                  css={css`\n                    float: right;\n                    font-size: ${theme.typography.sizes.s}px;\n                  `}\n                >\n                  {selectedComparisonColumns.includes(column.key) && (\n                    <CheckOutlined />\n                  )}\n                </span>\n              </Menu.Item>\n            ))}\n          </Menu>\n        }\n        trigger={['click']}\n      >\n        <span>\n          <TableOutlined /> <DownOutlined />\n        </span>\n      </Dropdown>\n    );\n  };\n\n  const renderGroupingHeaders = (): JSX.Element => {\n    // TODO: Make use of ColumnGroup to render the aditional headers\n    const headers: any = [];\n    let currentColumnIndex = 0;\n\n    Object.entries(groupHeaderColumns || {}).forEach(([key, value]) => {\n      // Calculate the number of placeholder columns needed before the current header\n      const startPosition = value[0];\n      const colSpan = value.length;\n      // Retrieve the originalLabel from the first column in this group\n      const originalLabel = columnsMeta[value[0]]?.originalLabel || key;\n\n      // Add placeholder <th> for columns before this header\n      for (let i = currentColumnIndex; i < startPosition; i += 1) {\n        headers.push(\n          <th\n            key={`placeholder-${i}`}\n            style={{ borderBottom: 0 }}\n            aria-label={`Header-${i}`}\n          />,\n        );\n      }\n\n      // Add the current header <th>\n      headers.push(\n        <th key={`header-${key}`} colSpan={colSpan} style={{ borderBottom: 0 }}>\n          {originalLabel}\n          <span\n            css={css`\n              float: right;\n              & svg {\n                color: ${theme.colors.grayscale.base} !important;\n              }\n            `}\n          >\n            {hideComparisonKeys.includes(key) ? (\n              <PlusCircleOutlined\n                onClick={() =>\n                  setHideComparisonKeys(\n                    hideComparisonKeys.filter(k => k !== key),\n                  )\n                }\n              />\n            ) : (\n              <MinusCircleOutlined\n                onClick={() =>\n                  setHideComparisonKeys([...hideComparisonKeys, key])\n                }\n              />\n            )}\n          </span>\n        </th>,\n      );\n\n      // Update the current column index\n      currentColumnIndex = startPosition + colSpan;\n    });\n\n    return (\n      <tr\n        css={css`\n          th {\n            border-right: 2px solid ${theme.colors.grayscale.light2};\n          }\n          th:first-child {\n            border-left: none;\n          }\n          th:last-child {\n            border-right: none;\n          }\n        `}\n      >\n        {headers}\n      </tr>\n    );\n  };\n\n  const groupHeaderColumns = useMemo(\n    () => getHeaderColumns(filteredColumnsMeta, isUsingTimeComparison),\n    [filteredColumnsMeta, isUsingTimeComparison],\n  );\n\n  const getColumnConfigs = useCallback(\n    (column: DataColumnMeta, i: number): ColumnWithLooseAccessor<D> => {\n      const {\n        key,\n        label: originalLabel,\n        isNumeric,\n        dataType,\n        isMetric,\n        isPercentMetric,\n        config = {},\n      } = column;\n      const label = config.customColumnName || originalLabel;\n      let displayLabel = label;\n\n      const isComparisonColumn = ['#', '△', '%', t('Main')].includes(\n        column.label,\n      );\n\n      if (isComparisonColumn) {\n        if (column.label === t('Main')) {\n          displayLabel = config.customColumnName || column.originalLabel || '';\n        } else if (config.customColumnName) {\n          displayLabel =\n            config.displayTypeIcon !== false\n              ? `${column.label} ${config.customColumnName}`\n              : config.customColumnName;\n        } else if (config.displayTypeIcon === false) {\n          displayLabel = '';\n        }\n      }\n\n      const columnWidth = Number.isNaN(Number(config.columnWidth))\n        ? config.columnWidth\n        : Number(config.columnWidth);\n\n      // inline style for both th and td cell\n      const sharedStyle: CSSProperties = getSharedStyle(column);\n\n      const alignPositiveNegative =\n        config.alignPositiveNegative === undefined\n          ? defaultAlignPN\n          : config.alignPositiveNegative;\n      const colorPositiveNegative =\n        config.colorPositiveNegative === undefined\n          ? defaultColorPN\n          : config.colorPositiveNegative;\n\n      const { truncateLongCells } = config;\n\n      const hasColumnColorFormatters =\n        isNumeric &&\n        Array.isArray(columnColorFormatters) &&\n        columnColorFormatters.length > 0;\n\n      const hasBasicColorFormatters =\n        isUsingTimeComparison &&\n        Array.isArray(basicColorFormatters) &&\n        basicColorFormatters.length > 0;\n\n      const valueRange =\n        !hasBasicColorFormatters &&\n        !hasColumnColorFormatters &&\n        (config.showCellBars === undefined\n          ? showCellBars\n          : config.showCellBars) &&\n        (isMetric || isRawRecords || isPercentMetric) &&\n        getValueRange(key, alignPositiveNegative);\n\n      let className = '';\n      if (emitCrossFilters && !isMetric) {\n        className += ' dt-is-filter';\n      }\n\n      if (!isMetric && !isPercentMetric) {\n        className += ' right-border-only';\n      } else if (comparisonLabels.includes(label)) {\n        const groupinHeader = key.substring(label.length);\n        const columnsUnderHeader = groupHeaderColumns[groupinHeader] || [];\n        if (i === columnsUnderHeader[columnsUnderHeader.length - 1]) {\n          className += ' right-border-only';\n        }\n      }\n\n      return {\n        id: String(i), // to allow duplicate column keys\n        // must use custom accessor to allow `.` in column names\n        // typing is incorrect in current version of `@types/react-table`\n        // so we ask TS not to check.\n        accessor: ((datum: D) => datum[key]) as never,\n        Cell: ({ value, row }: { value: DataRecordValue; row: Row<D> }) => {\n          const [isHtml, text] = formatColumnValue(column, value);\n          const html = isHtml && allowRenderHtml ? { __html: text } : undefined;\n\n          let backgroundColor;\n          let arrow = '';\n          const originKey = column.key.substring(column.label.length).trim();\n          if (!hasColumnColorFormatters && hasBasicColorFormatters) {\n            backgroundColor =\n              basicColorFormatters[row.index][originKey]?.backgroundColor;\n            arrow =\n              column.label === comparisonLabels[0]\n                ? basicColorFormatters[row.index][originKey]?.mainArrow\n                : '';\n          }\n\n          if (hasColumnColorFormatters) {\n            columnColorFormatters!\n              .filter(formatter => formatter.column === column.key)\n              .forEach(formatter => {\n                const formatterResult =\n                  value || value === 0\n                    ? formatter.getColorFromValue(value as number)\n                    : false;\n                if (formatterResult) {\n                  backgroundColor = formatterResult;\n                }\n              });\n          }\n\n          if (\n            basicColorColumnFormatters &&\n            basicColorColumnFormatters?.length > 0\n          ) {\n            backgroundColor =\n              basicColorColumnFormatters[row.index][column.key]\n                ?.backgroundColor || backgroundColor;\n            arrow =\n              column.label === comparisonLabels[0]\n                ? basicColorColumnFormatters[row.index][column.key]?.mainArrow\n                : '';\n          }\n\n          const StyledCell = styled.td`\n            text-align: ${sharedStyle.textAlign};\n            white-space: ${value instanceof Date ? 'nowrap' : undefined};\n            position: relative;\n            background: ${backgroundColor || undefined};\n            padding-left: ${column.isChildColumn\n              ? `${theme.gridUnit * 5}px`\n              : `${theme.gridUnit}px`};\n          `;\n\n          const cellBarStyles = css`\n            position: absolute;\n            height: 100%;\n            display: block;\n            top: 0;\n            ${valueRange &&\n            `\n                width: ${`${cellWidth({\n                  value: value as number,\n                  valueRange,\n                  alignPositiveNegative,\n                })}%`};\n                left: ${`${cellOffset({\n                  value: value as number,\n                  valueRange,\n                  alignPositiveNegative,\n                })}%`};\n                background-color: ${cellBackground({\n                  value: value as number,\n                  colorPositiveNegative,\n                })};\n              `}\n          `;\n\n          let arrowStyles = css`\n            color: ${basicColorFormatters &&\n            basicColorFormatters[row.index][originKey]?.arrowColor ===\n              ColorSchemeEnum.Green\n              ? theme.colors.success.base\n              : theme.colors.error.base};\n            margin-right: ${theme.gridUnit}px;\n          `;\n\n          if (\n            basicColorColumnFormatters &&\n            basicColorColumnFormatters?.length > 0\n          ) {\n            arrowStyles = css`\n              color: ${basicColorColumnFormatters[row.index][column.key]\n                ?.arrowColor === ColorSchemeEnum.Green\n                ? theme.colors.success.base\n                : theme.colors.error.base};\n              margin-right: ${theme.gridUnit}px;\n            `;\n          }\n\n          const cellProps = {\n            'aria-labelledby': `header-${column.key}`,\n            role: 'cell',\n            // show raw number in title in case of numeric values\n            title: typeof value === 'number' ? String(value) : undefined,\n            onClick:\n              emitCrossFilters && !valueRange && !isMetric\n                ? () => {\n                    // allow selecting text in a cell\n                    if (!getSelectedText()) {\n                      toggleFilter(key, value);\n                    }\n                  }\n                : undefined,\n            onContextMenu: (e: MouseEvent) => {\n              if (handleContextMenu) {\n                e.preventDefault();\n                e.stopPropagation();\n                handleContextMenu(\n                  row.original,\n                  { key, value, isMetric },\n                  e.nativeEvent.clientX,\n                  e.nativeEvent.clientY,\n                );\n              }\n            },\n            className: [\n              className,\n              value == null ? 'dt-is-null' : '',\n              isActiveFilterValue(key, value) ? ' dt-is-active-filter' : '',\n            ].join(' '),\n            tabIndex: 0,\n          };\n          if (html) {\n            if (truncateLongCells) {\n              // eslint-disable-next-line react/no-danger\n              return (\n                <StyledCell {...cellProps}>\n                  <div\n                    className=\"dt-truncate-cell\"\n                    style={columnWidth ? { width: columnWidth } : undefined}\n                    dangerouslySetInnerHTML={html}\n                  />\n                </StyledCell>\n              );\n            }\n            // eslint-disable-next-line react/no-danger\n            return <StyledCell {...cellProps} dangerouslySetInnerHTML={html} />;\n          }\n          // If cellProps renders textContent already, then we don't have to\n          // render `Cell`. This saves some time for large tables.\n          return (\n            <StyledCell {...cellProps}>\n              {valueRange && (\n                <div\n                  /* The following classes are added to support custom CSS styling */\n                  className={cx(\n                    'cell-bar',\n                    typeof value === 'number' && value < 0\n                      ? 'negative'\n                      : 'positive',\n                  )}\n                  css={cellBarStyles}\n                  role=\"presentation\"\n                />\n              )}\n              {truncateLongCells ? (\n                <div\n                  className=\"dt-truncate-cell\"\n                  style={columnWidth ? { width: columnWidth } : undefined}\n                >\n                  {arrow && <span css={arrowStyles}>{arrow}</span>}\n                  {text}\n                </div>\n              ) : (\n                <>\n                  {arrow && <span css={arrowStyles}>{arrow}</span>}\n                  {text}\n                </>\n              )}\n            </StyledCell>\n          );\n        },\n        Header: ({ column: col, onClick, style, onDragStart, onDrop }) => (\n          <th\n            id={`header-${column.key}`}\n            title={t('Shift + Click to sort by multiple columns')}\n            className={[className, col.isSorted ? 'is-sorted' : ''].join(' ')}\n            style={{\n              ...sharedStyle,\n              ...style,\n            }}\n            onKeyDown={(e: ReactKeyboardEvent<HTMLElement>) => {\n              // programatically sort column on keypress\n              if (Object.values(ACTION_KEYS).includes(e.key)) {\n                col.toggleSortBy();\n              }\n            }}\n            role=\"columnheader button\"\n            onClick={onClick}\n            data-column-name={col.id}\n            {...(allowRearrangeColumns && {\n              draggable: 'true',\n              onDragStart,\n              onDragOver: e => e.preventDefault(),\n              onDragEnter: e => e.preventDefault(),\n              onDrop,\n            })}\n            tabIndex={0}\n          >\n            {/* can't use `columnWidth &&` because it may also be zero */}\n            {config.columnWidth ? (\n              // column width hint\n              <div\n                style={{\n                  width: columnWidth,\n                  height: 0.01,\n                }}\n              />\n            ) : null}\n            <div\n              data-column-name={col.id}\n              css={{\n                display: 'inline-flex',\n                alignItems: 'flex-end',\n              }}\n            >\n              <span data-column-name={col.id}>{displayLabel}</span>\n              <SortIcon column={col} />\n            </div>\n          </th>\n        ),\n\n        Footer: totals ? (\n          i === 0 ? (\n            <th key={`footer-summary-${i}`}>\n              <div\n                css={css`\n                  display: flex;\n                  align-items: center;\n                  & svg {\n                    margin-left: ${theme.gridUnit}px;\n                    color: ${theme.colors.grayscale.dark1} !important;\n                  }\n                `}\n              >\n                {t('Summary')}\n                <Tooltip\n                  overlay={t(\n                    'Show total aggregations of selected metrics. Note that row limit does not apply to the result.',\n                  )}\n                >\n                  <InfoCircleOutlined />\n                </Tooltip>\n              </div>\n            </th>\n          ) : (\n            <td key={`footer-total-${i}`} style={sharedStyle}>\n              <strong>{formatColumnValue(column, totals[key])[1]}</strong>\n            </td>\n          )\n        ) : undefined,\n        sortDescFirst: sortDesc,\n        sortType: getSortTypeByDataType(dataType),\n      };\n    },\n    [\n      defaultAlignPN,\n      defaultColorPN,\n      emitCrossFilters,\n      getValueRange,\n      isActiveFilterValue,\n      isRawRecords,\n      showCellBars,\n      sortDesc,\n      toggleFilter,\n      totals,\n      columnColorFormatters,\n      columnOrderToggle,\n    ],\n  );\n\n  const visibleColumnsMeta = useMemo(\n    () => filteredColumnsMeta.filter(col => col.config?.visible !== false),\n    [filteredColumnsMeta],\n  );\n\n  const columns = useMemo(\n    () => visibleColumnsMeta.map(getColumnConfigs),\n    [visibleColumnsMeta, getColumnConfigs],\n  );\n\n  const handleServerPaginationChange = useCallback(\n    (pageNumber: number, pageSize: number) => {\n      updateExternalFormData(setDataMask, pageNumber, pageSize);\n    },\n    [setDataMask],\n  );\n\n  const handleSizeChange = useCallback(\n    ({ width, height }: { width: number; height: number }) => {\n      setTableSize({ width, height });\n    },\n    [],\n  );\n\n  useLayoutEffect(() => {\n    // After initial load the table should resize only when the new sizes\n    // Are not only scrollbar updates, otherwise, the table would twitch\n    const scrollBarSize = getScrollBarSize();\n    const { width: tableWidth, height: tableHeight } = tableSize;\n    // Table is increasing its original size\n    if (\n      width - tableWidth > scrollBarSize ||\n      height - tableHeight > scrollBarSize\n    ) {\n      handleSizeChange({\n        width: width - scrollBarSize,\n        height: height - scrollBarSize,\n      });\n    } else if (\n      tableWidth - width > scrollBarSize ||\n      tableHeight - height > scrollBarSize\n    ) {\n      // Table is decreasing its original size\n      handleSizeChange({\n        width,\n        height,\n      });\n    }\n  }, [width, height, handleSizeChange, tableSize]);\n\n  const { width: widthFromState, height: heightFromState } = tableSize;\n\n  return (\n    <Styles>\n      <DataTable<D>\n        columns={columns}\n        data={data}\n        rowCount={rowCount}\n        tableClassName=\"table table-striped table-condensed\"\n        pageSize={pageSize}\n        serverPaginationData={serverPaginationData}\n        pageSizeOptions={pageSizeOptions}\n        width={widthFromState}\n        height={heightFromState}\n        serverPagination={serverPagination}\n        onServerPaginationChange={handleServerPaginationChange}\n        onColumnOrderChange={() => setColumnOrderToggle(!columnOrderToggle)}\n        // 9 page items in > 340px works well even for 100+ pages\n        maxPageItemCount={width > 340 ? 9 : 7}\n        noResults={getNoResultsMessage}\n        searchInput={includeSearch && SearchInput}\n        selectPageSize={pageSize !== null && SelectPageSize}\n        // not in use in Superset, but needed for unit tests\n        sticky={sticky}\n        renderGroupingHeaders={\n          !isEmpty(groupHeaderColumns) ? renderGroupingHeaders : undefined\n        }\n        renderTimeComparisonDropdown={\n          isUsingTimeComparison ? renderTimeComparisonDropdown : undefined\n        }\n      />\n    </Styles>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}