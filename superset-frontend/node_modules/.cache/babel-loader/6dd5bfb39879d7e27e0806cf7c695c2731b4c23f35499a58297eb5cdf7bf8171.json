{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useRef, useMemo } from 'react';\nimport { Select } from 'src/components';\nimport { css, styled, t, useTheme } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\nimport { getColumnKeywords } from 'src/explore/controlUtils/getColumnKeywords';\nimport { Clauses, ExpressionTypes } from '../types';import { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\nexport default function AdhocFilterEditPopoverSqlTabContent({ adhocFilter, onChange, options, height }) {\n  const aceEditorRef = useRef(null);\n  const theme = useTheme();\n  useEffect(() => {var _aceEditorRef$current;\n    // @ts-ignore\n    aceEditorRef == null ? void 0 : (_aceEditorRef$current = aceEditorRef.current) == null ? void 0 : _aceEditorRef$current.editor.resize();\n  }, [adhocFilter]);\n  const onSqlExpressionClauseChange = (clause) => {\n    onChange(adhocFilter.duplicateWith({\n      clause,\n      expressionType: ExpressionTypes.Sql\n    }));\n  };\n  const onSqlExpressionChange = (sqlExpression) => {\n    onChange(adhocFilter.duplicateWith({\n      sqlExpression,\n      expressionType: ExpressionTypes.Sql\n    }));\n  };\n  const keywords = useMemo(() => sqlKeywords.concat(getColumnKeywords(options.filter((option) => typeof option === 'object' &&\n  option !== null &&\n  'column_name' in option &&\n  typeof option.column_name === 'string' &&\n  'type' in option))), [sqlKeywords]);\n  const selectOptions = useMemo(() => Object.values(Clauses).map((clause) => ({\n    label: clause,\n    value: clause\n  })), [Clauses]);\n  return _jsxs(\"span\", { children: [\n    _jsxs(\"div\", { className: \"filter-edit-clause-section\", children: [\n      _jsx(\"div\", { children:\n        _jsx(StyledSelect, { options: selectOptions, ariaLabel: t('Select column'), placeholder: t('choose WHERE or HAVING...'), value: adhocFilter.clause, onChange: onSqlExpressionClauseChange }) }\n      ),\n      _jsxs(\"span\", { className: \"filter-edit-clause-info\", children: [\n        _jsx(\"strong\", { children: \"WHERE\" }), \" \", t('Filters by columns'),\n        _jsx(\"br\", {}),\n        _jsx(\"strong\", { children: \"HAVING\" }), \" \", t('Filters by metrics')] }\n      )] }\n    ),\n    _jsx(\"div\", { css: css`\n          margin-top: ${theme.gridUnit * 4}px;\n        `, children:\n      _jsx(SQLEditor, { ref: aceEditorRef, keywords: keywords, height: `${height - 130}px`, onChange: onSqlExpressionChange, width: \"100%\", showGutter: false, value: adhocFilter.sqlExpression || adhocFilter.translateToSql(), editorProps: { $blockScrolling: true }, enableLiveAutocompletion: true, className: \"filter-sql-editor\", wrapEnabled: true }) }\n    )] }\n  );\n}__signature__(AdhocFilterEditPopoverSqlTabContent, \"useRef{aceEditorRef}\\nuseTheme{theme}\\nuseEffect{}\\nuseMemo{keywords}\\nuseMemo{selectOptions}\", () => [useTheme]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(StyledSelect, \"StyledSelect\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.tsx\");reactHotLoader.register(AdhocFilterEditPopoverSqlTabContent, \"AdhocFilterEditPopoverSqlTabContent\", \"/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useEffect","useRef","useMemo","Select","css","styled","t","useTheme","SQLEditor","sqlKeywords","getColumnKeywords","Clauses","ExpressionTypes","jsx","_jsx","jsxs","_jsxs","StyledSelect","theme","gridUnit","AdhocFilterEditPopoverSqlTabContent","adhocFilter","onChange","options","height","aceEditorRef","_aceEditorRef$current","current","editor","resize","onSqlExpressionClauseChange","clause","duplicateWith","expressionType","Sql","onSqlExpressionChange","sqlExpression","keywords","concat","filter","option","column_name","selectOptions","Object","values","map","label","value","children","className","ariaLabel","placeholder","ref","width","showGutter","translateToSql","editorProps","$blockScrolling","enableLiveAutocompletion","wrapEnabled","__signature__","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/Users/aryurkov/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useRef, useMemo } from 'react';\nimport { Select } from 'src/components';\nimport { css, styled, t, useTheme } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\nimport { getColumnKeywords } from 'src/explore/controlUtils/getColumnKeywords';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { OptionSortType } from 'src/explore/types';\nimport { ColumnMeta } from '@superset-ui/chart-controls';\nimport { Clauses, ExpressionTypes } from '../types';\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default function AdhocFilterEditPopoverSqlTabContent({\n  adhocFilter,\n  onChange,\n  options,\n  height,\n}: {\n  adhocFilter: AdhocFilter;\n  onChange: (filter: AdhocFilter) => void;\n  options: OptionSortType[];\n  height: number;\n}) {\n  const aceEditorRef = useRef(null);\n  const theme = useTheme();\n\n  useEffect(() => {\n    // @ts-ignore\n    aceEditorRef?.current?.editor.resize();\n  }, [adhocFilter]);\n\n  const onSqlExpressionClauseChange = (clause: string) => {\n    onChange(\n      adhocFilter.duplicateWith({\n        clause,\n        expressionType: ExpressionTypes.Sql,\n      }),\n    );\n  };\n\n  const onSqlExpressionChange = (sqlExpression: string) => {\n    onChange(\n      adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: ExpressionTypes.Sql,\n      }),\n    );\n  };\n\n  const keywords = useMemo(\n    () =>\n      sqlKeywords.concat(\n        getColumnKeywords(\n          options.filter(\n            (option): option is ColumnMeta =>\n              typeof option === 'object' &&\n              option !== null &&\n              'column_name' in option &&\n              typeof option.column_name === 'string' &&\n              'type' in option,\n          ),\n        ),\n      ),\n    [sqlKeywords],\n  );\n\n  const selectOptions = useMemo(\n    () =>\n      Object.values(Clauses).map(clause => ({\n        label: clause,\n        value: clause,\n      })),\n    [Clauses],\n  );\n\n  return (\n    <span>\n      <div className=\"filter-edit-clause-section\">\n        <div>\n          <StyledSelect\n            options={selectOptions}\n            ariaLabel={t('Select column')}\n            placeholder={t('choose WHERE or HAVING...')}\n            value={adhocFilter.clause}\n            onChange={onSqlExpressionClauseChange}\n          />\n        </div>\n        <span className=\"filter-edit-clause-info\">\n          <strong>WHERE</strong> {t('Filters by columns')}\n          <br />\n          <strong>HAVING</strong> {t('Filters by metrics')}\n        </span>\n      </div>\n      <div\n        css={css`\n          margin-top: ${theme.gridUnit * 4}px;\n        `}\n      >\n        <SQLEditor\n          ref={aceEditorRef}\n          keywords={keywords}\n          height={`${height - 130}px`}\n          onChange={onSqlExpressionChange}\n          width=\"100%\"\n          showGutter={false}\n          value={adhocFilter.sqlExpression || adhocFilter.translateToSql()}\n          editorProps={{ $blockScrolling: true }}\n          enableLiveAutocompletion\n          className=\"filter-sql-editor\"\n          wrapEnabled\n        />\n      </div>\n    </span>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}